/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/* tslint:disable:no-redundant-jsdoc variable-name no-conditional-assignment no-bitwise */
/**
 * Unique id counter
 * @type {?}
 */
var idCounter = 0;
/**
 * Regex used to split dimensions
 * @type {?}
 */
var unitsSplit = /(-?[0-9.]*[0-9]+[0-9.]*)/g;
/** @type {?} */
var unitsTest = /^-?[0-9.]*[0-9]+[0-9.]*$/g;
/**
 * Attributes used for icon
 * @type {?}
 */
var iconAttributes = ['width', 'height', 'inline', 'hFlip', 'vFlip', 'flip', 'rotate', 'align', 'color', 'box'];
/**
 * Default attribute values
 * @type {?}
 */
var defaultAttributes = {
    left: 0,
    top: 0,
    width: 16,
    height: 16,
    rotate: 0,
    hFlip: false,
    vFlip: false
};
/**
 * Add missing properties to icon
 *
 * Important: in PHP version of this library this function is part of Collection class: Collection::addMissingAttributes()
 *
 * JavaScript version uses separate file so this function could be used in React and other components without loading
 * entire Collection class.
 * @param {?} data
 * @return {?}
 */
export function normalize(data) {
    /** @type {?} */
    var item = Object.assign(Object.create(null), defaultAttributes, data);
    if (item.inlineTop === void 0) {
        item.inlineTop = item.top;
    }
    if (item.inlineHeight === void 0) {
        item.inlineHeight = item.height;
    }
    if (item.verticalAlign === void 0) {
        // -0.143 if icon is designed for 14px height,
        // otherwise assume icon is designed for 16px height
        item.verticalAlign = item.height % 7 === 0 && item.height % 8 !== 0 ? -0.143 : -0.125;
    }
    return item;
}
/**
 * Get preserveAspectRatio attribute value
 * @param {?} align
 * @return {?}
 */
export function getAlignment(align) {
    /** @type {?} */
    var result;
    switch (align.horizontal) {
        case 'left':
            result = 'xMin';
            break;
        case 'right':
            result = 'xMax';
            break;
        default:
            result = 'xMid';
    }
    switch (align.vertical) {
        case 'top':
            result += 'YMin';
            break;
        case 'bottom':
            result += 'YMax';
            break;
        default:
            result += 'YMid';
    }
    result += align.slice ? ' slice' : ' meet';
    return result;
}
/**
 * SVG class
 *
 * @see \@iconify/json-tools/src/svg.js
 */
var /**
 * SVG class
 *
 * @see \@iconify/json-tools/src/svg.js
 */
SVG = /** @class */ (function () {
    /**
     * Constructor
     *
     *  Use Collection.getIconData() to retrieve icon data
     */
    function SVG(_icon) {
        this._icon = _icon;
    }
    /**
     * Calculate second dimension when only 1 dimension is set
     * If size == width, ratio = height/width
     * If size == height, ratio = width/height
     */
    /**
     * Calculate second dimension when only 1 dimension is set
     * If size == width, ratio = height/width
     * If size == height, ratio = width/height
     * @param {?} size
     * @param {?} ratio
     * @param {?=} precision
     * @return {?}
     */
    SVG.calculateDimension = /**
     * Calculate second dimension when only 1 dimension is set
     * If size == width, ratio = height/width
     * If size == height, ratio = width/height
     * @param {?} size
     * @param {?} ratio
     * @param {?=} precision
     * @return {?}
     */
    function (size, ratio, precision) {
        if (precision === void 0) { precision = 100; }
        if (ratio === 1) {
            return size;
        }
        if (typeof size === 'number') {
            return Math.ceil(size * ratio * precision) / precision;
        }
        // split code into sets of strings and numbers
        /** @type {?} */
        var split = size.split(unitsSplit);
        if (split === null || !split.length) {
            return null;
        }
        /** @type {?} */
        var results = [];
        /** @type {?} */
        var code = split.shift();
        /** @type {?} */
        var isNumber = unitsTest.test(code);
        /** @type {?} */
        var num;
        while (true) {
            if (isNumber) {
                num = parseFloat(code);
                if (isNaN(num)) {
                    results.push(code);
                }
                else {
                    results.push(Math.ceil(num * ratio * precision) / precision);
                }
            }
            else {
                results.push(code);
            }
            // next
            code = split.shift();
            if (code === void 0) {
                return results.join('');
            }
            isNumber = !isNumber;
        }
    };
    /**
     * Replace IDs in SVG output with unique IDs
     * Fast replacement without parsing XML, assuming commonly used patterns.
     */
    /**
     * Replace IDs in SVG output with unique IDs
     * Fast replacement without parsing XML, assuming commonly used patterns.
     * @param {?} body
     * @return {?}
     */
    SVG.replaceIDs = /**
     * Replace IDs in SVG output with unique IDs
     * Fast replacement without parsing XML, assuming commonly used patterns.
     * @param {?} body
     * @return {?}
     */
    function (body) {
        /** @type {?} */
        var regex = /\sid="(\S+)"/g;
        /** @type {?} */
        var ids = [];
        /** @type {?} */
        var match;
        /** @type {?} */
        var prefix;
        /**
         * @param {?} search
         * @param {?} replace
         * @param {?} subject
         * @return {?}
         */
        function strReplace(search, replace, subject) {
            /** @type {?} */
            var pos = 0;
            while ((pos = subject.indexOf(search, pos)) !== -1) {
                subject = subject.slice(0, pos) + replace + subject.slice(pos + search.length);
                pos += replace.length;
            }
            return subject;
        }
        // Find all IDs
        while (match = regex.exec(body)) {
            ids.push(match[1]);
        }
        if (!ids.length) {
            return body;
        }
        prefix = 'IconifyId-' + Date.now().toString(16) + '-' + (Math.random() * 0x1000000 | 0).toString(16) + '-';
        // Replace with unique ids
        ids.forEach((/**
         * @param {?} id
         * @return {?}
         */
        function (id) {
            /** @type {?} */
            var newID = prefix + idCounter;
            idCounter++;
            body = strReplace('="' + id + '"', '="' + newID + '"', body);
            body = strReplace('="#' + id + '"', '="#' + newID + '"', body);
            body = strReplace('(#' + id + ')', '(#' + newID + ')', body);
        }));
        return body;
    };
    /**
     * Get SVG attributes
     */
    /**
     * Get SVG attributes
     * @param {?} props
     * @return {?}
     */
    SVG.prototype.getAttributes = /**
     * Get SVG attributes
     * @param {?} props
     * @return {?}
     */
    function (props) {
        /** @type {?} */
        var item = this._icon;
        if (typeof props !== 'object') {
            props = Object.create(null);
        }
        // Set data
        /** @type {?} */
        var align = {
            horizontal: 'center',
            vertical: 'middle',
            slice: false
        };
        /** @type {?} */
        var transform = {
            rotate: item.rotate,
            hFlip: item.hFlip,
            vFlip: item.vFlip
        };
        /** @type {?} */
        var style = Object.create(null);
        /** @type {?} */
        var attributes = Object.create(null);
        // Get width/height
        /** @type {?} */
        var inline = props.inline === true || props.inline === 'true' || props.inline === '1';
        /** @type {?} */
        var box = {
            left: item.left,
            top: inline ? item.inlineTop : item.top,
            width: item.width,
            height: inline ? item.inlineHeight : item.height
        };
        // Transformations
        ['hFlip', 'vFlip'].forEach((/**
         * @param {?} key
         * @return {?}
         */
        function (key) {
            if (props[key] !== void 0 && (props[key] === true || props[key] === 'true' || props[key] === '1')) {
                transform[key] = !transform[key];
            }
        }));
        if (props.flip !== void 0) {
            props.flip.toLowerCase().split(/[\s,]+/).forEach((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                switch (value) {
                    case 'horizontal':
                        transform.hFlip = !transform.hFlip;
                        break;
                    case 'vertical':
                        transform.vFlip = !transform.vFlip;
                }
            }));
        }
        if (props.rotate !== void 0) {
            /** @type {?} */
            var value = props.rotate;
            if (typeof value === 'number') {
                transform.rotate += value;
            }
            else if (typeof value === 'string') {
                /** @type {?} */
                var units = value.replace(/^-?[0-9.]*/, '');
                if (units === '') {
                    value = parseInt(value, 10);
                    if (!isNaN(value)) {
                        transform.rotate += value;
                    }
                }
                else if (units !== value) {
                    /** @type {?} */
                    var split = false;
                    switch (units) {
                        case '%':
                            // 25% -> 1, 50% -> 2, ...
                            split = 25;
                            break;
                        case 'deg':
                            // 90deg -> 1, 180deg -> 2, ...
                            split = 90;
                    }
                    if (split) {
                        value = parseInt(value.slice(0, value.length - units.length), 10);
                        if (!isNaN(value)) {
                            transform.rotate += Math.round(value / split);
                        }
                    }
                }
            }
        }
        // Apply transformations to box
        /** @type {?} */
        var transformations = [];
        /** @type {?} */
        var tempValue;
        if (transform.hFlip) {
            if (transform.vFlip) {
                transform.rotate += 2;
            }
            else {
                // Horizontal flip
                transformations.push('translate(' + (box.width + box.left) + ' ' + (0 - box.top) + ')');
                transformations.push('scale(-1 1)');
                box.top = box.left = 0;
            }
        }
        else if (transform.vFlip) {
            // Vertical flip
            transformations.push('translate(' + (0 - box.left) + ' ' + (box.height + box.top) + ')');
            transformations.push('scale(1 -1)');
            box.top = box.left = 0;
        }
        switch (transform.rotate % 4) {
            case 1:
                // 90deg
                tempValue = box.height / 2 + box.top;
                transformations.unshift('rotate(90 ' + tempValue + ' ' + tempValue + ')');
                // swap width/height and x/y
                if (box.left !== 0 || box.top !== 0) {
                    tempValue = box.left;
                    box.left = box.top;
                    box.top = tempValue;
                }
                if (box.width !== box.height) {
                    tempValue = box.width;
                    box.width = box.height;
                    box.height = tempValue;
                }
                break;
            case 2:
                // 180deg
                transformations.unshift('rotate(180 ' + (box.width / 2 + box.left) + ' ' + (box.height / 2 + box.top) + ')');
                break;
            case 3:
                // 270deg
                tempValue = box.width / 2 + box.left;
                transformations.unshift('rotate(-90 ' + tempValue + ' ' + tempValue + ')');
                // swap width/height and x/y
                if (box.left !== 0 || box.top !== 0) {
                    tempValue = box.left;
                    box.left = box.top;
                    box.top = tempValue;
                }
                if (box.width !== box.height) {
                    tempValue = box.width;
                    box.width = box.height;
                    box.height = tempValue;
                }
                break;
        }
        // Calculate dimensions
        // Values for width/height: null = default, 'auto' = from svg, false = do not set
        // Default: if both values aren't set, height defaults to '1em', width is calculated from height
        /** @type {?} */
        var customWidth = props.width ? props.width : null;
        /** @type {?} */
        var customHeight = props.height ? props.height : null;
        /** @type {?} */
        var width;
        /** @type {?} */
        var height;
        if (customWidth === null && customHeight === null) {
            customHeight = '1em';
        }
        if (customWidth !== null && customHeight !== null) {
            width = customWidth;
            height = customHeight;
        }
        else if (customWidth !== null) {
            width = customWidth;
            height = SVG.calculateDimension(width, box.height / box.width);
        }
        else {
            height = customHeight;
            width = SVG.calculateDimension(height, box.width / box.height);
        }
        if (width !== false) {
            attributes.width = width === 'auto' ? box.width : width;
        }
        if (height !== false) {
            attributes.height = height === 'auto' ? box.height : height;
        }
        // Add vertical-align for inline icon
        if (inline && item.verticalAlign !== 0) {
            style['vertical-align'] = item.verticalAlign + 'em';
        }
        // Check custom alignment
        if (props.align !== void 0) {
            props.align.toLowerCase().split(/[\s,]+/).forEach((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                switch (value) {
                    case 'left':
                    case 'right':
                    case 'center':
                        align.horizontal = value;
                        break;
                    case 'top':
                    case 'bottom':
                    case 'middle':
                        align.vertical = value;
                        break;
                    case 'crop':
                        align.slice = true;
                        break;
                    case 'meet':
                        align.slice = false;
                }
            }));
        }
        // Generate viewBox and preserveAspectRatio attributes
        attributes.preserveAspectRatio = getAlignment(align);
        attributes.viewBox = box.left + ' ' + box.top + ' ' + box.width + ' ' + box.height;
        // Generate body
        /** @type {?} */
        var body = SVG.replaceIDs(item.body);
        if (props.color !== void 0) {
            body = body.replace(/currentColor/g, props.color);
        }
        if (transformations.length) {
            body = '<g transform="' + transformations.join(' ') + '">' + body + '</g>';
        }
        if (props.box === true || props.box === 'true' || props.box === '1') {
            // Add transparent bounding box
            // tslint:disable-next-line:max-line-length
            body += '<rect x="' + box.left + '" y="' + box.top + '" width="' + box.width + '" height="' + box.height + '" fill="rgba(0, 0, 0, 0)" />';
        }
        return {
            attributes: attributes,
            body: body,
            style: style
        };
    };
    /**
     * Generate SVG
     */
    /**
     * Generate SVG
     * @param {?} attributes
     * @return {?}
     */
    SVG.prototype.getSVG = /**
     * Generate SVG
     * @param {?} attributes
     * @return {?}
     */
    function (attributes) {
        /** @type {?} */
        var data = this.getAttributes(attributes);
        /** @type {?} */
        var svg = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"';
        // Add SVG attributes
        Object.keys(data.attributes).forEach((/**
         * @param {?} attr
         * @return {?}
         */
        function (attr) {
            svg += ' ' + attr + '="' + data.attributes[attr] + '"';
        }));
        // Add style with 360deg transformation to style to prevent subpixel rendering bug
        svg += ' style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);';
        Object.keys(data.style).forEach((/**
         * @param {?} attr
         * @return {?}
         */
        function (attr) {
            svg += ' ' + attr + ': ' + data.style[attr] + ';';
        }));
        svg += '">';
        svg += data.body + '</svg>';
        return svg;
    };
    return SVG;
}());
/**
 * SVG class
 *
 * @see \@iconify/json-tools/src/svg.js
 */
export { SVG };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SVG.prototype._icon;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ZnLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZpc3VyZWwvaWNvbmlmeS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL3N2Zy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7SUFPSSxTQUFTLEdBQUcsQ0FBQzs7Ozs7SUFLWCxVQUFVLEdBQUcsMkJBQTJCOztJQUN4QyxTQUFTLEdBQUcsMkJBQTJCOzs7OztJQUt2QyxjQUFjLEdBQUcsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUM7Ozs7O0lBSzNHLGlCQUFpQixHQUFHO0lBQ3hCLElBQUksRUFBRSxDQUFDO0lBQ1AsR0FBRyxFQUFFLENBQUM7SUFDTixLQUFLLEVBQUUsRUFBRTtJQUNULE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLENBQUM7SUFDVCxLQUFLLEVBQUUsS0FBSztJQUNaLEtBQUssRUFBRSxLQUFLO0NBQ2I7Ozs7Ozs7Ozs7O0FBVUQsTUFBTSxVQUFVLFNBQVMsQ0FBQyxJQUFZOztRQUM5QixJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLGlCQUFpQixFQUFFLElBQUksQ0FBQztJQUN4RSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssS0FBSyxDQUFDLEVBQUU7UUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0tBQzNCO0lBQ0QsSUFBSSxJQUFJLENBQUMsWUFBWSxLQUFLLEtBQUssQ0FBQyxFQUFFO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztLQUNqQztJQUNELElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxLQUFLLENBQUMsRUFBRTtRQUNqQyw4Q0FBOEM7UUFDOUMsb0RBQW9EO1FBQ3BE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bGludDpkaXNhYmxlOm5vLXJlZHVuZGFudC1qc2RvYyB2YXJpYWJsZS1uYW1lIG5vLWNvbmRpdGlvbmFsLWFzc2lnbm1lbnQgbm8tYml0d2lzZSAqL1xyXG5cclxuaW1wb3J0IHsgSWNvblByb3BzIH0gZnJvbSAnLi9pY29uLXByb3BzLmludGVyZmFjZSc7XHJcblxyXG4vKipcclxuICogVW5pcXVlIGlkIGNvdW50ZXJcclxuICovXHJcbmxldCBpZENvdW50ZXIgPSAwO1xyXG5cclxuLyoqXHJcbiAqIFJlZ2V4IHVzZWQgdG8gc3BsaXQgZGltZW5zaW9uc1xyXG4gKi9cclxuY29uc3QgdW5pdHNTcGxpdCA9IC8oLT9bMC05Ll0qWzAtOV0rWzAtOS5dKikvZztcclxuY29uc3QgdW5pdHNUZXN0ID0gL14tP1swLTkuXSpbMC05XStbMC05Ll0qJC9nO1xyXG5cclxuLyoqXHJcbiAqIEF0dHJpYnV0ZXMgdXNlZCBmb3IgaWNvblxyXG4gKi9cclxuY29uc3QgaWNvbkF0dHJpYnV0ZXMgPSBbJ3dpZHRoJywgJ2hlaWdodCcsICdpbmxpbmUnLCAnaEZsaXAnLCAndkZsaXAnLCAnZmxpcCcsICdyb3RhdGUnLCAnYWxpZ24nLCAnY29sb3InLCAnYm94J107XHJcblxyXG4vKipcclxuICogRGVmYXVsdCBhdHRyaWJ1dGUgdmFsdWVzXHJcbiAqL1xyXG5jb25zdCBkZWZhdWx0QXR0cmlidXRlcyA9IHtcclxuICBsZWZ0OiAwLFxyXG4gIHRvcDogMCxcclxuICB3aWR0aDogMTYsXHJcbiAgaGVpZ2h0OiAxNixcclxuICByb3RhdGU6IDAsXHJcbiAgaEZsaXA6IGZhbHNlLFxyXG4gIHZGbGlwOiBmYWxzZVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCBtaXNzaW5nIHByb3BlcnRpZXMgdG8gaWNvblxyXG4gKlxyXG4gKiBJbXBvcnRhbnQ6IGluIFBIUCB2ZXJzaW9uIG9mIHRoaXMgbGlicmFyeSB0aGlzIGZ1bmN0aW9uIGlzIHBhcnQgb2YgQ29sbGVjdGlvbiBjbGFzczogQ29sbGVjdGlvbjo6YWRkTWlzc2luZ0F0dHJpYnV0ZXMoKVxyXG4gKlxyXG4gKiBKYXZhU2NyaXB0IHZlcnNpb24gdXNlcyBzZXBhcmF0ZSBmaWxlIHNvIHRoaXMgZnVuY3Rpb24gY291bGQgYmUgdXNlZCBpbiBSZWFjdCBhbmQgb3RoZXIgY29tcG9uZW50cyB3aXRob3V0IGxvYWRpbmdcclxuICogZW50aXJlIENvbGxlY3Rpb24gY2xhc3MuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplKGRhdGE6IG9iamVjdCk6IG9iamVjdCB7XHJcbiAgY29uc3QgaXRlbSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgZGVmYXVsdEF0dHJpYnV0ZXMsIGRhdGEpO1xyXG4gIGlmIChpdGVtLmlubGluZVRvcCA9PT0gdm9pZCAwKSB7XHJcbiAgICBpdGVtLmlubGluZVRvcCA9IGl0ZW0udG9wO1xyXG4gIH1cclxuICBpZiAoaXRlbS5pbmxpbmVIZWlnaHQgPT09IHZvaWQgMCkge1xyXG4gICAgaXRlbS5pbmxpbmVIZWlnaHQgPSBpdGVtLmhlaWdodDtcclxuICB9XHJcbiAgaWYgKGl0ZW0udmVydGljYWxBbGlnbiA9PT0gdm9pZCAwKSB7XHJcbiAgICAvLyAtMC4xNDMgaWYgaWNvbiBpcyBkZXNpZ25lZCBmb3IgMTRweCBoZWlnaHQsXHJcbiAgICAvLyBvdGhlcndpc2UgYXNzdW1lIGljb24gaXMgZGVzaWduZWQgZm9yIDE2cHggaGVpZ2h0XHJcbiAgICBpdGVtLnZlcnRpY2FsQWxpZ24gPSBpdGVtLmhlaWdodCAlIDcgPT09IDAgJiYgaXRlbS5oZWlnaHQgJSA4ICE9PSAwID8gLTAuMTQzIDogLTAuMTI1O1xyXG4gIH1cclxuICByZXR1cm4gaXRlbTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBwcmVzZXJ2ZUFzcGVjdFJhdGlvIGF0dHJpYnV0ZSB2YWx1ZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFsaWdubWVudChhbGlnbjogeyBob3Jpem9udGFsOiBzdHJpbmc7IHZlcnRpY2FsOiBzdHJpbmc7IHNsaWNlOiBib29sZWFuIH0pOiBzdHJpbmcge1xyXG4gIGxldCByZXN1bHQ7XHJcbiAgc3dpdGNoIChhbGlnbi5ob3Jpem9udGFsKSB7XHJcbiAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgcmVzdWx0ID0gJ3hNaW4nO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgIHJlc3VsdCA9ICd4TWF4JztcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmVzdWx0ID0gJ3hNaWQnO1xyXG4gIH1cclxuICBzd2l0Y2ggKGFsaWduLnZlcnRpY2FsKSB7XHJcbiAgICBjYXNlICd0b3AnOlxyXG4gICAgICByZXN1bHQgKz0gJ1lNaW4nO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICByZXN1bHQgKz0gJ1lNYXgnO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXN1bHQgKz0gJ1lNaWQnO1xyXG4gIH1cclxuICByZXN1bHQgKz0gYWxpZ24uc2xpY2UgPyAnIHNsaWNlJyA6ICcgbWVldCc7XHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNWRyBjbGFzc1xyXG4gKlxyXG4gKiBAc2VlIEBpY29uaWZ5L2pzb24tdG9vbHMvc3JjL3N2Zy5qc1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNWRyB7XHJcbiAgLyoqXHJcbiAgICogQ29uc3RydWN0b3JcclxuICAgKlxyXG4gICAqICBVc2UgQ29sbGVjdGlvbi5nZXRJY29uRGF0YSgpIHRvIHJldHJpZXZlIGljb24gZGF0YVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2ljb24pIHt9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBzZWNvbmQgZGltZW5zaW9uIHdoZW4gb25seSAxIGRpbWVuc2lvbiBpcyBzZXRcclxuICAgKiBJZiBzaXplID09IHdpZHRoLCByYXRpbyA9IGhlaWdodC93aWR0aFxyXG4gICAqIElmIHNpemUgPT0gaGVpZ2h0LCByYXRpbyA9IHdpZHRoL2hlaWdodFxyXG4gICAqL1xyXG4gIHN0YXRpYyBjYWxjdWxhdGVEaW1lbnNpb24oc2l6ZTogc3RyaW5nIHwgbnVtYmVyLCByYXRpbzogbnVtYmVyLCBwcmVjaXNpb24gPSAxMDApOiBzdHJpbmcgfCBudW1iZXIgfCBudWxsIHtcclxuICAgIGlmIChyYXRpbyA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gc2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodHlwZW9mIHNpemUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgIHJldHVybiBNYXRoLmNlaWwoc2l6ZSAqIHJhdGlvICogcHJlY2lzaW9uKSAvIHByZWNpc2lvbjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzcGxpdCBjb2RlIGludG8gc2V0cyBvZiBzdHJpbmdzIGFuZCBudW1iZXJzXHJcbiAgICBjb25zdCBzcGxpdCA9IHNpemUuc3BsaXQodW5pdHNTcGxpdCk7XHJcbiAgICBpZiAoc3BsaXQgPT09IG51bGwgfHwgIXNwbGl0Lmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuICAgIGxldCBjb2RlID0gc3BsaXQuc2hpZnQoKTtcclxuICAgIGxldCBpc051bWJlciA9IHVuaXRzVGVzdC50ZXN0KGNvZGUpO1xyXG4gICAgbGV0IG51bTtcclxuXHJcbiAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICBpZiAoaXNOdW1iZXIpIHtcclxuICAgICAgICBudW0gPSBwYXJzZUZsb2F0KGNvZGUpO1xyXG4gICAgICAgIGlmIChpc05hTihudW0pKSB7XHJcbiAgICAgICAgICByZXN1bHRzLnB1c2goY29kZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlc3VsdHMucHVzaChNYXRoLmNlaWwobnVtICogcmF0aW8gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0cy5wdXNoKGNvZGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBuZXh0XHJcbiAgICAgIGNvZGUgPSBzcGxpdC5zaGlmdCgpO1xyXG4gICAgICBpZiAoY29kZSA9PT0gdm9pZCAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHMuam9pbignJyk7XHJcbiAgICAgIH1cclxuICAgICAgaXNOdW1iZXIgPSAhaXNOdW1iZXI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXBsYWNlIElEcyBpbiBTVkcgb3V0cHV0IHdpdGggdW5pcXVlIElEc1xyXG4gICAqIEZhc3QgcmVwbGFjZW1lbnQgd2l0aG91dCBwYXJzaW5nIFhNTCwgYXNzdW1pbmcgY29tbW9ubHkgdXNlZCBwYXR0ZXJucy5cclxuICAgKi9cclxuICBzdGF0aWMgcmVwbGFjZUlEcyhib2R5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgcmVnZXggPSAvXFxzaWQ9XCIoXFxTKylcIi9nO1xyXG4gICAgY29uc3QgaWRzID0gW107XHJcbiAgICBsZXQgbWF0Y2g6IFJlZ0V4cEV4ZWNBcnJheTtcclxuICAgIGxldCBwcmVmaXg6IHN0cmluZztcclxuXHJcbiAgICBmdW5jdGlvbiBzdHJSZXBsYWNlKHNlYXJjaCwgcmVwbGFjZSwgc3ViamVjdCkge1xyXG4gICAgICBsZXQgcG9zID0gMDtcclxuXHJcbiAgICAgIHdoaWxlICgocG9zID0gc3ViamVjdC5pbmRleE9mKHNlYXJjaCwgcG9zKSkgIT09IC0xKSB7XHJcbiAgICAgICAgc3ViamVjdCA9IHN1YmplY3Quc2xpY2UoMCwgcG9zKSArIHJlcGxhY2UgKyBzdWJqZWN0LnNsaWNlKHBvcyArIHNlYXJjaC5sZW5ndGgpO1xyXG4gICAgICAgIHBvcyArPSByZXBsYWNlLmxlbmd0aDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHN1YmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmluZCBhbGwgSURzXHJcbiAgICB3aGlsZSAobWF0Y2ggPSByZWdleC5leGVjKGJvZHkpKSB7XHJcbiAgICAgIGlkcy5wdXNoKG1hdGNoWzFdKTtcclxuICAgIH1cclxuICAgIGlmICghaWRzLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm4gYm9keTtcclxuICAgIH1cclxuXHJcbiAgICBwcmVmaXggPSAnSWNvbmlmeUlkLScgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDE2KSArICctJyArIChNYXRoLnJhbmRvbSgpICogMHgxMDAwMDAwIHwgMCkudG9TdHJpbmcoMTYpICsgJy0nO1xyXG5cclxuICAgIC8vIFJlcGxhY2Ugd2l0aCB1bmlxdWUgaWRzXHJcbiAgICBpZHMuZm9yRWFjaCgoaWQpID0+IHtcclxuICAgICAgY29uc3QgbmV3SUQgPSBwcmVmaXggKyBpZENvdW50ZXI7XHJcbiAgICAgIGlkQ291bnRlcisrO1xyXG4gICAgICBib2R5ID0gc3RyUmVwbGFjZSgnPVwiJyArIGlkICsgJ1wiJywgJz1cIicgKyBuZXdJRCArICdcIicsIGJvZHkpO1xyXG4gICAgICBib2R5ID0gc3RyUmVwbGFjZSgnPVwiIycgKyBpZCArICdcIicsICc9XCIjJyArIG5ld0lEICsgJ1wiJywgYm9keSk7XHJcbiAgICAgIGJvZHkgPSBzdHJSZXBsYWNlKCcoIycgKyBpZCArICcpJywgJygjJyArIG5ld0lEICsgJyknLCBib2R5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBib2R5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IFNWRyBhdHRyaWJ1dGVzXHJcbiAgICovXHJcbiAgZ2V0QXR0cmlidXRlcyhwcm9wczogSWNvblByb3BzKSB7XHJcbiAgICBjb25zdCBpdGVtID0gdGhpcy5faWNvbjtcclxuICAgIGlmICh0eXBlb2YgcHJvcHMgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgIHByb3BzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgZGF0YVxyXG4gICAgY29uc3QgYWxpZ24gPSB7XHJcbiAgICAgIGhvcml6b250YWw6ICdjZW50ZXInLFxyXG4gICAgICB2ZXJ0aWNhbDogJ21pZGRsZScsXHJcbiAgICAgIHNsaWNlOiBmYWxzZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHRyYW5zZm9ybSA9IHtcclxuICAgICAgcm90YXRlOiBpdGVtLnJvdGF0ZSxcclxuICAgICAgaEZsaXA6IGl0ZW0uaEZsaXAsXHJcbiAgICAgIHZGbGlwOiBpdGVtLnZGbGlwXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG5cclxuICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG5cclxuICAgIC8vIEdldCB3aWR0aC9oZWlnaHRcclxuICAgIGNvbnN0IGlubGluZSA9IHByb3BzLmlubGluZSA9PT0gdHJ1ZSB8fCBwcm9wcy5pbmxpbmUgPT09ICd0cnVlJyB8fCBwcm9wcy5pbmxpbmUgPT09ICcxJztcclxuXHJcbiAgICBjb25zdCBib3ggPSB7XHJcbiAgICAgIGxlZnQ6IGl0ZW0ubGVmdCxcclxuICAgICAgdG9wOiBpbmxpbmUgPyBpdGVtLmlubGluZVRvcCA6IGl0ZW0udG9wLFxyXG4gICAgICB3aWR0aDogaXRlbS53aWR0aCxcclxuICAgICAgaGVpZ2h0OiBpbmxpbmUgPyBpdGVtLmlubGluZUhlaWdodCA6IGl0ZW0uaGVpZ2h0XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFRyYW5zZm9ybWF0aW9uc1xyXG4gICAgWydoRmxpcCcsICd2RmxpcCddLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgaWYgKHByb3BzW2tleV0gIT09IHZvaWQgMCAmJiAocHJvcHNba2V5XSA9PT0gdHJ1ZSB8fCBwcm9wc1trZXldID09PSAndHJ1ZScgfHwgcHJvcHNba2V5XSA9PT0gJzEnKSkge1xyXG4gICAgICAgIHRyYW5zZm9ybVtrZXldID0gIXRyYW5zZm9ybVtrZXldO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmIChwcm9wcy5mbGlwICE9PSB2b2lkIDApIHtcclxuICAgICAgcHJvcHMuZmxpcC50b0xvd2VyQ2FzZSgpLnNwbGl0KC9bXFxzLF0rLykuZm9yRWFjaCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xyXG4gICAgICAgICAgY2FzZSAnaG9yaXpvbnRhbCc6XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybS5oRmxpcCA9ICF0cmFuc2Zvcm0uaEZsaXA7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgJ3ZlcnRpY2FsJzpcclxuICAgICAgICAgICAgdHJhbnNmb3JtLnZGbGlwID0gIXRyYW5zZm9ybS52RmxpcDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHByb3BzLnJvdGF0ZSAhPT0gdm9pZCAwKSB7XHJcbiAgICAgIGxldCB2YWx1ZSA9IHByb3BzLnJvdGF0ZTtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICB0cmFuc2Zvcm0ucm90YXRlICs9IHZhbHVlO1xyXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBjb25zdCB1bml0cyA9IHZhbHVlLnJlcGxhY2UoL14tP1swLTkuXSovLCAnJyk7XHJcbiAgICAgICAgaWYgKHVuaXRzID09PSAnJykge1xyXG4gICAgICAgICAgdmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xyXG4gICAgICAgICAgaWYgKCFpc05hTih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgdHJhbnNmb3JtLnJvdGF0ZSArPSB2YWx1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHVuaXRzICE9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgbGV0IHNwbGl0OiBib29sZWFuIHwgbnVtYmVyID0gZmFsc2U7XHJcbiAgICAgICAgICBzd2l0Y2ggKHVuaXRzKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJyUnOlxyXG4gICAgICAgICAgICAgIC8vIDI1JSAtPiAxLCA1MCUgLT4gMiwgLi4uXHJcbiAgICAgICAgICAgICAgc3BsaXQgPSAyNTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2RlZyc6XHJcbiAgICAgICAgICAgICAgLy8gOTBkZWcgLT4gMSwgMTgwZGVnIC0+IDIsIC4uLlxyXG4gICAgICAgICAgICAgIHNwbGl0ID0gOTA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoc3BsaXQpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUludCh2YWx1ZS5zbGljZSgwLCB2YWx1ZS5sZW5ndGggLSB1bml0cy5sZW5ndGgpLCAxMCk7XHJcbiAgICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgdHJhbnNmb3JtLnJvdGF0ZSArPSBNYXRoLnJvdW5kKHZhbHVlIC8gc3BsaXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQXBwbHkgdHJhbnNmb3JtYXRpb25zIHRvIGJveFxyXG4gICAgY29uc3QgdHJhbnNmb3JtYXRpb25zID0gW107XHJcbiAgICBsZXQgdGVtcFZhbHVlO1xyXG4gICAgaWYgKHRyYW5zZm9ybS5oRmxpcCkge1xyXG4gICAgICBpZiAodHJhbnNmb3JtLnZGbGlwKSB7XHJcbiAgICAgICAgdHJhbnNmb3JtLnJvdGF0ZSArPSAyO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEhvcml6b250YWwgZmxpcFxyXG4gICAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKCd0cmFuc2xhdGUoJyArIChib3gud2lkdGggKyBib3gubGVmdCkgKyAnICcgKyAoMCAtIGJveC50b3ApICsgJyknKTtcclxuICAgICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgnc2NhbGUoLTEgMSknKTtcclxuICAgICAgICBib3gudG9wID0gYm94LmxlZnQgPSAwO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHRyYW5zZm9ybS52RmxpcCkge1xyXG4gICAgICAvLyBWZXJ0aWNhbCBmbGlwXHJcbiAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKCd0cmFuc2xhdGUoJyArICgwIC0gYm94LmxlZnQpICsgJyAnICsgKGJveC5oZWlnaHQgKyBib3gudG9wKSArICcpJyk7XHJcbiAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKCdzY2FsZSgxIC0xKScpO1xyXG4gICAgICBib3gudG9wID0gYm94LmxlZnQgPSAwO1xyXG4gICAgfVxyXG4gICAgc3dpdGNoICh0cmFuc2Zvcm0ucm90YXRlICUgNCkge1xyXG4gICAgICBjYXNlIDE6XHJcbiAgICAgICAgLy8gOTBkZWdcclxuICAgICAgICB0ZW1wVmFsdWUgPSBib3guaGVpZ2h0IC8gMiArIGJveC50b3A7XHJcbiAgICAgICAgdHJhbnNmb3JtYXRpb25zLnVuc2hpZnQoJ3JvdGF0ZSg5MCAnICsgdGVtcFZhbHVlICsgJyAnICsgdGVtcFZhbHVlICsgJyknKTtcclxuICAgICAgICAvLyBzd2FwIHdpZHRoL2hlaWdodCBhbmQgeC95XHJcbiAgICAgICAgaWYgKGJveC5sZWZ0ICE9PSAwIHx8IGJveC50b3AgIT09IDApIHtcclxuICAgICAgICAgIHRlbXBWYWx1ZSA9IGJveC5sZWZ0O1xyXG4gICAgICAgICAgYm94LmxlZnQgPSBib3gudG9wO1xyXG4gICAgICAgICAgYm94LnRvcCA9IHRlbXBWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGJveC53aWR0aCAhPT0gYm94LmhlaWdodCkge1xyXG4gICAgICAgICAgdGVtcFZhbHVlID0gYm94LndpZHRoO1xyXG4gICAgICAgICAgYm94LndpZHRoID0gYm94LmhlaWdodDtcclxuICAgICAgICAgIGJveC5oZWlnaHQgPSB0ZW1wVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgY2FzZSAyOlxyXG4gICAgICAgIC8vIDE4MGRlZ1xyXG4gICAgICAgIHRyYW5zZm9ybWF0aW9ucy51bnNoaWZ0KCdyb3RhdGUoMTgwICcgKyAoYm94LndpZHRoIC8gMiArIGJveC5sZWZ0KSArICcgJyArIChib3guaGVpZ2h0IC8gMiArIGJveC50b3ApICsgJyknKTtcclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMzpcclxuICAgICAgICAvLyAyNzBkZWdcclxuICAgICAgICB0ZW1wVmFsdWUgPSBib3gud2lkdGggLyAyICsgYm94LmxlZnQ7XHJcbiAgICAgICAgdHJhbnNmb3JtYXRpb25zLnVuc2hpZnQoJ3JvdGF0ZSgtOTAgJyArIHRlbXBWYWx1ZSArICcgJyArIHRlbXBWYWx1ZSArICcpJyk7XHJcbiAgICAgICAgLy8gc3dhcCB3aWR0aC9oZWlnaHQgYW5kIHgveVxyXG4gICAgICAgIGlmIChib3gubGVmdCAhPT0gMCB8fCBib3gudG9wICE9PSAwKSB7XHJcbiAgICAgICAgICB0ZW1wVmFsdWUgPSBib3gubGVmdDtcclxuICAgICAgICAgIGJveC5sZWZ0ID0gYm94LnRvcDtcclxuICAgICAgICAgIGJveC50b3AgPSB0ZW1wVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChib3gud2lkdGggIT09IGJveC5oZWlnaHQpIHtcclxuICAgICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aDtcclxuICAgICAgICAgIGJveC53aWR0aCA9IGJveC5oZWlnaHQ7XHJcbiAgICAgICAgICBib3guaGVpZ2h0ID0gdGVtcFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgZGltZW5zaW9uc1xyXG4gICAgLy8gVmFsdWVzIGZvciB3aWR0aC9oZWlnaHQ6IG51bGwgPSBkZWZhdWx0LCAnYXV0bycgPSBmcm9tIHN2ZywgZmFsc2UgPSBkbyBub3Qgc2V0XHJcbiAgICAvLyBEZWZhdWx0OiBpZiBib3RoIHZhbHVlcyBhcmVuJ3Qgc2V0LCBoZWlnaHQgZGVmYXVsdHMgdG8gJzFlbScsIHdpZHRoIGlzIGNhbGN1bGF0ZWQgZnJvbSBoZWlnaHRcclxuICAgIGNvbnN0IGN1c3RvbVdpZHRoID0gcHJvcHMud2lkdGggPyBwcm9wcy53aWR0aCA6IG51bGw7XHJcbiAgICBsZXQgY3VzdG9tSGVpZ2h0ID0gcHJvcHMuaGVpZ2h0ID8gcHJvcHMuaGVpZ2h0IDogbnVsbDtcclxuXHJcbiAgICBsZXQgd2lkdGg7XHJcbiAgICBsZXQgaGVpZ2h0O1xyXG4gICAgaWYgKGN1c3RvbVdpZHRoID09PSBudWxsICYmIGN1c3RvbUhlaWdodCA9PT0gbnVsbCkge1xyXG4gICAgICBjdXN0b21IZWlnaHQgPSAnMWVtJztcclxuICAgIH1cclxuICAgIGlmIChjdXN0b21XaWR0aCAhPT0gbnVsbCAmJiBjdXN0b21IZWlnaHQgIT09IG51bGwpIHtcclxuICAgICAgd2lkdGggPSBjdXN0b21XaWR0aDtcclxuICAgICAgaGVpZ2h0ID0gY3VzdG9tSGVpZ2h0O1xyXG4gICAgfSBlbHNlIGlmIChjdXN0b21XaWR0aCAhPT0gbnVsbCkge1xyXG4gICAgICB3aWR0aCA9IGN1c3RvbVdpZHRoO1xyXG4gICAgICBoZWlnaHQgPSBTVkcuY2FsY3VsYXRlRGltZW5zaW9uKHdpZHRoLCBib3guaGVpZ2h0IC8gYm94LndpZHRoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGhlaWdodCA9IGN1c3RvbUhlaWdodDtcclxuICAgICAgd2lkdGggPSBTVkcuY2FsY3VsYXRlRGltZW5zaW9uKGhlaWdodCwgYm94LndpZHRoIC8gYm94LmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHdpZHRoICE9PSBmYWxzZSkge1xyXG4gICAgICBhdHRyaWJ1dGVzLndpZHRoID0gd2lkdGggPT09ICdhdXRvJyA/IGJveC53aWR0aCA6IHdpZHRoO1xyXG4gICAgfVxyXG4gICAgaWYgKGhlaWdodCAhPT0gZmFsc2UpIHtcclxuICAgICAgYXR0cmlidXRlcy5oZWlnaHQgPSBoZWlnaHQgPT09ICdhdXRvJyA/IGJveC5oZWlnaHQgOiBoZWlnaHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQWRkIHZlcnRpY2FsLWFsaWduIGZvciBpbmxpbmUgaWNvblxyXG4gICAgaWYgKGlubGluZSAmJiBpdGVtLnZlcnRpY2FsQWxpZ24gIT09IDApIHtcclxuICAgICAgc3R5bGVbJ3ZlcnRpY2FsLWFsaWduJ10gPSBpdGVtLnZlcnRpY2FsQWxpZ24gKyAnZW0nO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGN1c3RvbSBhbGlnbm1lbnRcclxuICAgIGlmIChwcm9wcy5hbGlnbiAhPT0gdm9pZCAwKSB7XHJcbiAgICAgIHByb3BzLmFsaWduLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1tcXHMsXSsvKS5mb3JFYWNoKHZhbHVlID0+IHtcclxuICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7XHJcbiAgICAgICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgIGNhc2UgJ2NlbnRlcic6XHJcbiAgICAgICAgICAgIGFsaWduLmhvcml6b250YWwgPSB2YWx1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgICBjYXNlICdtaWRkbGUnOlxyXG4gICAgICAgICAgICBhbGlnbi52ZXJ0aWNhbCA9IHZhbHVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlICdjcm9wJzpcclxuICAgICAgICAgICAgYWxpZ24uc2xpY2UgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlICdtZWV0JzpcclxuICAgICAgICAgICAgYWxpZ24uc2xpY2UgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdlbmVyYXRlIHZpZXdCb3ggYW5kIHByZXNlcnZlQXNwZWN0UmF0aW8gYXR0cmlidXRlc1xyXG4gICAgYXR0cmlidXRlcy5wcmVzZXJ2ZUFzcGVjdFJhdGlvID0gZ2V0QWxpZ25tZW50KGFsaWduKTtcclxuICAgIGF0dHJpYnV0ZXMudmlld0JveCA9IGJveC5sZWZ0ICsgJyAnICsgYm94LnRvcCArICcgJyArIGJveC53aWR0aCArICcgJyArIGJveC5oZWlnaHQ7XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYm9keVxyXG4gICAgbGV0IGJvZHkgPSBTVkcucmVwbGFjZUlEcyhpdGVtLmJvZHkpO1xyXG5cclxuICAgIGlmIChwcm9wcy5jb2xvciAhPT0gdm9pZCAwKSB7XHJcbiAgICAgIGJvZHkgPSBib2R5LnJlcGxhY2UoL2N1cnJlbnRDb2xvci9nLCBwcm9wcy5jb2xvcik7XHJcbiAgICB9XHJcbiAgICBpZiAodHJhbnNmb3JtYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICBib2R5ID0gJzxnIHRyYW5zZm9ybT1cIicgKyB0cmFuc2Zvcm1hdGlvbnMuam9pbignICcpICsgJ1wiPicgKyBib2R5ICsgJzwvZz4nO1xyXG4gICAgfVxyXG4gICAgaWYgKHByb3BzLmJveCA9PT0gdHJ1ZSB8fCBwcm9wcy5ib3ggPT09ICd0cnVlJyB8fCBwcm9wcy5ib3ggPT09ICcxJykge1xyXG4gICAgICAvLyBBZGQgdHJhbnNwYXJlbnQgYm91bmRpbmcgYm94XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgICAgYm9keSArPSAnPHJlY3QgeD1cIicgKyBib3gubGVmdCArICdcIiB5PVwiJyArIGJveC50b3AgKyAnXCIgd2lkdGg9XCInICsgYm94LndpZHRoICsgJ1wiIGhlaWdodD1cIicgKyBib3guaGVpZ2h0ICsgJ1wiIGZpbGw9XCJyZ2JhKDAsIDAsIDAsIDApXCIgLz4nO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGF0dHJpYnV0ZXMsXHJcbiAgICAgIGJvZHksXHJcbiAgICAgIHN0eWxlXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgU1ZHXHJcbiAgICovXHJcbiAgZ2V0U1ZHKGF0dHJpYnV0ZXM6IEljb25Qcm9wcykge1xyXG4gICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0QXR0cmlidXRlcyhhdHRyaWJ1dGVzKTtcclxuXHJcbiAgICBsZXQgc3ZnID0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiJztcclxuXHJcbiAgICAvLyBBZGQgU1ZHIGF0dHJpYnV0ZXNcclxuICAgIE9iamVjdC5rZXlzKGRhdGEuYXR0cmlidXRlcykuZm9yRWFjaChhdHRyID0+IHtcclxuICAgICAgc3ZnICs9ICcgJyArIGF0dHIgKyAnPVwiJyArIGRhdGEuYXR0cmlidXRlc1thdHRyXSArICdcIic7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBZGQgc3R5bGUgd2l0aCAzNjBkZWcgdHJhbnNmb3JtYXRpb24gdG8gc3R5bGUgdG8gcHJldmVudCBzdWJwaXhlbCByZW5kZXJpbmcgYnVnXHJcbiAgICBzdmcgKz0gJyBzdHlsZT1cIi1tcy10cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7JztcclxuICAgIE9iamVjdC5rZXlzKGRhdGEuc3R5bGUpLmZvckVhY2goYXR0ciA9PiB7XHJcbiAgICAgIHN2ZyArPSAnICcgKyBhdHRyICsgJzogJyArIGRhdGEuc3R5bGVbYXR0cl0gKyAnOyc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBzdmcgKz0gJ1wiPic7XHJcblxyXG4gICAgc3ZnICs9IGRhdGEuYm9keSArICc8L3N2Zz4nO1xyXG5cclxuICAgIHJldHVybiBzdmc7XHJcbiAgfVxyXG59XHJcbiJdfQ==