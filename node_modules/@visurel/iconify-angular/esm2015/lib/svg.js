/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/* tslint:disable:no-redundant-jsdoc variable-name no-conditional-assignment no-bitwise */
/**
 * Unique id counter
 * @type {?}
 */
let idCounter = 0;
/**
 * Regex used to split dimensions
 * @type {?}
 */
const unitsSplit = /(-?[0-9.]*[0-9]+[0-9.]*)/g;
/** @type {?} */
const unitsTest = /^-?[0-9.]*[0-9]+[0-9.]*$/g;
/**
 * Attributes used for icon
 * @type {?}
 */
const iconAttributes = ['width', 'height', 'inline', 'hFlip', 'vFlip', 'flip', 'rotate', 'align', 'color', 'box'];
/**
 * Default attribute values
 * @type {?}
 */
const defaultAttributes = {
    left: 0,
    top: 0,
    width: 16,
    height: 16,
    rotate: 0,
    hFlip: false,
    vFlip: false
};
/**
 * Add missing properties to icon
 *
 * Important: in PHP version of this library this function is part of Collection class: Collection::addMissingAttributes()
 *
 * JavaScript version uses separate file so this function could be used in React and other components without loading
 * entire Collection class.
 * @param {?} data
 * @return {?}
 */
export function normalize(data) {
    /** @type {?} */
    const item = Object.assign(Object.create(null), defaultAttributes, data);
    if (item.inlineTop === void 0) {
        item.inlineTop = item.top;
    }
    if (item.inlineHeight === void 0) {
        item.inlineHeight = item.height;
    }
    if (item.verticalAlign === void 0) {
        // -0.143 if icon is designed for 14px height,
        // otherwise assume icon is designed for 16px height
        item.verticalAlign = item.height % 7 === 0 && item.height % 8 !== 0 ? -0.143 : -0.125;
    }
    return item;
}
/**
 * Get preserveAspectRatio attribute value
 * @param {?} align
 * @return {?}
 */
export function getAlignment(align) {
    /** @type {?} */
    let result;
    switch (align.horizontal) {
        case 'left':
            result = 'xMin';
            break;
        case 'right':
            result = 'xMax';
            break;
        default:
            result = 'xMid';
    }
    switch (align.vertical) {
        case 'top':
            result += 'YMin';
            break;
        case 'bottom':
            result += 'YMax';
            break;
        default:
            result += 'YMid';
    }
    result += align.slice ? ' slice' : ' meet';
    return result;
}
/**
 * SVG class
 *
 * @see \@iconify/json-tools/src/svg.js
 */
export class SVG {
    /**
     * Constructor
     *
     *  Use Collection.getIconData() to retrieve icon data
     * @param {?} _icon
     */
    constructor(_icon) {
        this._icon = _icon;
    }
    /**
     * Calculate second dimension when only 1 dimension is set
     * If size == width, ratio = height/width
     * If size == height, ratio = width/height
     * @param {?} size
     * @param {?} ratio
     * @param {?=} precision
     * @return {?}
     */
    static calculateDimension(size, ratio, precision = 100) {
        if (ratio === 1) {
            return size;
        }
        if (typeof size === 'number') {
            return Math.ceil(size * ratio * precision) / precision;
        }
        // split code into sets of strings and numbers
        /** @type {?} */
        const split = size.split(unitsSplit);
        if (split === null || !split.length) {
            return null;
        }
        /** @type {?} */
        const results = [];
        /** @type {?} */
        let code = split.shift();
        /** @type {?} */
        let isNumber = unitsTest.test(code);
        /** @type {?} */
        let num;
        while (true) {
            if (isNumber) {
                num = parseFloat(code);
                if (isNaN(num)) {
                    results.push(code);
                }
                else {
                    results.push(Math.ceil(num * ratio * precision) / precision);
                }
            }
            else {
                results.push(code);
            }
            // next
            code = split.shift();
            if (code === void 0) {
                return results.join('');
            }
            isNumber = !isNumber;
        }
    }
    /**
     * Replace IDs in SVG output with unique IDs
     * Fast replacement without parsing XML, assuming commonly used patterns.
     * @param {?} body
     * @return {?}
     */
    static replaceIDs(body) {
        /** @type {?} */
        const regex = /\sid="(\S+)"/g;
        /** @type {?} */
        const ids = [];
        /** @type {?} */
        let match;
        /** @type {?} */
        let prefix;
        /**
         * @param {?} search
         * @param {?} replace
         * @param {?} subject
         * @return {?}
         */
        function strReplace(search, replace, subject) {
            /** @type {?} */
            let pos = 0;
            while ((pos = subject.indexOf(search, pos)) !== -1) {
                subject = subject.slice(0, pos) + replace + subject.slice(pos + search.length);
                pos += replace.length;
            }
            return subject;
        }
        // Find all IDs
        while (match = regex.exec(body)) {
            ids.push(match[1]);
        }
        if (!ids.length) {
            return body;
        }
        prefix = 'IconifyId-' + Date.now().toString(16) + '-' + (Math.random() * 0x1000000 | 0).toString(16) + '-';
        // Replace with unique ids
        ids.forEach((/**
         * @param {?} id
         * @return {?}
         */
        (id) => {
            /** @type {?} */
            const newID = prefix + idCounter;
            idCounter++;
            body = strReplace('="' + id + '"', '="' + newID + '"', body);
            body = strReplace('="#' + id + '"', '="#' + newID + '"', body);
            body = strReplace('(#' + id + ')', '(#' + newID + ')', body);
        }));
        return body;
    }
    /**
     * Get SVG attributes
     * @param {?} props
     * @return {?}
     */
    getAttributes(props) {
        /** @type {?} */
        const item = this._icon;
        if (typeof props !== 'object') {
            props = Object.create(null);
        }
        // Set data
        /** @type {?} */
        const align = {
            horizontal: 'center',
            vertical: 'middle',
            slice: false
        };
        /** @type {?} */
        const transform = {
            rotate: item.rotate,
            hFlip: item.hFlip,
            vFlip: item.vFlip
        };
        /** @type {?} */
        const style = Object.create(null);
        /** @type {?} */
        const attributes = Object.create(null);
        // Get width/height
        /** @type {?} */
        const inline = props.inline === true || props.inline === 'true' || props.inline === '1';
        /** @type {?} */
        const box = {
            left: item.left,
            top: inline ? item.inlineTop : item.top,
            width: item.width,
            height: inline ? item.inlineHeight : item.height
        };
        // Transformations
        ['hFlip', 'vFlip'].forEach((/**
         * @param {?} key
         * @return {?}
         */
        key => {
            if (props[key] !== void 0 && (props[key] === true || props[key] === 'true' || props[key] === '1')) {
                transform[key] = !transform[key];
            }
        }));
        if (props.flip !== void 0) {
            props.flip.toLowerCase().split(/[\s,]+/).forEach((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                switch (value) {
                    case 'horizontal':
                        transform.hFlip = !transform.hFlip;
                        break;
                    case 'vertical':
                        transform.vFlip = !transform.vFlip;
                }
            }));
        }
        if (props.rotate !== void 0) {
            /** @type {?} */
            let value = props.rotate;
            if (typeof value === 'number') {
                transform.rotate += value;
            }
            else if (typeof value === 'string') {
                /** @type {?} */
                const units = value.replace(/^-?[0-9.]*/, '');
                if (units === '') {
                    value = parseInt(value, 10);
                    if (!isNaN(value)) {
                        transform.rotate += value;
                    }
                }
                else if (units !== value) {
                    /** @type {?} */
                    let split = false;
                    switch (units) {
                        case '%':
                            // 25% -> 1, 50% -> 2, ...
                            split = 25;
                            break;
                        case 'deg':
                            // 90deg -> 1, 180deg -> 2, ...
                            split = 90;
                    }
                    if (split) {
                        value = parseInt(value.slice(0, value.length - units.length), 10);
                        if (!isNaN(value)) {
                            transform.rotate += Math.round(value / split);
                        }
                    }
                }
            }
        }
        // Apply transformations to box
        /** @type {?} */
        const transformations = [];
        /** @type {?} */
        let tempValue;
        if (transform.hFlip) {
            if (transform.vFlip) {
                transform.rotate += 2;
            }
            else {
                // Horizontal flip
                transformations.push('translate(' + (box.width + box.left) + ' ' + (0 - box.top) + ')');
                transformations.push('scale(-1 1)');
                box.top = box.left = 0;
            }
        }
        else if (transform.vFlip) {
            // Vertical flip
            transformations.push('translate(' + (0 - box.left) + ' ' + (box.height + box.top) + ')');
            transformations.push('scale(1 -1)');
            box.top = box.left = 0;
        }
        switch (transform.rotate % 4) {
            case 1:
                // 90deg
                tempValue = box.height / 2 + box.top;
                transformations.unshift('rotate(90 ' + tempValue + ' ' + tempValue + ')');
                // swap width/height and x/y
                if (box.left !== 0 || box.top !== 0) {
                    tempValue = box.left;
                    box.left = box.top;
                    box.top = tempValue;
                }
                if (box.width !== box.height) {
                    tempValue = box.width;
                    box.width = box.height;
                    box.height = tempValue;
                }
                break;
            case 2:
                // 180deg
                transformations.unshift('rotate(180 ' + (box.width / 2 + box.left) + ' ' + (box.height / 2 + box.top) + ')');
                break;
            case 3:
                // 270deg
                tempValue = box.width / 2 + box.left;
                transformations.unshift('rotate(-90 ' + tempValue + ' ' + tempValue + ')');
                // swap width/height and x/y
                if (box.left !== 0 || box.top !== 0) {
                    tempValue = box.left;
                    box.left = box.top;
                    box.top = tempValue;
                }
                if (box.width !== box.height) {
                    tempValue = box.width;
                    box.width = box.height;
                    box.height = tempValue;
                }
                break;
        }
        // Calculate dimensions
        // Values for width/height: null = default, 'auto' = from svg, false = do not set
        // Default: if both values aren't set, height defaults to '1em', width is calculated from height
        /** @type {?} */
        const customWidth = props.width ? props.width : null;
        /** @type {?} */
        let customHeight = props.height ? props.height : null;
        /** @type {?} */
        let width;
        /** @type {?} */
        let height;
        if (customWidth === null && customHeight === null) {
            customHeight = '1em';
        }
        if (customWidth !== null && customHeight !== null) {
            width = customWidth;
            height = customHeight;
        }
        else if (customWidth !== null) {
            width = customWidth;
            height = SVG.calculateDimension(width, box.height / box.width);
        }
        else {
            height = customHeight;
            width = SVG.calculateDimension(height, box.width / box.height);
        }
        if (width !== false) {
            attributes.width = width === 'auto' ? box.width : width;
        }
        if (height !== false) {
            attributes.height = height === 'auto' ? box.height : height;
        }
        // Add vertical-align for inline icon
        if (inline && item.verticalAlign !== 0) {
            style['vertical-align'] = item.verticalAlign + 'em';
        }
        // Check custom alignment
        if (props.align !== void 0) {
            props.align.toLowerCase().split(/[\s,]+/).forEach((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                switch (value) {
                    case 'left':
                    case 'right':
                    case 'center':
                        align.horizontal = value;
                        break;
                    case 'top':
                    case 'bottom':
                    case 'middle':
                        align.vertical = value;
                        break;
                    case 'crop':
                        align.slice = true;
                        break;
                    case 'meet':
                        align.slice = false;
                }
            }));
        }
        // Generate viewBox and preserveAspectRatio attributes
        attributes.preserveAspectRatio = getAlignment(align);
        attributes.viewBox = box.left + ' ' + box.top + ' ' + box.width + ' ' + box.height;
        // Generate body
        /** @type {?} */
        let body = SVG.replaceIDs(item.body);
        if (props.color !== void 0) {
            body = body.replace(/currentColor/g, props.color);
        }
        if (transformations.length) {
            body = '<g transform="' + transformations.join(' ') + '">' + body + '</g>';
        }
        if (props.box === true || props.box === 'true' || props.box === '1') {
            // Add transparent bounding box
            // tslint:disable-next-line:max-line-length
            body += '<rect x="' + box.left + '" y="' + box.top + '" width="' + box.width + '" height="' + box.height + '" fill="rgba(0, 0, 0, 0)" />';
        }
        return {
            attributes,
            body,
            style
        };
    }
    /**
     * Generate SVG
     * @param {?} attributes
     * @return {?}
     */
    getSVG(attributes) {
        /** @type {?} */
        const data = this.getAttributes(attributes);
        /** @type {?} */
        let svg = '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"';
        // Add SVG attributes
        Object.keys(data.attributes).forEach((/**
         * @param {?} attr
         * @return {?}
         */
        attr => {
            svg += ' ' + attr + '="' + data.attributes[attr] + '"';
        }));
        // Add style with 360deg transformation to style to prevent subpixel rendering bug
        svg += ' style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);';
        Object.keys(data.style).forEach((/**
         * @param {?} attr
         * @return {?}
         */
        attr => {
            svg += ' ' + attr + ': ' + data.style[attr] + ';';
        }));
        svg += '">';
        svg += data.body + '</svg>';
        return svg;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    SVG.prototype._icon;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ZnLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZpc3VyZWwvaWNvbmlmeS1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL3N2Zy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7SUFPSSxTQUFTLEdBQUcsQ0FBQzs7Ozs7TUFLWCxVQUFVLEdBQUcsMkJBQTJCOztNQUN4QyxTQUFTLEdBQUcsMkJBQTJCOzs7OztNQUt2QyxjQUFjLEdBQUcsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUM7Ozs7O01BSzNHLGlCQUFpQixHQUFHO0lBQ3hCLElBQUksRUFBRSxDQUFDO0lBQ1AsR0FBRyxFQUFFLENBQUM7SUFDTixLQUFLLEVBQUUsRUFBRTtJQUNULE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLENBQUM7SUFDVCxLQUFLLEVBQUUsS0FBSztJQUNaLEtBQUssRUFBRSxLQUFLO0NBQ2I7Ozs7Ozs7Ozs7O0FBVUQsTUFBTSxVQUFVLFNBQVMsQ0FBQyxJQUFZOztVQUM5QixJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLGlCQUFpQixFQUFFLElBQUksQ0FBQztJQUN4RSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssS0FBSyxDQUFDLEVBQUU7UUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0tBQzNCO0lBQ0QsSUFBSSxJQUFJLENBQUMsWUFBWSxLQUFLLEtBQUssQ0FBQyxFQUFFO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztLQUNqQztJQUNELElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxLQUFLLENBQUMsRUFBRTtRQUNqQyw4Q0FBOEM7UUFDOUMsb0RBQW9EO1FBQ3BE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RyxDQUFDLEtBQUssR0FBRyxZQUFZLEdBQUcsR0FBRyxDQUFDLE1BQU0sR0FBRyw4QkFBOEIsQ0FBQztTQUMzSTtRQUVELE9BQU87WUFDTCxVQUFVO1lBQ1YsSUFBSTtZQUNKLEtBQUs7U0FDTixDQUFDO0lBQ0osQ0FBQzs7Ozs7O0lBS0QsTUFBTSxDQUFDLFVBQXFCOztjQUNwQixJQUFJLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUM7O1lBRXZDLEdBQUcsR0FBRyxvRkFBb0Y7UUFFOUYscUJBQXFCO1FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU87Ozs7UUFBQyxJQUFJLENBQUMsRUFBRTtZQUMxQyxHQUFHLElBQUksR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDekQsQ0FBQyxFQUFDLENBQUM7UUFFSCxrRkFBa0Y7UUFDbEYsR0FBRyxJQUFJLHNHQUFzRyxDQUFDO1FBQzlHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU87Ozs7UUFBQyxJQUFJLENBQUMsRUFBRTtZQUNyQyxHQUFHLElBQUksR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDcEQsQ0FBQyxFQUFDLENBQUM7UUFFSCxHQUFHLElBQUksSUFBSSxDQUFDO1FBRVosR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO1FBRTVCLE9BQU8sR0FBRyxDQUFDO0lBQ2IsQ0FBQztDQUNGOzs7Ozs7SUF6VmEsb0JBQWEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpuby1yZWR1bmRhbnQtanNkb2MgdmFyaWFibGUtbmFtZSBuby1jb25kaXRpb25hbC1hc3NpZ25tZW50IG5vLWJpdHdpc2UgKi9cclxuXHJcbmltcG9ydCB7IEljb25Qcm9wcyB9IGZyb20gJy4vaWNvbi1wcm9wcy5pbnRlcmZhY2UnO1xyXG5cclxuLyoqXHJcbiAqIFVuaXF1ZSBpZCBjb3VudGVyXHJcbiAqL1xyXG5sZXQgaWRDb3VudGVyID0gMDtcclxuXHJcbi8qKlxyXG4gKiBSZWdleCB1c2VkIHRvIHNwbGl0IGRpbWVuc2lvbnNcclxuICovXHJcbmNvbnN0IHVuaXRzU3BsaXQgPSAvKC0/WzAtOS5dKlswLTldK1swLTkuXSopL2c7XHJcbmNvbnN0IHVuaXRzVGVzdCA9IC9eLT9bMC05Ll0qWzAtOV0rWzAtOS5dKiQvZztcclxuXHJcbi8qKlxyXG4gKiBBdHRyaWJ1dGVzIHVzZWQgZm9yIGljb25cclxuICovXHJcbmNvbnN0IGljb25BdHRyaWJ1dGVzID0gWyd3aWR0aCcsICdoZWlnaHQnLCAnaW5saW5lJywgJ2hGbGlwJywgJ3ZGbGlwJywgJ2ZsaXAnLCAncm90YXRlJywgJ2FsaWduJywgJ2NvbG9yJywgJ2JveCddO1xyXG5cclxuLyoqXHJcbiAqIERlZmF1bHQgYXR0cmlidXRlIHZhbHVlc1xyXG4gKi9cclxuY29uc3QgZGVmYXVsdEF0dHJpYnV0ZXMgPSB7XHJcbiAgbGVmdDogMCxcclxuICB0b3A6IDAsXHJcbiAgd2lkdGg6IDE2LFxyXG4gIGhlaWdodDogMTYsXHJcbiAgcm90YXRlOiAwLFxyXG4gIGhGbGlwOiBmYWxzZSxcclxuICB2RmxpcDogZmFsc2VcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgbWlzc2luZyBwcm9wZXJ0aWVzIHRvIGljb25cclxuICpcclxuICogSW1wb3J0YW50OiBpbiBQSFAgdmVyc2lvbiBvZiB0aGlzIGxpYnJhcnkgdGhpcyBmdW5jdGlvbiBpcyBwYXJ0IG9mIENvbGxlY3Rpb24gY2xhc3M6IENvbGxlY3Rpb246OmFkZE1pc3NpbmdBdHRyaWJ1dGVzKClcclxuICpcclxuICogSmF2YVNjcmlwdCB2ZXJzaW9uIHVzZXMgc2VwYXJhdGUgZmlsZSBzbyB0aGlzIGZ1bmN0aW9uIGNvdWxkIGJlIHVzZWQgaW4gUmVhY3QgYW5kIG90aGVyIGNvbXBvbmVudHMgd2l0aG91dCBsb2FkaW5nXHJcbiAqIGVudGlyZSBDb2xsZWN0aW9uIGNsYXNzLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZShkYXRhOiBvYmplY3QpOiBvYmplY3Qge1xyXG4gIGNvbnN0IGl0ZW0gPSBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIGRlZmF1bHRBdHRyaWJ1dGVzLCBkYXRhKTtcclxuICBpZiAoaXRlbS5pbmxpbmVUb3AgPT09IHZvaWQgMCkge1xyXG4gICAgaXRlbS5pbmxpbmVUb3AgPSBpdGVtLnRvcDtcclxuICB9XHJcbiAgaWYgKGl0ZW0uaW5saW5lSGVpZ2h0ID09PSB2b2lkIDApIHtcclxuICAgIGl0ZW0uaW5saW5lSGVpZ2h0ID0gaXRlbS5oZWlnaHQ7XHJcbiAgfVxyXG4gIGlmIChpdGVtLnZlcnRpY2FsQWxpZ24gPT09IHZvaWQgMCkge1xyXG4gICAgLy8gLTAuMTQzIGlmIGljb24gaXMgZGVzaWduZWQgZm9yIDE0cHggaGVpZ2h0LFxyXG4gICAgLy8gb3RoZXJ3aXNlIGFzc3VtZSBpY29uIGlzIGRlc2lnbmVkIGZvciAxNnB4IGhlaWdodFxyXG4gICAgaXRlbS52ZXJ0aWNhbEFsaWduID0gaXRlbS5oZWlnaHQgJSA3ID09PSAwICYmIGl0ZW0uaGVpZ2h0ICUgOCAhPT0gMCA/IC0wLjE0MyA6IC0wLjEyNTtcclxuICB9XHJcbiAgcmV0dXJuIGl0ZW07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgcHJlc2VydmVBc3BlY3RSYXRpbyBhdHRyaWJ1dGUgdmFsdWVcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGlnbm1lbnQoYWxpZ246IHsgaG9yaXpvbnRhbDogc3RyaW5nOyB2ZXJ0aWNhbDogc3RyaW5nOyBzbGljZTogYm9vbGVhbiB9KTogc3RyaW5nIHtcclxuICBsZXQgcmVzdWx0O1xyXG4gIHN3aXRjaCAoYWxpZ24uaG9yaXpvbnRhbCkge1xyXG4gICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgIHJlc3VsdCA9ICd4TWluJztcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICByZXN1bHQgPSAneE1heCc7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJlc3VsdCA9ICd4TWlkJztcclxuICB9XHJcbiAgc3dpdGNoIChhbGlnbi52ZXJ0aWNhbCkge1xyXG4gICAgY2FzZSAndG9wJzpcclxuICAgICAgcmVzdWx0ICs9ICdZTWluJztcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgcmVzdWx0ICs9ICdZTWF4JztcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmVzdWx0ICs9ICdZTWlkJztcclxuICB9XHJcbiAgcmVzdWx0ICs9IGFsaWduLnNsaWNlID8gJyBzbGljZScgOiAnIG1lZXQnO1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTVkcgY2xhc3NcclxuICpcclxuICogQHNlZSBAaWNvbmlmeS9qc29uLXRvb2xzL3NyYy9zdmcuanNcclxuICovXHJcbmV4cG9ydCBjbGFzcyBTVkcge1xyXG4gIC8qKlxyXG4gICAqIENvbnN0cnVjdG9yXHJcbiAgICpcclxuICAgKiAgVXNlIENvbGxlY3Rpb24uZ2V0SWNvbkRhdGEoKSB0byByZXRyaWV2ZSBpY29uIGRhdGFcclxuICAgKi9cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9pY29uKSB7fVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgc2Vjb25kIGRpbWVuc2lvbiB3aGVuIG9ubHkgMSBkaW1lbnNpb24gaXMgc2V0XHJcbiAgICogSWYgc2l6ZSA9PSB3aWR0aCwgcmF0aW8gPSBoZWlnaHQvd2lkdGhcclxuICAgKiBJZiBzaXplID09IGhlaWdodCwgcmF0aW8gPSB3aWR0aC9oZWlnaHRcclxuICAgKi9cclxuICBzdGF0aWMgY2FsY3VsYXRlRGltZW5zaW9uKHNpemU6IHN0cmluZyB8IG51bWJlciwgcmF0aW86IG51bWJlciwgcHJlY2lzaW9uID0gMTAwKTogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbCB7XHJcbiAgICBpZiAocmF0aW8gPT09IDEpIHtcclxuICAgICAgcmV0dXJuIHNpemU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHR5cGVvZiBzaXplID09PSAnbnVtYmVyJykge1xyXG4gICAgICByZXR1cm4gTWF0aC5jZWlsKHNpemUgKiByYXRpbyAqIHByZWNpc2lvbikgLyBwcmVjaXNpb247XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc3BsaXQgY29kZSBpbnRvIHNldHMgb2Ygc3RyaW5ncyBhbmQgbnVtYmVyc1xyXG4gICAgY29uc3Qgc3BsaXQgPSBzaXplLnNwbGl0KHVuaXRzU3BsaXQpO1xyXG4gICAgaWYgKHNwbGl0ID09PSBudWxsIHx8ICFzcGxpdC5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHRzID0gW107XHJcbiAgICBsZXQgY29kZSA9IHNwbGl0LnNoaWZ0KCk7XHJcbiAgICBsZXQgaXNOdW1iZXIgPSB1bml0c1Rlc3QudGVzdChjb2RlKTtcclxuICAgIGxldCBudW07XHJcblxyXG4gICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgaWYgKGlzTnVtYmVyKSB7XHJcbiAgICAgICAgbnVtID0gcGFyc2VGbG9hdChjb2RlKTtcclxuICAgICAgICBpZiAoaXNOYU4obnVtKSkge1xyXG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGNvZGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXN1bHRzLnB1c2goTWF0aC5jZWlsKG51bSAqIHJhdGlvICogcHJlY2lzaW9uKSAvIHByZWNpc2lvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChjb2RlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbmV4dFxyXG4gICAgICBjb2RlID0gc3BsaXQuc2hpZnQoKTtcclxuICAgICAgaWYgKGNvZGUgPT09IHZvaWQgMCkge1xyXG4gICAgICAgIHJldHVybiByZXN1bHRzLmpvaW4oJycpO1xyXG4gICAgICB9XHJcbiAgICAgIGlzTnVtYmVyID0gIWlzTnVtYmVyO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVwbGFjZSBJRHMgaW4gU1ZHIG91dHB1dCB3aXRoIHVuaXF1ZSBJRHNcclxuICAgKiBGYXN0IHJlcGxhY2VtZW50IHdpdGhvdXQgcGFyc2luZyBYTUwsIGFzc3VtaW5nIGNvbW1vbmx5IHVzZWQgcGF0dGVybnMuXHJcbiAgICovXHJcbiAgc3RhdGljIHJlcGxhY2VJRHMoYm9keTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHJlZ2V4ID0gL1xcc2lkPVwiKFxcUyspXCIvZztcclxuICAgIGNvbnN0IGlkcyA9IFtdO1xyXG4gICAgbGV0IG1hdGNoOiBSZWdFeHBFeGVjQXJyYXk7XHJcbiAgICBsZXQgcHJlZml4OiBzdHJpbmc7XHJcblxyXG4gICAgZnVuY3Rpb24gc3RyUmVwbGFjZShzZWFyY2gsIHJlcGxhY2UsIHN1YmplY3QpIHtcclxuICAgICAgbGV0IHBvcyA9IDA7XHJcblxyXG4gICAgICB3aGlsZSAoKHBvcyA9IHN1YmplY3QuaW5kZXhPZihzZWFyY2gsIHBvcykpICE9PSAtMSkge1xyXG4gICAgICAgIHN1YmplY3QgPSBzdWJqZWN0LnNsaWNlKDAsIHBvcykgKyByZXBsYWNlICsgc3ViamVjdC5zbGljZShwb3MgKyBzZWFyY2gubGVuZ3RoKTtcclxuICAgICAgICBwb3MgKz0gcmVwbGFjZS5sZW5ndGg7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZpbmQgYWxsIElEc1xyXG4gICAgd2hpbGUgKG1hdGNoID0gcmVnZXguZXhlYyhib2R5KSkge1xyXG4gICAgICBpZHMucHVzaChtYXRjaFsxXSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlkcy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIGJvZHk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJlZml4ID0gJ0ljb25pZnlJZC0nICsgRGF0ZS5ub3coKS50b1N0cmluZygxNikgKyAnLScgKyAoTWF0aC5yYW5kb20oKSAqIDB4MTAwMDAwMCB8IDApLnRvU3RyaW5nKDE2KSArICctJztcclxuXHJcbiAgICAvLyBSZXBsYWNlIHdpdGggdW5pcXVlIGlkc1xyXG4gICAgaWRzLmZvckVhY2goKGlkKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld0lEID0gcHJlZml4ICsgaWRDb3VudGVyO1xyXG4gICAgICBpZENvdW50ZXIrKztcclxuICAgICAgYm9keSA9IHN0clJlcGxhY2UoJz1cIicgKyBpZCArICdcIicsICc9XCInICsgbmV3SUQgKyAnXCInLCBib2R5KTtcclxuICAgICAgYm9keSA9IHN0clJlcGxhY2UoJz1cIiMnICsgaWQgKyAnXCInLCAnPVwiIycgKyBuZXdJRCArICdcIicsIGJvZHkpO1xyXG4gICAgICBib2R5ID0gc3RyUmVwbGFjZSgnKCMnICsgaWQgKyAnKScsICcoIycgKyBuZXdJRCArICcpJywgYm9keSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gYm9keTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBTVkcgYXR0cmlidXRlc1xyXG4gICAqL1xyXG4gIGdldEF0dHJpYnV0ZXMocHJvcHM6IEljb25Qcm9wcykge1xyXG4gICAgY29uc3QgaXRlbSA9IHRoaXMuX2ljb247XHJcbiAgICBpZiAodHlwZW9mIHByb3BzICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICBwcm9wcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IGRhdGFcclxuICAgIGNvbnN0IGFsaWduID0ge1xyXG4gICAgICBob3Jpem9udGFsOiAnY2VudGVyJyxcclxuICAgICAgdmVydGljYWw6ICdtaWRkbGUnLFxyXG4gICAgICBzbGljZTogZmFsc2VcclxuICAgIH07XHJcbiAgICBjb25zdCB0cmFuc2Zvcm0gPSB7XHJcbiAgICAgIHJvdGF0ZTogaXRlbS5yb3RhdGUsXHJcbiAgICAgIGhGbGlwOiBpdGVtLmhGbGlwLFxyXG4gICAgICB2RmxpcDogaXRlbS52RmxpcFxyXG4gICAgfTtcclxuICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuXHJcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuXHJcbiAgICAvLyBHZXQgd2lkdGgvaGVpZ2h0XHJcbiAgICBjb25zdCBpbmxpbmUgPSBwcm9wcy5pbmxpbmUgPT09IHRydWUgfHwgcHJvcHMuaW5saW5lID09PSAndHJ1ZScgfHwgcHJvcHMuaW5saW5lID09PSAnMSc7XHJcblxyXG4gICAgY29uc3QgYm94ID0ge1xyXG4gICAgICBsZWZ0OiBpdGVtLmxlZnQsXHJcbiAgICAgIHRvcDogaW5saW5lID8gaXRlbS5pbmxpbmVUb3AgOiBpdGVtLnRvcCxcclxuICAgICAgd2lkdGg6IGl0ZW0ud2lkdGgsXHJcbiAgICAgIGhlaWdodDogaW5saW5lID8gaXRlbS5pbmxpbmVIZWlnaHQgOiBpdGVtLmhlaWdodFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBUcmFuc2Zvcm1hdGlvbnNcclxuICAgIFsnaEZsaXAnLCAndkZsaXAnXS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGlmIChwcm9wc1trZXldICE9PSB2b2lkIDAgJiYgKHByb3BzW2tleV0gPT09IHRydWUgfHwgcHJvcHNba2V5XSA9PT0gJ3RydWUnIHx8IHByb3BzW2tleV0gPT09ICcxJykpIHtcclxuICAgICAgICB0cmFuc2Zvcm1ba2V5XSA9ICF0cmFuc2Zvcm1ba2V5XTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAocHJvcHMuZmxpcCAhPT0gdm9pZCAwKSB7XHJcbiAgICAgIHByb3BzLmZsaXAudG9Mb3dlckNhc2UoKS5zcGxpdCgvW1xccyxdKy8pLmZvckVhY2godmFsdWUgPT4ge1xyXG4gICAgICAgIHN3aXRjaCAodmFsdWUpIHtcclxuICAgICAgICAgIGNhc2UgJ2hvcml6b250YWwnOlxyXG4gICAgICAgICAgICB0cmFuc2Zvcm0uaEZsaXAgPSAhdHJhbnNmb3JtLmhGbGlwO1xyXG4gICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICBjYXNlICd2ZXJ0aWNhbCc6XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybS52RmxpcCA9ICF0cmFuc2Zvcm0udkZsaXA7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChwcm9wcy5yb3RhdGUgIT09IHZvaWQgMCkge1xyXG4gICAgICBsZXQgdmFsdWUgPSBwcm9wcy5yb3RhdGU7XHJcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgdHJhbnNmb3JtLnJvdGF0ZSArPSB2YWx1ZTtcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgY29uc3QgdW5pdHMgPSB2YWx1ZS5yZXBsYWNlKC9eLT9bMC05Ll0qLywgJycpO1xyXG4gICAgICAgIGlmICh1bml0cyA9PT0gJycpIHtcclxuICAgICAgICAgIHZhbHVlID0gcGFyc2VJbnQodmFsdWUsIDEwKTtcclxuICAgICAgICAgIGlmICghaXNOYU4odmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybS5yb3RhdGUgKz0gdmFsdWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmICh1bml0cyAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgIGxldCBzcGxpdDogYm9vbGVhbiB8IG51bWJlciA9IGZhbHNlO1xyXG4gICAgICAgICAgc3dpdGNoICh1bml0cykge1xyXG4gICAgICAgICAgICBjYXNlICclJzpcclxuICAgICAgICAgICAgICAvLyAyNSUgLT4gMSwgNTAlIC0+IDIsIC4uLlxyXG4gICAgICAgICAgICAgIHNwbGl0ID0gMjU7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdkZWcnOlxyXG4gICAgICAgICAgICAgIC8vIDkwZGVnIC0+IDEsIDE4MGRlZyAtPiAyLCAuLi5cclxuICAgICAgICAgICAgICBzcGxpdCA9IDkwO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHNwbGl0KSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VJbnQodmFsdWUuc2xpY2UoMCwgdmFsdWUubGVuZ3RoIC0gdW5pdHMubGVuZ3RoKSwgMTApO1xyXG4gICAgICAgICAgICBpZiAoIWlzTmFOKHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgIHRyYW5zZm9ybS5yb3RhdGUgKz0gTWF0aC5yb3VuZCh2YWx1ZSAvIHNwbGl0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IHRyYW5zZm9ybWF0aW9ucyB0byBib3hcclxuICAgIGNvbnN0IHRyYW5zZm9ybWF0aW9ucyA9IFtdO1xyXG4gICAgbGV0IHRlbXBWYWx1ZTtcclxuICAgIGlmICh0cmFuc2Zvcm0uaEZsaXApIHtcclxuICAgICAgaWYgKHRyYW5zZm9ybS52RmxpcCkge1xyXG4gICAgICAgIHRyYW5zZm9ybS5yb3RhdGUgKz0gMjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBIb3Jpem9udGFsIGZsaXBcclxuICAgICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgndHJhbnNsYXRlKCcgKyAoYm94LndpZHRoICsgYm94LmxlZnQpICsgJyAnICsgKDAgLSBib3gudG9wKSArICcpJyk7XHJcbiAgICAgICAgdHJhbnNmb3JtYXRpb25zLnB1c2goJ3NjYWxlKC0xIDEpJyk7XHJcbiAgICAgICAgYm94LnRvcCA9IGJveC5sZWZ0ID0gMDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0cmFuc2Zvcm0udkZsaXApIHtcclxuICAgICAgLy8gVmVydGljYWwgZmxpcFxyXG4gICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgndHJhbnNsYXRlKCcgKyAoMCAtIGJveC5sZWZ0KSArICcgJyArIChib3guaGVpZ2h0ICsgYm94LnRvcCkgKyAnKScpO1xyXG4gICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgnc2NhbGUoMSAtMSknKTtcclxuICAgICAgYm94LnRvcCA9IGJveC5sZWZ0ID0gMDtcclxuICAgIH1cclxuICAgIHN3aXRjaCAodHJhbnNmb3JtLnJvdGF0ZSAlIDQpIHtcclxuICAgICAgY2FzZSAxOlxyXG4gICAgICAgIC8vIDkwZGVnXHJcbiAgICAgICAgdGVtcFZhbHVlID0gYm94LmhlaWdodCAvIDIgKyBib3gudG9wO1xyXG4gICAgICAgIHRyYW5zZm9ybWF0aW9ucy51bnNoaWZ0KCdyb3RhdGUoOTAgJyArIHRlbXBWYWx1ZSArICcgJyArIHRlbXBWYWx1ZSArICcpJyk7XHJcbiAgICAgICAgLy8gc3dhcCB3aWR0aC9oZWlnaHQgYW5kIHgveVxyXG4gICAgICAgIGlmIChib3gubGVmdCAhPT0gMCB8fCBib3gudG9wICE9PSAwKSB7XHJcbiAgICAgICAgICB0ZW1wVmFsdWUgPSBib3gubGVmdDtcclxuICAgICAgICAgIGJveC5sZWZ0ID0gYm94LnRvcDtcclxuICAgICAgICAgIGJveC50b3AgPSB0ZW1wVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChib3gud2lkdGggIT09IGJveC5oZWlnaHQpIHtcclxuICAgICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aDtcclxuICAgICAgICAgIGJveC53aWR0aCA9IGJveC5oZWlnaHQ7XHJcbiAgICAgICAgICBib3guaGVpZ2h0ID0gdGVtcFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBicmVhaztcclxuXHJcbiAgICAgIGNhc2UgMjpcclxuICAgICAgICAvLyAxODBkZWdcclxuICAgICAgICB0cmFuc2Zvcm1hdGlvbnMudW5zaGlmdCgncm90YXRlKDE4MCAnICsgKGJveC53aWR0aCAvIDIgKyBib3gubGVmdCkgKyAnICcgKyAoYm94LmhlaWdodCAvIDIgKyBib3gudG9wKSArICcpJyk7XHJcbiAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICBjYXNlIDM6XHJcbiAgICAgICAgLy8gMjcwZGVnXHJcbiAgICAgICAgdGVtcFZhbHVlID0gYm94LndpZHRoIC8gMiArIGJveC5sZWZ0O1xyXG4gICAgICAgIHRyYW5zZm9ybWF0aW9ucy51bnNoaWZ0KCdyb3RhdGUoLTkwICcgKyB0ZW1wVmFsdWUgKyAnICcgKyB0ZW1wVmFsdWUgKyAnKScpO1xyXG4gICAgICAgIC8vIHN3YXAgd2lkdGgvaGVpZ2h0IGFuZCB4L3lcclxuICAgICAgICBpZiAoYm94LmxlZnQgIT09IDAgfHwgYm94LnRvcCAhPT0gMCkge1xyXG4gICAgICAgICAgdGVtcFZhbHVlID0gYm94LmxlZnQ7XHJcbiAgICAgICAgICBib3gubGVmdCA9IGJveC50b3A7XHJcbiAgICAgICAgICBib3gudG9wID0gdGVtcFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYm94LndpZHRoICE9PSBib3guaGVpZ2h0KSB7XHJcbiAgICAgICAgICB0ZW1wVmFsdWUgPSBib3gud2lkdGg7XHJcbiAgICAgICAgICBib3gud2lkdGggPSBib3guaGVpZ2h0O1xyXG4gICAgICAgICAgYm94LmhlaWdodCA9IHRlbXBWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2FsY3VsYXRlIGRpbWVuc2lvbnNcclxuICAgIC8vIFZhbHVlcyBmb3Igd2lkdGgvaGVpZ2h0OiBudWxsID0gZGVmYXVsdCwgJ2F1dG8nID0gZnJvbSBzdmcsIGZhbHNlID0gZG8gbm90IHNldFxyXG4gICAgLy8gRGVmYXVsdDogaWYgYm90aCB2YWx1ZXMgYXJlbid0IHNldCwgaGVpZ2h0IGRlZmF1bHRzIHRvICcxZW0nLCB3aWR0aCBpcyBjYWxjdWxhdGVkIGZyb20gaGVpZ2h0XHJcbiAgICBjb25zdCBjdXN0b21XaWR0aCA9IHByb3BzLndpZHRoID8gcHJvcHMud2lkdGggOiBudWxsO1xyXG4gICAgbGV0IGN1c3RvbUhlaWdodCA9IHByb3BzLmhlaWdodCA/IHByb3BzLmhlaWdodCA6IG51bGw7XHJcblxyXG4gICAgbGV0IHdpZHRoO1xyXG4gICAgbGV0IGhlaWdodDtcclxuICAgIGlmIChjdXN0b21XaWR0aCA9PT0gbnVsbCAmJiBjdXN0b21IZWlnaHQgPT09IG51bGwpIHtcclxuICAgICAgY3VzdG9tSGVpZ2h0ID0gJzFlbSc7XHJcbiAgICB9XHJcbiAgICBpZiAoY3VzdG9tV2lkdGggIT09IG51bGwgJiYgY3VzdG9tSGVpZ2h0ICE9PSBudWxsKSB7XHJcbiAgICAgIHdpZHRoID0gY3VzdG9tV2lkdGg7XHJcbiAgICAgIGhlaWdodCA9IGN1c3RvbUhlaWdodDtcclxuICAgIH0gZWxzZSBpZiAoY3VzdG9tV2lkdGggIT09IG51bGwpIHtcclxuICAgICAgd2lkdGggPSBjdXN0b21XaWR0aDtcclxuICAgICAgaGVpZ2h0ID0gU1ZHLmNhbGN1bGF0ZURpbWVuc2lvbih3aWR0aCwgYm94LmhlaWdodCAvIGJveC53aWR0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBoZWlnaHQgPSBjdXN0b21IZWlnaHQ7XHJcbiAgICAgIHdpZHRoID0gU1ZHLmNhbGN1bGF0ZURpbWVuc2lvbihoZWlnaHQsIGJveC53aWR0aCAvIGJveC5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh3aWR0aCAhPT0gZmFsc2UpIHtcclxuICAgICAgYXR0cmlidXRlcy53aWR0aCA9IHdpZHRoID09PSAnYXV0bycgPyBib3gud2lkdGggOiB3aWR0aDtcclxuICAgIH1cclxuICAgIGlmIChoZWlnaHQgIT09IGZhbHNlKSB7XHJcbiAgICAgIGF0dHJpYnV0ZXMuaGVpZ2h0ID0gaGVpZ2h0ID09PSAnYXV0bycgPyBib3guaGVpZ2h0IDogaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFkZCB2ZXJ0aWNhbC1hbGlnbiBmb3IgaW5saW5lIGljb25cclxuICAgIGlmIChpbmxpbmUgJiYgaXRlbS52ZXJ0aWNhbEFsaWduICE9PSAwKSB7XHJcbiAgICAgIHN0eWxlWyd2ZXJ0aWNhbC1hbGlnbiddID0gaXRlbS52ZXJ0aWNhbEFsaWduICsgJ2VtJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBjdXN0b20gYWxpZ25tZW50XHJcbiAgICBpZiAocHJvcHMuYWxpZ24gIT09IHZvaWQgMCkge1xyXG4gICAgICBwcm9wcy5hbGlnbi50b0xvd2VyQ2FzZSgpLnNwbGl0KC9bXFxzLF0rLykuZm9yRWFjaCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgc3dpdGNoICh2YWx1ZSkge1xyXG4gICAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgICAgICBjYXNlICdjZW50ZXInOlxyXG4gICAgICAgICAgICBhbGlnbi5ob3Jpem9udGFsID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgJ3RvcCc6XHJcbiAgICAgICAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICAgICAgY2FzZSAnbWlkZGxlJzpcclxuICAgICAgICAgICAgYWxpZ24udmVydGljYWwgPSB2YWx1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSAnY3JvcCc6XHJcbiAgICAgICAgICAgIGFsaWduLnNsaWNlID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgY2FzZSAnbWVldCc6XHJcbiAgICAgICAgICAgIGFsaWduLnNsaWNlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBHZW5lcmF0ZSB2aWV3Qm94IGFuZCBwcmVzZXJ2ZUFzcGVjdFJhdGlvIGF0dHJpYnV0ZXNcclxuICAgIGF0dHJpYnV0ZXMucHJlc2VydmVBc3BlY3RSYXRpbyA9IGdldEFsaWdubWVudChhbGlnbik7XHJcbiAgICBhdHRyaWJ1dGVzLnZpZXdCb3ggPSBib3gubGVmdCArICcgJyArIGJveC50b3AgKyAnICcgKyBib3gud2lkdGggKyAnICcgKyBib3guaGVpZ2h0O1xyXG5cclxuICAgIC8vIEdlbmVyYXRlIGJvZHlcclxuICAgIGxldCBib2R5ID0gU1ZHLnJlcGxhY2VJRHMoaXRlbS5ib2R5KTtcclxuXHJcbiAgICBpZiAocHJvcHMuY29sb3IgIT09IHZvaWQgMCkge1xyXG4gICAgICBib2R5ID0gYm9keS5yZXBsYWNlKC9jdXJyZW50Q29sb3IvZywgcHJvcHMuY29sb3IpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRyYW5zZm9ybWF0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgYm9keSA9ICc8ZyB0cmFuc2Zvcm09XCInICsgdHJhbnNmb3JtYXRpb25zLmpvaW4oJyAnKSArICdcIj4nICsgYm9keSArICc8L2c+JztcclxuICAgIH1cclxuICAgIGlmIChwcm9wcy5ib3ggPT09IHRydWUgfHwgcHJvcHMuYm94ID09PSAndHJ1ZScgfHwgcHJvcHMuYm94ID09PSAnMScpIHtcclxuICAgICAgLy8gQWRkIHRyYW5zcGFyZW50IGJvdW5kaW5nIGJveFxyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgIGJvZHkgKz0gJzxyZWN0IHg9XCInICsgYm94LmxlZnQgKyAnXCIgeT1cIicgKyBib3gudG9wICsgJ1wiIHdpZHRoPVwiJyArIGJveC53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgYm94LmhlaWdodCArICdcIiBmaWxsPVwicmdiYSgwLCAwLCAwLCAwKVwiIC8+JztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhdHRyaWJ1dGVzLFxyXG4gICAgICBib2R5LFxyXG4gICAgICBzdHlsZVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdlbmVyYXRlIFNWR1xyXG4gICAqL1xyXG4gIGdldFNWRyhhdHRyaWJ1dGVzOiBJY29uUHJvcHMpIHtcclxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldEF0dHJpYnV0ZXMoYXR0cmlidXRlcyk7XHJcblxyXG4gICAgbGV0IHN2ZyA9ICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIic7XHJcblxyXG4gICAgLy8gQWRkIFNWRyBhdHRyaWJ1dGVzXHJcbiAgICBPYmplY3Qua2V5cyhkYXRhLmF0dHJpYnV0ZXMpLmZvckVhY2goYXR0ciA9PiB7XHJcbiAgICAgIHN2ZyArPSAnICcgKyBhdHRyICsgJz1cIicgKyBkYXRhLmF0dHJpYnV0ZXNbYXR0cl0gKyAnXCInO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQWRkIHN0eWxlIHdpdGggMzYwZGVnIHRyYW5zZm9ybWF0aW9uIHRvIHN0eWxlIHRvIHByZXZlbnQgc3VicGl4ZWwgcmVuZGVyaW5nIGJ1Z1xyXG4gICAgc3ZnICs9ICcgc3R5bGU9XCItbXMtdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyc7XHJcbiAgICBPYmplY3Qua2V5cyhkYXRhLnN0eWxlKS5mb3JFYWNoKGF0dHIgPT4ge1xyXG4gICAgICBzdmcgKz0gJyAnICsgYXR0ciArICc6ICcgKyBkYXRhLnN0eWxlW2F0dHJdICsgJzsnO1xyXG4gICAgfSk7XHJcblxyXG4gICAgc3ZnICs9ICdcIj4nO1xyXG5cclxuICAgIHN2ZyArPSBkYXRhLmJvZHkgKyAnPC9zdmc+JztcclxuXHJcbiAgICByZXR1cm4gc3ZnO1xyXG4gIH1cclxufVxyXG4iXX0=