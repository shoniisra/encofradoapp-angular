import { Observable, asyncScheduler } from 'rxjs';
import { map, share } from 'rxjs/operators';
export function fromRef(ref, event, listenType, scheduler) {
    if (listenType === void 0) { listenType = 'on'; }
    if (scheduler === void 0) { scheduler = asyncScheduler; }
    return new Observable(function (subscriber) {
        var fn = null;
        fn = ref[listenType](event, function (snapshot, prevKey) {
            scheduler.schedule(function () {
                subscriber.next({ snapshot: snapshot, prevKey: prevKey });
            });
            if (listenType == 'once') {
                scheduler.schedule(function () { return subscriber.complete(); });
            }
        }, function (err) {
            scheduler.schedule(function () { return subscriber.error(err); });
        });
        if (listenType == 'on') {
            return {
                unsubscribe: function () {
                    if (fn != null) {
                        ref.off(event, fn);
                    }
                }
            };
        }
        else {
            return { unsubscribe: function () { } };
        }
    }).pipe(map(function (payload) {
        var snapshot = payload.snapshot, prevKey = payload.prevKey;
        var key = null;
        if (snapshot.exists()) {
            key = snapshot.key;
        }
        return { type: event, payload: snapshot, prevKey: prevKey, key: key };
    }), share());
}
//# sourceMappingURL=fromRef.js.map