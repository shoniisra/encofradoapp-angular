{"version":3,"file":"builder.js","sourceRoot":"","sources":["../../../../src/schematics/deploy/builder.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,yDAImC;AACnC,oDAA2D;AAC3D,uCAA+B;AAC/B,+CAAqE;AAErE,6BAA6B;AAC7B,oCAAkD;AAMlD,kBAAe,yBAAa,CAC1B,CAAO,OAA6B,EAAE,OAAuB,EAA0B,EAAE;IAEvF,MAAM,IAAI,GAAG,gBAAS,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;IAC9C,MAAM,SAAS,GAAG,IAAI,mBAAY,CAAC,SAAS,CAAC,SAAS,CACpD,IAAI,EACJ,IAAI,qBAAc,EAAE,CACrB,CAAC;IACF,MAAM,SAAS;SACZ,qBAAqB,CAAC,gBAAS,CAAC,cAAc,CAAC,CAAC;SAChD,SAAS,EAAE,CAAC;IAEf,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;QACnB,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;KACnE;IAED,MAAM,OAAO,GAAG,SAAS,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAE7D,MAAM,eAAe,GAAG,8BAAsB,CAC5C,OAAO,CAAC,aAAa,EACrB,OAAO,CAAC,MAAM,CAAC,OAAO,CACvB,CAAC;IAEF,MAAM,WAAW,GAAG,OAAO,CAAC,WAAW,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,mBAAmB,CAAC;IAExF,IAAI;QACF,MAAM,iBAAM,CACV,OAAO,CAAC,gBAAgB,CAAC,EACzB,OAAO,EACP,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,OAAO,CAAC,IAAI,CAAC,EAC9C,WAAW,EACX,eAAe,CAChB,CAAC;KACH;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;QAC/C,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QACzB,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;KAC3B;IAED,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAC3B,CAAC,CAAA,CACF,CAAC","sourcesContent":["import {\n  BuilderContext,\n  BuilderOutput,\n  createBuilder\n} from \"@angular-devkit/architect\";\nimport { NodeJsSyncHost } from \"@angular-devkit/core/node\";\nimport deploy from \"./actions\";\nimport { experimental, normalize, json } from \"@angular-devkit/core\";\nimport { DeployBuilderSchema } from '../interfaces';\nimport * as path from \"path\";\nimport { getFirebaseProjectName } from \"../utils\";\n\ntype DeployBuilderOptions = DeployBuilderSchema & json.JsonObject;\n\n// Call the createBuilder() function to create a builder. This mirrors\n// createJobHandler() but add typings specific to Architect Builders.\nexport default createBuilder<any>(\n  async (options: DeployBuilderOptions, context: BuilderContext): Promise<BuilderOutput> => {\n    // The project root is added to a BuilderContext.\n    const root = normalize(context.workspaceRoot);\n    const workspace = new experimental.workspace.Workspace(\n      root,\n      new NodeJsSyncHost()\n    );\n    await workspace\n      .loadWorkspaceFromHost(normalize(\"angular.json\"))\n      .toPromise();\n\n    if (!context.target) {\n      throw new Error(\"Cannot deploy the application without a target\");\n    }\n\n    const project = workspace.getProject(context.target.project);\n\n    const firebaseProject = getFirebaseProjectName(\n      context.workspaceRoot,\n      context.target.project\n    );\n\n    const buildTarget = options.buildTarget || `${context.target.project}:build:production`;\n\n    try {\n      await deploy(\n        require(\"firebase-tools\"),\n        context,\n        path.join(context.workspaceRoot, project.root),\n        buildTarget,\n        firebaseProject\n      );\n    } catch (e) {\n      console.error(\"Error when trying to deploy: \");\n      console.error(e.message);\n      return { success: false };\n    }\n\n    return { success: true };\n  }\n);\n"]}