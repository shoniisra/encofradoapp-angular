{"version":3,"file":"remote-config.js","sourceRoot":"","sources":["../../../src/remote-config/remote-config.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Inject, Optional, NgZone, InjectionToken } from '@angular/core';\nimport { Observable, concat, of, pipe, OperatorFunction, MonoTypeOperatorFunction } from 'rxjs';\nimport { map, switchMap, tap, shareReplay, distinctUntilChanged, filter, groupBy, mergeMap, scan, withLatestFrom, startWith, debounceTime, observeOn } from 'rxjs/operators';\nimport { FirebaseAppConfig, FirebaseOptions, ɵlazySDKProxy, FIREBASE_OPTIONS, FIREBASE_APP_NAME } from '@angular/fire';\nimport { remoteConfig } from 'firebase/app';\n\nexport interface ConfigTemplate {[key:string]: string|number|boolean};\n\nexport const SETTINGS = new InjectionToken<remoteConfig.Settings>('angularfire2.remoteConfig.settings');\nexport const DEFAULTS = new InjectionToken<ConfigTemplate>('angularfire2.remoteConfig.defaultConfig');\n\nimport { FirebaseRemoteConfig, _firebaseAppFactory, ɵAngularFireSchedulers } from '@angular/fire';\n\n// SEMVER: once we move to Typescript 3.6 use `PromiseProxy<remoteConfig.RemoteConfig>` rather than hardcoding\ntype RemoteConfigProxy = {\n  activate: () => Promise<boolean>;\n  ensureInitialized: () => Promise<void>;\n  fetch: () => Promise<void>;\n  fetchAndActivate: () => Promise<boolean>;\n  getAll: () => Promise<{[key:string]: remoteConfig.Value}>;\n  getBoolean: (key:string) => Promise<boolean>;\n  getNumber: (key:string) => Promise<number>;\n  getString: (key:string) => Promise<string>;\n  getValue: (key:string) => Promise<remoteConfig.Value>;\n  setLogLevel: (logLevel: remoteConfig.LogLevel) => Promise<void>;\n  settings: Promise<remoteConfig.Settings>;\n  defaultConfig: Promise<{\n      [key: string]: string | number | boolean;\n  }>;\n  fetchTimeMillis: Promise<number>;\n  lastFetchStatus: Promise<remoteConfig.FetchStatus>;\n};\n\nexport interface AngularFireRemoteConfig extends RemoteConfigProxy {};\n\n// TODO export as implements Partial<...> so minor doesn't break us\nexport class Value implements remoteConfig.Value {\n  asBoolean() { return ['1', 'true', 't', 'y', 'yes', 'on'].indexOf(this._value.toLowerCase()) > -1 }\n  asString() { return this._value }\n  asNumber() { return Number(this._value) || 0 }\n  getSource() { return this._source; }\n  constructor(public _source: remoteConfig.ValueSource, public _value: string) { }\n}\n\n// SEMVER use ConstructorParameters when we can support Typescript 3.6\nexport class Parameter extends Value {\n  constructor(public key: string, public fetchTimeMillis: number, source: remoteConfig.ValueSource, value: string) {\n    super(source, value);\n  }\n}\n\n// If it's a Parameter array, test any, else test the individual Parameter\nconst filterTest = (fn: (param:Parameter) => boolean) => filter<Parameter|Parameter[]>(it => Array.isArray(it) ? it.some(fn) : fn(it))\n\n// Allow the user to bypass the default values and wait till they get something from the server, even if it's a cached copy;\n// if used in conjuntion with first() it will only fetch RC values from the server if they aren't cached locally\nexport const filterRemote = () => filterTest(p => p.getSource() === 'remote');\n\n// filterFresh allows the developer to effectively set up a maximum cache time\nexport const filterFresh = (howRecentInMillis: number) => filterTest(p => p.fetchTimeMillis + howRecentInMillis >= new Date().getTime());\n\n@Injectable()\nexport class AngularFireRemoteConfig {\n\n  readonly changes:    Observable<Parameter>;\n  readonly parameters: Observable<Parameter[]>;\n  readonly numbers:    Observable<{[key:string]: number|undefined}>  & {[key:string]: Observable<number>};\n  readonly booleans:   Observable<{[key:string]: boolean|undefined}> & {[key:string]: Observable<boolean>};\n  readonly strings:    Observable<{[key:string]: string|undefined}>  & {[key:string]: Observable<string|undefined>};\n\n  constructor(\n    @Inject(FIREBASE_OPTIONS) options:FirebaseOptions,\n    @Optional() @Inject(FIREBASE_APP_NAME) nameOrConfig:string|FirebaseAppConfig|null|undefined,\n    @Optional() @Inject(SETTINGS) settings:remoteConfig.Settings|null,\n    @Optional() @Inject(DEFAULTS) defaultConfig:ConfigTemplate|null,\n    private zone: NgZone\n  ) {\n\n    const schedulers = new ɵAngularFireSchedulers(zone);\n    \n    const remoteConfig$ = of(undefined).pipe(\n      observeOn(schedulers.outsideAngular),\n      // @ts-ignore zapping in the UMD in the build script\n      switchMap(() => zone.runOutsideAngular(() => import('firebase/remote-config'))),\n      map(() => _firebaseAppFactory(options, zone, nameOrConfig)),\n      // SEMVER no need to cast once we drop older Firebase\n      map(app => <remoteConfig.RemoteConfig>app.remoteConfig()),\n      tap(rc => {\n        if (settings) { rc.settings = settings }\n        if (defaultConfig) { rc.defaultConfig = defaultConfig }\n      }),\n      startWith(undefined),\n      shareReplay({ bufferSize: 1, refCount: false })\n    );\n\n    const loadedRemoteConfig$ = remoteConfig$.pipe(\n      filter<remoteConfig.RemoteConfig>(rc => !!rc)\n    );\n\n    let default$: Observable<{[key:string]: remoteConfig.Value}> = of(Object.keys(defaultConfig || {}).reduce(\n      (c, k) => ({...c, [k]: new Value(\"default\", defaultConfig![k].toString()) }), {}\n    ));\n\n    // we should filter out the defaults we provided to RC, since we have our own implementation\n    // that gives us a -1 for fetchTimeMillis (so filterFresh can filter them out)\n    const filterOutDefaults = map<{[key: string]: remoteConfig.Value}, {[key: string]: remoteConfig.Value}>(all =>\n      Object.keys(all)\n        .filter(key => all[key].getSource() != 'default')\n        .reduce((acc, key) => ({...acc, [key]: all[key]}), {})\n    );\n\n    const existing$ = loadedRemoteConfig$.pipe(\n      switchMap(rc =>\n        rc.activate()\n          .then(() => rc.ensureInitialized())\n          .then(() => rc.getAll())\n      ),\n      filterOutDefaults\n    );\n\n    const fresh$ = loadedRemoteConfig$.pipe(\n      switchMap(rc => zone.runOutsideAngular(() =>\n        rc.fetchAndActivate()\n          .then(() => rc.ensureInitialized())\n          .then(() => rc.getAll())\n      )),\n      filterOutDefaults\n    );\n\n    this.parameters = concat(default$, existing$, fresh$).pipe(\n      scanToParametersArray(remoteConfig$),\n      shareReplay({ bufferSize: 1, refCount: true })\n    );\n\n    this.changes = this.parameters.pipe(\n      switchMap(params => of(...params)),\n      groupBy(param => param.key),\n      mergeMap(group => group.pipe(\n        distinctUntilChanged()\n      ))\n    );\n\n    this.strings  = proxyAll(this.parameters, 'strings');\n    this.booleans = proxyAll(this.parameters, 'booleans');\n    this.numbers  = proxyAll(this.parameters, 'numbers');\n\n    return ɵlazySDKProxy(this, loadedRemoteConfig$, zone);\n  }\n\n}\n\n// I ditched loading the defaults into RC and a simple map for scan since we already have our own defaults implementation.\n// The idea here being that if they have a default that never loads from the server, they will be able to tell via fetchTimeMillis on the Parameter.\n// Also if it doesn't come from the server it won't emit again in .changes, due to the distinctUntilChanged, which we can simplify to === rather than deep comparison\nconst scanToParametersArray = (remoteConfig: Observable<remoteConfig.RemoteConfig|undefined>): OperatorFunction<{[key:string]: remoteConfig.Value}, Parameter[]> => pipe(\n  withLatestFrom(remoteConfig),\n  scan((existing, [all, rc]) => {\n    // SEMVER use \"new Set\" to unique once we're only targeting es6\n    // at the scale we expect remote config to be at, we probably won't see a performance hit from this unoptimized uniqueness implementation\n    // const allKeys = [...new Set([...existing.map(p => p.key), ...Object.keys(all)])];\n    const allKeys = [...existing.map(p => p.key), ...Object.keys(all)].filter((v, i, a) => a.indexOf(v) === i);\n    return allKeys.map(key => {\n      const updatedValue = all[key];\n      return updatedValue ? new Parameter(key, rc ? rc.fetchTimeMillis : -1, updatedValue.getSource(), updatedValue.asString())\n                : existing.find(p => p.key === key)!\n    });\n  }, [] as Array<Parameter>)\n);\n\nconst AS_TO_FN = { 'strings': 'asString', 'numbers': 'asNumber', 'booleans': 'asBoolean' };\nconst STATIC_VALUES = { 'numbers': 0, 'booleans': false, 'strings': undefined };\n\nexport const budget = <T>(interval: number): MonoTypeOperatorFunction<T> => (source: Observable<T>) => new Observable<T>(observer => {\n    let timedOut = false;\n    // TODO use scheduler task rather than settimeout\n    const timeout = setTimeout(() => {\n      observer.complete();\n      timedOut = true;\n    }, interval);\n    return source.subscribe({\n      next(val) { if (!timedOut) { observer.next(val); } },\n      error(err) { if (!timedOut) { clearTimeout(timeout); observer.error(err); } },\n      complete() { if (!timedOut) { clearTimeout(timeout); observer.complete(); } }\n    })\n  });\n\nconst typedMethod = (it:any) => {\n  switch(typeof it) {\n    case 'string': return 'asString';\n    case 'boolean': return 'asBoolean';\n    case 'number': return 'asNumber';\n    default: return 'asString';\n  }\n};\n\nexport function scanToObject(): OperatorFunction<Parameter, {[key:string]: string|undefined}>;\nexport function scanToObject(to: 'numbers'): OperatorFunction<Parameter, {[key:string]: number|undefined}>;\nexport function scanToObject(to: 'booleans'): OperatorFunction<Parameter, {[key:string]: boolean|undefined}>;\nexport function scanToObject(to: 'strings'): OperatorFunction<Parameter, {[key:string]: string|undefined}>;\nexport function scanToObject<T extends ConfigTemplate>(template: T): OperatorFunction<Parameter, T & {[key:string]: string|undefined}>;\nexport function scanToObject<T extends ConfigTemplate>(to: 'numbers'|'booleans'|'strings'|T = 'strings') {\n  return pipe(\n    // TODO cleanup\n    scan(\n      (c, p: Parameter) => ({...c, [p.key]: typeof to === 'object' ?\n        p[typedMethod(to[p.key])]() :\n        p[AS_TO_FN[to]]()  }),\n      typeof to === 'object' ?\n        to as T & {[key:string]: string|undefined}:\n        {} as {[key:string]: number|boolean|string}\n    ),\n    debounceTime(1),\n    budget(10),\n    distinctUntilChanged((a,b) => JSON.stringify(a) === JSON.stringify(b))\n  );\n};\n\nexport function mapToObject(): OperatorFunction<Parameter[], {[key:string]: string|undefined}>;\nexport function mapToObject(to: 'numbers'): OperatorFunction<Parameter[], {[key:string]: number|undefined}>;\nexport function mapToObject(to: 'booleans'): OperatorFunction<Parameter[], {[key:string]:  boolean|undefined}>;\nexport function mapToObject(to: 'strings'): OperatorFunction<Parameter[], {[key:string]: string|undefined}>;\nexport function mapToObject<T extends ConfigTemplate>(template: T): OperatorFunction<Parameter[], T & {[key:string]: string|undefined}>;\nexport function mapToObject<T extends ConfigTemplate>(to: 'numbers'|'booleans'|'strings'|T = 'strings') {\n  return pipe(\n    // TODO this is getting a little long, cleanup\n    map((params: Parameter[]) => params.reduce(\n      (c, p) => ({...c, [p.key]: typeof to === 'object' ?\n        p[typedMethod(to[p.key])]() :\n        p[AS_TO_FN[to]]() }),\n      typeof to === 'object' ?\n        to as T & {[key:string]: string|undefined} :\n        {} as {[key:string]: number|boolean|string}\n    )),\n    distinctUntilChanged((a,b) => JSON.stringify(a) === JSON.stringify(b))\n  );\n};\n\n// TODO look into the types here, I don't like the anys\nconst proxyAll = (observable: Observable<Parameter[]>, as: 'numbers'|'booleans'|'strings') => new Proxy(\n  observable.pipe(mapToObject(as as any)), {\n    get: (self, name:string) => self[name] || observable.pipe(\n      map(all => all.find(p => p.key === name)),\n      map(param => param ? param[AS_TO_FN[as]]() : STATIC_VALUES[as]),\n      distinctUntilChanged()\n    )\n  }\n) as any;"]}