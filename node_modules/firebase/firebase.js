!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new E(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function u(t){return Boolean(t&&void 0!==t.length)}function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void c(r.promise,t)}s(r.promise,e)}else(1===n._state?s:c)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void h(e);if("function"==typeof n)return void f(function(t,e){return function(){t.apply(e,arguments)}}(n,t),e)}e._state=1,e._value=t,h(e)}catch(t){c(e,t)}}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new l(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!u(e))return i(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){if(!u(i))return e(new TypeError("Promise.race accepts an array"));for(var n=0,r=i.length;n<r;n++)o.resolve(i[n]).then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var p=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in p?p.Promise.prototype.finally||(p.Promise.prototype.finally=n):p.Promise=o;function d(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function y(t){return F.call(t).slice(8,-1)}function g(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function b(t){return q(g(t))}function w(t){return"object"==typeof t?null!==t:"function"==typeof t}function _(t,e){if(!w(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!w(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function E(t,e){return V.call(t,e)}function T(t){return j?B.createElement(t):{}}function S(t){if(!w(t))throw TypeError(String(t)+" is not an object");return t}function I(e,n){try{z(O,e,n)}catch(t){O[e]=n}return n}function C(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++tt+et).toString(36)}function N(t){return nt[t]||(nt[t]=C(t))}var A,k,D,R="object",O=d(typeof globalThis==R&&globalThis)||d(typeof window==R&&window)||d(typeof self==R&&self)||d(typeof t==R&&t)||Function("return this")(),P=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),x={}.propertyIsEnumerable,M=Object.getOwnPropertyDescriptor,L={f:M&&!x.call({1:2},1)?function(t){var e=M(this,t);return!!e&&e.enumerable}:x},F={}.toString,U="".split,q=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==y(t)?U.call(t,""):Object(t)}:Object,V={}.hasOwnProperty,B=O.document,j=w(B)&&w(B.createElement),W=!P&&!m(function(){return 7!=Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a}),K=Object.getOwnPropertyDescriptor,Q={f:P?K:function(t,e){if(t=b(t),e=_(e,!0),W)try{return K(t,e)}catch(t){}if(E(t,e))return v(!L.f.call(t,e),t[e])}},H=Object.defineProperty,G={f:P?H:function(t,e,n){if(S(t),e=_(e,!0),S(n),W)try{return H(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},z=P?function(t,e,n){return G.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},Y=!1,X=e(function(t){var e="__core-js_shared__",n=O[e]||I(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),J=X("native-function-to-string",Function.toString),$=O.WeakMap,Z="function"==typeof $&&/native code/.test(J.call($)),tt=0,et=Math.random(),nt=X("keys"),rt={},it=O.WeakMap;if(Z){var ot=new it,at=ot.get,st=ot.has,ut=ot.set;A=function(t,e){return ut.call(ot,t,e),e},k=function(t){return at.call(ot,t)||{}},D=function(t){return st.call(ot,t)}}else{var ct=N("state");rt[ct]=!0,A=function(t,e){return z(t,ct,e),e},k=function(t){return E(t,ct)?t[ct]:{}},D=function(t){return E(t,ct)}}function ht(t){return"function"==typeof t?t:void 0}function lt(t,e){return arguments.length<2?ht(At[t])||ht(O[t]):At[t]&&At[t][e]||O[t]&&O[t][e]}function ft(t){return isNaN(t=+t)?0:(0<t?Dt:kt)(t)}function pt(t){return 0<t?Rt(ft(t),9007199254740991):0}function dt(s){return function(t,e,n){var r,i=b(t),o=pt(i.length),a=function(t,e){var n=ft(t);return n<0?Ot(n+e,0):Pt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function yt(t,e){var n,r=b(t),i=0,o=[];for(n in r)!E(rt,n)&&E(r,n)&&o.push(n);for(;e.length>i;)E(r,n=e[i++])&&(~xt(o,n)||o.push(n));return o}function mt(t,e){for(var n=qt(e),r=G.f,i=Q.f,o=0;o<n.length;o++){var a=n[o];E(t,a)||r(t,a,i(e,a))}}function vt(t,e){var n=jt[Bt(t)];return n==Kt||n!=Wt&&("function"==typeof e?m(e):!!e)}function gt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?O:c?O[s]||I(s,{}):(O[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Ht(n,r))&&a.value:n[r],!Qt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;mt(o,i)}(t.sham||i&&i.sham)&&z(o,"sham",!0),Nt(n,r,o,t)}}function bt(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function wt(r,i,t){if(bt(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function _t(t){return Object(g(t))}function Et(t){return Xt[t]||(Xt[t]=zt&&Yt[t]||(zt?Yt:C)("Symbol."+t))}function Tt(t,e){var n;return Gt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Gt(n.prototype)?w(n)&&null===(n=n[Jt])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function St(p){var d=1==p,y=2==p,m=3==p,v=4==p,g=6==p,b=5==p||g;return function(t,e,n,r){for(var i,o,a=_t(t),s=q(a),u=wt(e,n,3),c=pt(s.length),h=0,l=r||Tt,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:$t.call(f,i)}else if(v)return!1;return g?-1:m||v?v:f}}function It(){}var Ct={set:A,get:k,has:D,enforce:function(t){return D(t)?k(t):A(t,{})},getterFor:function(n){return function(t){var e;if(!w(t)||(e=k(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},Nt=e(function(t){var e=Ct.get,s=Ct.enforce,u=String(J).split("toString");X("inspectSource",function(t){return J.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||E(n,"name")||z(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==O?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:z(t,e,n)):o?t[e]=n:I(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||J.call(this)})}),At=O,kt=Math.ceil,Dt=Math.floor,Rt=Math.min,Ot=Math.max,Pt=Math.min,xt={includes:dt(!0),indexOf:dt(!1)}.indexOf,Mt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lt=Mt.concat("length","prototype"),Ft={f:Object.getOwnPropertyNames||function(t){return yt(t,Lt)}},Ut={f:Object.getOwnPropertySymbols},qt=lt("Reflect","ownKeys")||function(t){var e=Ft.f(S(t)),n=Ut.f;return n?e.concat(n(t)):e},Vt=/#|\.prototype\./,Bt=vt.normalize=function(t){return String(t).replace(Vt,".").toLowerCase()},jt=vt.data={},Wt=vt.NATIVE="N",Kt=vt.POLYFILL="P",Qt=vt,Ht=Q.f,Gt=Array.isArray||function(t){return"Array"==y(t)},zt=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Yt=O.Symbol,Xt=X("wks"),Jt=Et("species"),$t=[].push,Zt={forEach:St(0),map:St(1),filter:St(2),some:St(3),every:St(4),find:St(5),findIndex:St(6)},te=Object.keys||function(t){return yt(t,Mt)},ee=P?Object.defineProperties:function(t,e){S(t);for(var n,r=te(e),i=r.length,o=0;o<i;)G.f(t,n=r[o++],e[n]);return t},ne=lt("document","documentElement"),re=N("IE_PROTO"),ie="prototype",oe=function(){var t,e=T("iframe"),n=Mt.length,r="script";for(e.style.display="none",ne.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),oe=t.F;n--;)delete oe[ie][Mt[n]];return oe()},ae=Object.create||function(t,e){var n;return null!==t?(It[ie]=S(t),n=new It,It[ie]=null,n[re]=t):n=oe(),void 0===e?n:ee(n,e)};rt[re]=!0;var se=Et("unscopables"),ue=Array.prototype;null==ue[se]&&z(ue,se,ae(null));function ce(t){ue[se][t]=!0}var he=Zt.find,le="find",fe=!0;le in[]&&Array(1)[le](function(){fe=!1}),gt({target:"Array",proto:!0,forced:fe},{find:function(t,e){return he(this,t,1<arguments.length?e:void 0)}}),ce(le);function pe(t,e,n){return wt(de,O[t].prototype[e],n)}var de=Function.call,ye=(pe("Array","find"),Zt.findIndex),me="findIndex",ve=!0;me in[]&&Array(1)[me](function(){ve=!1}),gt({target:"Array",proto:!0,forced:ve},{findIndex:function(t,e){return ye(this,t,1<arguments.length?e:void 0)}}),ce(me);function ge(s){return function(t,e){var n,r,i=String(g(t)),o=ft(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}pe("Array","findIndex");var be,we,_e,Ee={codeAt:ge(!1),charAt:ge(!0)},Te=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Se=N("IE_PROTO"),Ie=Object.prototype,Ce=Te?Object.getPrototypeOf:function(t){return t=_t(t),E(t,Se)?t[Se]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Ie:null},Ne=Et("iterator"),Ae=!1;[].keys&&("next"in(_e=[].keys())?(we=Ce(Ce(_e)))!==Object.prototype&&(be=we):Ae=!0),null==be&&(be={}),E(be,Ne)||z(be,Ne,function(){return this});function ke(t,e,n){t&&!E(t=n?t:t.prototype,Me)&&xe(t,Me,{configurable:!0,value:e})}function De(){return this}function Re(){return this}function Oe(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!Ve&&t in p)return p[t];switch(t){case"keys":case je:case We:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ae(Fe,{next:v(1,n)}),ke(t,r,!1),Le[r]=De}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[Be]||p["@@iterator"]||i&&p[i],y=!Ve&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=Ce(m.call(new t)),qe!==Object.prototype&&u.next&&(Ce(u)!==qe&&(Ue?Ue(u,qe):"function"!=typeof u[Be]&&z(u,Be,Re)),ke(u,l,!0))),i==je&&d&&d.name!==je&&(f=!0,y=function(){return d.call(this)}),p[Be]!==y&&z(p,Be,y),Le[e]=y,i)if(c={values:s(je),keys:o?y:s("keys"),entries:s(We)},a)for(h in c)!Ve&&!f&&h in p||Nt(p,h,c[h]);else gt({target:e,proto:!0,forced:Ve||f},c);return c}var Pe={IteratorPrototype:be,BUGGY_SAFARI_ITERATORS:Ae},xe=G.f,Me=Et("toStringTag"),Le={},Fe=Pe.IteratorPrototype,Ue=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return S(t),function(t){if(!w(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),qe=Pe.IteratorPrototype,Ve=Pe.BUGGY_SAFARI_ITERATORS,Be=Et("iterator"),je="values",We="entries",Ke=Ee.charAt,Qe="String Iterator",He=Ct.set,Ge=Ct.getterFor(Qe);Oe(String,"String",function(t){He(this,{type:Qe,string:String(t),index:0})},function(){var t,e=Ge(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ke(n,r),e.index+=t.length,{value:t,done:!1})});function ze(e,t,n,r){try{return r?t(S(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&S(i.call(e)),t}}function Ye(t){return void 0!==t&&(Le.Array===t||tn[Ze]===t)}function Xe(t,e,n){var r=_(e);r in t?G.f(t,r,v(0,n)):t[r]=n}function Je(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),en))?n:nn?y(e):"Object"==(r=y(e))&&"function"==typeof e.callee?"Arguments":r}function $e(t){if(null!=t)return t[rn]||t["@@iterator"]||Le[Je(t)]}var Ze=Et("iterator"),tn=Array.prototype,en=Et("toStringTag"),nn="Arguments"==y(function(){return arguments}()),rn=Et("iterator"),on=Et("iterator"),an=!1;try{var sn=0,un={next:function(){return{done:!!sn++}},return:function(){an=!0}};un[on]=function(){return this},Array.from(un,function(){throw 2})}catch(To){}function cn(t,e){if(!e&&!an)return!1;var n=!1;try{var r={};r[on]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}var hn=!cn(function(t){Array.from(t)});gt({target:"Array",stat:!0,forced:hn},{from:function(t,e,n){var r,i,o,a,s=_t(t),u="function"==typeof this?this:Array,c=arguments.length,h=1<c?e:void 0,l=void 0!==h,f=0,p=$e(s);if(l&&(h=wt(h,2<c?n:void 0,2)),null==p||u==Array&&Ye(p))for(i=new u(r=pt(s.length));f<r;f++)Xe(i,f,l?h(s[f],f):s[f]);else for(a=p.call(s),i=new u;!(o=a.next()).done;f++)Xe(i,f,l?ze(a,h,[o.value,f],!0):o.value);return i.length=f,i}});At.Array.from;var ln=Object.assign,fn=!ln||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=ln({},t)[n]||te(ln({},e)).join("")!=r})?function(t,e){for(var n=_t(t),r=arguments.length,i=1,o=Ut.f,a=L.f;i<r;)for(var s,u=q(arguments[i++]),c=o?te(u).concat(o(u)):te(u),h=c.length,l=0;l<h;)s=c[l++],P&&!a.call(u,s)||(n[s]=u[s]);return n}:ln;gt({target:"Object",stat:!0,forced:Object.assign!==fn},{assign:fn});At.Object.assign;function pn(s){return function(t){for(var e,n=b(t),r=te(n),i=r.length,o=0,a=[];o<i;)e=r[o++],P&&!dn.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var dn=L.f,yn={entries:pn(!0),values:pn(!1)},mn=yn.entries;gt({target:"Object",stat:!0},{entries:function(t){return mn(t)}});At.Object.entries;var vn=yn.values;gt({target:"Object",stat:!0},{values:function(t){return vn(t)}});At.Object.values;function gn(t){if(function(t){var e;return w(t)&&(void 0!==(e=t[bn])?!!e:"RegExp"==y(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}var bn=Et("match"),wn=Et("match"),_n="".startsWith,En=Math.min;gt({target:"String",proto:!0,forced:!function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[wn]=!1,"/./"[e](n)}catch(t){}}return!1}("startsWith")},{startsWith:function(t,e){var n=String(g(this));gn(t);var r=pt(En(1<arguments.length?e:void 0,n.length)),i=String(t);return _n?_n.call(n,i,r):n.slice(r,r+i.length)===i}});pe("String","startsWith");gt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(g(this)),n="",r=ft(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});pe("String","repeat");function Tn(t){if(!w(t))return!1;var e=t[Cn];return void 0!==e?!!e:Gt(t)}var Sn,In=Et("species"),Cn=Et("isConcatSpreadable"),Nn=9007199254740991,An="Maximum allowed index exceeded",kn=!m(function(){var t=[];return t[Cn]=!1,t.concat()[0]!==t}),Dn=(Sn="concat",!m(function(){var t=[];return(t.constructor={})[In]=function(){return{foo:1}},1!==t[Sn](Boolean).foo}));gt({target:"Array",proto:!0,forced:!kn||!Dn},{concat:function(t){var e,n,r,i,o,a=_t(this),s=Tt(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Tn(o=-1===e?a:arguments[e])){if(i=pt(o.length),Nn<u+i)throw TypeError(An);for(n=0;n<i;n++,u++)n in o&&Xe(s,u,o[n])}else{if(Nn<=u)throw TypeError(An);Xe(s,u++,o)}return s.length=u,s}});var Rn={};Rn[Et("toStringTag")]="z";var On="[object z]"!==String(Rn)?function(){return"[object "+Je(this)+"]"}:Rn.toString,Pn=Object.prototype;On!==Pn.toString&&Nt(Pn,"toString",On,{unsafe:!0});function xn(t){var e=At.Symbol||(At.Symbol={});E(e,t)||Kn(e,t,{value:Wn.f(t)})}function Mn(t,e){var n=ar[t]=ae(Zn[zn]);return Xn(n,{type:Gn,tag:t,description:e}),P||(n.description=e),n}function Ln(e,t){S(e);var n=b(t),r=te(n).concat(vr(n));return Qn(r,function(t){P&&!mr.call(n,t)||yr(e,t,n[t])}),e}function Fn(t,e){var n=b(t),r=_(e,!0);if(n!==$n||!E(ar,r)||E(sr,r)){var i=nr(n,r);return!i||!E(ar,r)||E(n,Hn)&&n[Hn][r]||(i.enumerable=!0),i}}function Un(t){var e=ir(b(t)),n=[];return Qn(e,function(t){E(ar,t)||E(rt,t)||n.push(t)}),n}var qn=Ft.f,Vn={}.toString,Bn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],jn={f:function(t){return Bn&&"[object Window]"==Vn.call(t)?function(t){try{return qn(t)}catch(t){return Bn.slice()}}(t):qn(b(t))}},Wn={f:Et},Kn=G.f,Qn=Zt.forEach,Hn=N("hidden"),Gn="Symbol",zn="prototype",Yn=Et("toPrimitive"),Xn=Ct.set,Jn=Ct.getterFor(Gn),$n=Object[zn],Zn=O.Symbol,tr=O.JSON,er=tr&&tr.stringify,nr=Q.f,rr=G.f,ir=jn.f,or=L.f,ar=X("symbols"),sr=X("op-symbols"),ur=X("string-to-symbol-registry"),cr=X("symbol-to-string-registry"),hr=X("wks"),lr=O.QObject,fr=!lr||!lr[zn]||!lr[zn].findChild,pr=P&&m(function(){return 7!=ae(rr({},"a",{get:function(){return rr(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=nr($n,e);r&&delete $n[e],rr(t,e,n),r&&t!==$n&&rr($n,e,r)}:rr,dr=zt&&"symbol"==typeof Zn.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Zn},yr=function(t,e,n){t===$n&&yr(sr,e,n),S(t);var r=_(e,!0);return S(n),E(ar,r)?(n.enumerable?(E(t,Hn)&&t[Hn][r]&&(t[Hn][r]=!1),n=ae(n,{enumerable:v(0,!1)})):(E(t,Hn)||rr(t,Hn,v(1,{})),t[Hn][r]=!0),pr(t,r,n)):rr(t,r,n)},mr=function(t){var e=_(t,!0),n=or.call(this,e);return!(this===$n&&E(ar,e)&&!E(sr,e))&&(!(n||!E(this,e)||!E(ar,e)||E(this,Hn)&&this[Hn][e])||n)},vr=function(t){var e=t===$n,n=ir(e?sr:b(t)),r=[];return Qn(n,function(t){!E(ar,t)||e&&!E($n,t)||r.push(ar[t])}),r};zt||(Nt((Zn=function(t){if(this instanceof Zn)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=C(e),r=function(t){this===$n&&r.call(sr,t),E(this,Hn)&&E(this[Hn],n)&&(this[Hn][n]=!1),pr(this,n,v(1,t))};return P&&fr&&pr($n,n,{configurable:!0,set:r}),Mn(n,e)})[zn],"toString",function(){return Jn(this).tag}),L.f=mr,G.f=yr,Q.f=Fn,Ft.f=jn.f=Un,Ut.f=vr,P&&(rr(Zn[zn],"description",{configurable:!0,get:function(){return Jn(this).description}}),Nt($n,"propertyIsEnumerable",mr,{unsafe:!0})),Wn.f=function(t){return Mn(Et(t),t)}),gt({global:!0,wrap:!0,forced:!zt,sham:!zt},{Symbol:Zn}),Qn(te(hr),function(t){xn(t)}),gt({target:Gn,stat:!0,forced:!zt},{for:function(t){var e=String(t);if(E(ur,e))return ur[e];var n=Zn(e);return ur[e]=n,cr[n]=e,n},keyFor:function(t){if(!dr(t))throw TypeError(t+" is not a symbol");if(E(cr,t))return cr[t]},useSetter:function(){fr=!0},useSimple:function(){fr=!1}}),gt({target:"Object",stat:!0,forced:!zt,sham:!P},{create:function(t,e){return void 0===e?ae(t):Ln(ae(t),e)},defineProperty:yr,defineProperties:Ln,getOwnPropertyDescriptor:Fn}),gt({target:"Object",stat:!0,forced:!zt},{getOwnPropertyNames:Un,getOwnPropertySymbols:vr}),gt({target:"Object",stat:!0,forced:m(function(){Ut.f(1)})},{getOwnPropertySymbols:function(t){return Ut.f(_t(t))}}),tr&&gt({target:"JSON",stat:!0,forced:!zt||m(function(){var t=Zn();return"[null]"!=er([t])||"{}"!=er({a:t})||"{}"!=er(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;i<arguments.length;)r.push(arguments[i++]);if(n=e=r[1],(w(e)||void 0!==t)&&!dr(t))return Gt(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!dr(e))return e}),r[1]=e,er.apply(tr,r)}}),Zn[zn][Yn]||z(Zn[zn],Yn,Zn[zn].valueOf),ke(Zn,Gn),rt[Hn]=!0,xn("asyncIterator");var gr=G.f,br=O.Symbol;if(!(!P||"function"!=typeof br||"description"in br.prototype&&void 0===br().description)){var wr={},_r=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof _r?new br(e):void 0===e?br():br(e);return""===e&&(wr[n]=!0),n};mt(_r,br);var Er=_r.prototype=br.prototype;Er.constructor=_r;var Tr=Er.toString,Sr="Symbol(test)"==String(br("test")),Ir=/^Symbol\((.*)\)[^)]+$/;gr(Er,"description",{configurable:!0,get:function(){var t=w(this)?this.valueOf():this,e=Tr.call(t);if(E(wr,t))return"";var n=Sr?e.slice(7,-1):e.replace(Ir,"$1");return""===n?void 0:n}}),gt({global:!0,forced:!0},{Symbol:_r})}xn("hasInstance"),xn("isConcatSpreadable"),xn("iterator"),xn("match"),xn("matchAll"),xn("replace"),xn("search"),xn("species"),xn("split"),xn("toPrimitive"),xn("toStringTag"),xn("unscopables"),ke(Math,"Math",!0),ke(O.JSON,"JSON",!0);At.Symbol;xn("dispose"),xn("observable"),xn("patternMatch"),xn("replaceAll");var Cr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Nr="Array Iterator",Ar=Ct.set,kr=Ct.getterFor(Nr),Dr=Oe(Array,"Array",function(t,e){Ar(this,{type:Nr,target:b(t),index:0,kind:e})},function(){var t=kr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");Le.Arguments=Le.Array,ce("keys"),ce("values"),ce("entries");var Rr=Et("iterator"),Or=Et("toStringTag"),Pr=Dr.values;for(var xr in Cr){var Mr=O[xr],Lr=Mr&&Mr.prototype;if(Lr){if(Lr[Rr]!==Pr)try{z(Lr,Rr,Pr)}catch(To){Lr[Rr]=Pr}if(Lr[Or]||z(Lr,Or,xr),Cr[xr])for(var Fr in Dr)if(Lr[Fr]!==Dr[Fr])try{z(Lr,Fr,Dr[Fr])}catch(To){Lr[Fr]=Dr[Fr]}}}Wn.f("iterator");function Ur(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function qr(r,t,e,i,o){function n(t){var n=s[t];Nt(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!w(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!w(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=O[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Qt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Wr.REQUIRED=!0;else if(Qt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=cn(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){Ur(t,u,r);var n=function(t,e,n){var r,i;return Ue&&"function"==typeof(r=e.constructor)&&r!==n&&w(i=r.prototype)&&i!==n.prototype&&Ue(t,i),t}(new a,t,u);return null!=e&&Kr(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,gt({global:!0,forced:u!=a},h),ke(u,r),o||e.setStrong(u,r,i),u}function Vr(t,e,n){for(var r in e)Nt(t,r,e[r],n);return t}function Br(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return bt(this),(r=void 0!==u)&&bt(u),null==t?new this:(i=[],r?(o=0,a=wt(u,2<s?n:void 0,2),Kr(t,function(t){i.push(a(t,o++))})):Kr(t,i.push,i),new this(i))}var jr=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Wr=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=G.f,r=C("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!w(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!E(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!E(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return jr&&a.REQUIRED&&o(t)&&!E(t,r)&&n(t),t}};rt[r]=!0}),Kr=(Wr.REQUIRED,Wr.fastKey,Wr.getWeakData,Wr.onFreeze,e(function(t){function f(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l=wt(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=$e(t)))throw TypeError("Target is not iterable");if(Ye(a)){for(s=0,u=pt(t.length);s<u;s++)if((c=r?l(S(h=t[s])[0],h[1]):l(t[s]))&&c instanceof f)return c;return new f(!1)}o=a.call(t)}for(;!(h=o.next()).done;)if((c=ze(o,l,h.value,r))&&c instanceof f)return c;return new f(!1)}).stop=function(t){return new f(!0,t)}})),Qr=Et("species"),Hr=G.f,Gr=Wr.fastKey,zr=Ct.set,Yr=Ct.getterFor,Xr={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Gr(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),P?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){Ur(t,a,n),zr(t,{type:n,index:ae(null),first:void 0,last:void 0,size:0}),P||(t.size=0),null!=e&&Kr(e,t[i],t,r)}),s=Yr(n),u=function(t,e){var n,r=s(t),i=Gr(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Vr(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,P?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),P?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=wt(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Vr(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),P&&Hr(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Yr(e),o=Yr(r);Oe(t,e,function(t,e){zr(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),function(t){var e=lt(t),n=G.f;P&&e&&!e[Qr]&&n(e,Qr,{configurable:!0,get:function(){return this}})}(e)}};qr("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xr,!0),At.Map;gt({target:"Map",stat:!0},{from:Br});function Jr(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}gt({target:"Map",stat:!0},{of:Jr});function $r(){for(var t=S(this),e=bt(t.delete),n=!0,r=0,i=arguments.length;r<i;r++)n=n&&e.call(t,arguments[r]);return!!n}gt({target:"Map",proto:!0,real:!0,forced:Y},{deleteAll:function(){return $r.apply(this,arguments)}});function Zr(t){return Map.prototype.entries.call(t)}gt({target:"Map",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return!Kr(r,function(t,e){if(!i(e,t,n))return Kr.stop()},void 0,!0,!0).stopped}});function ti(t,e){var n,r=S(t).constructor;return void 0===r||null==(n=S(r)[ei])?e:bt(n)}var ei=Et("species");gt({target:"Map",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop(e)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{findKey:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;bt(n);var i=bt(r.has),o=bt(r.get),a=bt(r.set);return Kr(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});gt({target:"Map",proto:!0,real:!0,forced:Y},{includes:function(n){return Kr(Zr(S(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return Kr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;bt(e);var r=bt(n.set);return Kr(t,function(t){r.call(n,e(t),t)}),n}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{keyOf:function(n){return Kr(Zr(S(this)),function(t,e){if(e===n)return Kr.stop(t)},void 0,!0,!0).result}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapKeys:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{mapValues:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Map"))),a=bt(o.set);return Kr(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{merge:function(t){for(var e=S(this),n=bt(e.set),r=0;r<arguments.length;)Kr(arguments[r++],n,e,!0);return e}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{reduce:function(n,t){var r,e,i=S(this),o=Zr(i);if(bt(n),1<arguments.length)r=t;else{if((e=o.next()).done)throw TypeError("Reduce of empty map with no initial value");r=e.value[1]}return Kr(o,function(t,e){r=n(r,e,t,i)},void 0,!0,!0),r}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=Zr(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t,e){if(i(e,t,n))return Kr.stop()},void 0,!0,!0).stopped}}),gt({target:"Map",proto:!0,real:!0,forced:Y},{update:function(t,e,n){var r=S(this),i=arguments.length;bt(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):bt(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}});qr("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},Xr),At.Set;gt({target:"Set",stat:!0},{from:Br}),gt({target:"Set",stat:!0},{of:Jr});gt({target:"Set",proto:!0,real:!0,forced:Y},{addAll:function(){return function(){for(var t=S(this),e=bt(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{deleteAll:function(){return $r.apply(this,arguments)}});function ni(t){return Set.prototype.values.call(t)}gt({target:"Set",proto:!0,real:!0,forced:Y},{every:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return!Kr(r,function(t){if(!i(t,t,n))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{difference:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e),r=bt(n.delete);return Kr(t,function(t){r.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{filter:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Set"))),a=bt(o.add);return Kr(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{find:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t){if(i(t,t,n))return Kr.stop(t)},void 0,!1,!0).result}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{intersection:function(t){var e=S(this),n=new(ti(e,lt("Set"))),r=bt(e.has),i=bt(n.add);return Kr(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isDisjointFrom:function(t){var e=S(this),n=bt(e.has);return!Kr(t,function(t){if(!0===n.call(e,t))return Kr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSubsetOf:function(t){var e=function(t){var e=$e(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return S(e.call(t))}(this),n=S(t),r=n.has;return"function"!=typeof r&&(n=new(lt("Set"))(t),r=bt(n.has)),!Kr(e,function(t){if(!1===r.call(n,t))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{isSupersetOf:function(t){var e=S(this),n=bt(e.has);return!Kr(t,function(t){if(!1===n.call(e,t))return Kr.stop()}).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{join:function(t){var e=S(this),n=ni(e),r=void 0===t?",":String(t),i=[];return Kr(n,i.push,i,!1,!0),i.join(r)}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{map:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3),o=new(ti(n,lt("Set"))),a=bt(o.add);return Kr(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{reduce:function(e,t){var n,r,i=S(this),o=ni(i);if(bt(e),1<arguments.length)n=t;else{if((r=o.next()).done)throw TypeError("Reduce of empty set with no initial value");n=r.value}return Kr(o,function(t){n=e(n,t,t,i)},void 0,!1,!0),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{some:function(t,e){var n=S(this),r=ni(n),i=wt(t,1<arguments.length?e:void 0,3);return Kr(r,function(t){if(i(t,t,n))return Kr.stop()},void 0,!1,!0).stopped}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{symmetricDifference:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e),r=bt(n.delete),i=bt(n.add);return Kr(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),gt({target:"Set",proto:!0,real:!0,forced:Y},{union:function(t){var e=S(this),n=new(ti(e,lt("Set")))(e);return Kr(t,bt(n.add),n),n}});var ri=function(t,e){return(ri=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ii(t,e){function n(){this.constructor=t}ri(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var oi=function(){return(oi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ai(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function si(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ui(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ci(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function hi(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ci(arguments[e]));return t}function li(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function fi(t){try{return mi.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var pi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},di=function(t,e){if(!t)throw yi(e)},yi=function(t){return new Error("Firebase Database ("+pi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},mi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(li(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function vi(t){return gi(void 0,t)}function gi(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=gi(t[n],e[n]));return t}var bi=(wi.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},wi);function wi(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function _i(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ei(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_i())}function Ti(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Si(){return!0===pi.NODE_ADMIN}var Ii,Ci=(ii(Ni,Ii=Error),Ni);function Ni(t,e){var n=Ii.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Ni.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ai.prototype.create),n}var Ai=(ki.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Di,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Ci(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},ki);function ki(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Di=/\{\$([^}]+)}/g;function Ri(t){return JSON.parse(t)}function Oi(t){return JSON.stringify(t)}function Pi(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ri(fi(o[0])||""),n=Ri(fi(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function xi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mi(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Li(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Fi(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Ui=(qi.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},qi.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},qi.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},qi.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},qi);function qi(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Vi(t,e){var n=new Bi(t,e);return n.subscribe.bind(n)}var Bi=(ji.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},ji.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},ji.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},ji.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Wi),void 0===r.error&&(r.error=Wi),void 0===r.complete&&(r.complete=Wi);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},ji.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},ji.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},ji.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},ji.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},ji);function ji(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Wi(){}function Ki(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Qi(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Hi(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Qi(t,e,r)+"must be a valid function.")}function Gi(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Qi(t,e,r)+"must be a valid context object.")}function zi(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var Yi,Xi;(Xi=Yi=Yi||{})[Xi.DEBUG=0]="DEBUG",Xi[Xi.VERBOSE=1]="VERBOSE",Xi[Xi.INFO=2]="INFO",Xi[Xi.WARN=3]="WARN",Xi[Xi.ERROR=4]="ERROR",Xi[Xi.SILENT=5]="SILENT";function Ji(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Yi.DEBUG:case Yi.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Yi.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var $i,Zi=Yi.INFO,to=(Object.defineProperty(eo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Yi))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(eo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),eo.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.DEBUG].concat(t))},eo.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.VERBOSE].concat(t))},eo.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.INFO].concat(t))},eo.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.WARN].concat(t))},eo.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Yi.ERROR].concat(t))},eo);function eo(t){this.name=t,this._logLevel=Zi,this._logHandler=Ji}var no=(($i={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",$i["bad-app-name"]="Illegal App name: '{$appName}",$i["duplicate-app"]="Firebase App named '{$appName}' already exists",$i["app-deleted"]="Firebase App named '{$appName}' already deleted",$i["duplicate-service"]="Firebase service named '{$appName}' already registered",$i["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",$i),ro=new Ai("app","Firebase",no),io="[DEFAULT]",oo=[],ao=(Object.defineProperty(so.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(so.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(so.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),so.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},so.prototype._getService=function(t,e){if(void 0===e&&(e=io),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==io?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},so.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=io),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},so.prototype.extendApp=function(t){var e=this;gi(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(oo.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),oo=[])},so.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ro.create("app-deleted",{appName:this.name_})},so);function so(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=vi(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){oo.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){oo=oo.filter(function(t){return t!==e})}}}ao.prototype.name&&ao.prototype.options||ao.prototype.delete||console.log("dc");var uo="6.3.5";var co=new to("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){co.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ho=self.firebase.SDK_VERSION;ho&&0<=ho.indexOf("LITE")&&co.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var lo=function t(){var e=function(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={}),"object"==typeof e&&null!==e||(e={name:e});var n=e;void 0===n.name&&(n.name=io);var r=n.name;if("string"!=typeof r||!r)throw ro.create("bad-app-name",{appName:String(r)});if(xi(o,r))throw ro.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:uo,INTERNAL:{registerService:function(n,t,e,r,i){if(void 0===i&&(i=!1),s[n])throw ro.create("duplicate-service",{appName:n});function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw ro.create("invalid-app-argument",{appName:n});return t[n]()}return s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)})),void 0!==e&&gi(o,e),c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!xi(o,t=t||io))throw ro.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(0,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}(ao);return e.INTERNAL=oi({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){gi(e,t)},createSubscribe:Vi,ErrorFactory:Ai,deepExtend:gi}),e}(),fo=lo.initializeApp;lo.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&co.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),fo.apply(void 0,t)};var il=lo;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.o),reject:t(this.g)}},s.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.u(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.l(t):this.h(t)}},s.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},s.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.u=function(t){var e=this.f();t.Ha(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.Ha(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.Ha=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).Ha(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).Ha(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},h=this||self;function l(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function v(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),g=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var T=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.mb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).ad=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||h).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(v(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var M=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(l(t))return l(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=l(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=l(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=l(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function q(t,e){return 0<=M(t,e)}function V(t,e){var n;return(n=0<=(e=M(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=l(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.na=!0,Y.prototype.ma=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.na=!0,tt.prototype.ma=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function vt(){this.a="",this.b=Et}function gt(t){return t instanceof vt&&t.constructor===vt&&t.b===Et?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}vt.prototype.na=!0,vt.prototype.ma=function(){return this.a.toString()},vt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof vt?t:(t="object"==typeof t&&t.na?t.ma():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Tt(t))}var _t,Et={};function Tt(t){var e=new vt;return e.a=t,e}Tt("about:blank");t:{var St=h.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.na=!0,Nt.prototype.ma=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Mt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){h.setTimeout(function(){throw t},0)}function Ft(){var t=h.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));x(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){h.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).ub;n.ub=null,t()}},function(t){r.next={ub:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(h.Promise&&h.Promise.resolve){var t=h.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(h.setImmediate)||h.Window&&h.Window.prototype&&!Ct("Edge")&&h.Window.prototype.setImmediate==h.setImmediate?(Rt=Rt||Ft())(t):h.setImmediate(t)}}(),qt||(Ot(),qt=!0),Vt.add(t,e)}Dt("<br>");var qt=!1,Vt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=Vt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;qt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(E(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Cb:!0,value:n}:{Cb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],E(t,e,!0),E(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Jc,t.Kc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(v(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Ub,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ha=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Jc=function(t){this.a=Wt,ee(this,Kt,t)},t.Kc=function(t){this.a=Wt,ee(this,Qt,t)},t.Ub=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.qa=this.qa,this.ia=this.ia}S(ue,C);var he=0;function le(t){if(!t.qa&&(t.qa=!0,t.va(),0!=he))t[e]||(t[e]=++g)}function fe(t){return fe[" "](t),t}ce.prototype.qa=!(ue.prototype.name="cancel"),ce.prototype.va=function(){if(this.ia)for(;this.ia.length;)this.ia.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ve=Ct("Edge"),ge=ve||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=h.document;return t?t.documentMode:void 0}t:{var Ee="",Te=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ve?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Te&&(Ee=Te?Te[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Ee)){pe=String(Se);break t}}pe=Ee}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=h.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{h.addEventListener("test",p,e),h.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Ib=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=l(t.pointerType)?t.pointerType:xe[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Ib=!1},S(Pe,Oe);var xe=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.mb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var Me="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.La=i,this.key=++Le,this.oa=this.Ga=!1}function Ue(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.La=null}function qe(t){this.src=t,this.a={},this.b=0}function Ve(t,e){var n=e.type;n in t.a&&V(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.La==r)return i}return-1}qe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ga=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ga=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[Me]?rn(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new qe(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[Me]?on(t,e,n,v(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=v(r)?!!r.capture:!!r,n=en(n),t&&t[Me]?(t=t.m,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[Me])Ve(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(Ve(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.La||t.src;return t.Ga&&ze(t),n.call(r,e)}function $e(t,e){if(t.oa)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=h,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof qe?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.m=new qe(this),(this.Nb=this).Ua=null}function rn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.La||a.src;a.Ga&&Ve(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ib}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw h.clearTimeout(r),t})}function cn(t){if(t.S&&"function"==typeof t.S)return t.S();if(l(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||l(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[Me]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Ua;if(n)for(e=[];n;n=n.Ua)e.push(n);n=this.Nb;var r=t.type||t;if(l(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.va=function(){if(nn.mb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Ua=null},(t=ln.prototype).S=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,vn(this,t.m),this.c=t.c,gn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=Tn(n[2]||""),this.b=Tn(n[3]||"",!0),vn(this,n[4]),this.c=Tn(n[5]||"",!0),gn(this,n[6]||"",!0),this.g=Tn(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?Tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.m=e}else t.m=null}function gn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(xn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function En(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return l(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)vn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?gn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function xn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function Mn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){xn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.U=function(){On(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){On(this);var e=[];if(l(t))Mn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,Mn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var qn=!me||9<=Number(Ie);function Vn(t){var e=document;return l(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.na&&(t=t.ma()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!qn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Mt(a.name),'"'),a.type){o.push(' type="',Mt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(l(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(l(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||v(o)&&0<o.nodeType?r(o):L(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(v(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return h.window&&h.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||h.window;var n="about:blank";t&&(n=gt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||h.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof vt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof vt||e instanceof vt||(e="object"==typeof e&&e.na?e.ma():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Tt(e)),a.href=gt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=gt(e).toString(),a&&(ge&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Mt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(gt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==h.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=h.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==h.WorkerGlobalScope&&"function"==typeof h.importScripts}function ur(){return il.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":il.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Qc:"FirebaseCore-web",Sc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return h.navigator&&h.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||h;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function vr(){try{var t=h.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!h.indexedDB}catch(t){return sr()&&!!h.indexedDB}return!1}function gr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&vr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return h.location&&h.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Er(t){return void 0===t?null:Qn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=h.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=h.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",h)&&!mr("fireauth.iframe",h))}Ar.prototype.get=function(){var t=h.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function xr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Mr={};Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Mr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==Mr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function qr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,qr(t[n]));return e}function Vr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,Lr(this,zr,t),Lr(this,Gr,qr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=t[ii];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ti];if(n&&"object"==typeof n){e=n[si];var r=n[oi];if(n=n[ai],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",oi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",ai+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",si+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ti+" property must be a non null object when specified.");if(this.f=null,(e=t[ri])&&"object"==typeof e){if("string"==typeof(e=e[ui])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",ui+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",ri+" property must be a non null object when specified.");if(void 0!==(e=t[ni])&&"boolean"!=typeof e)throw new Yr("argument-error",ni+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ei])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",ei+" property must be a non empty string when specified.");this.i=t||null}var ti="android",ei="dynamicLinkDomain",ni="handleCodeInApp",ri="iOS",ii="url",oi="installApp",ai="minimumVersion",si="packageName",ui="bundleId";function ci(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var hi=null,li=null;function fi(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=li[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!hi){hi={},li={};for(var t=0;t<65;t++)hi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(li[hi[t]]=t)&&(li["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function pi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function di(t){return(t=yi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new pi(t):null}function yi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(fi(t))}catch(t){}return null}pi.prototype.f=function(){return this.b};var mi,vi={Wc:{Za:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://securetoken.googleapis.com/v1/token",id:"p"},Yc:{Za:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",fb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Zc:{Za:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",fb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function gi(t){for(var e in vi)if(vi[e].id===t)return{firebaseEndpoint:(t=vi[e]).Za,secureTokenEndpoint:t.fb};return null}mi=gi("__EID__")?"__EID__":void 0;var bi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),wi=["client_id","response_type","scope","redirect_uri","state"],_i={Rc:{Ma:"locale",Ba:500,Aa:600,Na:"facebook.com",eb:wi},Tc:{Ma:null,Ba:500,Aa:620,Na:"github.com",eb:wi},Uc:{Ma:"hl",Ba:515,Aa:680,Na:"google.com",eb:wi},$c:{Ma:"lang",Ba:485,Aa:705,Na:"twitter.com",eb:bi}};function Ei(t){for(var e in _i)if(_i[e].Na==t)return _i[e];return null}function Ti(t){var e={};e["facebook.com"]=Ai,e["google.com"]=Di,e["github.com"]=ki,e["twitter.com"]=Ri;var n=t&&t[Ii];try{if(n)return e[n]?new e[n](t):new Ni(t);if(void 0!==t[Si])return new Ci(t)}catch(t){}return null}var Si="idToken",Ii="providerId";function Ci(t){var e=t[Ii];if(!e&&t[Si]){var n=di(t[Si]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Ni(t){Ci.call(this,t),Lr(this,"profile",qr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Ai(t){if(Ni.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function ki(t){if(Ni.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function Di(t){if(Ni.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ri(t){if(Ni.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Oi(t){this.a=_n(t)}function Pi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function xi(){}function Mi(t,n){return t.then(function(t){if(t[Sa]){var e=di(t[Sa]);if(!e||n!=e.c)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Li(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Fi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Ui(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Li(t.providerId,t.pendingToken)}catch(t){}return null}function qi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function Vi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Bi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new qi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function ji(t,e){this.Ac=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.vb={},this.$a=(Ei(t)||{}).Ma||null,this.Ya=null}function Wi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');ji.call(this,t,[])}function Ki(t){ji.call(this,t,wi),this.a=[]}function Qi(){Ki.call(this,"facebook.com")}function Hi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Qi).credential({accessToken:e})}function Gi(){Ki.call(this,"github.com")}function zi(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return v(t)&&(e=t.accessToken),(new Gi).credential({accessToken:e})}function Yi(){Ki.call(this,"google.com"),this.ua("profile")}function Xi(t,e){var n=t;return v(t)&&(n=t.idToken,e=t.accessToken),(new Yi).credential({idToken:n,accessToken:e})}function Ji(){ji.call(this,"twitter.com",bi)}function $i(t,e){var n=t;if(v(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new qi("twitter.com",n,"twitter.com")}function Zi(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===eo.EMAIL_LINK_SIGN_IN_METHOD?eo.EMAIL_LINK_SIGN_IN_METHOD:eo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function to(t){return t&&t.email&&t.password?new Zi(t.email,t.password,t.signInMethod):null}function eo(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function no(t,e){if(!(e=ro(e)))throw new Yr("argument-error","Invalid email link!");return new Zi(t,e,eo.EMAIL_LINK_SIGN_IN_METHOD)}function ro(t){var e=wn((t=new Oi(t=Pi(t))).a,"oobCode")||null;return"signIn"===(wn(t.a,"mode")||null)&&e?e:null}function io(t){if(!(t.Sa&&t.Ra||t.Da&&t.$))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function oo(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new io(n)}return null}function ao(t){return t.a.Da&&t.a.$?{temporaryProof:t.a.Da,phoneNumber:t.a.$}:{sessionInfo:t.a.Sa,code:t.a.Ra}}function so(t){try{this.a=t||il.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function uo(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new io({Sa:t,Ra:e})}function co(t){if(t.temporaryProof&&t.phoneNumber)return new io({Da:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Xi(o,n);case"facebook.com":return Hi(n);case"github.com":return zi(n);case"twitter.com":return $i(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Li(e,a):new qi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Ki(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function ho(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function lo(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function fo(t){return(t=t||{}).type?new lo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody):null}function po(){this.b=null,this.a=[]}S(Ni,Ci),S(Ai,Ni),S(ki,Ni),S(Di,Ni),S(Ri,Ni),Li.prototype.ka=function(t){return ja(t,Fi(this))},Li.prototype.b=function(t,e){var n=Fi(this);return n.idToken=e,Wa(t,n)},Li.prototype.f=function(t,e){return Mi(Ka(t,Fi(this)),e)},Li.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},qi.prototype.ka=function(t){return ja(t,Vi(this))},qi.prototype.b=function(t,e){var n=Vi(this);return n.idToken=e,Wa(t,n)},qi.prototype.f=function(t,e){return Mi(Ka(t,Vi(this)),e)},qi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},ji.prototype.Ca=function(t){return this.vb=H(t),this},S(Wi,ji),S(Ki,ji),Ki.prototype.ua=function(t){return q(this.a,t)||this.a.push(t),this},Ki.prototype.Db=function(){return W(this.a)},Ki.prototype.credential=function(t,e){var n;if(!(n=v(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new qi(this.providerId,n,this.providerId)},S(Qi,Ki),Lr(Qi,"PROVIDER_ID","facebook.com"),Lr(Qi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(Gi,Ki),Lr(Gi,"PROVIDER_ID","github.com"),Lr(Gi,"GITHUB_SIGN_IN_METHOD","github.com"),S(Yi,Ki),Lr(Yi,"PROVIDER_ID","google.com"),Lr(Yi,"GOOGLE_SIGN_IN_METHOD","google.com"),S(Ji,ji),Lr(Ji,"PROVIDER_ID","twitter.com"),Lr(Ji,"TWITTER_SIGN_IN_METHOD","twitter.com"),Zi.prototype.ka=function(t){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,$a,{email:this.a,oobCode:this.c}):bs(t,ys,{email:this.a,password:this.c})},Zi.prototype.b=function(t,e){return this.signInMethod==eo.EMAIL_LINK_SIGN_IN_METHOD?bs(t,Za,{idToken:e,email:this.a,oobCode:this.c}):bs(t,cs,{idToken:e,email:this.a,password:this.c})},Zi.prototype.f=function(t,e){return Mi(this.ka(t),e)},Zi.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(eo,{PROVIDER_ID:"password"}),Fr(eo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(eo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),io.prototype.ka=function(t){return t.Ta(ao(this))},io.prototype.b=function(t,e){var n=ao(this);return n.idToken=e,bs(t,vs,n)},io.prototype.f=function(t,e){var n=ao(this);return n.operation="REAUTH",Mi(t=bs(t,gs,n),e)},io.prototype.A=function(){var t={providerId:"phone"};return this.a.Sa&&(t.verificationId=this.a.Sa),this.a.Ra&&(t.verificationCode=this.a.Ra),this.a.Da&&(t.temporaryProof=this.a.Da),this.a.$&&(t.phoneNumber=this.a.$),t},so.prototype.Ta=function(e,n){var r=this.a.c;return Yt(n.verify()).then(function(t){if(!l(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return bs(t,ss,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(so,{PROVIDER_ID:"phone"}),Fr(so,{PHONE_SIGN_IN_METHOD:"phone"}),lo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},lo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.A()}};var yo,mo=null;function vo(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function go(t,e,n){Yr.call(this,t,n),(t=e||{}).wb&&Lr(this,"email",t.wb),t.$&&Lr(this,"phoneNumber",t.$),t.credential&&Lr(this,"credential",t.credential)}function bo(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:co(t)};if(t.email)n.wb=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new go(e,n,t.message)}return null}function wo(){}function _o(t){return t.c||(t.c=t.b())}function Eo(){}function To(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function So(){}function Io(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.ac,this),this.a.onerror=_(this.Eb,this),this.a.onprogress=_(this.bc,this),this.a.ontimeout=_(this.fc,this)}function Co(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function No(t,e,n){this.reset(t,e,n,void 0,void 0)}function Ao(t){this.f=t,this.b=this.c=this.a=null}function ko(t,e){this.name=t,this.value=e}S(vo,Yr),S(go,Yr),go.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.A();return e&&z(t,e),t},go.prototype.toJSON=function(){return this.A()},wo.prototype.c=null,S(Eo,wo),Eo.prototype.a=function(){var t=To(this);return t?new ActiveXObject(t):new XMLHttpRequest},Eo.prototype.b=function(){var t={};return To(this)&&(t[0]=!0,t[1]=!0),t},yo=new Eo,S(So,wo),So.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Io;throw Error("Unsupported browser")},So.prototype.b=function(){return{}},(t=Io.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.ac=function(){this.status=200,this.response=this.responseText=this.a.responseText,Co(this,4)},t.Eb=function(){this.status=500,this.response=this.responseText="",Co(this,4)},t.fc=function(){this.Eb()},t.bc=function(){this.status=200,Co(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},No.prototype.a=null,No.prototype.reset=function(t,e,n,r,i){delete this.a},ko.prototype.toString=function(){return this.name};var Do=new ko("SEVERE",1e3),Ro=new ko("WARNING",900),Oo=new ko("CONFIG",700),Po=new ko("FINE",500);Ao.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new No(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var xo,Mo={},Lo=null;function Fo(t){var e;if(Lo||(Lo=new Ao(""),(Mo[""]=Lo).c=Oo),!(e=Mo[t])){e=new Ao(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Fo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Mo[t]=e}return e}function Uo(t,e){t&&t.log(Po,e,void 0)}function qo(t){this.f=t}function Vo(t){nn.call(this),this.u=t,this.readyState=Bo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Fo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(qo,wo),qo.prototype.a=function(){return new Vo(this.f)},qo.prototype.b=(xo={},function(){return xo}),S(Vo,nn);var Bo=0;function jo(t){t.c.read().then(t.$b.bind(t)).catch(t.Ka.bind(t))}function Wo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Ko(t)}function Ko(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Qo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Ho,this.v=this.O=!1}(t=Vo.prototype).open=function(t,e){if(this.readyState!=Bo)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Ko(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.ec.bind(this),this.Ka.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Wo(this,!1)),this.readyState=Bo},t.ec=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Ko(this)),this.a&&(this.readyState=3,Ko(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.cc.bind(this),this.Ka.bind(this)):void 0!==h.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,jo(this)):t.text().then(this.dc.bind(this),this.Ka.bind(this)))))},t.$b=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Wo(this,!0):Ko(this),3==this.readyState&&jo(this)}},t.dc=function(t){this.a&&(this.response=this.responseText=t,Wo(this,!0))},t.cc=function(t){this.a&&(this.response=t,Wo(this,!0))},t.Ka=function(t){var e=this.h;e&&e.log(Ro,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Wo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Ro,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Ro,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Qo,nn);var Ho="";Qo.prototype.b=Fo("goog.net.XhrIo");var Go=/^https?$/i,zo=["POST","PUT"];function Yo(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.N=n,e.G=!1,e.c=!0,e.a=e.B?e.B.a():yo.a(),e.w=e.B?_o(e.B):_o(yo),e.a.onreadystatechange=_(e.Hb,e);try{Uo(e.b,ia(e,"Opening Xhr")),e.I=!0,e.a.open(n,String(t),!0),e.I=!1}catch(t){return Uo(e.b,ia(e,"Error opening Xhr: "+t.message)),void Jo(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||l(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=Xo,n=t.length,r=l(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:l(t)?t.charAt(e):t[e]}(o.U()),r=h.FormData&&t instanceof h.FormData,!q(zo,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.o&&(e.a.responseType=e.o),"withCredentials"in e.a&&e.a.withCredentials!==e.O&&(e.a.withCredentials=e.O);try{ea(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Uo(e.b,ia(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ea,e)):e.u=sn(e.Ea,e.g,e)),Uo(e.b,ia(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Uo(e.b,ia(e,"Send error: "+t.message)),Jo(e,t)}}function Xo(t){return"content-type"==t.toLowerCase()}function Jo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,$o(t),ta(t)}function $o(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Zo(e){if(e.c&&void 0!==u)if(e.w[1]&&4==na(e)&&2==ra(e))Uo(e.b,ia(e,"Local request error detected and ignored"));else if(e.i&&4==na(e))sn(e.Hb,0,e);else if(e.dispatchEvent("readystatechange"),4==na(e)){Uo(e.b,ia(e,"Request complete")),e.c=!1;try{var t,n=ra(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&h.self&&h.self.location){var a=h.self.location.protocol;o=a.substr(0,a.length-1)}i=!Go.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<na(e)?e.a.statusText:""}catch(t){Uo(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+ra(e)+"]",$o(e)}}finally{ta(e)}}}function ta(e,t){if(e.a){ea(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Do,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ea(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(h.clearTimeout(t.u),t.u=null)}function na(t){return t.a?t.a.readyState:0}function ra(t){try{return 2<na(t)?t.a.status:-1}catch(t){return-1}}function ia(t,e){return e+" ["+t.N+" "+t.l+" "+ra(t)+"]"}function oa(t){var e=ma;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.m=0}function aa(t,e,n){t.a=!0,t.c=n,t.f=!e,ha(t)}function sa(t){if(t.a){if(!t.l)throw new la(t);t.l=!1}}function ua(t,e,n,r){t.g.push([e,n,r]),t.a&&ha(t)}function ca(t){return U(t.g,function(t){return m(t[1])})}function ha(e){if(e.h&&e.a&&ca(e)){var n=e.h,r=da[n];r&&(h.clearTimeout(r.a),delete da[n]),e.h=0}e.b&&(e.b.m--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.u,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof h.Promise&&n instanceof h.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ca(e)||(r=!0)}}e.c=n,t&&(s=_(e.o,e,!0),t=_(e.o,e,!1),n instanceof oa?(ua(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new pa(n),da[n.a]=n,e.h=n.a)}function la(){C.call(this)}function fa(){C.call(this)}function pa(t){this.a=h.setTimeout(_(this.c,this),0),this.b=t}(t=Qo.prototype).Ea=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Uo(this.b,ia(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Uo(this.b,ia(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ta(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ta(this,!0)),Qo.mb.va.call(this)},t.Hb=function(){this.qa||(this.I||this.i||this.f?Zo(this):this.tc())},t.tc=function(){Zo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Ho:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Do,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Uo(this.b,"Can not get response: "+t.message),null}},oa.prototype.cancel=function(t){if(this.a)this.c instanceof oa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,e.m<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new fa(this),sa(this),aa(this,!1,t))}},oa.prototype.o=function(t,e){this.i=!1,aa(this,t,e)},oa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ua(this,r,function(t){t instanceof fa?o.cancel():i(t)}),o.then(t,e,n)},oa.prototype.$goog_Thenable=!0,S(la,C),la.prototype.message="Deferred has already fired",la.prototype.name="AlreadyCalledError",S(fa,C),fa.prototype.message="Deferred was canceled",fa.prototype.name="CanceledError",pa.prototype.c=function(){throw delete da[this.a],this.b};var da={};function ya(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Jb:i,Ea:void 0},a=new oa(o);return e=window.setTimeout(function(){va(i,!0);var t=new wa(ba,"Timeout reached for loading script "+r);sa(a),aa(a,!1,t)},5e3),o.Ea=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(va(i,!1,e),sa(a),aa(a,!0,null))},i.onerror=function(){va(i,!0,e);var t=new wa(ga,"Error while loading script "+r);sa(a),aa(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=h.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function ma(){if(this&&this.Jb){var t=this.Jb;t&&"SCRIPT"==t.tagName&&va(t,!0,this.Ea)}}function va(t,e,n){null!=n&&h.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ga=0,ba=1;function wa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function _a(t){this.f=t}function Ea(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ia,this.f=H(t.secureTokenHeaders||Ca),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Na,this.a=H(t.firebaseHeaders||Aa),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==ur(),!(n=h.XMLHttpRequest||n&&il.INTERNAL.node&&il.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,sr()?this.c=new qo(self):cr()?this.c=new _a(n):this.c=new So}S(wa,C),S(_a,wo),_a.prototype.a=function(){return new this.f},_a.prototype.b=function(){return{}};var Ta,Sa="idToken",Ia=new Ar(3e4,6e4),Ca={"Content-Type":"application/x-www-form-urlencoded"},Na=new Ar(3e4,6e4),Aa={"Content-Type":"application/json"};function ka(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Da(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Ra(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ta=Ta||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{h[Pa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ua(t,null,e,void 0)}(ya(nt(Oa,{onload:Pa})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.l,t)))(e,n,r,i,o,a)}Ea.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===h.fetch||void 0===h.Headers||void 0===h.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Qo(this.c);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Uo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),Yo(a,t,e,r,i)};var Oa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Pa="__fcb"+Math.floor(1e6*Math.random()).toString();function xa(t){if(!l(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Ma(t){"email"in t&&xa(t)}function La(t){if(!t[Sa])throw new Yr("internal-error")}function Fa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Ea.prototype.l=function(t,n,r,i,o){var a=this;Ta.then(function(){window.gapi.client.setApiKey(a.b);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Ea.prototype.kb=function(){return bs(this,hs,{})},Ea.prototype.nb=function(t,e){return bs(this,us,{idToken:t,email:e})},Ea.prototype.ob=function(t,e){return bs(this,cs,{idToken:t,password:e})};var Ua={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function qa(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function Va(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Mn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ba(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=bo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=bo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=bo(t)):t.errorMessage&&(e=ws(t.errorMessage)),e)throw e;if(!t[Sa])throw new Yr("internal-error")}function ja(t,e){return e.returnIdpCredential=!0,bs(t,ls,e)}function Wa(t,e){return e.returnIdpCredential=!0,bs(t,ps,e)}function Ka(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,bs(t,fs,e)}function Qa(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Ea.prototype).pb=function(t,r){var i={idToken:t},o=[];return K(Ua,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),bs(this,us,i)},t.hb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),bs(this,rs,t)},t.ib=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),bs(this,es,t)},t.gb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),bs(this,ns,t)},t.Ta=function(t){return bs(this,ms,t)},t.Xa=function(t,e){return bs(this,as,{oobCode:t,newPassword:e})},t.Ia=function(t){return bs(this,Ga,{oobCode:t})},t.Va=function(t){return bs(this,Ha,{oobCode:t})};var Ha={endpoint:"setAccountInfo",D:Qa,da:"email"},Ga={endpoint:"resetPassword",D:Qa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")}},za={endpoint:"signupNewUser",D:function(t){if(xa(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},Ya={endpoint:"createAuthUri"},Xa={endpoint:"deleteAccount",T:["idToken"]},Ja={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},$a={endpoint:"emailLinkSignin",T:["email","oobCode"],D:xa,J:La,R:!0},Za={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],D:xa,J:La,R:!0},ts={endpoint:"getAccountInfo"},es={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},ns={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},da:"email"},rs={endpoint:"getOobConfirmationCode",T:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");xa(t)},da:"email"},is={sb:!0,endpoint:"getProjectConfig",Gb:"GET"},os={sb:!0,endpoint:"getRecaptchaParam",Gb:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},as={endpoint:"resetPassword",D:Qa,da:"email"},ss={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},us={endpoint:"setAccountInfo",T:["idToken"],D:Ma,R:!0},cs={endpoint:"setAccountInfo",T:["idToken"],D:function(t){if(Ma(t),!t.password)throw new Yr("weak-password")},J:La,R:!0},hs={endpoint:"signupNewUser",J:La,R:!0},ls={endpoint:"verifyAssertion",D:qa,Oa:Va,J:Ba,R:!0},fs={endpoint:"verifyAssertion",D:qa,Oa:Va,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw ws(t.errorMessage);if(!t[Sa])throw new Yr("internal-error")},R:!0},ps={endpoint:"verifyAssertion",D:function(t){if(qa(t),!t.idToken)throw new Yr("internal-error")},Oa:Va,J:Ba,R:!0},ds={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},J:La,R:!0},ys={endpoint:"verifyPassword",D:function(t){if(xa(t),!t.password)throw new Yr("wrong-password")},J:La,R:!0},ms={endpoint:"verifyPhoneNumber",D:Fa,J:La},vs={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Fa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",bo(t);La(t)}},gs={Tb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Fa,J:La};function bs(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Xt(new Yr("internal-error"));var r,i=e.Gb||"POST";return Yt(n).then(e.D).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,r,i,o,n){var a=_n(t.g+e);bn(a,"key",t.b),n&&bn(a,"cb",T().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Ra(t,a.toString(),function(t){t?t.error?n(_s(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Tr(i)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Tb,e.sb||!1)}).then(function(t){return r=t,e.Oa?e.Oa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new Yr("internal-error");return r[e.da]})}function ws(t){return _s({error:{errors:[{message:t}],code:400,message:t}})}function _s(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Er(t)),new Yr("internal-error",e)}function Es(t){this.b=t,this.a=null,this.bb=function(o){return(Cs=Cs||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Ss.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();h[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(ya(r=nt(Ts,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Cs=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Is.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Ts=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Ss=new Ar(3e4,6e4),Is=new Ar(5e3,15e3),Cs=null;function Ns(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=En(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function As(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ks(t){try{return il.app(t).auth().ya()}catch(t){return[]}}function Ds(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function Rs(t){var s=Jn();return function(t){return bs(t,is,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new vo(Jn())})}function Os(i){return i.m||(i.m=ir().then(function(){if(!i.u){var t=i.c,e=i.h,n=ks(i.b),r=new Ns(i.l,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.u=r.toString()}i.i=new Es(i.u),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.bb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=fo(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.m}function Ps(t){return t.o||(t.v=t.c?dr(t.c,ks(t.b)):null,t.o=new Ea(t.f,gi(t.h),t.v)),t.o}function xs(t,e,n,r,i,o,a,s,u,c){return(t=new As(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=H(u||null),t.f=c,t.toString()}function Ms(t){if(this.a=t||il.INTERNAL.reactNative&&il.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ls(t){this.b=t,this.a={},this.f=_(this.c,this)}Ns.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):xn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):xn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):xn(this.a.a,"fw"),this.a.toString()},As.prototype.toString=function(){var t=En(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.l),bn(t,"appName",this.c),bn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=il.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.Ya=n,bn(t,"providerId",this.a.providerId),n=Tr((e=this.a).vb))n[r]=n[r].toString();r=e.Ac,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.$a&&e.Ya&&!n[e.$a]&&(n[e.$a]=e.Ya),Q(n)||bn(t,"customParameters",Er(n))}if("function"==typeof this.a.Db&&((e=this.a.Db()).length&&bn(t,"scopes",e.join(","))),this.i?bn(t,"redirectUrl",this.i):xn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):xn(t.a,"eventId"),this.h?bn(t,"v",this.h):xn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.f?bn(t,"eid",this.f):xn(t.a,"eid"),(a=ks(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Ds.prototype).Bb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.fa().then(function(){(function(t){var e={type:"webStorageSupport"};return Os(t).then(function(){return function(e,n){return e.bb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Kb=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Fb=function(){return!1},t.zb=function(e,t,n,r,i,o,a){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.fa().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Rs(Ps(this)));var s=this;return this.a.then(function(){var t=s.fa().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){ho(n),a||$n(xs(s.l,s.f,s.b,t,n,null,o,s.c,void 0,s.h),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ab=function(t,e,n){this.a||(this.a=Rs(Ps(this)));var r=this;return this.a.then(function(){ho(e),$n(xs(r.l,r.f,r.b,t,e,Jn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.fa=function(){var t=this;return Os(this).then(function(){return t.i.bb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Mb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ja=function(e){B(this.g,function(t){return t==e})},(t=Ms.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Er(e)))},t.P=function(t){return Yt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Fs,Us=[];function qs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Vs(t){this.a=t}function Bs(t){this.c=t,this.b=!1,this.a=[]}function js(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Ws(r,c),t}).s(function(t){throw Ws(r,c),t})}function Ws(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function Ks(){if(!Gs())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=h.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var r=this;sr()&&self?(this.m=function(){var e=sr()?self:null;if(L(Us,function(t){t.b==e&&(n=t)}),!n){var n=new Ls(e);Us.push(n)}return n}(),qs(this.m,"keyChanged",function(t,n){return $s(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:q(e,n.key)}})}),qs(this.m,"ping",function(){return Yt(["keyChanged"])})):function(){var t=h.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Bs(new Vs(t)),js(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&q(t[0].value,"keyChanged")&&(r.u=!0)}).s(function(){}))})}function Qs(r){return new jt(function(e,n){var t=r.l.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Qs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Hs(t){return t.o||(t.o=Qs(t)),t.o}function Gs(){try{return!!h.indexedDB}catch(t){return!1}}function zs(t){return t.objectStore("firebaseLocalStorage")}function Ys(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Xs(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Js(t,e){return t.g&&t.h&&function(){var t=h.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?js(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Yt()}function $s(r){return Hs(r).then(function(t){var i=zs(Ys(t,!1));return i.getAll?Xs(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function Zs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function tu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(Gs()){var e=Ir(),n="__sak"+e;return Fs=Fs||new Ks,(i=Fs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.P(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.Y(function(e){L(r.a,function(t){t(e)})}),t})}function eu(){this.a={},this.type="inMemory"}function nu(){if(!function(){var t="Node"==ur();if(!(t=ru()||t&&il.INTERNAL.node&&il.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=ru()||il.INTERNAL.node.localStorage,this.type="localStorage"}function ru(){try{var t=h.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function iu(){this.type="nullStorage"}function ou(){if(!function(){var t="Node"==ur();if(!(t=au()||t&&il.INTERNAL.node&&il.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=au()||il.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function au(){try{var t=h.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function su(){var t={};t.Browser=hu,t.Node=lu,t.ReactNative=fu,t.Worker=pu,this.a=t[ur()]}Ls.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Cb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},Vs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Bs.prototype.close=function(){for(;0<this.a.length;)Ws(this,this.a[0]);this.b=!0},(t=Ks.prototype).set=function(n,r){var i,o=!1,a=this;return Hs(this).then(function(t){return Xs((t=zs(Ys(i=t,!0))).get(n))}).then(function(t){var e=zs(Ys(i,!0));return t?(t.value=r,Xs(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,Xs(e.add(t)))}).then(function(){return a.c[n]=r,Js(a,n)}).ha(function(){o&&a.b--})},t.get=function(e){return Hs(this).then(function(t){return Xs(zs(Ys(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.P=function(e){var n=!1,r=this;return Hs(this).then(function(t){return n=!0,r.b++,Xs(zs(Ys(t,!0)).delete(e))}).then(function(){return delete r.c[e],Js(r,e)}).ha(function(){n&&r.b--})},t.Y=function(t){0==this.a.length&&function(t){Zs(t),function e(){t.f=setTimeout(function(){t.i=$s(t).then(function(e){0<e.length&&L(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&Zs(this)},(t=tu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.P=function(e){return this.b.then(function(t){return t.P(e)})},t.Y=function(t){this.a.push(t)},t.ca=function(e){B(this.a,function(t){return t==e})},(t=eu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.P=function(t){return delete this.a[t],Yt()},t.Y=function(){},t.ca=function(){},(t=nu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(t){h.window&&Ke(h.window,"storage",t)},t.ca=function(t){h.window&&Ge(h.window,"storage",t)},(t=iu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.P=function(){return Yt()},t.Y=function(){},t.ca=function(){},(t=ou.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Er(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var uu,cu,hu={C:nu,Qa:ou},lu={C:nu,Qa:ou},fu={C:Ms,Qa:iu},pu={C:nu,Qa:iu},du={Vc:"local",NONE:"none",Xc:"session"};function yu(){var t=!(Cr(yr())||!ar()),e=_r(),n=vr();this.o=t,this.h=e,this.m=n,this.a={},t=uu=uu||new su;try{this.g=!Xn()&&Rr()||!h.indexedDB?new t.a.C:new tu(sr()?new eu:new t.a.C)}catch(t){this.g=new eu,this.h=!0}try{this.i=new t.a.Qa}catch(t){this.i=new eu}this.l=new eu,this.f=_(this.Lb,this),this.b={}}function mu(){return cu=cu||new yu}function vu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function gu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function bu(t,e,n){return n=gu(e,n),"local"==e.C&&(t.b[n]=null),vu(t,e.C).P(n)}function wu(t){t.c&&(clearInterval(t.c),t.c=null)}function _u(t){this.a=t,this.b=mu()}(t=yu.prototype).get=function(t,e){return vu(this,t.C).get(gu(t,e))},t.set=function(e,t,n){var r=gu(e,n),i=this,o=vu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=gu(t,e),this.m&&(this.b[t]=h.localStorage.getItem(t)),Q(this.a)&&(vu(this,"local").Y(this.f),this.h||(Xn()||!Rr())&&h.indexedDB||!this.m||function(r){wu(r),r.c=setInterval(function(){for(var t in r.a){var e=h.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Lb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=gu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(vu(this,"local").ca(this.f),wu(this))},t.Lb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=h.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Wa(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?vu(this,"local").ca(this.f):wu(this),this.o)if(n=h.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?h.localStorage.setItem(e,r):h.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===h.localStorage.getItem(e)||(o.b[e]=h.localStorage.getItem(e),o.Wa(e))},me&&Ie&&10==Ie&&h.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.Wa,this))},t.Wa=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var Eu,Tu={name:"authEvent",C:"local"};function Su(){this.a=mu()}function Iu(t,e){this.b=Cu,this.f=h.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=h.Int32Array?new Int32Array(64):Array(64),void 0!==Eu||(Eu=h.Int32Array?new Int32Array(Pu):Pu),this.reset()}S(Iu,function(){this.b=-1});for(var Cu=64,Nu=Cu-1,Au=[],ku=0;ku<Nu;ku++)Au[ku]=0;var Du=j(128,Au);function Ru(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Eu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Ou(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(l(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Ru(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Ru(t),i=0)}}t.c=i,t.g+=n}Iu.prototype.reset=function(){this.g=this.c=0,this.a=h.Int32Array?new Int32Array(this.h):W(this.h)};var Pu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function xu(){Iu.call(this,8,Mu)}S(xu,Iu);var Mu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Lu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new Su,this.g=new _u(this.h),this.f=null,this.b=[],this.a=this.c=null}function Fu(t){return new Yr("invalid-cordova-configuration",t)}function Uu(t){var e=new xu;Ou(e,t),t=[];var n=8*e.g;e.c<56?Ou(e,Du,56-e.c):Ou(e,Du,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Ru(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function qu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Vu(r){return r.f||(r.f=r.fa().then(function(){return new jt(function(n){r.wa(function t(e){return n(e),r.Ja(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Bu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Pi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new lo(t.c,t.b,null,null,n):new lo(t.c,t.b,e,t.f)),e=n||o}qu(i,e)})}var o=new lo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Bu(i).then(function(){t||qu(i,o)})}),r=h.handleOpenURL;h.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",h).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},mo=mo||new po,function(t){var n=mo;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",h))&&t(null,n.b))}(e)}(r)})})),r.f}function Bu(e){var n=null;return function(t){return t.b.get(Tu,t.a).then(function(t){return fo(t)})}(e.g).then(function(t){return n=t,bu((t=e.g).b,Tu,t.a)}).then(function(){return n})}function ju(t){this.a=t,this.b=mu()}(t=Lu.prototype).fa=function(){return this.za?this.za:this.za=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=h.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",h))throw Fu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",h))throw Fu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",h))throw Fu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",h))throw Fu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Bb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.zb=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Mb=function(){return!1},t.Kb=function(){return!0},t.Fb=function(){return!0},t.Ab=function(t,e,n){if(this.c)return Xt(new Yr("redirect-operation-pending"));var r=this,i=h.document,o=null,a=null,s=null,u=null;return this.c=Yt().then(function(){return ho(e),Vu(r)}).then(function(){return function(n,t,e,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new lo(t,r,null,i,new Yr("no-auth-event")),a=mr("BuildInfo.packageName",h);if("string"!=typeof a)throw new Yr("invalid-cordova-configuration");var s=mr("BuildInfo.displayName",h),u={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))u.ibi=a;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));u.apn=a}s&&(u.appDisplayName=s),i=Uu(i),u.sessionId=i;var c=xs(n.l,n.i,n.m,t,e,null,r,n.o,u,n.u);return n.fa().then(function(){var t=n.h;return n.v.a.set(Tu,o.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",h);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",h)))throw new Yr("invalid-cordova-configuration");e(c)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",h)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(c,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new jt(function(e,t){a=function(){var t=mr("cordova.plugins.browsertab.close",h);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(a),s=function(){o=o||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},u=function(){kr()&&s()},i.addEventListener("resume",s,!1),yr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",u,!1)}).s(function(t){return Bu(r).then(function(){throw t})})}).ha(function(){s&&i.removeEventListener("resume",s,!1),u&&i.removeEventListener("visibilitychange",u,!1),o&&o.cancel(),a&&r.Ja(a),r.c=null})},t.wa=function(e){this.b.push(e),Vu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new lo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.Ja=function(e){B(this.b,function(t){return t==e})};var Wu={name:"pendingRedirect",C:"session"};function Ku(t){return bu(t.b,Wu,t.a)}function Qu(t,e,n){this.i={},this.v=0,this.B=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=_(this.u,this),this.b=new oc,this.w=new hc,this.g=new ju(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=Hu(this.B,this.l,this.o,mi)}function Hu(t,e,n,r){var i=il.SDK_VERSION||null;return or()?new Lu(t,e,n,i,r):new Ds(t,e,n,i,r)}function Gu(e){e.f||(e.f=!0,e.a.wa(e.m));var n=e.a;return e.a.fa().s(function(t){throw e.a==n&&e.reset(),t})}function zu(n){n.a.Kb()&&Gu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));tc(t)&&n.u(e)}),n.a.Fb()||ac(n.b)}function Yu(n,t){q(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Wu,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?Ku(n.g).then(function(){Gu(n).s(function(t){var e=new lo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));tc(t)&&n.u(e)})}):zu(n)}).s(function(){zu(n)})}function Xu(t,e){B(t.h,function(t){return t==e})}Qu.prototype.reset=function(){this.f=!1,this.a.Ja(this.m),this.a=Hu(this.B,this.l,this.o),this.i={}},Qu.prototype.u=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.tb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return ac(this.b),e};var Ju=new Ar(2e3,1e4),$u=new Ar(3e4,6e4);function Zu(t,e,n,r,i,o){return t.a.zb(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function tc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function ec(e,t,n,r){var i;return function(t){return t.b.set(Wu,"pending",t.a)}(e.g).then(function(){return e.a.Ab(t,n,r).s(function(t){if(tc(t))throw new Yr("operation-not-supported-in-this-environment");return i=t,Ku(e.g).then(function(){throw i})}).then(function(){return e.a.Mb()?new jt(function(){}):Ku(e.g).then(function(){return e.la()}).then(function(){}).s(function(){})})})}function nc(t,e,n,r,i){return t.a.Bb(r,function(t){e.ga(n,null,t,i)},Ju.get())}Qu.prototype.la=function(){return this.b.la()};var rc={};function ic(t,e,n){var r=e+":"+n;return rc[r]||(rc[r]=new Qu(t,e,n)),rc[r]}function oc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function ac(t){t.g||(t.g=!0,cc(t,!1,null,null))}function sc(t){t.g&&!t.i&&cc(t,!1,null,null)}function uc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function cc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):uc(t,n):uc(t,{user:null}),t.f=[],t.c=[]}function hc(){}function lc(){this.qb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.qb},set:function(t){this.qb=t},enumerable:!1})}function fc(t,e){this.a=e,Lr(this,"verificationId",t)}function pc(t,e,n,r){return new so(t).Ta(e,n).then(function(t){return new fc(t,r)})}function dc(t){var e=yi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function yc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function mc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function vc(t){this.f=t,this.b=this.a=null,this.c=0}function gc(t,e){var n=e[Sa],r=e.refreshToken;e=bc(e.expiresIn),t.b=n,t.c=e,t.a=r}function bc(t){return T()+1e3*parseInt(t,10)}function wc(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?Ra(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?n(_s(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.f,t.m.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=bc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function _c(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Ec(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Tc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Sc(t,e,n){this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=il.SDK_VERSION?dr(il.SDK_VERSION):null,this.a=new Ea(this.l,gi(mi),t),this.c=new vc(this.a),Rc(this,e[Sa]),gc(this.c,e),Lr(this,"refreshToken",this.c.a),xc(this,n||{}),nn.call(this),this.I=!1,this.u&&gr()&&(this.i=ic(this.u,this.l,this.o)),this.N=[],this.h=null,this.w=function(e){return new yc(function(){return e.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.c.c-T()-3e5;return 0<t?t:0})}(this),this.V=_(this.Fa,this);var r=this;this.ja=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){Cc(r,t.c)},this.W=null}function Ic(t,e){t.X&&Ge(t.X,"languageCodeChanged",t.ta),(t.X=e)&&Ke(e,"languageCodeChanged",t.ta)}function Cc(t,e){t.O=e,Da(t.a,il.SDK_VERSION?dr(il.SDK_VERSION,t.O):null)}function Nc(t,e){t.W&&Ge(t.W,"frameworkChanged",t.sa),(t.W=e)&&Ke(e,"frameworkChanged",t.sa)}function Ac(e){try{return il.app(e.o).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.o+"'!")}}function kc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.V),Ke(t,"tokenChanged",t.V))}function Dc(t){Ge(t,"tokenChanged",t.V),t.w.stop()}function Rc(t,e){t.ra=e,Lr(t,"_lat",e)}function Oc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return $t(e).then(function(){return t})}function Pc(t){t.i&&!t.I&&(t.I=!0,Yu(t.i,t))}function xc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new _c(e.createdAt,e.lastLoginAt),providerData:[]})}function Mc(){}function Lc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Fc(t){return F(t.providerData,function(t){return t.providerId})}function Uc(t,e){e&&(qc(t,e.providerId),t.providerData.push(e))}function qc(t,e){B(t.providerData,function(t){return t.providerId==e})}function Vc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Bc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,providerData:[]}),t.metadata?Lr(e,"metadata",function(t){return new _c(t.a,t.b)}(t.metadata)):Lr(e,"metadata",new _c),L(t.providerData,function(t){Uc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.c,t.c),Lr(e,"refreshToken",e.c.a))}function jc(n){return n.F().then(function(t){var e=n.isAnonymous;return function(t,e){return bs(t.a,ts,{idToken:e}).then(_(t.uc,t))}(n,t).then(function(){return e||Vc(n,"isAnonymous",!1),t})})}function Wc(t,e){e[Sa]&&t.ra!=e[Sa]&&(gc(t.c,e),t.dispatchEvent(new Tc("tokenChanged")),Rc(t,e[Sa]),Vc(t,"refreshToken",t.c.a))}function Kc(t,e){return jc(t).then(function(){if(q(Fc(t),e))return Oc(t).then(function(){throw new Yr("provider-already-linked")})})}function Qc(t,e,n){return Ur({user:t,credential:co(e),additionalUserInfo:e=Ti(e),operationType:n})}function Hc(t,e){return Wc(t,e),t.reload().then(function(){return t})}function Gc(n,r,t,e,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ei(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.u&&t.isOAuthProvider&&(s=xs(n.u,n.l,n.o,r,t,null,a,il.SDK_VERSION||null));var u=er(s,o&&o.Ba,o&&o.Aa);return e=e().then(function(){if(Yc(n),!i)return n.F().then(function(){})}).then(function(){return Zu(n.i,u,r,t,a,!!s)}).then(function(){return new jt(function(t,e){n.ga(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.b=nc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),Xc(n,e,i)}function zc(e,t,n,r,i){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(Yc(e),!i)return e.F().then(function(){})}).then(function(){return e.aa=a,Oc(e)}).then(function(t){return e.ba&&(t=(t=e.ba).b.set(Zc,e.A(),t.a)),t}).then(function(){return ec(e.i,t,n,a)}).s(function(t){if(o=t,e.ba)return th(e.ba);throw o}).then(function(){if(o)throw o}),Xc(e,r,i)}function Yc(t){if(!t.i||!t.I){if(t.i&&!t.I)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function Xc(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Tc("userInvalidated")),e.h=t),t})}(t,e,n);return t.G.push(r),r.ha(function(){V(t.G,r)}),r}function Jc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Sa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Sc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Uc(r,Ur(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function $c(t){this.a=t,this.b=mu()}oc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},oc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(cc(this,!0,null,t.a),Yt()):e.xa(n,r)?function(e,t,n){n=n.xa(t.c,t.b);var r=t.g,i=t.f,o=t.h,a=!!t.c.match(/Redirect$/);n(r,i,o).then(function(t){cc(e,a,t,null)}).s(function(t){cc(e,a,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(cc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},oc.prototype.la=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un($u.get()).then(function(){t.b||(t.g=!0,cc(t,!0,null,e))})}(n))})},hc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ga(t.c,null,t.a,t.b),Yt()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ga(r,t,null,n)}).s(function(t){e.ga(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},fc.prototype.confirm=function(t){return t=uo(this.verificationId,t),this.a(t)},yc.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(mc(n,t)).then(function(){return e=h.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},yc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},vc.prototype.A=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},vc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?wc(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},_c.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Tc,Oe),S(Sc,nn),Sc.prototype.pa=function(t){this.ja=t,ka(this.a,t)},Sc.prototype.ea=function(){return this.ja},Sc.prototype.ya=function(){return W(this.O)},Sc.prototype.Fa=function(){this.w.b&&(this.w.stop(),this.w.start())},Lr(Sc.prototype,"providerId","firebase"),(t=Sc.prototype).reload=function(){var t=this;return Xc(this,Lc(this).then(function(){return jc(t).then(function(){return Oc(t)}).then(Mc)}))},t.Zb=function(t){return this.F(t).then(function(t){return new dc(t)})},t.F=function(t){var e=this;return Xc(this,Lc(this).then(function(){return e.c.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ra&&(Rc(e,t.accessToken),e.dispatchEvent(new Tc("tokenChanged"))),Vc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.uc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");xc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Ec(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Uc(this,e[n]);Vc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.vc=function(t){return xr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.cb(t)},t.cb=function(t){var e=this,n=null;return Xc(this,t.f(this.a,this.uid).then(function(t){return Wc(e,t),n=Qc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.mc=function(t){return xr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.ab(t)},t.ab=function(e){var n=this,r=null;return Xc(this,Kc(this,e.providerId).then(function(){return n.F()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Qc(n,t,"link"),Hc(n,t)}).then(function(){return r}))},t.nc=function(t,e){var n=this;return Xc(this,Kc(this,"phone").then(function(){return pc(Ac(n),t,e,_(n.ab,n))}))},t.wc=function(t,e){var n=this;return Xc(this,Yt().then(function(){return pc(Ac(n),t,e,_(n.cb,n))}),!0)},t.nb=function(e){var n=this;return Xc(this,this.F().then(function(t){return n.a.nb(t,e)}).then(function(t){return Wc(n,t),n.reload()}))},t.Nc=function(e){var n=this;return Xc(this,this.F().then(function(t){return e.b(n.a,t)}).then(function(t){return Wc(n,t),n.reload()}))},t.ob=function(e){var n=this;return Xc(this,this.F().then(function(t){return n.a.ob(t,e)}).then(function(t){return Wc(n,t),n.reload()}))},t.pb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Lc(this);var n=this;return Xc(this,this.F().then(function(t){return n.a.pb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Wc(n,t),Vc(n,"displayName",t.displayName||null),Vc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),Oc(n)}).then(Mc))},t.Lc=function(e){var n=this;return Xc(this,jc(this).then(function(t){return q(Fc(n),e)?function(t,e,n){return bs(t,Ja,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Fc(n),function(t){e[t]||qc(n,t)}),e[so.PROVIDER_ID]||Lr(n,"phoneNumber",null),Oc(n)}):Oc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return Xc(this,this.F().then(function(t){return bs(e.a,Xa,{idToken:t})}).then(function(){e.dispatchEvent(new Tc("userDeleted"))})).then(function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");Ic(e,null),Nc(e,null),e.G=[],e.B=!0,Dc(e),Lr(e,"refreshToken",null),e.i&&Xu(e.i,e)})},t.tb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ga=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.xb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.yb,this):"linkViaRedirect"==t&&(this.aa||null)==e?_(this.xb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?_(this.yb,this):null},t.oc=function(t){var e=this;return Gc(this,"linkViaPopup",t,function(){return Kc(e,t.providerId).then(function(){return Oc(e)})},!1)},t.xc=function(t){return Gc(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.pc=function(t){var e=this;return zc(this,"linkViaRedirect",t,function(){return Kc(e,t.providerId)},!1)},t.yc=function(t){return zc(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.xb=function(e,n,r){var i=this;this.b&&(this.b.cancel(),this.b=null);var o=null,t=this.F().then(function(t){return Wa(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Qc(i,t,"link"),Hc(i,t)}).then(function(){return o});return Xc(this,t)},t.yb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Xc(this,Yt().then(function(){return Mi(Ka(r.a,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Qc(r,t,"reauthenticate"),Wc(r,t),r.h=null,r.reload()}).then(function(){return i}),!0)},t.gb=function(e){var n=this,r=null;return Xc(this,this.F().then(function(t){return r=t,void 0===e||Q(e)?{}:ci(new Zr(e))}).then(function(t){return n.a.gb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.c.A(),redirectEventId:this.aa||null};return this.metadata&&z(e,this.metadata.A()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var Zc={name:"redirectUser",C:"session"};function th(t){return bu(t.b,Zc,t.a)}function eh(t){this.a=t,this.b=mu(),this.c=null,this.f=function(e){var n=ih("local"),r=ih("session"),i=ih("none");return function(n,r,i){var o=gu(r,i),a=vu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(h.localStorage.getItem(o))}catch(t){}if(e&&!t)return h.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&h.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(rh,e.a).then(function(t){return t?ih(t):n})})})}).then(function(t){return e.c=t,nh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(ih("local"),this.a,_(this.g,this))}function nh(t,e){var n,r=[];for(n in du)du[n]!==e&&r.push(bu(t.b,ih(du[n]),t.a));return r.push(bu(t.b,rh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],E(t,a),o);else n(i)})}(r)}eh.prototype.g=function(){var e=this,n=ih("local");uh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return nh(e,"local").then(function(){e.c=n})})})};var rh={name:"persistence",C:"session"};function ih(t){return{name:"authUser",C:t}}function oh(t,e){return uh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function ah(t){return uh(t,function(){return bu(t.b,t.c,t.a)})}function sh(t,e){return uh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Jc(t||{})})})}function uh(t,e){return t.f=t.f.then(e,e),t.f}function ch(t){if(this.l=!1,Lr(this,"settings",new lc),Lr(this,"app",t),!vh(this).options||!vh(this).options.apiKey)throw new Yr("invalid-api-key");t=il.SDK_VERSION?dr(il.SDK_VERSION):null,this.c=new Ea(vh(this).options&&vh(this).options.apiKey,gi(mi),t),this.N=[],this.o=[],this.I=[],this.Pb=il.INTERNAL.createSubscribe(_(this.ic,this)),this.O=void 0,this.Qb=il.INTERNAL.createSubscribe(_(this.jc,this)),yh(this,null),this.h=new eh(vh(this).options.apiKey+":"+vh(this).name),this.w=new $c(vh(this).options.apiKey+":"+vh(this).name),this.V=_h(this,function(n){var t=vh(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(Zc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Jc(t||{})})}(e.w,vh(e).options.authDomain).then(function(t){return(e.B=t)&&(t.ba=e.w),th(e.w)});return _h(e,t)}(n).then(function(){return sh(n.h,t)}).then(function(e){return e?(e.ba=n.w,n.B&&(n.B.aa||null)==(e.aa||null)?e:e.reload().then(function(){return oh(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:ah(n.h)})):null}).then(function(t){yh(n,t||null)});return _h(n,e)}(this)),this.i=_h(this,function(e){return e.V.then(function(){return ph(e)}).s(function(){}).then(function(){if(!e.l)return e.ja()}).s(function(){}).then(function(){if(!e.l){e.X=!0;var t=e.h;t.b.addListener(ih("local"),t.a,e.ja)}})}(this)),this.X=!1,this.ja=_(this.Ic,this),this.Fa=_(this.Z,this),this.ra=_(this.Xb,this),this.sa=_(this.gc,this),this.ta=_(this.hc,this),this.a=null,function(e){var n=vh(e).options.authDomain,r=vh(e).options.apiKey;n&&gr()&&(e.Ob=e.V.then(function(){if(!e.l){if(e.a=ic(n,r,vh(e).name),Yu(e.a,e),gh(e)&&Pc(gh(e)),e.B){Pc(e.B);var t=e.B;t.pa(e.ea()),Ic(t,e),Cc(t=e.B,e.G),Nc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.qc,this),this.u=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function hh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function lh(t){Oe.call(this,"frameworkChanged"),this.c=t}function fh(t){return t.Ob||Xt(new Yr("auth-domain-config-required"))}function ph(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=fh(t).then(function(){return t.a.la()}).then(function(t){return t?Ur(t):null});return _h(t,e)}function dh(e,t){var n={};return n.apiKey=vh(e).options.apiKey,n.authDomain=vh(e).options.authDomain,n.appName=vh(e).name,e.V.then(function(){return function(t,e,n,r){var i=new Sc(t,e);return n&&(i.ba=n),r&&Cc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.ya())}).then(function(t){return gh(e)&&t.uid==gh(e).uid?Bc(gh(e),t):(yh(e,t),Pc(t)),e.Z(t)}).then(function(){wh(e)})}function yh(t,e){gh(t)&&(function(t,e){B(t.N,function(t){return t==e})}(gh(t),t.Fa),Ge(gh(t),"tokenChanged",t.ra),Ge(gh(t),"userDeleted",t.sa),Ge(gh(t),"userInvalidated",t.ta),Dc(gh(t))),e&&(e.N.push(t.Fa),Ke(e,"tokenChanged",t.ra),Ke(e,"userDeleted",t.sa),Ke(e,"userInvalidated",t.ta),0<t.u&&kc(e)),Lr(t,"currentUser",e),e&&(e.pa(t.ea()),Ic(e,t),Cc(e,t.G),Nc(e,t))}function mh(e,t){var n=null,r=null;return _h(e,t.then(function(t){return n=co(t),r=Ti(t),dh(e,t)}).then(function(){return Ur({user:gh(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function vh(t){return t.app}function gh(t){return t.currentUser}function bh(t){return gh(t)&&gh(t)._lat||null}function wh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](bh(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](bh(t))}}function _h(t,e){return t.N.push(e),e.ha(function(){V(t.N,e)}),e}function Eh(){}function Th(){this.a={},this.b=1e12}eh.prototype.jb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in du)if(du[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!vr()&&"none"!==t)throw n}}(e),uh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,nh(r,e)}).then(function(){if(r.c=ih(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(ch,nn),S(hh,Oe),S(lh,Oe),(t=ch.prototype).jb=function(t){return t=this.h.jb(t),_h(this,t)},t.pa=function(t){this.W===t||this.l||(this.W=t,ka(this.c,this.W),this.dispatchEvent(new hh(this.ea())))},t.ea=function(){return this.W},t.Oc=function(){var t=h.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.qc=function(t){this.G.push(t),Da(this.c,il.SDK_VERSION?dr(il.SDK_VERSION,this.G):null),this.dispatchEvent(new lh(this.G))},t.ya=function(){return W(this.G)},t.toJSON=function(){return{apiKey:vh(this).options.apiKey,authDomain:vh(this).options.authDomain,appName:vh(this).name,currentUser:gh(this)&&gh(this).A()}},t.tb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ga=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.Wb,this):null},t.Wb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=ja(r.c,t).then(function(t){return i=co(t),o=Ti(t),t});return _h(this,t=r.V.then(function(){return a}).then(function(t){return dh(r,t)}).then(function(){return Ur({user:gh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Gc=function(e){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ei(e.providerId),r=Ir(),i=null;(!_r()||ar())&&vh(this).options.authDomain&&e.isOAuthProvider&&(i=xs(vh(this).options.authDomain,vh(this).options.apiKey,vh(this).name,"signInViaPopup",e,null,r,il.SDK_VERSION||null));var o=er(i,t&&t.Ba,t&&t.Aa);return _h(this,t=fh(this).then(function(t){return Zu(t,o,"signInViaPopup",e,r,!!i)}).then(function(){return new jt(function(t,e){n.ga("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.b=nc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Hc=function(t){if(!gr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return _h(this,fh(this).then(function(){return function(t){return uh(t,function(){return t.b.set(rh,t.c.C,t.a)})}(e.h)}).then(function(){return ec(e.a,"signInViaRedirect",t)}))},t.la=function(){var e=this;return ph(this).then(function(t){return e.a&&sc(e.a.b),t}).s(function(t){throw e.a&&sc(e.a.b),t})},t.Mc=function(t){if(!t)return Xt(new Yr("null-user"));var e=this,n={};n.apiKey=vh(this).options.apiKey,n.authDomain=vh(this).options.authDomain,n.appName=vh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.c,o={};return o[Sa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Sc(e,o),n&&(e.ba=n),r&&Cc(e,r),Bc(e,t),e}(t,n,e.w,e.ya());return _h(this,this.i.then(function(){if(vh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return gh(e)&&t.uid==gh(e).uid?(Bc(gh(e),t),e.Z(t)):(yh(e,r),Pc(r),e.Z(r))}).then(function(){wh(e)}))},t.lb=function(){var t=this,e=this.i.then(function(){return t.a&&sc(t.a.b),gh(t)?(yh(t,null),ah(t.h).then(function(){wh(t)})):Yt()});return _h(this,e)},t.Ic=function(){var r=this;return sh(this.h,vh(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=gh(r)&&t){e=gh(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Bc(gh(r),t),gh(r).F();(gh(r)||t)&&(yh(r,t),t&&(Pc(t),t.ba=r.w),r.a&&Yu(r.a,r),wh(r))}})},t.Z=function(t){return oh(this.h,t)},t.Xb=function(){wh(this),this.Z(gh(this))},t.gc=function(){this.lb()},t.hc=function(){this.lb()},t.ic=function(t){var e=this;this.addAuthTokenListener(function(){t.next(gh(e))})},t.jc=function(t){var e=this;!function(t,e){t.I.push(e),_h(t,t.i.then(function(){!t.l&&q(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(bh(t)))}))}(this,function(){t.next(gh(e))})},t.sc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){m(t)?t(gh(r)):m(t.next)&&t.next(gh(r))}),this.Pb(t,e,n)},t.rc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),m(t)?t(gh(r)):m(t.next)&&t.next(gh(r))}),this.Qb(t,e,n)},t.Yb=function(t){var e=this,n=this.i.then(function(){return gh(e)?gh(e).F(t).then(function(t){return{accessToken:t}}):null});return _h(this,n)},t.Cc=function(t){var n=this;return this.i.then(function(){return mh(n,bs(n.c,ds,{token:t}))}).then(function(t){var e=t.user;return Vc(e,"isAnonymous",!1),n.Z(e),t})},t.Dc=function(t,e){var n=this;return this.i.then(function(){return mh(n,bs(n.c,ys,{email:t,password:e}))})},t.Sb=function(t,e){var n=this;return this.i.then(function(){return mh(n,bs(n.c,za,{email:t,password:e}))})},t.Pa=function(t){var e=this;return this.i.then(function(){return mh(e,t.ka(e.c))})},t.Bc=function(t){return xr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Pa(t)},t.kb=function(){var n=this;return this.i.then(function(){var t=gh(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):mh(n,n.c.kb()).then(function(t){var e=t.user;return Vc(e,"isAnonymous",!0),n.Z(e),t})})},t.getUid=function(){return gh(this)&&gh(this).uid||null},t.Rb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&gh(this)&&kc(gh(this))},t.zc=function(e){var n=this;L(this.o,function(t){t==e&&n.u--}),this.u<0&&(this.u=0),0==this.u&&gh(this)&&Dc(gh(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),_h(this,this.i.then(function(){e.l||q(e.o,t)&&t(bh(e))}))},t.removeAuthTokenListener=function(e){B(this.o,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(ih("local"),t.a,this.ja),this.a&&(Xu(this.a,this),sc(this.a.b)),Promise.resolve()},t.Vb=function(t){return _h(this,function(t,e){return bs(t,Ya,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.c,t))},t.kc=function(t){return!!ro(t)},t.ib=function(e,n){var r=this;return _h(this,Yt().then(function(){var t=new Zr(n);if(!t.c)throw new Yr("argument-error",ni+" must be true when sending sign in link to email");return ci(t)}).then(function(t){return r.c.ib(e,t)}).then(function(){}))},t.Pc=function(t){return this.Ia(t).then(function(t){return t.data.email})},t.Xa=function(t,e){return _h(this,this.c.Xa(t,e).then(function(){}))},t.Ia=function(t){return _h(this,this.c.Ia(t).then(function(t){return new Vr(t)}))},t.Va=function(t){return _h(this,this.c.Va(t).then(function(){}))},t.hb=function(e,t){var n=this;return _h(this,Yt().then(function(){return void 0===t||Q(t)?{}:ci(new Zr(t))}).then(function(t){return n.c.hb(e,t)}).then(function(){}))},t.Fc=function(t,e){return _h(this,pc(this,t,e,_(this.Pa,this)))},t.Ec=function(e,n){var r=this;return _h(this,Yt().then(function(){var t=no(e,n||Jn());return r.Pa(t)}))},Eh.prototype.render=function(){},Eh.prototype.reset=function(){},Eh.prototype.getResponse=function(){},Eh.prototype.execute=function(){};var Sh=null;function Ih(t,e){return(e=Ch(e))&&t.a[e]||null}function Ch(t){return(t=void 0===t?1e12:t)?t.toString():null}function Nh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Vn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function Ah(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function kh(){}Th.prototype.render=function(t,e){return this.a[this.b.toString()]=new Nh(t,e),this.b++},Th.prototype.reset=function(t){var e=Ih(this,t);t=Ch(t),e&&t&&(e.delete(),delete this.a[t])},Th.prototype.getResponse=function(t){return(t=Ih(this,t))?t.getResponse():null},Th.prototype.execute=function(t){(t=Ih(this,t))&&t.execute()},Nh.prototype.getResponse=function(){return Ah(this),this.b},Nh.prototype.execute=function(){Ah(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},Nh.prototype.delete=function(){Ah(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},kh.prototype.g=function(){return Yt(Sh=Sh||new Th)},kh.prototype.c=function(){};var Dh=null;function Rh(){this.b=h.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Oh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Ph=new Ar(3e4,6e4);Rh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Ph.get());!h.grecaptcha||i!==o.f&&!o.b?(h[o.a]=function(){if(h.grecaptcha){o.f=i;var n=h.grecaptcha.render;h.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(h.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete h[o.a]},Yt(ya(nt(Oh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(h.grecaptcha))})},Rh.prototype.c=function(){this.b--};var xh=null;function Mh(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.l=e,this.g=null,a=a?Dh=Dh||new kh:xh=xh||new Rh,this.o=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Uh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[qh],!h.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Vn(e)||!this.i&&Vn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Ea(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.m=[];var u=this.a[Lh];this.a[Lh]=function(t){if(Vh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,h);"function"==typeof e&&e(t)}};var c=this.a[Fh];this.a[Fh]=function(){if(Vh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,h);"function"==typeof t&&t()}}}var Lh="callback",Fh="expired-callback",Uh="sitekey",qh="size";function Vh(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function Bh(t,e){return t.h.push(e),e.ha(function(){V(t.h,e)}),e}function jh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Wh(t,e,n){var r=!1;try{this.b=n||il.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=il.SDK_VERSION?dr(il.SDK_VERSION,o):null,Mh.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,gi(mi),r)}function Kh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Qh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Qh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Mh.prototype).za=function(){var e=this;return this.f?this.f:this.f=Bh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.o.g(e.v())}).then(function(t){return e.g=t,bs(e.u,os,{})}).then(function(t){e.a[Uh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){jh(this);var n=this;return Bh(this,this.za().then(function(){if(null===n.c){var t=n.l;if(!n.i){var e=Vn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){jh(this);var i=this;return Bh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.m,function(t){return t==e})}(i,n),e(t))};i.m.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){jh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){jh(this),this.B=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Vn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Wh,Mh);var Qh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Hh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:l}}function Gh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:n}}function zh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:v}}function Yh(t,e){return{name:t||"",K:"a function",optional:!!e,M:m}}function Xh(t,e){return{name:t||"",K:"null",optional:!!e,M:i}}function Jh(n){return{name:n?n+"Credential":"credential",K:n?"a valid "+n+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.ka||!e)}}}function $h(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&l(t.type)&&m(t.verify))}}}function Zh(e,n,t,r){return{name:t||"",K:e.K+" or "+n.K,optional:!!r,M:function(t){return e.M(t)||n.M(t)}}}function tl(t,e){for(var n in e){var r=e[n].name;t[r]=rl(r,t[n],e[n].j)}}function el(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:E(function(t){return this[t]},n),set:E(function(t,e,n,r){Kh(t,[n],[r],!0),this[e]=r},r,n,e[n].rb),enumerable:!0})}}function nl(t,e,n,r){t[e]=rl(e,n,r)}function rl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Kh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}tl(ch.prototype,{Va:{name:"applyActionCode",j:[Hh("code")]},Ia:{name:"checkActionCode",j:[Hh("code")]},Xa:{name:"confirmPasswordReset",j:[Hh("code"),Hh("newPassword")]},Sb:{name:"createUserWithEmailAndPassword",j:[Hh("email"),Hh("password")]},Vb:{name:"fetchSignInMethodsForEmail",j:[Hh("email")]},la:{name:"getRedirectResult",j:[]},kc:{name:"isSignInWithEmailLink",j:[Hh("emailLink")]},rc:{name:"onAuthStateChanged",j:[Zh(zh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},sc:{name:"onIdTokenChanged",j:[Zh(zh(),Yh(),"nextOrObserver"),Yh("opt_error",!0),Yh("opt_completed",!0)]},hb:{name:"sendPasswordResetEmail",j:[Hh("email"),Zh(zh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},ib:{name:"sendSignInLinkToEmail",j:[Hh("email"),zh("actionCodeSettings")]},jb:{name:"setPersistence",j:[Hh("persistence")]},Bc:{name:"signInAndRetrieveDataWithCredential",j:[Jh()]},kb:{name:"signInAnonymously",j:[]},Pa:{name:"signInWithCredential",j:[Jh()]},Cc:{name:"signInWithCustomToken",j:[Hh("token")]},Dc:{name:"signInWithEmailAndPassword",j:[Hh("email"),Hh("password")]},Ec:{name:"signInWithEmailLink",j:[Hh("email"),Hh("emailLink",!0)]},Fc:{name:"signInWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},Gc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Hc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"updateCurrentUser",j:[Zh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof Sc)}},Xh(),"user")]},lb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Oc:{name:"useDeviceLanguage",j:[]},Pc:{name:"verifyPasswordResetCode",j:[Hh("code")]}}),el(ch.prototype,{lc:{name:"languageCode",rb:Zh(Hh(),Xh(),"languageCode")}}),(ch.Persistence=du).LOCAL="local",ch.Persistence.SESSION="session",ch.Persistence.NONE="none",tl(Sc.prototype,{delete:{name:"delete",j:[]},Zb:{name:"getIdTokenResult",j:[Gh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Gh("opt_forceRefresh",!0)]},mc:{name:"linkAndRetrieveDataWithCredential",j:[Jh()]},ab:{name:"linkWithCredential",j:[Jh()]},nc:{name:"linkWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},oc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},pc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},vc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Jh()]},cb:{name:"reauthenticateWithCredential",j:[Jh()]},wc:{name:"reauthenticateWithPhoneNumber",j:[Hh("phoneNumber"),$h()]},xc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},yc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},gb:{name:"sendEmailVerification",j:[Zh(zh("opt_actionCodeSettings",!0),Xh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Hh(null,!0)]},Lc:{name:"unlink",j:[Hh("provider")]},nb:{name:"updateEmail",j:[Hh("email")]},ob:{name:"updatePassword",j:[Hh("password")]},Nc:{name:"updatePhoneNumber",j:[Jh("phone")]},pb:{name:"updateProfile",j:[zh("profile")]}}),tl(Th.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(Eh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),tl(jt.prototype,{ha:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),el(lc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",rb:Gh("appVerificationDisabledForTesting")}}),tl(fc.prototype,{confirm:{name:"confirm",j:[Hh("verificationCode")]}}),nl(xi,"fromJSON",function(t){t=l(t)?JSON.parse(t):t;for(var e,n=[Bi,to,oo,Ui],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[Zh(Hh(),zh(),"json")]),nl(eo,"credential",function(t,e){return new Zi(t,e)},[Hh("email"),Hh("password")]),tl(Zi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Qi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Qi,"credential",Hi,[Zh(Hh(),zh(),"token")]),nl(eo,"credentialWithLink",no,[Hh("email"),Hh("emailLink")]),tl(Gi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Gi,"credential",zi,[Zh(Hh(),zh(),"token")]),tl(Yi.prototype,{ua:{name:"addScope",j:[Hh("scope")]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Yi,"credential",Xi,[Zh(Hh(),Zh(zh(),Xh()),"idToken"),Zh(Hh(),Xh(),"accessToken",!0)]),tl(Ji.prototype,{Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),nl(Ji,"credential",$i,[Zh(Hh(),zh(),"token"),Hh("secret",!0)]),tl(Ki.prototype,{ua:{name:"addScope",j:[Hh("scope")]},credential:{name:"credential",j:[Zh(Hh(),Zh(zh(),Xh()),"optionsOrIdToken"),Zh(Hh(),Xh(),"accessToken",!0)]},Ca:{name:"setCustomParameters",j:[zh("customOAuthParameters")]}}),tl(qi.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Li.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),nl(so,"credential",uo,[Hh("verificationId"),Hh("verificationCode")]),tl(so.prototype,{Ta:{name:"verifyPhoneNumber",j:[Hh("phoneNumber"),$h()]}}),tl(io.prototype,{A:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Yr.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(go.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(vo.prototype,{toJSON:{name:"toJSON",j:[Hh(null,!0)]}}),tl(Wh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===il||!il.INTERNAL||!il.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:ch,AuthCredential:xi,Error:Yr};nl(t,"EmailAuthProvider",eo,[]),nl(t,"FacebookAuthProvider",Qi,[]),nl(t,"GithubAuthProvider",Gi,[]),nl(t,"GoogleAuthProvider",Yi,[]),nl(t,"TwitterAuthProvider",Ji,[]),nl(t,"OAuthProvider",Ki,[Hh("providerId")]),nl(t,"SAMLAuthProvider",Wi,[Hh("providerId")]),nl(t,"PhoneAuthProvider",so,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof ch)}}]),nl(t,"RecaptchaVerifier",Wh,[Zh(Hh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),zh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof il.app.App)}}]),il.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new ch(t)).getUid,t),getToken:_(t.Yb,t),addAuthTokenListener:_(t.Rb,t),removeAuthTokenListener:_(t.zc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),il.INTERNAL.extendNamespace({User:Sc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var po=(yo.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Oi(e))},yo.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ri(e)},yo.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},yo.prototype.prefixedName_=function(t){return this.prefix_+t},yo.prototype.toString=function(){return this.domStorage_.toString()},yo);function yo(t){this.domStorage_=t,this.prefix_="firebase:"}var mo=(vo.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},vo.prototype.get=function(t){return xi(this.cache_,t)?this.cache_[t]:null},vo.prototype.remove=function(t){delete this.cache_[t]},vo);function vo(){this.cache_={},this.isInMemoryStorage=!0}function go(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new po(e)}}catch(t){}return new mo}function bo(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;di(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Ui;n.update(e);var r=n.digest();return mi.encodeByteArray(r)}function wo(t,e){di(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Po.logLevel=Yi.VERBOSE,Lo=Po.log.bind(Po),e&&Oo.set("logging_enabled",!0)):"function"==typeof t?Lo=t:(Lo=null,Oo.remove("logging_enabled"))}function _o(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Fo&&(Fo=!1,null===Lo&&!0===Oo.get("logging_enabled")&&wo(!0)),Lo){var n=Mo.apply(null,t);Lo(n)}}function Eo(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_o.apply(void 0,hi([n],t))}}function To(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Mo.apply(void 0,hi(t));Po.error(n)}function So(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Mo.apply(void 0,hi(t));throw Po.error(n),new Error(n)}function Io(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Mo.apply(void 0,hi(t));Po.warn(n)}function Co(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function No(t,e){return t===e?0:t<e?-1:1}function Ao(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Oi(e))}function ko(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Do,Ro=go("localStorage"),Oo=go("sessionStorage"),Po=new to("@firebase/database"),xo=(Do=1,function(){return Do++}),Mo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Mo.apply(null,t[r]):"object"==typeof t[r]?n+=Oi(t[r]):n+=t[r],n+=" ";return n},Lo=null,Fo=!0,Uo="[MIN_NAME]",qo="[MAX_NAME]",Vo=function(t,e){if(t===e)return 0;if(t===Uo||e===qo)return-1;if(e===Uo||t===qo)return 1;var n=Go(t),r=Go(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Bo=function(t){if("object"!=typeof t||null===t)return Oi(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Oi(e[i]),r+=":",r+=Bo(t[e[i]]);return r+="}"};function jo(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Wo(t){var e,n,r,i,o,a,s;for(di(!Co(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Ko(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Io("Exception was thrown by user callback.",t),e},Math.floor(0))}}function Qo(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Ho=new RegExp("^-?\\d{1,10}$"),Go=function(t){if(Ho.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},zo=(Object.defineProperty(Yo,"Empty",{get:function(){return new Yo("")},enumerable:!0,configurable:!0}),Yo.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},Yo.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},Yo.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new Yo(this.pieces_,t)},Yo.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},Yo.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},Yo.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},Yo.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},Yo.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new Yo(t,0)},Yo.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof Yo)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new Yo(e,0)},Yo.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},Yo.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return Yo.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},Yo.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Vo(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},Yo.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},Yo.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},Yo);function Yo(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var Xo=(Object.defineProperty(Jo,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Jo,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Jo.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=zi(t),this.checkValid_()},Jo.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=zi(t),0<this.parts_.length&&(this.byteLength_-=1)},Jo.prototype.checkValid_=function(){if(this.byteLength_>Jo.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Jo.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Jo.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Jo.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Jo.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Jo);function Jo(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=zi(this.parts_[n]);this.checkValid_()}var $o="firebaseio.com",Zo="websocket",ta="long_polling",ea=(na.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},na.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},na.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},na.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},na.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ro.set("host:"+this.host,this.internalHost))},na.prototype.connectionURL=function(t,e){var n;if(di("string"==typeof t,"typeof type must == string"),di("object"==typeof e,"typeof params must == object"),t===Zo)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==ta)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return jo(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},na.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},na.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},na);function na(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Ro.get("host:"+t)||this.host}function ra(t){var e=ya(t),n=e.subdomain;"firebase"===e.domain&&So(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||So("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Io("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new ea(e.host,e.secure,n,r),path:new zo(e.pathString)}}function ia(t){return"string"==typeof t&&0!==t.length&&!ma.test(t)}function oa(t){return"string"==typeof t&&0!==t.length&&!va.test(t)}function aa(t){return null===t||"string"==typeof t||"number"==typeof t&&!Co(t)||t&&"object"==typeof t&&xi(t,".sv")}function sa(t,e,n,r,i){i&&void 0===n||ba(Qi(t,e,i),n,r)}function ua(t,e,n,r,i){if(!i||void 0!==n){var o=Qi(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];jo(n,function(t,e){var n=new zo(t);if(ba(o,e,r.child(n)),".priority"===n.getBack()&&!aa(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ia(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(zo.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function ca(t,e,n,r){if(!r||void 0!==n){if(Co(n))throw new Error(Qi(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!aa(n))throw new Error(Qi(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function ha(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Qi(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function la(t,e,n,r){if(!(r&&void 0===n||ia(n)))throw new Error(Qi(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function fa(t,e,n,r){if(!(r&&void 0===n||oa(n)))throw new Error(Qi(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function pa(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function da(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ia(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),oa(t)}(r))throw new Error(Qi(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var ya=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ui(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Io("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},ma=/[\[\].#$\/\u0000-\u001F\u007F]/,va=/[\[\].#$\u0000-\u001F\u007F]/,ga=10485760,ba=function(n,t,e){var r=e instanceof zo?new Xo(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(Co(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>ga/3&&zi(t)>ga)throw new Error(n+"contains a string greater than "+ga+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(jo(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ia(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),ba(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},wa=(_a.prototype.cancel=function(t){Ki("OnDisconnect.cancel",0,1,arguments.length),Hi("OnDisconnect.cancel",1,t,!0);var e=new bi;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},_a.prototype.remove=function(t){Ki("OnDisconnect.remove",0,1,arguments.length),pa("OnDisconnect.remove",this.path_),Hi("OnDisconnect.remove",1,t,!0);var e=new bi;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},_a.prototype.set=function(t,e){Ki("OnDisconnect.set",1,2,arguments.length),pa("OnDisconnect.set",this.path_),sa("OnDisconnect.set",1,t,this.path_,!1),Hi("OnDisconnect.set",2,e,!0);var n=new bi;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},_a.prototype.setWithPriority=function(t,e,n){Ki("OnDisconnect.setWithPriority",2,3,arguments.length),pa("OnDisconnect.setWithPriority",this.path_),sa("OnDisconnect.setWithPriority",1,t,this.path_,!1),ca("OnDisconnect.setWithPriority",2,e,!1),Hi("OnDisconnect.setWithPriority",3,n,!0);var r=new bi;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},_a.prototype.update=function(t,e){if(Ki("OnDisconnect.update",1,2,arguments.length),pa("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Io("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ua("OnDisconnect.update",1,t,this.path_,!1),Hi("OnDisconnect.update",2,e,!0);var i=new bi;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},_a);function _a(t,e){this.repo_=t,this.path_=e}var Ea=(Ta.prototype.toJSON=function(){return Ki("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Ta);function Ta(t,e){this.committed=t,this.snapshot=e}var Sa,Ia,Ca,Na=(Sa="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ia=0,Ca=[],function(t){var e,n=t===Ia;Ia=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Sa.charAt(t%64),t=Math.floor(t/64);di(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Ca[e];e--)Ca[e]=0;Ca[e]++}else for(e=0;e<12;e++)Ca[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Sa.charAt(Ca[e]);return di(20===i.length,"nextPushId: Length should be 20."),i}),Aa=(ka.Wrap=function(t,e){return new ka(t,e)},ka);function ka(t,e){this.name=t,this.node=e}var Da,Ra=(Oa.prototype.getCompare=function(){return this.compare.bind(this)},Oa.prototype.indexedValueChanged=function(t,e){var n=new Aa(Uo,t),r=new Aa(Uo,e);return 0!==this.compare(n,r)},Oa.prototype.minPost=function(){return Aa.MIN},Oa);function Oa(){}var Pa,xa=(ii(Ma,Pa=Ra),Object.defineProperty(Ma,"__EMPTY_NODE",{get:function(){return Da},set:function(t){Da=t},enumerable:!0,configurable:!0}),Ma.prototype.compare=function(t,e){return Vo(t.name,e.name)},Ma.prototype.isDefinedOn=function(t){throw yi("KeyIndex.isDefinedOn not expected to be called.")},Ma.prototype.indexedValueChanged=function(t,e){return!1},Ma.prototype.minPost=function(){return Aa.MIN},Ma.prototype.maxPost=function(){return new Aa(qo,Da)},Ma.prototype.makePost=function(t,e){return di("string"==typeof t,"KeyIndex indexValue must always be a string."),new Aa(t,Da)},Ma.prototype.toString=function(){return".key"},Ma);function Ma(){return null!==Pa&&Pa.apply(this,arguments)||this}var La,Fa=new xa;function Ua(t){return"number"==typeof t?"number:"+Wo(t):"string:"+t}function qa(t){if(t.isLeafNode()){var e=t.val();di("string"==typeof e||"number"==typeof e||"object"==typeof e&&xi(e,".sv"),"Priority must be a string or number.")}else di(t===La||t.isEmpty(),"priority of unexpected type.");di(t===La||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Va,Ba,ja,Wa,Ka=(Object.defineProperty(Qa,"__childrenNodeConstructor",{get:function(){return Va},set:function(t){Va=t},enumerable:!0,configurable:!0}),Qa.prototype.isLeafNode=function(){return!0},Qa.prototype.getPriority=function(){return this.priorityNode_},Qa.prototype.updatePriority=function(t){return new Qa(this.value_,t)},Qa.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:Qa.__childrenNodeConstructor.EMPTY_NODE},Qa.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:Qa.__childrenNodeConstructor.EMPTY_NODE},Qa.prototype.hasChild=function(){return!1},Qa.prototype.getPredecessorChildName=function(t,e){return null},Qa.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Qa.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},Qa.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(di(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,Qa.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},Qa.prototype.isEmpty=function(){return!1},Qa.prototype.numChildren=function(){return 0},Qa.prototype.forEachChild=function(t,e){return!1},Qa.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},Qa.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ua(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Wo(this.value_):this.value_,this.lazyHash_=bo(t)}return this.lazyHash_},Qa.prototype.getValue=function(){return this.value_},Qa.prototype.compareTo=function(t){return t===Qa.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Qa.__childrenNodeConstructor?-1:(di(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},Qa.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=Qa.VALUE_TYPE_ORDER.indexOf(e),i=Qa.VALUE_TYPE_ORDER.indexOf(n);return di(0<=r,"Unknown leaf type: "+e),di(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},Qa.prototype.withIndex=function(){return this},Qa.prototype.isIndexed=function(){return!0},Qa.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},Qa.VALUE_TYPE_ORDER=["object","boolean","number","string"],Qa);function Qa(t,e){void 0===e&&(e=Qa.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,di(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),qa(this.priorityNode_)}function Ha(){return null!==Wa&&Wa.apply(this,arguments)||this}var Ga=new(ii(Ha,Wa=Ra),Ha.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Vo(t.name,e.name):i},Ha.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Ha.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Ha.prototype.minPost=function(){return Aa.MIN},Ha.prototype.maxPost=function(){return new Aa(qo,new Ka("[PRIORITY-POST]",ja))},Ha.prototype.makePost=function(t,e){var n=Ba(t);return new Aa(e,new Ka("[PRIORITY-POST]",n))},Ha.prototype.toString=function(){return".priority"},Ha),za=(Ya.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},Ya.prototype.hasNext=function(){return 0<this.nodeStack_.length},Ya.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},Ya);function Ya(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Xa=(Ja.prototype.copy=function(t,e,n,r,i){return new Ja(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ja.prototype.count=function(){return this.left.count()+1+this.right.count()},Ja.prototype.isEmpty=function(){return!1},Ja.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Ja.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Ja.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},Ja.prototype.minKey=function(){return this.min_().key},Ja.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Ja.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},Ja.prototype.removeMin_=function(){if(this.left.isEmpty())return ts.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},Ja.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return ts.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},Ja.prototype.isRed_=function(){return this.color},Ja.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},Ja.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},Ja.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},Ja.prototype.rotateLeft_=function(){var t=this.copy(null,null,Ja.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ja.prototype.rotateRight_=function(){var t=this.copy(null,null,Ja.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ja.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ja.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},Ja.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},Ja.RED=!0,Ja.BLACK=!1,Ja);function Ja(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ja.RED,this.left=null!=r?r:ts.EMPTY_NODE,this.right=null!=i?i:ts.EMPTY_NODE}var $a=(Za.prototype.copy=function(t,e,n,r,i){return this},Za.prototype.insert=function(t,e,n){return new Xa(t,e,null)},Za.prototype.remove=function(t,e){return this},Za.prototype.count=function(){return 0},Za.prototype.isEmpty=function(){return!0},Za.prototype.inorderTraversal=function(t){return!1},Za.prototype.reverseTraversal=function(t){return!1},Za.prototype.minKey=function(){return null},Za.prototype.maxKey=function(){return null},Za.prototype.check_=function(){return 0},Za.prototype.isRed_=function(){return!1},Za);function Za(){}var ts=(es.prototype.insert=function(t,e){return new es(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Xa.BLACK,null,null))},es.prototype.remove=function(t){return new es(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Xa.BLACK,null,null))},es.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},es.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},es.prototype.isEmpty=function(){return this.root_.isEmpty()},es.prototype.count=function(){return this.root_.count()},es.prototype.minKey=function(){return this.root_.minKey()},es.prototype.maxKey=function(){return this.root_.maxKey()},es.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},es.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},es.prototype.getIterator=function(t){return new za(this.root_,null,this.comparator_,!1,t)},es.prototype.getIteratorFrom=function(t,e){return new za(this.root_,t,this.comparator_,!1,e)},es.prototype.getReverseIteratorFrom=function(t,e){return new za(this.root_,t,this.comparator_,!0,e)},es.prototype.getReverseIterator=function(t){return new za(this.root_,null,this.comparator_,!0,t)},es.EMPTY_NODE=new $a,es);function es(t,e){void 0===e&&(e=es.EMPTY_NODE),this.comparator_=t,this.root_=e}var ns=Math.log(2),rs=(is.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},is);function is(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/ns,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var os,as,ss=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Xa(r,n.node,Xa.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Xa(r,n.node,Xa.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new Xa(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Xa.BLACK):(r(a,Xa.BLACK),r(a,Xa.RED))}return n}(new rs(c.length));return new ts(e||t,n)},us={},cs=(Object.defineProperty(hs,"Default",{get:function(){return di(Ga,"ChildrenNode.ts has not been loaded"),os=os||new hs({".priority":us},{".priority":Ga})},enumerable:!0,configurable:!0}),hs.prototype.get=function(t){var e=Mi(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ts?e:null},hs.prototype.hasIndex=function(t){return xi(this.indexSet_,t.toString())},hs.prototype.addIndex=function(t,e){di(t!==Fa,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Aa.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?ss(r,t.getCompare()):us;var s=t.toString(),u=oi({},this.indexSet_);u[s]=t;var c=oi({},this.indexes_);return c[s]=n,new hs(c,u)},hs.prototype.addToIndexes=function(u,c){var h=this;return new hs(Fi(this.indexes_,function(t,e){var n=Mi(h.indexSet_,e);if(di(n,"Missing index implementation for "+e),t===us){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(Aa.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),ss(r,n.getCompare())}return us}var a=c.get(u.name),s=t;return a&&(s=s.remove(new Aa(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},hs.prototype.removeFromIndexes=function(n,r){return new hs(Fi(this.indexes_,function(t){if(t===us)return t;var e=r.get(n.name);return e?t.remove(new Aa(n.name,e)):t}),this.indexSet_)},hs);function hs(t,e){this.indexes_=t,this.indexSet_=e}function ls(t,e){return Vo(t.name,e.name)}function fs(t,e){return Vo(t,e)}var ps,ds=(Object.defineProperty(ys,"EMPTY_NODE",{get:function(){return as=as||new ys(new ts(fs),null,cs.Default)},enumerable:!0,configurable:!0}),ys.prototype.isLeafNode=function(){return!1},ys.prototype.getPriority=function(){return this.priorityNode_||as},ys.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new ys(this.children_,t,this.indexMap_)},ys.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?as:e},ys.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},ys.prototype.hasChild=function(t){return null!==this.children_.get(t)},ys.prototype.updateImmediateChild=function(t,e){if(di(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new Aa(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?as:this.priorityNode_,new ys(i,n,o)},ys.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;di(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},ys.prototype.isEmpty=function(){return this.children_.isEmpty()},ys.prototype.numChildren=function(){return this.children_.count()},ys.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(Ga,function(t,e){r[t]=e.val(n),i++,a&&ys.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},ys.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Ua(this.getPriority().val())+":"),this.forEachChild(Ga,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":bo(r)}return this.lazyHash_},ys.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Aa(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},ys.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},ys.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Aa(e,this.children_.get(e)):null},ys.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},ys.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Aa(e,this.children_.get(e)):null},ys.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},ys.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},ys.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Aa.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},ys.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},ys.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Aa.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},ys.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===vs?-1:0},ys.prototype.withIndex=function(t){if(t===Fa||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new ys(this.children_,this.priorityNode_,e)},ys.prototype.isIndexed=function(t){return t===Fa||this.indexMap_.hasIndex(t)},ys.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Ga),r=e.getIterator(Ga),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},ys.prototype.resolveIndex_=function(t){return t===Fa?null:this.indexMap_.get(t.toString())},ys.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,ys);function ys(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&qa(this.priorityNode_),this.children_.isEmpty()&&di(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function ms(){return ps.call(this,new ts(fs),ds.EMPTY_NODE,cs.Default)||this}var vs=new(ii(ms,ps=ds),ms.prototype.compareTo=function(t){return t===this?0:1},ms.prototype.equals=function(t){return t===this},ms.prototype.getPriority=function(){return this},ms.prototype.getImmediateChild=function(t){return ds.EMPTY_NODE},ms.prototype.isEmpty=function(){return!1},ms);Object.defineProperties(Aa,{MIN:{value:new Aa(Uo,ds.EMPTY_NODE)},MAX:{value:new Aa(qo,vs)}}),xa.__EMPTY_NODE=ds.EMPTY_NODE,Ka.__childrenNodeConstructor=ds,La=vs,ja=vs;var gs,bs=!0;function ws(r,t){if(void 0===t&&(t=null),null===r)return ds.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),di(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Ka(r,ws(t));if(r instanceof Array||!bs){var i=ds.EMPTY_NODE;return jo(r,function(t,e){if(xi(r,t)&&"."!==t.substring(0,1)){var n=ws(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(ws(t))}var o=[],a=!1;if(jo(r,function(t,e){if("."!==t.substring(0,1)){var n=ws(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new Aa(t,n)))}}),0==o.length)return ds.EMPTY_NODE;var e=ss(o,ls,function(t){return t.name},fs);if(a){var n=ss(o,Ga.getCompare());return new ds(e,ws(t),new cs({".priority":n},{".priority":Ga}))}return new ds(e,ws(t),cs.Default)}function _s(){return null!==gs&&gs.apply(this,arguments)||this}Ba=ws;var Es,Ts=new(ii(_s,gs=Ra),_s.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Vo(t.name,e.name):n},_s.prototype.isDefinedOn=function(t){return!0},_s.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},_s.prototype.minPost=function(){return Aa.MIN},_s.prototype.maxPost=function(){return Aa.MAX},_s.prototype.makePost=function(t,e){var n=ws(t);return new Aa(e,n)},_s.prototype.toString=function(){return".value"},_s),Ss=(ii(Is,Es=Ra),Is.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Is.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Is.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Vo(t.name,e.name):i},Is.prototype.makePost=function(t,e){var n=ws(t),r=ds.EMPTY_NODE.updateChild(this.indexPath_,n);return new Aa(e,r)},Is.prototype.maxPost=function(){var t=ds.EMPTY_NODE.updateChild(this.indexPath_,vs);return new Aa(qo,t)},Is.prototype.toString=function(){return this.indexPath_.slice().join("/")},Is);function Is(t){var e=Es.call(this)||this;return e.indexPath_=t,di(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Cs=(Ns.prototype.val=function(){return Ki("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Ns.prototype.exportVal=function(){return Ki("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Ns.prototype.toJSON=function(){return Ki("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Ns.prototype.exists=function(){return Ki("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Ns.prototype.child=function(t){Ki("DataSnapshot.child",0,1,arguments.length),t=String(t),fa("DataSnapshot.child",1,t,!1);var e=new zo(t),n=this.ref_.child(e);return new Ns(this.node_.getChild(e),n,Ga)},Ns.prototype.hasChild=function(t){Ki("DataSnapshot.hasChild",1,1,arguments.length),fa("DataSnapshot.hasChild",1,t,!1);var e=new zo(t);return!this.node_.getChild(e).isEmpty()},Ns.prototype.getPriority=function(){return Ki("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Ns.prototype.forEach=function(n){var r=this;return Ki("DataSnapshot.forEach",1,1,arguments.length),Hi("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new Ns(e,r.ref_.child(t),Ga))})},Ns.prototype.hasChildren=function(){return Ki("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Ns.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Ns.prototype.numChildren=function(){return Ki("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Ns.prototype.getRef=function(){return Ki("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Ns.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Ns);function Ns(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var As=(ks.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},ks.prototype.getEventType=function(){return this.eventType},ks.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},ks.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Oi(this.snapshot.exportVal())},ks);function ks(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Ds=(Rs.prototype.getPath=function(){return this.path},Rs.prototype.getEventType=function(){return"cancel"},Rs.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Rs.prototype.toString=function(){return this.path.toString()+":cancel"},Rs);function Rs(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Os=(Ps.prototype.respondsTo=function(t){return"value"===t},Ps.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new As("value",this,new Cs(t.snapshotNode,e.getRef(),n))},Ps.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){di(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},Ps.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ds(this,t,e):null},Ps.prototype.matches=function(t){return t instanceof Ps&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},Ps.prototype.hasAnyCallback=function(){return null!==this.callback_},Ps);function Ps(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var xs,Ms=(Ls.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,xi(this.callbacks_,e)},Ls.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ds(this,t,e):null},Ls.prototype.createEvent=function(t,e){di(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new As(t.type,this,new Cs(t.snapshotNode,n,r),t.prevName)},Ls.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){di(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Ls.prototype.matches=function(e){var n=this;if(e instanceof Ls){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Ls.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Ls);function Ls(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var Fs=(Object.defineProperty(Us,"__referenceConstructor",{get:function(){return di(xs,"Reference.ts has not been loaded"),xs},set:function(t){xs=t},enumerable:!0,configurable:!0}),Us.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Fa){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Uo)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=qo)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ga){if(null!=e&&!aa(e)||null!=n&&!aa(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(di(t.getIndex()instanceof Ss||t.getIndex()===Ts,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Us.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Us.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Us.prototype.getQueryParams=function(){return this.queryParams_},Us.prototype.getRef=function(){return Ki("Query.ref",0,0,arguments.length),new Us.__referenceConstructor(this.repo,this.path)},Us.prototype.on=function(t,e,n,r){Ki("Query.on",2,4,arguments.length),ha("Query.on",1,t,!1),Hi("Query.on",2,e,!1);var i=Us.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Us.prototype.onValueEvent=function(t,e,n){var r=new Os(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Us.prototype.onChildEvent=function(t,e,n){var r=new Ms(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Us.prototype.off=function(t,e,n){Ki("Query.off",0,3,arguments.length),ha("Query.off",1,t,!0),Hi("Query.off",2,e,!0),Gi("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Os(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Ms(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Us.prototype.once=function(e,n,t,r){var i=this;Ki("Query.once",1,4,arguments.length),ha("Query.once",1,e,!1),Hi("Query.once",2,n,!0);var o=Us.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new bi;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},Us.prototype.limitToFirst=function(t){if(Ki("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Us(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Us.prototype.limitToLast=function(t){if(Ki("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Us(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Us.prototype.orderByChild=function(t){if(Ki("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');fa("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new zo(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Ss(e),r=this.queryParams_.orderBy(n);return Us.validateQueryEndpoints_(r),new Us(this.repo,this.path,r,!0)},Us.prototype.orderByKey=function(){Ki("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Fa);return Us.validateQueryEndpoints_(t),new Us(this.repo,this.path,t,!0)},Us.prototype.orderByPriority=function(){Ki("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ga);return Us.validateQueryEndpoints_(t),new Us(this.repo,this.path,t,!0)},Us.prototype.orderByValue=function(){Ki("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Ts);return Us.validateQueryEndpoints_(t),new Us(this.repo,this.path,t,!0)},Us.prototype.startAt=function(t,e){void 0===t&&(t=null),Ki("Query.startAt",0,2,arguments.length),sa("Query.startAt",1,t,this.path,!0),la("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Us.validateLimit_(n),Us.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Us(this.repo,this.path,n,this.orderByCalled_)},Us.prototype.endAt=function(t,e){void 0===t&&(t=null),Ki("Query.endAt",0,2,arguments.length),sa("Query.endAt",1,t,this.path,!0),la("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Us.validateLimit_(n),Us.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Us(this.repo,this.path,n,this.orderByCalled_)},Us.prototype.equalTo=function(t,e){if(Ki("Query.equalTo",1,2,arguments.length),sa("Query.equalTo",1,t,this.path,!1),la("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Us.prototype.toString=function(){return Ki("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Us.prototype.toJSON=function(){return Ki("Query.toJSON",0,1,arguments.length),this.toString()},Us.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Us.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Bo(t);return"{}"===e?"default":e},Us.prototype.isEqual=function(t){if(Ki("Query.isEqual",1,1,arguments.length),!(t instanceof Us))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Us.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Hi(t,3,r.cancel,!0),r.context=n,Gi(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Qi(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Us.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Us);function Us(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var qs=(Vs.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Vs.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Vs);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Vs.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Ga,function(t,e){n.remember(new zo(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Vs.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new zo(r.toString()+"/"+t);e.forEachTree(n,i)})},Vs.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Vs);function Vs(){this.value=null,this.children=new Map}function Bs(t,e){return t&&"object"==typeof t?(di(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var js,Ws,Ks=function(t,r){var i,e=t.getPriority().val(),n=Bs(e,r);if(t.isLeafNode()){var o=t,a=Bs(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Ka(a,ws(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Ka(n))),s.forEachChild(Ga,function(t,e){var n=Ks(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(Ws=js=js||{})[Ws.OVERWRITE=0]="OVERWRITE",Ws[Ws.MERGE=1]="MERGE",Ws[Ws.ACK_USER_WRITE=2]="ACK_USER_WRITE",Ws[Ws.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Qs=(Hs.User=new Hs(!0,!1,null,!1),Hs.Server=new Hs(!1,!0,null,!1),Hs.forServerTaggedQuery=function(t){return new Hs(!1,!0,t,!0)},Hs);function Hs(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,di(!r||e,"Tagged queries must be from server.")}var Gs,zs=(Ys.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return di(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new zo(t));return new Ys(zo.Empty,e,this.revert)}return di(this.path.getFront()===t,"operationForChild called for unrelated child."),new Ys(this.path.popFront(),this.affectedTree,this.revert)},Ys);function Ys(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=js.ACK_USER_WRITE,this.source=Qs.User}var Xs=(Js.fromObject=function(t){var n=Js.Empty;return jo(t,function(t,e){n=n.set(new zo(t),e)}),n},Js.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Js.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:zo.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new zo(n).child(i.path),value:i.value}},Js.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},Js.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):Js.Empty},Js.prototype.set=function(t,e){if(t.isEmpty())return new Js(e,this.children);var n=t.getFront(),r=(this.children.get(n)||Js.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new Js(this.value,i)},Js.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?Js.Empty:new Js(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?Js.Empty:new Js(this.value,i)}return this},Js.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},Js.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||Js.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Js(this.value,i)},Js.prototype.fold=function(t){return this.fold_(zo.Empty,t)},Js.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},Js.prototype.findOnPath=function(t,e){return this.findOnPath_(t,zo.Empty,e)},Js.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},Js.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,zo.Empty,e)},Js.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):Js.Empty},Js.prototype.foreach=function(t){this.foreach_(zo.Empty,t)},Js.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},Js.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},Js.Empty=new Js(null),Js);function Js(t,e){void 0===e&&(e=Gs=Gs||new ts(No)),this.value=t,this.children=e}var $s=(Zs.prototype.operationForChild=function(t){return this.path.isEmpty()?new Zs(this.source,zo.Empty):new Zs(this.source,this.path.popFront())},Zs);function Zs(t,e){this.source=t,this.path=e,this.type=js.LISTEN_COMPLETE}var tu=(eu.prototype.operationForChild=function(t){return this.path.isEmpty()?new eu(this.source,zo.Empty,this.snap.getImmediateChild(t)):new eu(this.source,this.path.popFront(),this.snap)},eu);function eu(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=js.OVERWRITE}var nu=(ru.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new zo(t));return e.isEmpty()?null:e.value?new tu(this.source,zo.Empty,e.value):new ru(this.source,zo.Empty,e)}return di(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new ru(this.source,this.path.popFront(),this.children)},ru.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},ru);function ru(t,e,n){this.source=t,this.path=e,this.children=n,this.type=js.MERGE}var iu=(ou.prototype.isFullyInitialized=function(){return this.fullyInitialized_},ou.prototype.isFiltered=function(){return this.filtered_},ou.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},ou.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},ou.prototype.getNode=function(){return this.node_},ou);function ou(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var au=(su.prototype.updateEventSnap=function(t,e,n){return new su(new iu(t,e,n),this.serverCache_)},su.prototype.updateServerSnap=function(t,e,n){return new su(this.eventCache_,new iu(t,e,n))},su.prototype.getEventCache=function(){return this.eventCache_},su.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},su.prototype.getServerCache=function(){return this.serverCache_},su.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},su.Empty=new su(new iu(ds.EMPTY_NODE,!1,!1),new iu(ds.EMPTY_NODE,!1,!1)),su);function su(t,e){this.eventCache_=t,this.serverCache_=e}var uu=(cu.valueChange=function(t){return new cu(cu.VALUE,t)},cu.childAddedChange=function(t,e){return new cu(cu.CHILD_ADDED,e,t)},cu.childRemovedChange=function(t,e){return new cu(cu.CHILD_REMOVED,e,t)},cu.childChangedChange=function(t,e,n){return new cu(cu.CHILD_CHANGED,e,t,n)},cu.childMovedChange=function(t,e){return new cu(cu.CHILD_MOVED,e,t)},cu.CHILD_ADDED="child_added",cu.CHILD_REMOVED="child_removed",cu.CHILD_CHANGED="child_changed",cu.CHILD_MOVED="child_moved",cu.VALUE="value",cu);function cu(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var hu=(lu.prototype.updateChild=function(t,e,n,r,i,o){di(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(uu.childRemovedChange(e,a)):di(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(uu.childAddedChange(e,n)):o.trackChildChange(uu.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},lu.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Ga,function(t,e){n.hasChild(t)||i.trackChildChange(uu.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(Ga,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(uu.childChangedChange(t,e,n))}else i.trackChildChange(uu.childAddedChange(t,e))})),n.withIndex(this.index_)},lu.prototype.updatePriority=function(t,e){return t.isEmpty()?ds.EMPTY_NODE:t.updatePriority(e)},lu.prototype.filtersNodes=function(){return!1},lu.prototype.getIndexedFilter=function(){return this},lu.prototype.getIndex=function(){return this.index_},lu);function lu(t){this.index_=t}var fu=(pu.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;di(e==uu.CHILD_ADDED||e==uu.CHILD_CHANGED||e==uu.CHILD_REMOVED,"Only child changes supported for tracking"),di(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==uu.CHILD_ADDED&&i==uu.CHILD_REMOVED)this.changeMap.set(n,uu.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==uu.CHILD_REMOVED&&i==uu.CHILD_ADDED)this.changeMap.delete(n);else if(e==uu.CHILD_REMOVED&&i==uu.CHILD_CHANGED)this.changeMap.set(n,uu.childRemovedChange(n,r.oldSnap));else if(e==uu.CHILD_CHANGED&&i==uu.CHILD_ADDED)this.changeMap.set(n,uu.childAddedChange(n,t.snapshotNode));else{if(e!=uu.CHILD_CHANGED||i!=uu.CHILD_CHANGED)throw yi("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,uu.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},pu.prototype.getChanges=function(){return Array.from(this.changeMap.values())},pu);function pu(){this.changeMap=new Map}function du(){}var yu=new(du.prototype.getCompleteChild=function(t){return null},du.prototype.getChildAfterChild=function(t,e,n){return null},du),mu=(vu.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new iu(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},vu.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},vu);function vu(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var gu=function(t,e){this.viewCache=t,this.changes=e},bu=(wu.prototype.assertIndexed=function(t){di(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),di(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},wu.prototype.applyOperation=function(t,e,n,r){var i,o,a=new fu;if(e.type===js.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(di(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===js.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(di(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===js.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==js.LISTEN_COMPLETE)throw yi("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return wu.maybeAddValueEvent_(t,i,h),new gu(i,h)},wu.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(uu.valueChange(e.getCompleteEventSnap()))}},wu.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(di(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof ds?u:ds.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){di(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},wu.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,yu,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new mu(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},wu.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new mu(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):ds.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},wu.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},wu.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);wu.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);wu.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},wu.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},wu.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:Xs.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new zo(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new zo(t),i,a,s,u,c)}}),l},wu.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=Xs.Empty;return s.getNode().forEachChild(Fa,function(t,e){u=u.set(new zo(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=Xs.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},wu.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,yu,r)},wu.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new mu(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();di(h instanceof ds,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,ds.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(zo.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},wu);function wu(t){this.filter_=t}var _u=(Eu.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===uu.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(uu.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,uu.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,uu.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,uu.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,uu.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,uu.VALUE,t,n,e),i},Eu.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Eu.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Eu.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw yi("Should only compare child_ events.");var n=new Aa(t.childName,t.snapshotNode),r=new Aa(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Eu);function Eu(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Tu,Su=(Iu.prototype.getQuery=function(){return this.query_},Iu.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Iu.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Iu.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Iu.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Iu.prototype.removeEventRegistration=function(t,n){var r=[];if(n){di(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Iu.prototype.applyOperation=function(t,e,n){t.type===js.MERGE&&null!==t.source.queryId&&(di(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),di(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),di(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Iu.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ga,function(t,e){n.push(uu.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(uu.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Iu.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Iu);function Iu(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new hu(n.getIndex()),i=n.getNodeFilter();this.processor_=new bu(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(ds.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ds.EMPTY_NODE,a.getNode(),null),c=new iu(s,o.isFullyInitialized(),r.filtersNodes()),h=new iu(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new au(h,c),this.eventGenerator_=new _u(this.query_)}var Cu=(Object.defineProperty(Nu,"__referenceConstructor",{get:function(){return di(Tu,"Reference.ts has not been loaded"),Tu},set:function(t){di(!Tu,"__referenceConstructor has already been defined"),Tu=t},enumerable:!0,configurable:!0}),Nu.prototype.isEmpty=function(){return 0===this.views.size},Nu.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return di(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ui(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Nu.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof ds?n.calcCompleteEventChildren(r):ds.EMPTY_NODE,!1);var c=new au(new iu(s,u,!1),new iu(r,i,!1));a=new Su(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Nu.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ui(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ci(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Nu.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Nu.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ui(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},Nu.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ui(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Nu.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Nu.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Nu.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Nu.prototype.getCompleteView=function(){var e,t;try{for(var n=ui(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},Nu);function Nu(){this.views=new Map}var Au=(ku.prototype.addWrite=function(t,e){if(t.isEmpty())return new ku(new Xs(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=zo.relativePath(r,t);return i=i.updateChild(o,e),new ku(this.writeTree_.set(r,i))}var a=new Xs(e);return new ku(this.writeTree_.setTree(t,a))},ku.prototype.addWrites=function(n,t){var r=this;return jo(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},ku.prototype.removeWrite=function(t){return t.isEmpty()?ku.Empty:new ku(this.writeTree_.setTree(t,Xs.Empty))},ku.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},ku.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(zo.relativePath(e.path,t)):null},ku.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Ga,function(t,e){n.push(new Aa(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new Aa(t,e.value))}),n},ku.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new ku(null!=e?new Xs(e):this.writeTree_.subtree(t))},ku.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},ku.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(di(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(zo.Empty,this.writeTree_,t)},ku.Empty=new ku(new Xs(null)),ku);function ku(t){this.writeTree_=t}var Du=(Ru.prototype.childWrites=function(t){return new Ou(t,this)},Ru.prototype.addOverwrite=function(t,e,n,r){di(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},Ru.prototype.addMerge=function(t,e,n){di(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},Ru.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},Ru.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});di(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):jo(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},Ru.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},Ru.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(zo.Empty)){var o=Ru.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||ds.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(zo.Empty)){var u=t||ds.EMPTY_NODE;return s.apply(u)}return null},Ru.prototype.calcCompleteEventChildren=function(t,e){var r=ds.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(Ga,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ga,function(t,e){var n=i.childCompoundWrite(new zo(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},Ru.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){di(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},Ru.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},Ru.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},Ru.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(zo.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},Ru.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},Ru.prototype.resetTree_=function(){this.visibleWrites_=Ru.layerTree_(this.allWrites_,Ru.DefaultFilter_,zo.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},Ru.DefaultFilter_=function(t){return t.visible},Ru.layerTree_=function(t,e,n){for(var r=Au.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=zo.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=zo.relativePath(a,n),r=r.addWrite(zo.Empty,o.snap.getChild(s)));else{if(!o.children)throw yi("WriteRecord should have .snap or .children");if(n.contains(a))s=zo.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=zo.relativePath(a,n)).isEmpty())r=r.addWrites(zo.Empty,o.children);else{var u=Mi(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(zo.Empty,c)}}}}}return r},Ru);function Ru(){this.visibleWrites_=Au.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Ou=(Pu.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Pu.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Pu.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Pu.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Pu.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Pu.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Pu.prototype.child=function(t){return new Pu(this.treePath_.child(t),this.writeTree_)},Pu);function Pu(t,e){this.treePath_=t,this.writeTree_=e}var xu=(Mu.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new tu(Qs.User,t,e)):[]},Mu.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Xs.fromObject(e);return this.applyOperationToSyncPoints_(new nu(Qs.User,t,r))},Mu.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Xs.Empty;return null!=n.snap?r=r.set(zo.Empty,!0):jo(n.children,function(t,e){r=r.set(new zo(t),e)}),this.applyOperationToSyncPoints_(new zs(n.path,r,e))}return[]},Mu.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new tu(Qs.Server,t,e))},Mu.prototype.applyServerMerge=function(t,e){var n=Xs.fromObject(e);return this.applyOperationToSyncPoints_(new nu(Qs.Server,t,n))},Mu.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new $s(Qs.Server,t))},Mu.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=Mu.parseQueryKey_(r),o=i.path,a=i.queryId,s=zo.relativePath(o,t),u=new tu(Qs.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},Mu.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=Mu.parseQueryKey_(r),o=i.path,a=i.queryId,s=zo.relativePath(o,t),u=Xs.fromObject(e),c=new nu(Qs.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},Mu.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=Mu.parseQueryKey_(n),i=r.path,o=r.queryId,a=zo.relativePath(i,t),s=new $s(Qs.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},Mu.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=zo.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(zo.Empty)):(a=new Cu,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=ds.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(zo.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=Mu.makeQueryKey_(t);di(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=Mu.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},Mu.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(Mu.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(Mu.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(Mu.makeQueryKey_(t));r.listenProvider_.stopListening(Mu.queryForListening_(t),e)})),this.removeTags_(u)}return a},Mu.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=zo.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},Mu.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),jo(n,function(t,e){r=r.concat(e)}),r})},Mu.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=Mu.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},Mu.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},Mu.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(Mu.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)di(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),jo(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(Mu.queryForListening_(c),this.tagForQuery_(c))}return o},Mu.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||ds.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},Mu.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},Mu.parseQueryKey_=function(t){var e=t.indexOf("$");return di(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new zo(t.substr(0,e))}},Mu.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},Mu.prototype.tagForQuery_=function(t){var e=Mu.makeQueryKey_(t);return this.queryToTagMap.get(e)},Mu.getNextQueryTag_=function(){return Mu.nextQueryTag_++},Mu.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);di(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},Mu.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(zo.Empty))},Mu.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(zo.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(zo.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},Mu.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(zo.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(zo.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},Mu.nextQueryTag_=1,Mu);function Mu(t){this.listenProvider_=t,this.syncPointTree_=Xs.Empty,this.pendingWriteTree_=new Du,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Lu=(Fu.prototype.getNode=function(t){return this.rootNode_.getChild(t)},Fu.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},Fu);function Fu(){this.rootNode_=ds.EMPTY_NODE}var Uu=(qu.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(_o("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},qu.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},qu.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},qu.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Io(t)},qu);function qu(t){this.app_=t}var Vu=(Bu.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),xi(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Bu.prototype.get=function(){return vi(this.counters_)},Bu);function Bu(){this.counters_={}}var ju=(Wu.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Vu),this.collections_[e]},Wu.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},Wu.collections_={},Wu.reporters_={},Wu);function Wu(){}var Ku=(Qu.prototype.get=function(){var t=this.collection_.get(),n=oi({},t);return this.last_&&jo(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Qu);function Qu(t){this.collection_=t,this.last_=null}var Hu=(Gu.prototype.includeStat=function(t){this.statsToReport_[t]=!0},Gu.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;jo(t,function(t,e){0<e&&xi(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Qo(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Gu);function Gu(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Ku(t);var n=1e4+2e4*Math.random();Qo(this.reportStats_.bind(this),Math.floor(n))}var zu=(Yu.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Xu(i)),e.add(r)}e&&this.eventLists_.push(e)},Yu.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},Yu.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},Yu.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},Yu);function Yu(){this.eventLists_=[],this.recursionDepth_=0}var Xu=(Ju.prototype.add=function(t){this.events_.push(t)},Ju.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Lo&&_o("event: "+e.toString()),Ko(n)}}},Ju.prototype.getPath=function(){return this.path_},Ju);function Ju(t){this.path_=t,this.events_=[]}var $u=(Zu.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=hi(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},Zu.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},Zu.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},Zu.prototype.validateEventType_=function(e){di(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},Zu);function Zu(t){this.allowedEvents_=t,this.listeners_={},di(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var tc,ec=(ii(nc,tc=$u),nc.getInstance=function(){return new nc},nc.prototype.getInitialEvent=function(t){return di("visible"===t,"Unknown event type: "+t),[this.visible_]},nc);function nc(){var e,t,n=tc.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var rc,ic=(ii(oc,rc=$u),oc.getInstance=function(){return new oc},oc.prototype.getInitialEvent=function(t){return di("online"===t,"Unknown event type: "+t),[this.online_]},oc.prototype.currentlyOnline=function(){return this.online_},oc);function oc(){var t=rc.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ei()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var ac=(sc.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},sc.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Ko(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},sc);function sc(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var uc=(cc.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new ac(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new hc(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ci(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf($o)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},cc.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},cc.forceAllow=function(){cc.forceAllow_=!0},cc.forceDisallow=function(){cc.forceDisallow_=!0},cc.isAvailable=function(){return cc.forceAllow_||!cc.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Si()},cc.prototype.markConnectionHealthy=function(){},cc.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},cc.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},cc.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},cc.prototype.send=function(t){var e=Oi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=li(t);return mi.encodeByteArray(e,!0)}(e),r=ko(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},cc.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},cc.prototype.incrementIncomingBytes_=function(t){var e=Oi(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},cc);function cc(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Eo(t),this.stats_=ju.getCollection(e),this.urlFn=function(t){return e.connectionURL(ta,t)}}var hc=(lc.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||_o("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},lc.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},lc.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},lc.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},lc.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},lc.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},lc.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){_o("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},lc);function lc(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=xo(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=lc.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){_o("frame writing exception"),t.stack&&_o(t.stack),_o(t)}}var fc="";var pc=null;"undefined"!=typeof MozWebSocket?pc=MozWebSocket:"undefined"!=typeof WebSocket&&(pc=WebSocket);var dc=(yc.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf($o)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Zo,r)},yc.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ro.set("previous_websocket_failure",!0);try{if(Si()){var r=pi.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+fc+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new pc(this.connURL,[],i)}else this.mySock=new pc(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},yc.prototype.start=function(){},yc.forceDisallow=function(){yc.forceDisallow_=!0},yc.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==pc&&!yc.forceDisallow_},yc.previouslyFailed=function(){return Ro.isInMemoryStorage||!0===Ro.get("previous_websocket_failure")},yc.prototype.markConnectionHealthy=function(){Ro.remove("previous_websocket_failure")},yc.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ri(e);this.onMessage(n)}},yc.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},yc.prototype.extractFrameCount_=function(t){if(di(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},yc.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},yc.prototype.send=function(t){this.resetKeepAlive();var e=Oi(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=ko(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},yc.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},yc.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},yc.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},yc.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},yc.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},yc.responsesRequiredToBeHealthy=2,yc.healthyTimeout=3e4,yc);function yc(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Eo(this.connId),this.stats_=ju.getCollection(e),this.connURL=yc.connectionURL_(e,n,r)}var mc=(Object.defineProperty(vc,"ALL_TRANSPORTS",{get:function(){return[uc,dc]},enumerable:!0,configurable:!0}),vc.prototype.initTransports_=function(t){var e,n,r=dc&&dc.isAvailable(),i=r&&!dc.previouslyFailed();if(t.webSocketOnly&&(r||Io("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[dc];else{var o=this.transports_=[];try{for(var a=ui(vc.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},vc.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},vc.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},vc);function vc(t){this.initTransports_(t)}var gc=(bc.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Qo(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},bc.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},bc.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},bc.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},bc.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},bc.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},bc.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},bc.prototype.onSecondaryMessageReceived_=function(t){var e=Ao("t",t),n=Ao("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},bc.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},bc.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},bc.prototype.onPrimaryMessageReceived_=function(t){var e=Ao("t",t),n=Ao("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},bc.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},bc.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},bc.prototype.onControl_=function(t){var e=Ao("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?To("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):To("Unknown control packet command: "+e)}},bc.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Io("Protocol version mismatch detected"),this.tryStartUpgrade_())},bc.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},bc.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Qo(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},bc.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},bc.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Qo(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},bc.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},bc.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},bc.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ro.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},bc.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},bc.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},bc.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},bc.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},bc);function bc(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Eo("c:"+this.id+":"),this.transportManager_=new mc(e),this.log_("Connection created"),this.start_()}var wc=(_c.prototype.put=function(t,e,n,r){},_c.prototype.merge=function(t,e,n,r){},_c.prototype.refreshAuthToken=function(t){},_c.prototype.onDisconnectPut=function(t,e,n){},_c.prototype.onDisconnectMerge=function(t,e,n){},_c.prototype.onDisconnectCancel=function(t,e){},_c.prototype.reportStats=function(t){},_c);function _c(){}var Ec,Tc=(ii(Sc,Ec=wc),Sc.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Oi(i)),di(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Sc.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),di(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),di(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Sc.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Sc.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Sc.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&xi(t,"w")){var n=Mi(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Io("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Sc.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Sc.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Pi(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Sc.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Pi(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Sc.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),di(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Sc.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Sc.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Sc.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Sc.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Sc.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Sc.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Sc.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Sc.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Sc.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Sc.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Sc.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Oi(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Sc.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):To("Unrecognized action received from server: "+Oi(t)+"\nAre you using the latest client?")},Sc.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Sc.prototype.scheduleConnect_=function(t){var e=this;di(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Sc.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Sc.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Sc.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Sc.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Sc.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){di(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?_o("getToken() completed but was canceled"):(_o("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new gc(i,o.repoInfo_,e,n,r,function(t){Io(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Sc.prototype.interrupt=function(t){_o("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Sc.prototype.resume=function(t){_o("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Li(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Sc.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Sc.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Sc.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Bo(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Sc.prototype.removeListen_=function(t,e){var n,r=new zo(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Sc.prototype.onAuthRevoked_=function(t,e){_o("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Sc.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Sc.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ui(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ui(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Sc.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+fc.replace(/\./g,"-")]=1,Ei()?t["framework.cordova"]=1:Ti()&&(t["framework.reactnative"]=1),this.reportStats(t)},Sc.prototype.shouldReconnect_=function(){var t=ic.getInstance().currentlyOnline();return Li(this.interruptReasons_)&&t},Sc.nextPersistentConnectionId_=0,Sc.nextConnectionId_=0,Sc);function Sc(t,e,n,r,i,o){var a=Ec.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Sc.nextPersistentConnectionId_++,a.log_=Eo("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Si())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),ec.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&ic.getInstance().on("online",a.onOnline_,a),a}var Ic,Cc=(ii(Nc,Ic=wc),Nc.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Nc.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(di(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Nc.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=Nc.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Mi(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Nc.prototype.unlisten=function(t,e){var n=Nc.getListenId_(t,e);delete this.listens_[n]},Nc.prototype.refreshAuthToken=function(t){},Nc.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ri(r.responseText)}catch(t){Io("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&Io("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},Nc);function Nc(t,e,n){var r=Ic.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Eo("p:rest:"),r.listens_={},r}var Ac="repo_interrupt",kc=(Dc.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Dc.prototype.name=function(){return this.repoInfo_.namespace},Dc.prototype.serverTime=function(){var t=this.infoData_.getNode(new zo(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},Dc.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},Dc.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new zo(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Fi(e,function(t){return ws(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=ws(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Fi(e,function(t){return ws(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=ws(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},Dc.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},Dc.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},Dc.prototype.onServerInfoUpdate_=function(t){var n=this;jo(t,function(t,e){n.updateInfo_(e,t)})},Dc.prototype.updateInfo_=function(t,e){var n=new zo("/.info/"+t),r=ws(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},Dc.prototype.getNextWriteId_=function(){return this.nextWriteId_++},Dc.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=ws(t,e),s=Ks(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Io("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},Dc.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(jo(t,function(t,e){r=!1;var n=ws(e);u[t]=Ks(n,i)}),r)_o("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Io("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),jo(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},Dc.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new qs;return t.forEachTree(new zo(""),function(t,e){r.remember(t,Ks(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(zo.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new qs,this.eventQueue_.raiseEventsForChangedPath(zo.Empty,i)},Dc.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},Dc.prototype.onDisconnectSet=function(n,t,r){var i=this,o=ws(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Dc.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=ws(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},Dc.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Li(n))return _o("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&jo(n,function(t,e){var n=ws(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},Dc.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Dc.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},Dc.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Ac)},Dc.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Ac)},Dc.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Ku(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);jo(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},Dc.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},Dc.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),_o.apply(void 0,hi([n],t))},Dc.prototype.callOnCompleteCallback=function(r,i,o){r&&Ko(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(Dc.prototype,"database",{get:function(){return this.__database||(this.__database=new Yc(this))},enumerable:!0,configurable:!0}),Dc);function Dc(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new zu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new qs,this.persistentConnection_=null;var r=new Uu(n);if(this.stats_=ju.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Cc(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Oi(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Tc(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=ju.getOrCreateReporter(t,function(){return new Hu(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Lu,this.infoSyncTree_=new xu({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new xu({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var Rc=(Oc.prototype.getStartPost=function(){return this.startPost_},Oc.prototype.getEndPost=function(){return this.endPost_},Oc.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Oc.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Aa(e,n))||(n=ds.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Oc.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=ds.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(ds.EMPTY_NODE);var i=this;return e.forEachChild(Ga,function(t,e){i.matches(new Aa(t,e))||(r=r.updateImmediateChild(t,ds.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Oc.prototype.updatePriority=function(t,e){return t},Oc.prototype.filtersNodes=function(){return!0},Oc.prototype.getIndexedFilter=function(){return this.indexedFilter_},Oc.prototype.getIndex=function(){return this.index_},Oc.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Oc.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Oc);function Oc(t){this.indexedFilter_=new hu(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Oc.getStartPost_(t),this.endPost_=Oc.getEndPost_(t)}var Pc=(xc.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Aa(e,n))||(n=ds.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},xc.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=ds.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=ds.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(ds.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,ds.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},xc.prototype.updatePriority=function(t,e){return t},xc.prototype.filtersNodes=function(){return!0},xc.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},xc.prototype.getIndex=function(){return this.index_},xc.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;di(s.numChildren()==this.limit_,"");var u=new Aa(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(uu.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(uu.childRemovedChange(e,l));var d=s.updateImmediateChild(e,ds.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(uu.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(uu.childRemovedChange(c.name,c.node)),i.trackChildChange(uu.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,ds.EMPTY_NODE)):t},xc);function xc(t){this.rangedFilter_=new Rc(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Mc=(Lc.prototype.hasStart=function(){return this.startSet_},Lc.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===Lc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},Lc.prototype.getIndexStartValue=function(){return di(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},Lc.prototype.getIndexStartName=function(){return di(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Uo},Lc.prototype.hasEnd=function(){return this.endSet_},Lc.prototype.getIndexEndValue=function(){return di(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},Lc.prototype.getIndexEndName=function(){return di(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:qo},Lc.prototype.hasLimit=function(){return this.limitSet_},Lc.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},Lc.prototype.getLimit=function(){return di(this.limitSet_,"Only valid if limit has been set"),this.limit_},Lc.prototype.getIndex=function(){return this.index_},Lc.prototype.copy_=function(){var t=new Lc;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},Lc.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},Lc.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Lc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},Lc.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=Lc.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},Lc.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},Lc.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},Lc.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},Lc.prototype.getQueryObject=function(){var t=Lc.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Ga&&(e[t.INDEX]=this.index_.toString()),e},Lc.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},Lc.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ga},Lc.prototype.getNodeFilter=function(){return this.loadsAllData()?new hu(this.getIndex()):this.hasLimit()?new Pc(this):new Rc(this)},Lc.prototype.toRestQueryStringParameters=function(){var t,e=Lc.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Ga?e.PRIORITY_INDEX:this.index_===Ts?e.VALUE_INDEX:this.index_===Fa?e.KEY_INDEX:(di(this.index_ instanceof Ss,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Oi(t),this.startSet_&&(n[e.START_AT]=Oi(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Oi(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Oi(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Oi(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},Lc.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},Lc.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},Lc.DEFAULT=new Lc,Lc);function Lc(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ga}var Fc,Uc=(ii(qc,Fc=Fs),qc.prototype.getKey=function(){return Ki("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},qc.prototype.child=function(t){return Ki("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof zo||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),fa(t,e,n,r)}("Reference.child",1,t,!1):fa("Reference.child",1,t,!1)),new qc(this.repo,this.path.child(t))},qc.prototype.getParent=function(){Ki("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new qc(this.repo,t)},qc.prototype.getRoot=function(){Ki("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},qc.prototype.databaseProp=function(){return this.repo.database},qc.prototype.set=function(t,e){Ki("Reference.set",1,2,arguments.length),pa("Reference.set",this.path),sa("Reference.set",1,t,this.path,!1),Hi("Reference.set",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},qc.prototype.update=function(t,e){if(Ki("Reference.update",1,2,arguments.length),pa("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Io("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ua("Reference.update",1,t,this.path,!1),Hi("Reference.update",2,e,!0);var i=new bi;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},qc.prototype.setWithPriority=function(t,e,n){if(Ki("Reference.setWithPriority",2,3,arguments.length),pa("Reference.setWithPriority",this.path),sa("Reference.setWithPriority",1,t,this.path,!1),ca("Reference.setWithPriority",2,e,!1),Hi("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new bi;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},qc.prototype.remove=function(t){return Ki("Reference.remove",0,1,arguments.length),pa("Reference.remove",this.path),Hi("Reference.remove",1,t,!0),this.set(null,t)},qc.prototype.transaction=function(t,r,e){if(Ki("Reference.transaction",1,3,arguments.length),pa("Reference.transaction",this.path),Hi("Reference.transaction",1,t,!1),Hi("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Qi(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new bi;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Ea(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},qc.prototype.setPriority=function(t,e){Ki("Reference.setPriority",1,2,arguments.length),pa("Reference.setPriority",this.path),ca("Reference.setPriority",1,t,!1),Hi("Reference.setPriority",2,e,!0);var n=new bi;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},qc.prototype.push=function(t,e){Ki("Reference.push",0,2,arguments.length),pa("Reference.push",this.path),sa("Reference.push",1,t,this.path,!0),Hi("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Na(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},qc.prototype.onDisconnect=function(){return pa("Reference.onDisconnect",this.path),new wa(this.repo,this.path)},Object.defineProperty(qc.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(qc.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(qc.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(qc.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),qc);function qc(t,e){if(!(t instanceof kc))throw new Error("new Reference() no longer supported - use app.database().");return Fc.call(this,t,e,Mc.DEFAULT,!1)||this}Fs.__referenceConstructor=Uc,Cu.__referenceConstructor=Uc;var Vc,Bc,jc=function(){this.children={},this.childCount=0,this.value=null},Wc=(Kc.prototype.subTree=function(t){for(var e,n=t instanceof zo?t:new zo(t),r=this;null!==(e=n.getFront());)r=new Kc(e,r,Mi(r.node_.children,e)||new jc),n=n.popFront();return r},Kc.prototype.getValue=function(){return this.node_.value},Kc.prototype.setValue=function(t){di(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Kc.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Kc.prototype.hasChildren=function(){return 0<this.node_.childCount},Kc.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Kc.prototype.forEachChild=function(n){var r=this;jo(this.node_.children,function(t,e){n(new Kc(t,r,e))})},Kc.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},Kc.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Kc.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},Kc.prototype.path=function(){return new zo(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Kc.prototype.name=function(){return this.name_},Kc.prototype.parent=function(){return this.parent_},Kc.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Kc.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=xi(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Kc);function Kc(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new jc),this.name_=t,this.parent_=e,this.node_=n}(Bc=Vc=Vc||{})[Bc.RUN=0]="RUN",Bc[Bc.SENT=1]="SENT",Bc[Bc.COMPLETED=2]="COMPLETED",Bc[Bc.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Bc[Bc.NEEDS_ABORT=4]="NEEDS_ABORT",kc.MAX_TRANSACTION_RETRIES_=25,kc.prototype.transactions_init_=function(){this.transactionQueueTree_=new Wc},kc.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new Uc(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:xo(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Cs(a.currentInputSnapshot,new Uc(this,a.path),Ga);a.onComplete(null,!1,c)}}else{ba("transaction failed: Data returned ",u,a.path),a.status=Vc.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&xi(u,".priority"))f=Mi(u,".priority"),di(aa(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||ds.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=ws(u,f),y=Ks(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},kc.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||ds.EMPTY_NODE},kc.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);di(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Vc.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},kc.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];di(o.status===Vc.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=Vc.SENT,o.retryCount++;var a=zo.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=Vc.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new Uc(c,u[r].path),a=new Cs(i,o,Ga);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Ko(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===Vc.SENT_NEEDS_ABORT?u[r].status=Vc.NEEDS_ABORT:u[r].status=Vc.RUN;else{Io("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=Vc.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},kc.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},kc.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Vc.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=zo.relativePath(e,s.path),c=!1,h=void 0;if(di(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Vc.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Vc.RUN)if(s.retryCount>=kc.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){ba("transaction failed: Data returned ",f,s.path);var p=ws(f);"object"==typeof f&&null!=f&&xi(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Ks(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Vc.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new Uc(this,t[a].path),g=t[a].currentInputSnapshot,b=new Cs(g,v,Ga);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Ko(r[a]);this.sendReadyTransactions_()}},kc.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},kc.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},kc.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},kc.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Vc.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},kc.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},kc.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===Vc.SENT_NEEDS_ABORT);else if(e[o].status===Vc.SENT)di(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Vc.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(di(e[o].status===Vc.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Ko(n[o])}};var Qc,Hc="databaseURL",Gc=(zc.getInstance=function(){return Qc=Qc||new zc},zc.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},zc.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},zc.prototype.databaseFromApp=function(t,e){var n=e||t.options[Hc];void 0===n&&So("Can't determine Firebase Database URL.  Be sure to include "+Hc+" option when calling firebase.initializeApp().");var r=ra(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o&&(n="http://"+o+"?ns="+i.namespace),da("Invalid Firebase Database URL",1,r),r.path.isEmpty()||So("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},zc.prototype.deleteRepo=function(t){var e=Mi(this.repos_,t.app.name);e&&Mi(e,t.repoInfo_.toURLString())===t||So("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},zc.prototype.createRepo=function(t,e){var n=Mi(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Mi(n,t.toURLString());return r&&So("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new kc(t,this.useRestClient_,e),n[t.toURLString()]=r},zc.prototype.forceRestClient=function(t){this.useRestClient_=t},zc);function zc(){this.repos_={},this.useRestClient_=!1}var Yc=(Object.defineProperty(Xc.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Xc.prototype.ref=function(t){return this.checkDeleted_("ref"),Ki("database.ref",0,1,arguments.length),t instanceof Uc?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},Xc.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Ki(e,1,1,arguments.length);var n=ra(t);da(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&So(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Xc.prototype.checkDeleted_=function(t){null===this.repo_&&So("Cannot call "+t+" on a deleted database.")},Xc.prototype.goOffline=function(){Ki("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Xc.prototype.goOnline=function(){Ki("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Xc.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Xc);function Xc(t){(this.repo_=t)instanceof kc||So("Don't call new Database() directly - please use firebase.database()."),this.root_=new Uc(t,zo.Empty),this.INTERNAL=new Jc(this)}var Jc=($c.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.database.checkDeleted_("delete"),Gc.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},$c);function $c(t){this.database=t}var Zc=Object.freeze({forceLongPolling:function(){dc.forceDisallow(),uc.forceAllow()},forceWebSockets:function(){uc.forceDisallow()},isWebSocketsAvailable:function(){return dc.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),th=Tc;Tc.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Tc.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var eh,nh,rh=gc,ih=ea,oh=Object.freeze({DataConnection:th,RealTimeConnection:rh,hijackHash:function(i){var o=Tc.prototype.put;return Tc.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Tc.prototype.put=o}},ConnectionTarget:ih,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Gc.getInstance().forceRestClient(t)}}),ah=Yc.ServerValue;eh=(nh=il).SDK_VERSION,fc=eh,nh.INTERNAL.registerService("database",function(t,e,n){return Gc.getInstance().databaseFromApp(t,n)},{Reference:Uc,Query:Fs,Database:Yc,DataSnapshot:Cs,enableLogging:wo,INTERNAL:Zc,ServerValue:ah,TEST_ACCESS:oh},null,!0);var sh,uh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ch=ch||{},hh=uh;function lh(t){return"string"==typeof t}function fh(t){return"number"==typeof t}function ph(t,e){t=t.split("."),e=e||hh;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function dh(){}function yh(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function mh(t){return"array"==yh(t)}function vh(t){var e=yh(t);return"array"==e||"object"==e&&"number"==typeof t.length}function gh(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var bh="closure_uid_"+(1e9*Math.random()>>>0),wh=0;function _h(t,e,n){return t.call.apply(t.bind,arguments)}function Eh(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Th(t,e,n){return(Th=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_h:Eh).apply(null,arguments)}function Sh(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Ih=Date.now||function(){return+new Date};function Ch(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Nh(){this.j=this.j,this.i=this.i}Nh.prototype.j=!1,Nh.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[bh]||(this[bh]=++wh)},Nh.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Ah=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(lh(t))return lh(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},kh=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=lh(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Dh(){return Array.prototype.concat.apply([],arguments)}function Rh(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Oh(t){return/^[\s\xa0]*$/.test(t)}var Ph,xh=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Mh(t,e){return-1!=t.indexOf(e)}function Lh(t,e){return t<e?-1:e<t?1:0}t:{var Fh=hh.navigator;if(Fh){var Uh=Fh.userAgent;if(Uh){Ph=Uh;break t}}Ph=""}function qh(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Vh(t){var e,n={};for(e in t)n[e]=t[e];return n}var Bh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function jh(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Bh.length;i++)e=Bh[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Wh(t){return Wh[" "](t),t}Wh[" "]=dh;var Kh,Qh,Hh=Mh(Ph,"Opera"),Gh=Mh(Ph,"Trident")||Mh(Ph,"MSIE"),zh=Mh(Ph,"Edge"),Yh=zh||Gh,Xh=Mh(Ph,"Gecko")&&!(Mh(Ph.toLowerCase(),"webkit")&&!Mh(Ph,"Edge"))&&!(Mh(Ph,"Trident")||Mh(Ph,"MSIE"))&&!Mh(Ph,"Edge"),Jh=Mh(Ph.toLowerCase(),"webkit")&&!Mh(Ph,"Edge");function $h(){var t=hh.document;return t?t.documentMode:void 0}t:{var Zh="",tl=(Qh=Ph,Xh?/rv:([^\);]+)(\)|;)/.exec(Qh):zh?/Edge\/([\d\.]+)/.exec(Qh):Gh?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Qh):Jh?/WebKit\/(\S+)/.exec(Qh):Hh?/(?:Version)[ \/]?(\S+)/.exec(Qh):void 0);if(tl&&(Zh=tl?tl[1]:""),Gh){var el=$h();if(null!=el&&el>parseFloat(Zh)){Kh=String(el);break t}}Kh=Zh}var nl,rl={};function ol(s){return function(t,e){var n=rl;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=xh(String(Kh)).split("."),n=xh(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Lh(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Lh(0==o[2].length,0==a[2].length)||Lh(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var al=hh.document;nl=al&&Gh?$h()||("CSS1Compat"==al.compatMode?parseInt(Kh,10):5):void 0;var sl=!Gh||9<=Number(nl),ul=Gh&&!ol("9"),cl=function(){if(!hh.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{hh.addEventListener("test",dh,e),hh.removeEventListener("test",dh,e)}catch(t){}return t}();function hl(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function ll(t,e){if(hl.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Xh){t:{try{Wh(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=lh(t.pointerType)?t.pointerType:fl[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}hl.prototype.b=function(){this.Ja=!1},Ch(ll,hl);var fl={2:"touch",3:"pen",4:"mouse"};ll.prototype.b=function(){ll.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ul)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var pl="closure_listenable_"+(1e6*Math.random()|0),dl=0;function yl(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++dl,this.X=this.Z=!1}function ml(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function vl(t){this.src=t,this.a={},this.b=0}function gl(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Ah(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ml(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function bl(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}vl.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=bl(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new yl(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var wl="closure_lm_"+(1e6*Math.random()|0),_l={};function El(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(mh(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Dl(r);return e&&e[pl]?e.Ba(n,r,gh(i)?!!i.capture:!!i,o):Tl(e,n,r,!0,i,o)}(t,e,n,r,i);if(mh(e)){for(var o=0;o<e.length;o++)El(t,e[o],n,r,i);return null}return n=Dl(n),t&&t[pl]?t.Aa(e,n,gh(r)?!!r.capture:!!r,i):Tl(t,e,n,!1,r,i)}function Tl(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=gh(i)?!!i.capture:!!i;if(a&&!sl)return null;var s=Al(t);if(s||(t[wl]=s=new vl(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Nl,n=sl?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)cl||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Il(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Sl(t){if(!fh(t)&&t&&!t.X){var e=t.src;if(e&&e[pl])gl(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Il(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Al(e))?(gl(n,t),0==n.b&&(n.src=null,e[wl]=null)):ml(t)}}}function Il(t){return t in _l?_l[t]:_l[t]="on"+t}function Cl(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Sl(t),n.call(r,e)}function Nl(t,e){return!!t.X||(sl?Cl(t,new ll(e,this)):Cl(t,e=new ll(e||ph("window.event"),this)))}function Al(t){return(t=t[wl])instanceof vl?t:null}var kl="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dl(e){return"function"==yh(e)?e:(e[kl]||(e[kl]=function(t){return e.handleEvent(t)}),e[kl])}function Rl(){Nh.call(this),this.c=new vl(this),(this.J=this).B=null}function Ol(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&gl(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Ch(Rl,Nh),Rl.prototype[pl]=!0,(sh=Rl.prototype).addEventListener=function(t,e,n,r){El(this,t,e,n,r)},sh.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(mh(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=gh(i)?!!i.capture:!!i,r=Dl(r),e&&e[pl]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=bl(a=e.a[n],r,i,o))&&(ml(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Al(e))&&(n=e.a[n.toString()],e=-1,n&&(e=bl(n,r,i,o)),(r=-1<e?n[e]:null)&&Sl(r))}(this,t,e,n,r)},sh.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(lh(t))t=new hl(t,n);else if(t instanceof hl)t.target=t.target||n;else{var i=t;jh(t=new hl(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Ol(a,r,!0,t)&&i}if(i=Ol(a=t.a=n,r,!0,t)&&i,i=Ol(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ol(a=t.a=e[o],r,!1,t)&&i;return i},sh.G=function(){if(Rl.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ml(n[r]);delete e.a[t],e.b--}}this.B=null},sh.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},sh.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Pl=hh.JSON.stringify;function xl(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Ml(){this.b=this.a=null}xl.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Ll,Fl=new xl(function(){return new Ul},function(t){t.reset()});function Ul(){this.next=this.b=this.a=null}function ql(t){hh.setTimeout(function(){throw t},0)}function Vl(t,e){Ll||function(){var t=hh.Promise.resolve(void 0);Ll=function(){t.then(Wl)}}(),Bl||(Ll(),Bl=!0),jl.add(t,e)}Ml.prototype.add=function(t,e){var n=Fl.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ul.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Bl=!(Ul.prototype.reset=function(){this.next=this.b=this.a=null}),jl=new Ml;function Wl(){for(var t;r=n=void 0,r=null,(n=jl).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){ql(t)}var e=Fl;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Bl=!1}function Kl(t,e){Rl.call(this),this.b=t||1,this.a=e||hh,this.f=Th(this.gb,this),this.g=Ih()}function Ql(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Hl(t,e,n){if("function"==yh(t))n&&(t=Th(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Th(t.handleEvent,t)}return 2147483647<Number(e)?-1:hh.setTimeout(t,e||0)}function Gl(t,e,n){Nh.call(this),this.f=null!=n?Th(t,n):t,this.c=e,this.b=Th(this.ab,this),this.a=[]}function zl(t){t.U=Hl(t.b,t.c),t.f.apply(null,t.a)}function Yl(t){Nh.call(this),this.b=t,this.a={}}Ch(Kl,Rl),(sh=Kl.prototype).ba=!1,sh.L=null,sh.gb=function(){if(this.ba){var t=Ih()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Ql(this),this.start()))}},sh.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Ih())},sh.G=function(){Kl.N.G.call(this),Ql(this),delete this.a},Ch(Gl,Nh),(sh=Gl.prototype).ea=!1,sh.U=null,sh.Ua=function(t){this.a=arguments,this.U?this.ea=!0:zl(this)},sh.G=function(){Gl.N.G.call(this),this.U&&(hh.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},sh.ab=function(){this.U=null,this.ea&&(this.ea=!1,zl(this))},Ch(Yl,Nh);var Xl=[];function Jl(t,e,n,r){mh(n)||(n&&(Xl[0]=n.toString()),n=Xl);for(var i=0;i<n.length;i++){var o=El(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function $l(t){qh(t.a,function(t,e){this.a.hasOwnProperty(e)&&Sl(t)},t),t.a={}}function Zl(){}Yl.prototype.G=function(){Yl.N.G.call(this),$l(this)},Yl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tf=new Rl;function ef(t){hl.call(this,"serverreachability",t)}function nf(t){tf.dispatchEvent(new ef(tf,t))}function rf(t){hl.call(this,"statevent",t)}function of(t){tf.dispatchEvent(new rf(tf,t))}function af(t){hl.call(this,"timingevent",t)}function sf(t,e){if("function"!=yh(t))throw Error("Fn must not be null and must be a function");return hh.setTimeout(function(){t()},e)}Ch(ef,hl),Ch(rf,hl),Ch(af,hl);var uf={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},cf={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function hf(){}function lf(t){var e;return(e=t.a)||(e=t.a={}),e}function ff(){}hf.prototype.a=null;var pf,df={OPEN:"a",ib:"b",Na:"c",rb:"d"};function yf(){hl.call(this,"d")}function mf(){hl.call(this,"c")}function vf(){}function gf(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Yl(this),this.O=bf,t=Yh?125:void 0,this.P=new Kl(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Ch(yf,hl),Ch(mf,hl),Ch(vf,hf),pf=new vf;var bf=45e3,wf={},_f={};function Ef(t,e,n){t.F=1,t.f=Gf(Vf(e)),t.l=n,t.H=!0,Sf(t,null)}function Tf(t,e,n,r){t.F=1,t.f=Gf(Vf(e)),t.l=null,t.H=n,Sf(t,r)}function Sf(t,e){t.v=Ih(),Nf(t),t.D=Vf(t.f),Hf(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Gl(Th(t.Ka,t,t.a),t.J)),Jl(t.I,t.a,"readystatechange",t.eb),e=t.h?Vh(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),nf(1)}function If(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Cf(t,n);if(i==_f){4==e&&(t.c=4,of(14),r=!1);break}if(i==wf){t.c=4,of(15),r=!1;break}Of(t,i)}4==e&&0==n.length&&(t.c=1,of(16),r=!1),t.b=t.b&&r,r||(Rf(t),Df(t))}function Cf(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?_f:(n=Number(e.substring(n,r)),isNaN(n)?wf:(r+=1)+n>e.length?_f:(e=e.substr(r,n),t.A=r+n,e))}function Nf(t){t.R=Ih()+t.O,Af(t,t.O)}function Af(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=sf(Th(t.bb,t),e)}function kf(t){t.i&&(hh.clearTimeout(t.i),t.i=null)}function Df(t){t.g.Da()||t.m||t.g.na(t)}function Rf(t){kf(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Ql(t.P),$l(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Of(t,e){try{t.g.Ga(t,e),nf(4)}catch(t){}}function Pf(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(vh(t)||lh(t))kh(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(vh(t)||lh(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(lh(t))return t.split("");if(vh(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function xf(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof xf)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Mf(t,e){Ff(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Lf(t))}function Lf(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ff(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ff(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ff(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(sh=gf.prototype).setTimeout=function(t){this.O=t},sh.eb=function(t){t=t.target;var e=this.B;e&&3==qp(t)?e.Ua():this.Ka(t)},sh.Ka=function(t){try{if(t==this.a)t:{var e=qp(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!Yh&&!this.a.aa())){this.m||4!=e||7==n||nf(8==n||r<=0?3:2),kf(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Vp(this.a,"X-HTTP-Initial-Response");if(a&&!Oh(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,of(12),Rf(this),Df(this);break t}this.s=!0,Of(this,s)}this.H?(If(this,e,o),Yh&&this.b&&3==e&&(Jl(this.I,this.P,"tick",this.cb),this.P.start())):Of(this,o),4==e&&Rf(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Nf(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,of(12)):(this.c=0,of(13)),Rf(this),Df(this)}}}catch(t){}},sh.cb=function(){if(this.a){var t=qp(this.a),e=this.a.aa();this.A<e.length&&(kf(this),If(this,t,e),this.b&&4!=t&&Nf(this))}},sh.cancel=function(){this.m=!0,Rf(this)},sh.bb=function(){this.i=null;var t=Ih();0<=t-this.R?(2!=this.F&&(nf(3),of(17)),Rf(this),this.c=2,Df(this)):Af(this,this.R-t)},(sh=xf.prototype).C=function(){Lf(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},sh.K=function(){return Lf(this),this.a.concat()},sh.get=function(t,e){return Ff(this.b,t)?this.b[t]:e},sh.set=function(t,e){Ff(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},sh.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Uf=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function qf(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof qf?(this.h=void 0!==e?e:t.h,Bf(this,t.f),this.j=t.j,jf(this,t.b),Wf(this,t.i),this.a=t.a,Kf(this,sp(t.c)),this.g=t.g):t&&(n=String(t).match(Uf))?(this.h=!!e,Bf(this,n[1]||"",!0),this.j=zf(n[2]||""),jf(this,n[3]||"",!0),Wf(this,n[4]),this.a=zf(n[5]||"",!0),Kf(this,n[6]||"",!0),this.g=zf(n[7]||"")):(this.h=!!e,this.c=new np(null,this.h))}function Vf(t){return new qf(t)}function Bf(t,e,n){t.f=n?zf(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function jf(t,e,n){t.b=n?zf(e,!0):e}function Wf(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Kf(t,e,n){e instanceof np?(t.c=e,function(t,e){e&&!t.f&&(rp(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ip(this,e),ap(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Yf(e,tp)),t.c=new np(e,t.h))}function Qf(t,e,n){t.c.set(e,n)}function Hf(t,e,n){mh(n)||(n=[String(n)]),ap(t.c,e,n)}function Gf(t){return Qf(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ih()).toString(36)),t}function zf(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Yf(t,e,n){return lh(t)?(t=encodeURI(t).replace(e,Xf),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Xf(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}qf.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Yf(e,Jf,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(Yf(e,Jf,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Yf(n,"/"==n.charAt(0)?Zf:$f,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Yf(n,ep)),t.join("")},qf.prototype.resolve=function(t){var e=Vf(this),n=!!t.f;n?Bf(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?jf(e,t.b):n=null!=t.i;var r=t.a;if(n)Wf(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Mh(i,"./")||Mh(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Kf(e,sp(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Jf=/[#\/\?@]/g,$f=/[#\?:]/g,Zf=/[#\?]/g,tp=/[#\?@]/g,ep=/#/g;function np(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function rp(n){n.a||(n.a=new xf,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function ip(t,e){rp(t),e=up(t,e),Ff(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Mf(t.a,e))}function op(t,e){return rp(t),e=up(t,e),Ff(t.a.b,e)}function ap(t,e,n){ip(t,e),0<n.length&&(t.c=null,t.a.set(up(t,e),Rh(n)),t.b+=n.length)}function sp(t){var e=new np;return e.c=t.c,t.a&&(e.a=new xf(t.a),e.b=t.b),e}function up(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function cp(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function hp(t){var e=t.a.F.a;if(null!=e)of(4),e?(of(10),$p(t.a,t,!1)):(of(11),$p(t.a,t,!0));else{t.b=new gf(t,void 0,void 0),t.b.h=t.h,e=rd(e=t.a,e.Y()?t.f:null,t.i),of(4),Hf(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Qf(e,n,r),Tf(t.b,e,!1,t.f)}}function lp(){this.a=this.b=null}function fp(){this.a=new xf}function pp(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[bh]||(t[bh]=++wh)):e.charAt(0)+t}function dp(t,e){this.b=t,this.a=e}function yp(t){this.g=t||mp,t=hh.PerformanceNavigationTiming?0<(t=hh.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(hh.ka&&hh.ka.Ea&&hh.ka.Ea()&&hh.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new fp),this.b=null,this.c=[]}(sh=np.prototype).add=function(t,e){rp(this),this.c=null,t=up(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},sh.forEach=function(n,r){rp(this),this.a.forEach(function(t,e){kh(t,function(t){n.call(r,t,e,this)},this)},this)},sh.K=function(){rp(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},sh.C=function(t){rp(this);var e=[];if(lh(t))op(this,t)&&(e=Dh(e,this.a.get(up(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Dh(e,t[n])}return e},sh.set=function(t,e){return rp(this),this.c=null,op(this,t=up(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},sh.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},sh.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Ch(function(){},function(){}),(sh=cp.prototype).M=null,sh.$=function(t){return this.a.$(t)},sh.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},sh.Da=function(){return!1},sh.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Vp(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Vp(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void ed(e,2)}this.f=r[0]}else(e=this.a).m=this.c,ed(e,2)}else 1==this.M&&(this.g?of(6):"11111"==e?(of(5),this.g=!0,(!Gh||10<=Number(nl))&&(this.c=200,this.b.cancel(),of(11),$p(this.a,this,!0))):(of(7),this.g=!1))},sh.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,hp(this)):1==this.M&&(this.g?(of(11),$p(this.a,this,!0)):(of(10),$p(this.a,this,!1)));else{0==this.M?of(8):1==this.M&&of(9);var t=this.a;t.m=this.c,ed(t,2)}},sh.Y=function(){return this.a.Y()},sh.ma=function(){return this.a.ma()},fp.prototype.add=function(t){this.a.set(pp(t),t)},fp.prototype.C=function(){return this.a.C()};var mp=10;function vp(t,e){!t.a&&(Mh(e,"spdy")||Mh(e,"quic")||Mh(e,"h2"))&&(t.f=t.g,t.a=new fp,t.b&&(_p(t,t.b),t.b=null))}function gp(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function bp(t){return t.b?1:t.a?t.a.a.c:0}function wp(t,e){return t=t.b?t.b==e:!!t.a&&(e=pp(e),Ff(t.a.a.b,e))}function _p(t,e){t.a?t.a.add(e):t.b=e}function Ep(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=pp(e),n=Ff(t.a.a.b,n)),n&&Mf(t.a.a,pp(e)))}function Tp(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Rh(t.c);var e=t.c;return kh(t.a.C(),function(t){e=e.concat(t.j)}),e}function Sp(){}function Ip(){this.a=new Sp}function Cp(t,r,e){var i=e||"";try{Pf(t,function(t,e){var n=t;gh(t)&&(n=Pl(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Np(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}yp.prototype.cancel=function(){this.c=Tp(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(kh(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Sp.prototype.stringify=function(t){return hh.JSON.stringify(t,void 0)},Sp.prototype.parse=function(t){return hh.JSON.parse(t,void 0)};var Ap=hh.JSON.parse;function kp(t){Rl.call(this),this.headers=new xf,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Dp,this.D=this.F=!1}Ch(kp,Rl);var Dp="",Rp=/^https?$/i,Op=["POST","PUT"];function Pp(t){return"content-type"==t.toLowerCase()}function xp(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Mp(t),Fp(t)}function Mp(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Lp(t){if(t.b&&void 0!==ch&&(!t.s[1]||4!=qp(t)||2!=t.T()))if(t.l&&4==qp(t))Hl(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==qp(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Uf)[1]||null;if(!o&&hh.self&&hh.self.location){var a=hh.self.location.protocol;o=a.substr(0,a.length-1)}i=!Rp.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",Mp(t))}finally{Fp(t)}}}function Fp(t,e){if(t.a){Up(t);var n=t.a,r=t.s[0]?dh:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Up(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(hh.clearTimeout(t.m),t.m=null)}function qp(t){return t.a?t.a.readyState:0}function Vp(t,e){return t.a?t.a.getResponseHeader(e):null}function Bp(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return qh(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),lh(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Qf(t,e,n),t}function jp(t){this.f=[],this.F=new lp,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!ph("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=ph("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=ph("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=ph("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=ph("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new yp(t&&t.concurrentRequestLimit),this.ja=new Ip,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Wp(t){if(Kp(t),3==t.u){var e=t.P++,n=Vf(t.B);Qf(n,"SID",t.H),Qf(n,"RID",e),Qf(n,"TYPE","terminate"),zp(t,n),(e=new gf(t,e,void 0)).F=2,e.f=Gf(Vf(n)),n=!1,hh.navigator&&hh.navigator.sendBeacon&&(n=hh.navigator.sendBeacon(e.f.toString(),"")),!n&&hh.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Ih(),Nf(e)}nd(t)}function Kp(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(hh.clearTimeout(t.l),t.l=null),Zp(t),t.b.cancel(),t.h&&(fh(t.h)&&hh.clearTimeout(t.h),t.h=null)}function Qp(t,e){t.f.push(new dp(t.Ra++,e)),3==t.u&&Hp(t)}function Hp(t){gp(t.b)||t.h||(t.h=!0,Vl(t.Ia,t),t.A=0)}function Gp(t,e){var n;n=e?e.W:t.P++;var r=Vf(t.B);Qf(r,"SID",t.H),Qf(r,"RID",n),Qf(r,"AID",t.O),zp(t,r),t.g&&t.i&&Bp(r,t.g,t.i),n=new gf(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Yp(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),_p(t.b,n),Ef(n,r,e)}function zp(t,n){t.c&&Pf({},function(t,e){Qf(n,e,t)})}function Yp(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Th(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Cp(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Xp(t){t.a||t.l||(t.S=1,Vl(t.Ha,t),t.v=0)}function Jp(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=sf(Th(t.Ha,t),td(t,t.v)),t.v++,!0)}function $p(t,e,n){var r=e.l;r&&vp(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=rd(t,null,t.ha),Hp(t)}function Zp(t){null!=t.s&&(hh.clearTimeout(t.s),t.s=null)}function td(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function ed(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Th(t.fb,t);n||(n=new qf("//www.google.com/images/cleardot.gif"),hh.location&&"http"==hh.location.protocol||Bf(n,"https"),Gf(n)),function(t,e){var n=new Zl;if(hh.Image){var r=new Image;r.onload=Sh(Np,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Sh(Np,n,r,"TestLoadImage: error",!1,e),r.onabort=Sh(Np,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Sh(Np,n,r,"TestLoadImage: timeout",!1,e),hh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else of(2);t.u=0,t.c&&t.c.ta(e),nd(t),Kp(t)}function nd(t){t.u=0,t.m=-1,t.c&&(0==Tp(t.b).length&&0==t.f.length||(t.b.c.length=0,Rh(t.f),t.f.length=0),t.c.sa())}function rd(t,e,n){var r=function(t){return t instanceof qf?Vf(t):new qf(t,void 0)}(n);if(""!=r.b)e&&jf(r,e+"."+r.b),Wf(r,r.i);else{var i,o=hh.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new qf(null,void 0);return t&&Bf(i,t),e&&jf(i,e),n&&Wf(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&qh(t.V,function(t,e){Qf(r,e,t)}),e=t.j,n=t.I,e&&n&&Qf(r,e,n),Qf(r,"VER",t.wa),zp(t,r),r}function id(){}function od(){if(Gh&&!(10<=Number(nl)))throw Error("Environmental error: no available transport.")}function ad(t,e){Rl.call(this),this.a=new jp(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Oh(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Oh(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new cd(this)}function sd(t){yf.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ud(){mf.call(this),this.status=1}function cd(t){this.a=t}(sh=kp.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?lf(this.H):lf(pf),this.a.onreadystatechange=Th(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void xp(this,t)}t=n||"";var i=new xf(this.headers);r&&Pf(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Pp,n=t.length,r=lh(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:lh(t)?t.charAt(e):t[e]}(i.K()),n=hh.FormData&&t instanceof hh.FormData,0<=Ah(Op,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Up(this),0<this.o&&((this.D=function(t){return Gh&&ol(9)&&fh(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Th(this.Ca,this)):this.m=Hl(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){xp(this,t)}},sh.Ca=function(){void 0!==ch&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},sh.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Fp(this))},sh.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fp(this,!0)),kp.N.G.call(this)},sh.Fa=function(){this.j||(this.w||this.l||this.g?Lp(this):this.$a())},sh.$a=function(){Lp(this)},sh.T=function(){try{return 2<qp(this)?this.a.status:-1}catch(t){return-1}},sh.za=function(){try{return 2<qp(this)?this.a.statusText:""}catch(t){return""}},sh.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},sh.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ap(e)}},sh.ya=function(){return this.h},sh.Ya=function(){return lh(this.f)?this.f:String(this.f)},(sh=jp.prototype).wa=8,sh.u=1,sh.Da=function(){return 0==this.u},sh.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new gf(this,t,void 0),r=this.i;if(this.J&&(r?jh(r=Vh(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&lh(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Yp(this,n,e),Qf(i=Vf(this.B),"RID",t),Qf(i,"CVER",22),this.o&&this.j&&Qf(i,"X-HTTP-Session-Id",this.j),zp(this,i),this.g&&r&&Bp(i,this.g,r),_p(this.b,n),this.W?(Qf(i,"$req",e),Qf(i,"SID","null"),n.S=!0,Ef(n,i,null)):Ef(n,i,e),this.u=2}}else 3==this.u&&(t?Gp(this,t):0==this.f.length||gp(this.b)||Gp(this))},sh.Ha=function(){this.l=null,this.a=new gf(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Vf(this.pa);Qf(t,"RID","rpc"),Qf(t,"SID",this.H),Qf(t,"CI",this.ia?"0":"1"),Qf(t,"AID",this.O),zp(this,t),Qf(t,"TYPE","xmlhttp"),this.g&&this.i&&Bp(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Tf(this.a,t,!0,this.ga)},sh.Ga=function(t,e){if(0!=this.u&&(this.a==t||wp(this.b,t)))if(this.m=t.o,!t.s&&wp(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(mh(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Zp(this),this.a.cancel(),this.a=null}Jp(this),of(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=sf(Th(this.Za,this),6e3));if(bp(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else ed(this,11)}else if(!t.s&&this.a!=t||Zp(this),!Oh(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&fh(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Vp(r,"X-Client-Wire-Protocol"))&&vp(this.b,i),this.j&&(r=Vp(r,"X-HTTP-Session-Id")))&&(this.I=r,Qf(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=rd(this,this.Y()?this.ga:null,this.ha),r.s?(Ep(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(kf(r),Nf(r)),this.a=r):Xp(this),0<this.f.length&&Hp(this)}else"stop"!=r[0]&&"close"!=r[0]||ed(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?ed(this,7):Wp(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},sh.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Jp(this),of(19))},sh.na=function(t){var e=null;if(this.a==t){Zp(this),this.a=null;var n=2}else{if(!wp(this.b,t))return;e=t.j,Ep(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Ih()-t.v,tf.dispatchEvent(new af(tf,t.l?t.l.length:0,e,this.A)),Hp(this)):Xp(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(bp(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=sf(Th(t.Ia,t,e),td(t,t.A)),t.A++,!0))}(this,t)||2==n&&Jp(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:ed(this,5);break;case 4:ed(this,10);break;case 3:ed(this,6);break;default:ed(this,2)}}},sh.fb=function(t){of(t?2:1)},sh.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new kp(this.La)).F=this.R,t},sh.ma=function(){return!!this.c&&!0},sh.Y=function(){return this.R},(sh=id.prototype).va=function(){},sh.ua=function(){},sh.ta=function(){},sh.sa=function(){},sh.Ta=function(){},od.prototype.a=function(t,e){return new ad(t,e)},Ch(ad,Rl),(sh=ad.prototype).addEventListener=function(t,e,n,r){ad.N.addEventListener.call(this,t,e,n,r)},sh.removeEventListener=function(t,e,n,r){ad.N.removeEventListener.call(this,t,e,n,r)},sh.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;of(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new cp(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Bp(e,t.g,t.i)),(t=t.w).i=n,e=rd(t.a,null,t.i),of(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,hp(t)):(Hf(e,"MODE","init"),!t.a.o&&t.a.j&&Hf(e,"X-HTTP-Session-Id",t.a.j),t.b=new gf(t,void 0,void 0),t.b.h=t.h,Tf(t.b,e,!1,null),t.M=0)},sh.close=function(){Wp(this.a)},sh.Xa=function(t){if(lh(t)){var e={};e.__data__=t,Qp(this.a,e)}else this.h?((e={}).__data__=Pl(t),Qp(this.a,e)):Qp(this.a,t)},sh.G=function(){this.a.c=null,delete this.f,Wp(this.a),delete this.a,ad.N.G.call(this)},Ch(sd,yf),Ch(ud,mf),Ch(cd,id),cd.prototype.va=function(){this.a.dispatchEvent("a")},cd.prototype.ua=function(t){this.a.dispatchEvent(new sd(t))},cd.prototype.ta=function(t){this.a.dispatchEvent(new ud(t))},cd.prototype.sa=function(){this.a.dispatchEvent("b")};var hd=Sh(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},od);od.prototype.createWebChannel=od.prototype.a,ad.prototype.send=ad.prototype.Xa,ad.prototype.open=ad.prototype.Wa,ad.prototype.close=ad.prototype.close,uf.NO_ERROR=0,uf.TIMEOUT=8,uf.HTTP_ERROR=6,cf.COMPLETE="complete",(ff.EventType=df).OPEN="a",df.CLOSE="b",df.ERROR="c",df.MESSAGE="d",Rl.prototype.listen=Rl.prototype.Aa,kp.prototype.listenOnce=kp.prototype.Ba,kp.prototype.getLastError=kp.prototype.Ya,kp.prototype.getLastErrorCode=kp.prototype.ya,kp.prototype.getStatus=kp.prototype.T,kp.prototype.getStatusText=kp.prototype.za,kp.prototype.getResponseJson=kp.prototype.Va,kp.prototype.getResponseText=kp.prototype.aa,kp.prototype.send=kp.prototype.ca;var ld,fd,pd={createWebChannelTransport:hd,ErrorCode:uf,EventType:cf,WebChannel:ff,XhrIo:kp},dd=pd.createWebChannelTransport,yd=pd.ErrorCode,md=pd.EventType,vd=pd.WebChannel,gd=pd.XhrIo,bd=il.SDK_VERSION,wd=new to("@firebase/firestore");function _d(){return wd.logLevel===Yi.DEBUG?ld.DEBUG:wd.logLevel===Yi.SILENT?ld.SILENT:ld.ERROR}function Ed(t){switch(t){case ld.DEBUG:wd.logLevel=Yi.DEBUG;break;case ld.ERROR:wd.logLevel=Yi.ERROR;break;case ld.SILENT:wd.logLevel=Yi.SILENT;break;default:wd.error("Firestore ("+bd+"): Invalid value passed to `setLogLevel`")}}function Td(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(wd.logLevel<=Yi.DEBUG){var i=n.map(Id);wd.debug.apply(wd,["Firestore ("+bd+") ["+t+"]: "+e].concat(i))}}function Sd(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(wd.logLevel<=Yi.ERROR){var r=e.map(Id);wd.error.apply(wd,["Firestore ("+bd+"): "+t].concat(r))}}function Id(e){if("string"==typeof e)return e;var t=Ad.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Cd(t){var e="FIRESTORE ("+bd+") INTERNAL ASSERTION FAILED: "+t;throw Sd(e),new Error(e)}function Nd(t,e){t||Cd(e)}(fd=ld=ld||{})[fd.DEBUG=0]="DEBUG",fd[fd.ERROR=1]="ERROR",fd[fd.SILENT=2]="SILENT";var Ad=(kd.setPlatform=function(t){kd.platform&&Cd("Platform already defined"),kd.platform=t},kd.getPlatform=function(){return kd.platform||Cd("Platform not set"),kd.platform},kd);function kd(){}function Dd(){return Ad.getPlatform().emptyByteString}var Rd,Od={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Pd=(ii(xd,Rd=Error),xd);function xd(t,e){var n=Rd.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Md(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Pd(Od.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Ld(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Fd(t,e){return void 0!==t?t:e}function Ud(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function qd(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Vd(t){for(var e in Nd(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Bd(t,e){if(0!==e.length)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+iy(e.length,"argument")+".")}function jd(t,e,n){if(e.length!==n)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires "+iy(n,"argument")+", but was called with "+iy(e.length,"argument")+".")}function Wd(t,e,n){if(e.length<n)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires at least "+iy(n,"argument")+", but was called with "+iy(e.length,"argument")+".")}function Kd(t,e,n,r){if(e.length<n||e.length>r)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+iy(e.length,"argument")+".")}function Qd(t,e,n,r){Jd(t,e,ry(n)+" argument",r)}function Hd(t,e,n,r){void 0!==r&&Qd(t,e,n,r)}function Gd(t,e,n,r){Jd(t,e,n+" option",r)}function zd(t,e,n,r){void 0!==r&&Gd(t,e,n,r)}function Yd(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Zd(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Zd(r[o]))}(t,e,n,r,i)}function Xd(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Zd(u))}var c=Zd(r);throw new Pd(Od.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Jd(t,e,n,r){if(!("object"===e?$d(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Zd(r);throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function $d(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Zd(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Cd("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function ty(t,e,n){if(void 0===n)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ry(e)+" argument, but it was undefined.")}function ey(n,t,r){qd(t,function(t,e){if(r.indexOf(t)<0)throw new Pd(Od.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function ny(t,e,n,r){var i=Zd(r);return new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires its "+ry(n)+" argument to be a "+e+", but it was: "+i)}function ry(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function iy(t,e){return t+" "+e+(1===t?"":"s")}var oy=(ay.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Nd(20===e.length,"Invalid auto ID: "+e),e},ay);function ay(){}function sy(t,e){return t<e?-1:e<t?1:0}function uy(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function cy(t){return t+"\0"}function hy(){if("undefined"==typeof Uint8Array)throw new Pd(Od.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ly(){if(!Ad.getPlatform().base64Available)throw new Pd(Od.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var fy=(py.fromBase64String=function(t){jd("Blob.fromBase64String",arguments,1),Qd("Blob.fromBase64String","string",1,t),ly();try{return new py(Ad.getPlatform().atob(t))}catch(t){throw new Pd(Od.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},py.fromUint8Array=function(t){if(jd("Blob.fromUint8Array",arguments,1),hy(),!(t instanceof Uint8Array))throw ny("Blob.fromUint8Array","Uint8Array",1,t);return new py(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},py.prototype.toBase64=function(){return jd("Blob.toBase64",arguments,0),ly(),Ad.getPlatform().btoa(this._binaryString)},py.prototype.toUint8Array=function(){jd("Blob.toUint8Array",arguments,0),hy();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},py.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},py.prototype.isEqual=function(t){return this._binaryString===t._binaryString},py.prototype._compareTo=function(t){return sy(this._binaryString,t._binaryString)},py);function py(t){ly(),this._binaryString=t}var dy=Md(fy,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),yy=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},my="(default)",vy=(Object.defineProperty(gy.prototype,"isDefaultDatabase",{get:function(){return this.database===my},enumerable:!0,configurable:!0}),gy.prototype.isEqual=function(t){return t instanceof gy&&t.projectId===this.projectId&&t.database===this.database},gy.prototype.compareTo=function(t){return sy(this.projectId,t.projectId)||sy(this.database,t.database)},gy);function gy(t,e){this.projectId=t,this.database=e||my}var by=(wy.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},wy.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},wy.INVALID=-1,wy);function wy(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var _y="__name__",Ey=(Ty.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Cd("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Cd("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},Ty.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(Ty.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Ty.prototype.isEqual=function(t){return 0===Ty.comparator(this,t)},Ty.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Ty?t.forEach(function(t){e.push(t)}):"string"==typeof t?e.push(t):Cd("Unknown parameter type for Path.child(): "+t),this.construct(e)},Ty.prototype.limit=function(){return this.offset+this.length},Ty.prototype.popFirst=function(t){return t=void 0===t?1:t,Nd(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Ty.prototype.popLast=function(){return Nd(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Ty.prototype.firstSegment=function(){return Nd(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Ty.prototype.lastSegment=function(){return this.get(this.length-1)},Ty.prototype.get=function(t){return Nd(t<this.length,"Index out of range"),this.segments[this.offset+t]},Ty.prototype.isEmpty=function(){return 0===this.length},Ty.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ty.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Ty.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Ty.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Ty.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Ty);function Ty(t,e,n){this.init(t,e,n)}var Sy,Iy=(ii(Cy,Sy=Ey),Cy.prototype.canonicalString=function(){return this.toArray().join("/")},Cy.prototype.toString=function(){return this.canonicalString()},Cy.fromString=function(t){if(0<=t.indexOf("//"))throw new Pd(Od.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Cy(t.split("/").filter(function(t){return 0<t.length}))},Cy.EMPTY_PATH=new Cy([]),Cy);function Cy(){return null!==Sy&&Sy.apply(this,arguments)||this}var Ny,Ay=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ky=(ii(Dy,Ny=Ey),Dy.isValidIdentifier=function(t){return Ay.test(t)},Dy.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Dy.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},Dy.prototype.toString=function(){return this.canonicalString()},Dy.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===_y},Dy.keyField=function(){return new Dy([_y])},Dy.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Pd(Od.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Pd(Od.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Pd(Od.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Pd(Od.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Dy(e)},Dy.EMPTY_PATH=new Dy([]),Dy);function Dy(){return null!==Ny&&Ny.apply(this,arguments)||this}var Ry=(Oy.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Oy.prototype.isEqual=function(t){return null!==t&&0===Iy.comparator(this.path,t.path)},Oy.prototype.toString=function(){return this.path.toString()},Oy.comparator=function(t,e){return Iy.comparator(t.path,e.path)},Oy.isDocumentKey=function(t){return t.length%2==0},Oy.fromSegments=function(t){return new Oy(new Iy(t.slice()))},Oy.fromPathString=function(t){return new Oy(Iy.fromString(t))},Oy.EMPTY=new Oy(new Iy([])),Oy);function Oy(t){this.path=t,Nd(Oy.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Py,xy,My=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(xy=Py=Py||{}).All="all",xy.ListenStreamIdle="listen_stream_idle",xy.ListenStreamConnectionBackoff="listen_stream_connection_backoff",xy.WriteStreamIdle="write_stream_idle",xy.WriteStreamConnectionBackoff="write_stream_connection_backoff",xy.OnlineStateTimeout="online_state_timeout",xy.ClientMetadataRefresh="client_metadata_refresh",xy.LruGarbageCollection="lru_garbage_collection";var Ly=(Fy.createAndSchedule=function(t,e,n,r,i){var o=new Fy(t,e,Date.now()+n,r,i);return o.start(n),o},Fy.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Fy.prototype.skipDelay=function(){return this.handleDelayElapsed()},Fy.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Pd(Od.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Fy.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Fy.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Fy);function Fy(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new My,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var Uy=(qy.prototype.enqueueAndForget=function(t){this.enqueue(t)},qy.prototype.enqueue=function(t){var n=this;this.verifyNotFailed();var e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Sd("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},qy.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Nd(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Nd(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Ly.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},qy.prototype.verifyNotFailed=function(){this.failure&&Cd("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},qy.prototype.verifyOperationInProgress=function(){Nd(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},qy.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},qy.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},qy.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Nd(r===Py.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Py.All&&n.timerId===r)break}return i.drain()})},qy.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Nd(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},qy);function qy(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}var Vy="",By="",jy="",Wy="";function Ky(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Hy(e)),e=Qy(t.get(n),e);return Hy(e)}function Qy(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Vy+jy;break;case Vy:n+=Vy+Wy;break;default:n+=o}}return n}function Hy(t){return t+Vy+By}function Gy(t){var e=t.length;if(Nd(2<=e,"Invalid path "+t),2===e)return Nd(t.charAt(0)===Vy&&t.charAt(1)===By,"Non-empty path "+t+" had length 2"),Iy.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Vy,o);switch((a<0||n<a)&&Cd('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case By:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case jy:i+=t.substring(o,a),i+="\0";break;case Wy:i+=t.substring(o,a+1);break;default:Cd('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Iy(r)}var zy=(Yy.now=function(){return Yy.fromMillis(Date.now())},Yy.fromDate=function(t){return Yy.fromMillis(t.getTime())},Yy.fromMillis=function(t){var e=Math.floor(t/1e3);return new Yy(e,1e6*(t-1e3*e))},Yy.prototype.toDate=function(){return new Date(this.toMillis())},Yy.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Yy.prototype._compareTo=function(t){return this.seconds===t.seconds?sy(this.nanoseconds,t.nanoseconds):sy(this.seconds,t.seconds)},Yy.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Yy.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Yy);function Yy(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Pd(Od.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Pd(Od.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Pd(Od.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Pd(Od.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var Xy=(Jy.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new Jy(new zy(e,t%1e6*1e3))},Jy.fromTimestamp=function(t){return new Jy(t)},Jy.forDeletedDoc=function(){return Jy.MIN},Jy.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Jy.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Jy.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Jy.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Jy.prototype.toTimestamp=function(){return this.timestamp},Jy.MIN=new Jy(new zy(0,0)),Jy);function Jy(t){this.timestamp=t}var $y=(Zy.prototype.insert=function(t,e){return new Zy(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,nm.BLACK,null,null))},Zy.prototype.remove=function(t){return new Zy(this.comparator,this.root.remove(t,this.comparator).copy(null,null,nm.BLACK,null,null))},Zy.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Zy.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Zy.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Zy.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Zy.prototype.minKey=function(){return this.root.minKey()},Zy.prototype.maxKey=function(){return this.root.maxKey()},Zy.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Zy.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Zy.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Zy.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Zy.prototype.getIterator=function(){return new tm(this.root,null,this.comparator,!1)},Zy.prototype.getIteratorFrom=function(t){return new tm(this.root,t,this.comparator,!1)},Zy.prototype.getReverseIterator=function(){return new tm(this.root,null,this.comparator,!0)},Zy.prototype.getReverseIteratorFrom=function(t){return new tm(this.root,t,this.comparator,!0)},Zy);function Zy(t,e){this.comparator=t,this.root=e||nm.EMPTY}var tm=(em.prototype.getNext=function(){Nd(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},em.prototype.hasNext=function(){return 0<this.nodeStack.length},em.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},em);function em(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var nm=(rm.prototype.copy=function(t,e,n,r,i){return new rm(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},rm.prototype.isEmpty=function(){return!1},rm.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},rm.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},rm.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},rm.prototype.minKey=function(){return this.min().key},rm.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},rm.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},rm.prototype.removeMin=function(){if(this.left.isEmpty())return rm.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},rm.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return rm.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},rm.prototype.isRed=function(){return this.color},rm.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},rm.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},rm.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},rm.prototype.rotateLeft=function(){var t=this.copy(null,null,rm.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},rm.prototype.rotateRight=function(){var t=this.copy(null,null,rm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},rm.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},rm.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},rm.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Cd("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Cd("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Cd("Black depths differ");return t+(this.isRed()?0:1)},rm.EMPTY=null,rm.RED=!0,rm.BLACK=!1,rm);function rm(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:rm.RED,this.left=null!=r?r:rm.EMPTY,this.right=null!=i?i:rm.EMPTY,this.size=this.left.size+1+this.right.size}var im=(om.prototype.copy=function(t,e,n,r,i){return this},om.prototype.insert=function(t,e,n){return new nm(t,e)},om.prototype.remove=function(t,e){return this},om.prototype.isEmpty=function(){return!0},om.prototype.inorderTraversal=function(t){return!1},om.prototype.reverseTraversal=function(t){return!1},om.prototype.minKey=function(){return null},om.prototype.maxKey=function(){return null},om.prototype.isRed=function(){return!1},om.prototype.checkMaxDepth=function(){return!0},om.prototype.check=function(){return 0},om);function om(){this.size=0}nm.EMPTY=new im;var am=(sm.fromMapKeys=function(t){var e=new sm(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},sm.prototype.has=function(t){return null!==this.data.get(t)},sm.prototype.first=function(){return this.data.minKey()},sm.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(sm.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),sm.prototype.indexOf=function(t){return this.data.indexOf(t)},sm.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},sm.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},sm.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},sm.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},sm.prototype.getIterator=function(){return new um(this.data.getIterator())},sm.prototype.getIteratorFrom=function(t){return new um(this.data.getIteratorFrom(t))},sm.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},sm.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},sm.prototype.isEmpty=function(){return this.data.isEmpty()},sm.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},sm.prototype.isEqual=function(t){if(!(t instanceof sm))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},sm.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},sm.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},sm.prototype.copy=function(t){var e=new sm(this.comparator);return e.data=t,e},sm);function sm(t){this.comparator=t,this.data=new $y(this.comparator)}var um=(cm.prototype.getNext=function(){return this.iter.getNext().key},cm.prototype.hasNext=function(){return this.iter.hasNext()},cm);function cm(t){this.iter=t}var hm=new $y(Ry.comparator);function lm(){return hm}function fm(){return lm()}var pm=new $y(Ry.comparator);function dm(){return pm}var ym=new $y(Ry.comparator);function mm(){return ym}var vm=new am(Ry.comparator);function gm(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=vm,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var bm=new am(sy);function wm(){return bm}var _m=(Em.prototype.applyToRemoteDocument=function(t,e,n){e&&Nd(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Nd(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Em.prototype.applyToLocalView=function(t,e){e&&Nd(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Em.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Em.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},gm())},Em.prototype.isEqual=function(t){return this.batchId===t.batchId&&uy(this.mutations,t.mutations)&&uy(this.baseMutations,t.baseMutations)},Em);function Em(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Nd(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Tm=(Sm.from=function(t,e,n,r){Nd(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=mm(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Sm(t,e,n,r,i)},Sm);function Sm(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Im=(Cm.prototype.catch=function(t){return this.next(void 0,t)},Cm.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Cd("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Cm(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Cm.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Cm.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Cm?e:Cm.resolve(e)}catch(t){return Cm.reject(t)}},Cm.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Cm.resolve(e)},Cm.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Cm.reject(e)},Cm.resolve=function(n){return new Cm(function(t,e){t(n)})},Cm.reject=function(n){return new Cm(function(t,e){e(n)})},Cm.waitFor=function(t){return new Cm(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Cm.or=function(t){for(var n=Cm.resolve(!1),e=function(e){n=n.next(function(t){return t?Cm.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Cm.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Cm);function Cm(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Nm=(Am.forUser=function(t,e,n,r){return Nd(""!==t.uid,"UserID must not be an empty string."),new Am(t.isAuthenticated()?t.uid:"",e,n,r)},Am.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Om(t).iterate({index:Bv.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Am.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Rm(n),xm(e).put(t)})},Am.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Am.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Rm(n),xm(e).put(t)})},Am.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=Pm(u),d=Om(u);return d.add({}).next(function(t){Nd("number"==typeof t,"Auto-generated key is not a number");var e=new _m(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=Wv.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,Wv.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return Im.waitFor(r).next(function(){return e})})},Am.prototype.lookupMutationBatch=function(t,e){var n=this;return Om(t).get(e).next(function(t){return t?(Nd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Am.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Im.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},Am.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Om(t).iterate({index:Bv.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Nd(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},Am.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Om(t).loadAll(Bv.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Am.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=Wv.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Pm(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Gy(i);if(r===c.userId&&u.path.isEqual(a))return Om(s).get(o).next(function(t){if(!t)throw Cd("Dangling document-mutation reference found: "+e+" which points to "+o);Nd(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},Am.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new am(sy),i=[];return t.forEach(function(s){var t=Wv.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Pm(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Gy(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Im.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Am.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Nd(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Nd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=Wv.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new am(sy);return Pm(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Gy(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},Am.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Om(t).get(e).next(function(t){if(null===t)throw Cd("Dangling document-mutation reference found, which points to "+e);Nd(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Im.waitFor(i).next(function(){return r})},Am.prototype.removeMutationBatch=function(e,n){var r=this;return Dm(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),Im.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},Am.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Am.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Im.resolve();var e=IDBKeyRange.lowerBound(Wv.prefixForUser(o.userId)),i=[];return Pm(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Gy(t[1]);i.push(r)}else n.done()}).next(function(){Nd(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Am.prototype.containsKey=function(t,e){return km(t,this.userId,e)},Am.prototype.getMutationQueueMetadata=function(t){var e=this;return xm(t).get(this.userId).next(function(t){return t||new qv(e.userId,-1,"")})},Am);function Am(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function km(t,o,e){var n=Wv.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Pm(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Dm(t,e,n){var r=t.store(Bv.store),i=t.store(Wv.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Nd(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Wv.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Im.waitFor(o).next(function(){return c})}function Rm(t){return t instanceof Uint8Array?(Nd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Om(t){return Lg.getStore(t,Bv.store)}function Pm(t){return Lg.getStore(t,Wv.store)}function xm(t){return Lg.getStore(t,qv.store)}var Mm,Lm;(Lm=Mm=Mm||{})[Lm.QueryCache=0]="QueryCache",Lm[Lm.SyncEngine=1]="SyncEngine";var Fm=(Um.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Um.prototype.after=function(t){return this.seek(t+2),this.next()},Um.prototype.seek=function(t){Nd((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Um.forQueryCache=function(){return new Um(Mm.QueryCache,2)},Um.forSyncEngine=function(){return new Um(Mm.SyncEngine)},Um);function Um(t,e){Nd((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var qm="SimpleDb",Vm=(Bm.openOrCreate=function(o,t,a){return Nd(Bm.isAvailable(),"IndexedDB not supported in current environment."),Td(qm,"Opening database:",o),new Im(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Bm(e))},i.onblocked=function(){r(new Pd(Od.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Pd(Od.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Td(qm,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new Km(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,Pv).next(function(){Td(qm,"Database upgrade to version "+Pv+" complete")})}}).toPromise()},Bm.delete=function(t){return Td(qm,"Removing database:",t),zm(window.indexedDB.deleteDatabase(t)).toPromise()},Bm.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=_i(),e=Bm.getIOSVersion(t),n=0<e&&e<10,r=Bm.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Bm.getStore=function(t,e){return t.store(e)},Bm.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Bm.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Bm.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Bm.prototype.runTransaction=function(t,e,n){var r=Km.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Im.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},Bm.prototype.close=function(){this.db.close()},Bm);function Bm(t){this.db=t,12.2===Bm.getIOSVersion(_i())&&Sd("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var jm=(Object.defineProperty(Wm.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Wm.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Wm.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Wm.prototype.done=function(){this.shouldStop=!0},Wm.prototype.skip=function(t){this.nextKey=t},Wm.prototype.delete=function(){return zm(this.dbCursor.delete())},Wm);function Wm(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Km=(Qm.open=function(t,e,n){return new Qm(t.transaction(n,e))},Object.defineProperty(Qm.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Qm.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Td(qm,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Qm.prototype.store=function(t){var e=this.transaction.objectStore(t);return Nd(!!e,"Object store not part of transaction: "+t),new Hm(e)},Qm);function Qm(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new My,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=Xm(t.target.error);n.completionDeferred.reject(e)}}var Hm=(Gm.prototype.put=function(t,e){return zm(void 0!==e?(Td(qm,"PUT",this.store.name,t,e),this.store.put(e,t)):(Td(qm,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Gm.prototype.add=function(t){return Td(qm,"ADD",this.store.name,t,t),zm(this.store.add(t))},Gm.prototype.get=function(e){var n=this;return zm(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Td(qm,"GET",n.store.name,e,t),t})},Gm.prototype.delete=function(t){return Td(qm,"DELETE",this.store.name,t),zm(this.store.delete(t))},Gm.prototype.count=function(){return Td(qm,"COUNT",this.store.name),zm(this.store.count())},Gm.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Gm.prototype.deleteAll=function(t,e){Td(qm,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Gm.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Gm.prototype.iterateSerial=function(i){var t=this.cursor({});return new Im(function(n,r){t.onerror=function(t){var e=Xm(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Gm.prototype.iterateCursor=function(t,a){var s=[];return new Im(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new jm(e),r=a(e.primaryKey,e.value,n);if(r instanceof Im){var i=r.catch(function(t){return n.done(),Im.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Im.waitFor(s)})},Gm.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Nd(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Gm.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Gm);function Gm(t){this.store=t}function zm(t){return new Im(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Xm(t.target.error);r(e)}})}var Ym=!1;function Xm(t){var e=Vm.getIOSVersion(_i());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Pd("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ym||(Ym=!0,setTimeout(function(){throw r},0)),r}}return t}var Jm=($m.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},$m.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Xy.fromTimestamp(new zy(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},$m.prototype.getHighestSequenceNumber=function(t){return ev(t.simpleDbTransaction)},$m.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},$m.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},$m.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},$m.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Zm(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Nd(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},$m.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return Zm(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return Im.waitFor(u)}).next(function(){return s})},$m.prototype.forEachTarget=function(t,r){var i=this;return Zm(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},$m.prototype.retrieveMetadata=function(t){return tv(t.simpleDbTransaction)},$m.prototype.saveMetadata=function(t,e){return function(t){return Lg.getStore(t,eg.store)}(t).put(eg.key,e)},$m.prototype.saveQueryData=function(t,e){return Zm(t).put(this.serializer.toDbTarget(e))},$m.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},$m.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},$m.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return Zm(t).iterate({range:n,index:Jv.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},$m.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=nv(n);return t.forEach(function(t){var e=Ky(t.path);o.push(a.put(new Zv(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Im.waitFor(o)},$m.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=nv(n);return Im.forEach(t,function(t){var e=Ky(t.path);return Im.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},$m.prototype.removeMatchingKeysForTargetId=function(t,e){var n=nv(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},$m.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=nv(t),o=gm();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Gy(t[1]),i=new Ry(r);o=o.add(i)}).next(function(){return o})},$m.prototype.containsKey=function(t,e){var n=Ky(e.path),r=IDBKeyRange.bound([n],[cy(n)],!1,!0),i=0;return nv(t).iterate({index:Zv.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},$m.prototype.getQueryDataForTarget=function(t,e){var n=this;return Zm(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},$m);function $m(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Fm.forQueryCache()}function Zm(t){return Lg.getStore(t,Jv.store)}function tv(t){return Vm.getStore(t,eg.store).get(eg.key).next(function(t){return Nd(null!==t,"Missing metadata row."),t})}function ev(t){return tv(t).next(function(t){return t.highestListenSequenceNumber})}function nv(t){return Lg.getStore(t,Zv.store)}var rv=(iv.compareByKey=function(t,e){return Ry.comparator(t.key,e.key)},iv);function iv(t,e){this.key=t,this.version=e}var ov,av=(ii(sv,ov=rv),sv.prototype.field=function(t){return this.data.field(t)},sv.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},sv.prototype.value=function(){return this.data.value()},sv.prototype.isEqual=function(t){return t instanceof sv&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},sv.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(sv.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),sv.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Cd("Trying to compare documents on fields that don't exist")},sv);function sv(t,e,n,r,i){var o=ov.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}var uv,cv=(ii(hv,uv=rv),hv.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(hv.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),hv.prototype.isEqual=function(t){return t instanceof hv&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},hv);function hv(t,e,n){var r=uv.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var lv,fv=(ii(pv,lv=rv),pv.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(pv.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),pv.prototype.isEqual=function(t){return t instanceof pv&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},pv);function pv(){return null!==lv&&lv.apply(this,arguments)||this}var dv=(yv.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},yv.prototype.has=function(t){return void 0!==this.get(t)},yv.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},yv.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},yv.prototype.forEach=function(s){qd(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},yv.prototype.isEmpty=function(){return Vd(this.inner)},yv);function yv(t){this.mapKeyFn=t,this.inner={}}var mv=(vv.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},vv.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?Im.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},vv.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},vv.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},vv.prototype.assertChanges=function(){return Nd(null!==this.changes,"Changes have already been applied."),this.changes},vv);function vv(){this.changes=lm(),this.documentSizes=new dv(function(t){return t.toString()})}var gv="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",bv=(Object.defineProperty(wv.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),wv.prototype.start=function(t){var e=Vm.getStore(t,ag.store);return this.synchronizeLastDocumentChangeId(e)},wv.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=Iv(t),o=gm(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Nv(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Cv(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return Im.waitFor(r)},wv.prototype.removeEntry=function(t,e){var n=Iv(t),r=Nv(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Av(t)}):Im.resolve(0)})},wv.prototype.getEntry=function(t,e){var n=this;return Iv(t).get(Nv(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},wv.prototype.getSizedEntry=function(t,e){var n=this;return Iv(t).get(Nv(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Av(t)}:null})},wv.prototype.getEntries=function(t,e){var n=this,r=fm();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},wv.prototype.getSizedEntries=function(t,e){var n=this,r=fm(),i=new $y(Ry.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Av(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},wv.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Im.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return Iv(t).iterate({range:n},function(t,e,n){for(var r=Ry.fromSegments(t);a&&Ry.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},wv.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;Nd(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=dm(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return Iv(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof av&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},wv.prototype.getNewDocumentChanges=function(e){var r=this;Nd(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=gm(),i=lm(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Cv(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return Im.reject(new Pd(Od.DATA_LOSS,gv))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new cv(n,Xy.forDeletedDoc());i=i.insert(n,e)}))}),Im.waitFor(t)}).next(function(){return i})},wv.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Cv(t).delete(n)},wv.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},wv.prototype.newChangeBuffer=function(){return new Tv(this)},wv.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},wv.prototype.getMetadata=function(t){return _v(t).get(Yv.key).next(function(t){return Nd(!!t,"Missing document cache metadata"),t})},wv.prototype.setMetadata=function(t,e){return _v(t).put(Yv.key,e)},wv.prototype.updateSize=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},wv);function wv(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}function _v(t){return Lg.getStore(t,Yv.store)}var Ev,Tv=(ii(Sv,Ev=mv),Sv.prototype.applyChanges=function(t){var o=this,e=this.assertChanges(),a=0,s=[];return e.forEach(function(t,e){var n=o.documentCache.serializer.toDbRemoteDocument(e),r=o.documentSizes.get(t);Nd(void 0!==r,"Attempting to change document "+t.toString()+" without having read it first");var i=Av(n);a+=i-r,s.push({key:t,doc:n})}),this.documentCache.addEntries(t,s,a)},Sv.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Sv.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Sv);function Sv(t){var e=Ev.call(this)||this;return e.documentCache=t,e}function Iv(t){return Lg.getStore(t,Gv.store)}function Cv(t){return Lg.getStore(t,ag.store)}function Nv(t){return t.path.toArray()}function Av(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Cd("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var kv=(Dv.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Im.resolve()},Dv.prototype.getCollectionParents=function(t,e){return Im.resolve(this.collectionParentIndex.getEntries(e))},Dv);function Dv(){this.collectionParentIndex=new Rv}var Rv=(Ov.prototype.add=function(t){Nd(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new am(Iy.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},Ov.prototype.getEntries=function(t){return(this.index[t]||new am(Iy.comparator)).toArray()},Ov);function Ov(){this.index={}}var Pv=8,xv=(Mv.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Nd(n<r&&0<=n&&r<=Pv,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(function(t){t.createObjectStore(Fv.store)}(t),function(t){t.createObjectStore(qv.store,{keyPath:qv.keyPath}),t.createObjectStore(Bv.store,{keyPath:Bv.keyPath,autoIncrement:!0}).createIndex(Bv.userMutationsIndex,Bv.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Wv.store)}(t),og(t),function(t){t.createObjectStore(Gv.store)}(t));var o=Im.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(Zv.store),t.deleteObjectStore(Jv.store),t.deleteObjectStore(eg.store)}(t),og(t)),o=o.next(function(){return function(t){var e=t.store(eg.store),n=new eg(0,0,Xy.MIN.toTimestamp(),0);return e.put(eg.key,n)}(e)})),n<4&&4<=r&&(0!==n&&(o=o.next(function(){return function(r,i){return i.store(Bv.store).loadAll().next(function(t){r.deleteObjectStore(Bv.store),r.createObjectStore(Bv.store,{keyPath:Bv.keyPath,autoIncrement:!0}).createIndex(Bv.userMutationsIndex,Bv.userMutationsKeyPath,{unique:!0});var e=i.store(Bv.store),n=t.map(function(t){return e.put(t)});return Im.waitFor(n)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(ug.store,{keyPath:ug.keyPath})}(t),function(t){t.createObjectStore(ag.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&5<=r&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(o=o.next(function(){return function(t){t.createObjectStore(Yv.store)}(t),i.addDocumentGlobal(e)})),n<7&&7<=r&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&8<=r&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},Mv.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Gv.store).iterate(function(t,e){n+=Av(e)}).next(function(){var t=new Yv(n);return e.store(Yv.store).put(Yv.key,t)})},Mv.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(qv.store),e=r.store(Bv.store);return t.loadAll().next(function(t){return Im.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(Bv.userMutationsIndex,t).next(function(t){return Im.forEach(t,function(t){Nd(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return Dm(r,n.userId,e).next(function(){})})})})})},Mv.prototype.ensureSequenceNumbers=function(t){var a=t.store(Zv.store),e=t.store(Gv.store);return ev(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Iy(t),r=function(t){return[0,Ky(t)]}(n);o.push(a.get(r).next(function(t){return t?Im.resolve():function(t){return a.put(new Zv(0,Ky(t),i))}(n)}))}).next(function(){return Im.waitFor(o)})})},Mv.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Ky(n)})}}t.createObjectStore(rg.store,{keyPath:rg.keyPath});var r=e.store(rg.store),o=new Rv;return e.store(Gv.store).iterate({keysOnly:!0},function(t,e){var n=new Iy(t);return i(n.popLast())}).next(function(){return e.store(Wv.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Gy(n));return i(r.popLast())})})},Mv);function Mv(t){this.serializer=t}var Lv=function(t,e){this.seconds=t,this.nanoseconds=e},Fv=(Uv.store="owner",Uv.key="owner",Uv);function Uv(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var qv=(Vv.store="mutationQueues",Vv.keyPath="userId",Vv);function Vv(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Bv=(jv.store="mutations",jv.keyPath="batchId",jv.userMutationsIndex="userMutationsIndex",jv.userMutationsKeyPath=["userId","batchId"],jv);function jv(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var Wv=(Kv.prefixForUser=function(t){return[t]},Kv.prefixForPath=function(t,e){return[t,Ky(e)]},Kv.key=function(t,e,n){return[t,Ky(e),n]},Kv.store="documentMutations",Kv.PLACEHOLDER=new Kv,Kv);function Kv(){}var Qv=function(t,e){this.path=t,this.readTime=e},Hv=function(t,e){this.path=t,this.version=e},Gv=(zv.store="remoteDocuments",zv);function zv(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}var Yv=(Xv.store="remoteDocumentGlobal",Xv.key="remoteDocumentGlobalKey",Xv);function Xv(t){this.byteSize=t}var Jv=($v.store="targets",$v.keyPath="targetId",$v.queryTargetsIndexName="queryTargetsIndex",$v.queryTargetsKeyPath=["canonicalId","targetId"],$v);function $v(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}var Zv=(tg.store="targetDocuments",tg.keyPath=["targetId","path"],tg.documentTargetsIndex="documentTargetsIndex",tg.documentTargetsKeyPath=["path","targetId"],tg);function tg(t,e,n){this.targetId=t,this.path=e,Nd(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var eg=(ng.key="targetGlobalKey",ng.store="targetGlobal",ng);function ng(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var rg=(ig.store="collectionParents",ig.keyPath=["collectionId","parent"],ig);function ig(t,e){this.collectionId=t,this.parent=e}function og(t){t.createObjectStore(Zv.store,{keyPath:Zv.keyPath}).createIndex(Zv.documentTargetsIndex,Zv.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Jv.store,{keyPath:Jv.keyPath}).createIndex(Jv.queryTargetsIndexName,Jv.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(eg.store)}var ag=(sg.store="remoteDocumentChanges",sg.keyPath="id",sg);function sg(t){this.changes=t}var ug=(cg.store="clientMetadata",cg.keyPath="clientId",cg);function cg(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}var hg,lg,fg=[qv.store,Bv.store,Wv.store,Gv.store,Jv.store,Fv.store,eg.store,Zv.store].concat([ug.store,ag.store]).concat([Yv.store]).concat([rg.store]),pg=(dg.prototype.addToCollectionParentIndex=function(t,e){if(Nd(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Nd(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return yg(t).put({collectionId:n,parent:Ky(r)})}return Im.resolve()},dg.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[cy(i),""],!1,!0);return yg(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Gy(r.parent))}return o})},dg);function dg(){this.collectionParentsCache=new Rv}function yg(t){return Lg.getStore(t,rg.store)}(lg=hg=hg||{})[lg.Listen=0]="Listen",lg[lg.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",lg[lg.LimboResolution=2]="LimboResolution";var mg=(vg.prototype.copy=function(t){return new vg(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},vg.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},vg);function vg(t,e,n,r,i,o){void 0===i&&(i=Xy.MIN),void 0===o&&(o=Dd()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}var gg=(bg.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Ry.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new cv(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Ry.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new fv(e,n)):Cd("Unexpected DbRemoteDocument")},bg.prototype.toDbRemoteDocument=function(t){if(t instanceof av){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Gv(null,null,e,n)}if(t instanceof cv){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new Gv(null,new Qv(r,i),null,n)}return t instanceof fv?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new Gv(new Hv(r,i),null,null,!0)):Cd("Unexpected MaybeDocumment")},bg.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Lv(e.seconds,e.nanoseconds)},bg.prototype.fromDbTimestamp=function(t){var e=new zy(t.seconds,t.nanoseconds);return Xy.fromTimestamp(e)},bg.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Bv(t,e.batchId,e.localWriteTime.toMillis(),r,i)},bg.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=zy.fromMillis(t.localWriteTimeMs);return new _m(t.batchId,i,n,r)},bg.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Ky(t.path))}),e},bg.prototype.fromDbResourcePaths=function(t){for(var e=gm(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Ry(Gy(i)))}return e},bg.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new mg(e,t.targetId,hg.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},bg.prototype.toDbTarget=function(t){Nd(hg.Listen===t.purpose,"Only queries with purpose "+hg.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Nd("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Jv(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},bg);function bg(t){this.remoteSerializer=t}function wg(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=sy(n,i);return 0===a?sy(r,o):a}var _g=(Eg.prototype.nextIndex=function(){return++this.previousIndex},Eg.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();wg(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Eg.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Eg);function Eg(t){this.maxElements=t,this.buffer=new am(wg),this.previousIndex=0}var Tg={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sg=(Ig.withCacheSize=function(t){return new Ig(t,Ig.DEFAULT_COLLECTION_PERCENTILE,Ig.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},Ig.COLLECTION_DISABLED=-1,Ig.MINIMUM_CACHE_SIZE_BYTES=1048576,Ig.DEFAULT=new Ig(Ig.DEFAULT_CACHE_SIZE_BYTES=41943040,Ig.DEFAULT_COLLECTION_PERCENTILE=10,Ig.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),Ig.DISABLED=new Ig(Ig.COLLECTION_DISABLED,0,0),Ig);function Ig(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var Cg=(Ng.prototype.start=function(){Nd(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Sg.COLLECTION_DISABLED&&this.scheduleGC()},Ng.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Ng.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Ng.prototype.scheduleGC=function(){var t=this;Nd(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Td("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Py.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Ug)})},Ng);function Ng(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}var Ag=(kg.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},kg.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Im.resolve(by.INVALID);var r=new _g(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},kg.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},kg.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},kg.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===Sg.COLLECTION_DISABLED?(Td("LruGarbageCollector","Garbage collection skipped; disabled"),Im.resolve(Tg)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Td("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Tg):r.runGarbageCollection(e,n)})},kg.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},kg.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Td("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),_d()<=ld.DEBUG&&Td("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Im.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},kg);function kg(t,e){this.delegate=t,this.params=e}var Dg,Rg="IndexedDbPersistence",Og="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Pg="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",xg=(ii(Mg,Dg=function(){}),Mg);function Mg(t,e){var n=Dg.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var Lg=(Fg.getStore=function(t,e){if(t instanceof xg)return Vm.getStore(t.simpleDbTransaction,e);throw Cd("IndexedDbPersistence must use instances of IndexedDbTransaction")},Fg.createIndexedDbPersistence=function(n,r,i,o,a,s){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new Fg(n,r,i,o,a,s)).start()];case 1:return t.sent(),[2,e]}})})},Fg.createMultiClientIndexedDbPersistence=function(n,r,i,o,a,s,u){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new Fg(n,r,i,o,a,s,u)).start()];case 1:return t.sent(),[2,e]}})})},Fg.prototype.start=function(){var n=this;return Nd(!this.started,"IndexedDbPersistence double-started!"),Nd(null!==this.window,"Expected 'window' to be defined"),Vm.openOrCreate(this.dbName,Pv,new xv(this.serializer)).then(function(t){return n.simpleDb=t,n.updateClientMetadataAndTryBecomePrimary()}).then(function(){return n.attachVisibilityHandler(),n.attachWindowUnloadHook(),n.scheduleClientMetadataAndPrimaryLeaseRefreshes(),n.startRemoteDocumentCache()}).then(function(){return n.simpleDb.runTransaction("readonly",[eg.store],function(t){return ev(t).next(function(t){var e=n.multiClientParams?n.multiClientParams.sequenceNumberSyncer:void 0;n.listenSequence=new by(t,e)})})}).then(function(){n._started=!0}).catch(function(t){return n.simpleDb&&n.simpleDb.close(),Promise.reject(t)})},Fg.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",fg,function(t){return e.remoteDocumentCache.start(t)})},Fg.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Fg.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Fg.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Fg.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",fg,function(n){return Vg(n).put(new ug(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},Fg.prototype.verifyPrimaryLease=function(t){var e=this;return qg(t).get(Fv.key).next(function(t){return Im.resolve(e.isLocalClient(t))})},Fg.prototype.removeClientMetadata=function(t){return Vg(t).delete(this.clientId)},Fg.prototype.maybeGarbageCollectMultiClientState=function(){return ai(this,void 0,void 0,function(){var r,i,o=this;return si(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=Fg.getStore(n,ug.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return Im.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,t);return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},Fg.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Py.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},Fg.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},Fg.prototype.canActAsPrimary=function(e){var i=this;return qg(e).get(Fv.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Pd(Od.FAILED_PRECONDITION,Pg);return!1}}return!(!i.networkEnabled||!i.inForeground)||Vg(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Td(Rg,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Fg.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Fv.store,ug.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},Fg.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},Fg.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[ug.store],function(t){return Vg(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},Fg.clearPersistence=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return Fg.isAvailable()?(e=n+Fg.MAIN_DATABASE,[4,Vm.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Fg.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Fg.prototype.getMutationQueue=function(t){return Nd(this.started,"Cannot initialize MutationQueue before persistence is started."),Nm.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},Fg.prototype.getQueryCache=function(){return Nd(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},Fg.prototype.getRemoteDocumentCache=function(){return Nd(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},Fg.prototype.getIndexManager=function(){return Nd(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},Fg.prototype.runTransaction=function(n,t,r){var i=this;return Td(Rg,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",fg,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Sd("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Pd(Od.FAILED_PRECONDITION,Og);return r(new xg(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new xg(e,i.listenSequence.next()))})})},Fg.prototype.verifyAllowTabSynchronization=function(t){var e=this;return qg(t).get(Fv.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Pd(Od.FAILED_PRECONDITION,Pg)})},Fg.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Fv(this.clientId,this.allowTabSynchronization,Date.now());return qg(t).put(Fv.key,e)},Fg.isAvailable=function(){return Vm.isAvailable()},Fg.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Fg.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=qg(t);return n.get(Fv.key).next(function(t){return e.isLocalClient(t)?(Td(Rg,"Releasing primary lease."),n.delete(Fv.key)):Im.resolve()})},Fg.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Sd("Detected an update time that is in the future: "+t+" > "+n),1))},Fg.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},Fg.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Nd(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},Fg.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},Fg.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Nd("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},Fg.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Td(Rg,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Sd(Rg,"Failed to get zombied client id.",t),!1}},Fg.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Sd("Failed to set zombie client id.",t)}},Fg.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},Fg.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Fg.MAIN_DATABASE="main",Fg);function Fg(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!Fg.isAvailable())throw new Pd(Od.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new Qg(this,o),this.dbName=t+Fg.MAIN_DATABASE,this.serializer=new gg(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new Jm(this.referenceDelegate,this.serializer),this.indexManager=new pg,this.remoteDocumentCache=new bv(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new Pd(Od.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}function Ug(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!function(t){return t.code===Od.FAILED_PRECONDITION&&t.message===Og}(e))throw e;return Td(Rg,"Unexpectedly lost primary lease"),[2]})})}function qg(t){return t.store(Fv.store)}function Vg(t){return t.store(ug.store)}var Bg,jg,Wg,Kg,Qg=(Hg.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},Hg.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Hg.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},Hg.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},Hg.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Hg.prototype.addReference=function(t,e){return Gg(t,e)},Hg.prototype.removeReference=function(t,e){return Gg(t,e)},Hg.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},Hg.prototype.removeMutationReference=function(t,e){return Gg(t,e)},Hg.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Im.resolve(!0):function(e,n){var r=!1;return xm(e).iterateSerial(function(t){return km(e,t,n).next(function(t){return t&&(r=!0),Im.resolve(!t)})}).next(function(){return r})}(t,e)},Hg.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=0,s=0,u=[];return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return a++,o.removeOrphanedDocument(r,e).next(function(t){s+=t})});u.push(n)}}).next(function(){return Im.waitFor(u)}).next(function(){return o.db.getRemoteDocumentCache().updateSize(r,-s)}).next(function(){return a})},Hg.prototype.removeOrphanedDocument=function(t,e){var n=0,r=this.db.getRemoteDocumentCache();return Im.waitFor([nv(t).delete(function(t){return[0,Ky(t.path)]}(e)),r.removeEntry(t,e).next(function(t){n+=t})]).next(function(){return n})},Hg.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},Hg.prototype.updateLimboDocument=function(t,e){return Gg(t,e)},Hg.prototype.forEachOrphanedDocument=function(t,o){var a,e=nv(t),s=by.INVALID;return e.iterate({index:Zv.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==by.INVALID&&o(new Ry(Gy(a)),s),s=i,a=r):s=by.INVALID}).next(function(){s!==by.INVALID&&o(new Ry(Gy(a)),s)})},Hg.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Hg);function Hg(t,e){this.db=t,this.garbageCollector=new Ag(this,e)}function Gg(t,e){return nv(t).put(function(t,e){return new Zv(0,Ky(t.path),e)}(e,t.currentSequenceNumber))}(jg=Bg=Bg||{})[jg.NullValue=0]="NullValue",jg[jg.BooleanValue=1]="BooleanValue",jg[jg.NumberValue=2]="NumberValue",jg[jg.TimestampValue=3]="TimestampValue",jg[jg.StringValue=4]="StringValue",jg[jg.BlobValue=5]="BlobValue",jg[jg.RefValue=6]="RefValue",jg[jg.GeoPointValue=7]="GeoPointValue",jg[jg.ArrayValue=8]="ArrayValue",jg[jg.ObjectValue=9]="ObjectValue",(Kg=Wg=Wg||{})[Kg.Default=0]="Default",Kg[Kg.Estimate=1]="Estimate",Kg[Kg.Previous=2]="Previous";var zg=(Yg.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Yg(Wg.Estimate,e);case"previous":return new Yg(Wg.Previous,e);case"none":case void 0:return new Yg(Wg.Default,e);default:return Cd("fromSnapshotOptions() called with invalid options.")}},Yg);function Yg(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Xg=(Jg.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Jg.prototype.defaultCompareTo=function(t){return Nd(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),sy(this.typeOrder,t.typeOrder)},Jg);function Jg(){}var $g,Zg=(ii(tb,$g=Xg),tb.prototype.value=function(t){return null},tb.prototype.isEqual=function(t){return t instanceof tb},tb.prototype.compareTo=function(t){return t instanceof tb?0:this.defaultCompareTo(t)},tb.INSTANCE=new tb,tb);function tb(){var t=$g.call(this)||this;return t.typeOrder=Bg.NullValue,t.internalValue=null,t}var eb,nb=(ii(rb,eb=Xg),rb.prototype.value=function(t){return this.internalValue},rb.prototype.isEqual=function(t){return t instanceof rb&&this.internalValue===t.internalValue},rb.prototype.compareTo=function(t){return t instanceof rb?sy(this,t):this.defaultCompareTo(t)},rb.of=function(t){return t?rb.TRUE:rb.FALSE},rb.TRUE=new rb(!0),rb.FALSE=new rb(!1),rb);function rb(t){var e=eb.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.BooleanValue,e}var ib,ob=(ii(ab,ib=Xg),ab.prototype.value=function(t){return this.internalValue},ab.prototype.compareTo=function(t){return t instanceof ab?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},ab);function ab(t){var e=ib.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.NumberValue,e}function sb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var ub,cb=(ii(hb,ub=ob),hb.prototype.isEqual=function(t){return t instanceof hb&&sb(this.internalValue,t.internalValue)},hb);function hb(){return null!==ub&&ub.apply(this,arguments)||this}var lb,fb=(ii(pb,lb=ob),pb.prototype.isEqual=function(t){return t instanceof pb&&sb(this.internalValue,t.internalValue)},pb.NAN=new pb(NaN),pb.POSITIVE_INFINITY=new pb(1/0),pb.NEGATIVE_INFINITY=new pb(-1/0),pb);function pb(){return null!==lb&&lb.apply(this,arguments)||this}var db,yb=(ii(mb,db=Xg),mb.prototype.value=function(t){return this.internalValue},mb.prototype.isEqual=function(t){return t instanceof mb&&this.internalValue===t.internalValue},mb.prototype.compareTo=function(t){return t instanceof mb?sy(this.internalValue,t.internalValue):this.defaultCompareTo(t)},mb);function mb(t){var e=db.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.StringValue,e}var vb,gb=(ii(bb,vb=Xg),bb.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},bb.prototype.isEqual=function(t){return t instanceof bb&&this.internalValue.isEqual(t.internalValue)},bb.prototype.compareTo=function(t){return t instanceof bb?this.internalValue._compareTo(t.internalValue):t instanceof _b?-1:this.defaultCompareTo(t)},bb);function bb(t){var e=vb.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.TimestampValue,e}var wb,_b=(ii(Eb,wb=Xg),Eb.prototype.value=function(t){return t&&t.serverTimestampBehavior===Wg.Estimate?new gb(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Wg.Previous&&this.previousValue?this.previousValue.value(t):null},Eb.prototype.isEqual=function(t){return t instanceof Eb&&this.localWriteTime.isEqual(t.localWriteTime)},Eb.prototype.compareTo=function(t){return t instanceof Eb?this.localWriteTime._compareTo(t.localWriteTime):t instanceof gb?1:this.defaultCompareTo(t)},Eb.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Eb);function Eb(t,e){var n=wb.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Bg.TimestampValue,n}var Tb,Sb=(ii(Ib,Tb=Xg),Ib.prototype.value=function(t){return this.internalValue},Ib.prototype.isEqual=function(t){return t instanceof Ib&&this.internalValue.isEqual(t.internalValue)},Ib.prototype.compareTo=function(t){return t instanceof Ib?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Ib);function Ib(t){var e=Tb.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.BlobValue,e}var Cb,Nb=(ii(Ab,Cb=Xg),Ab.prototype.value=function(t){return this.key},Ab.prototype.isEqual=function(t){return t instanceof Ab&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Ab.prototype.compareTo=function(t){if(t instanceof Ab){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Ry.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Ab);function Ab(t,e){var n=Cb.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Bg.RefValue,n}var kb,Db=(ii(Rb,kb=Xg),Rb.prototype.value=function(t){return this.internalValue},Rb.prototype.isEqual=function(t){return t instanceof Rb&&this.internalValue.isEqual(t.internalValue)},Rb.prototype.compareTo=function(t){return t instanceof Rb?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Rb);function Rb(t){var e=kb.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.GeoPointValue,e}var Ob,Pb=(ii(xb,Ob=Xg),xb.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},xb.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},xb.prototype.isEqual=function(t){if(t instanceof xb){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},xb.prototype.compareTo=function(t){if(t instanceof xb){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=sy(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return sy(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},xb.prototype.set=function(t,e){if(Nd(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof xb||(n=xb.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},xb.prototype.delete=function(t){if(Nd(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new xb(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof xb){var n=e.delete(t.popFirst());return new xb(this.internalValue.insert(t.firstSegment(),n))}return this},xb.prototype.contains=function(t){return null!==this.field(t)},xb.prototype.field=function(t){Nd(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof xb?e.internalValue.get(t):null}),e},xb.prototype.fieldMask=function(){var i=new am(ky.comparator);return this.internalValue.forEach(function(t,e){var n=new ky([t]);if(e instanceof xb){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),Ub.fromSet(i)},xb.prototype.toString=function(){return this.internalValue.toString()},xb.prototype.child=function(t){return this.internalValue.get(t)||void 0},xb.prototype.setChild=function(t,e){return new xb(this.internalValue.insert(t,e))},xb.EMPTY=new xb(new $y(sy)),xb);function xb(t){var e=Ob.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.ObjectValue,e}var Mb,Lb=(ii(Fb,Mb=Xg),Fb.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},Fb.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Fb.prototype.forEach=function(t){this.internalValue.forEach(t)},Fb.prototype.isEqual=function(t){if(t instanceof Fb){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Fb.prototype.compareTo=function(t){if(t instanceof Fb){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return sy(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Fb.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Fb);function Fb(t){var e=Mb.call(this)||this;return e.internalValue=t,e.typeOrder=Bg.ArrayValue,e}var Ub=(qb.fromSet=function(t){return new qb(t)},qb.fromArray=function(t){var e=new am(ky.comparator);return t.forEach(function(t){return e=e.add(t)}),new qb(e)},qb.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},qb.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},qb);function qb(t){this.fields=t}var Vb=(Bb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Bb);function Bb(t,e){this.field=t,this.transform=e}var jb,Wb,Kb=function(t,e){this.version=t,this.transformResults=e};(Wb=jb=jb||{})[Wb.Set=0]="Set",Wb[Wb.Patch=1]="Patch",Wb[Wb.Transform=2]="Transform",Wb[Wb.Delete=3]="Delete";var Qb=(Hb.exists=function(t){return new Hb(void 0,t)},Hb.updateTime=function(t){return new Hb(t)},Object.defineProperty(Hb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Hb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof av&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof av:(Nd(this.isNone,"Precondition should be empty"),!0)},Hb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Hb.NONE=new Hb,Hb);function Hb(t,e){this.updateTime=t,this.exists=e,Nd(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Gb=(zb.prototype.verifyKeyMatches=function(t){null!=t&&Nd(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},zb.getPostMutationVersion=function(t){return t instanceof av?t.version:Xy.MIN},zb);function zb(){}var Yb,Xb=(ii(Jb,Yb=Gb),Jb.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Nd(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new av(this.key,n,this.value,{hasCommittedMutations:!0})},Jb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Gb.getPostMutationVersion(t);return new av(this.key,r,this.value,{hasLocalMutations:!0})},Jb.prototype.extractBaseValue=function(t){return null},Jb.prototype.isEqual=function(t){return t instanceof Jb&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},Jb);function Jb(t,e,n){var r=Yb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=jb.Set,r}var $b,Zb=(ii(tw,$b=Gb),tw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Nd(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new fv(this.key,e.version);var n=this.patchDocument(t);return new av(this.key,e.version,n,{hasCommittedMutations:!0})},tw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Gb.getPostMutationVersion(t),i=this.patchDocument(t);return new av(this.key,r,i,{hasLocalMutations:!0})},tw.prototype.extractBaseValue=function(t){return null},tw.prototype.isEqual=function(t){return t instanceof tw&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},tw.prototype.patchDocument=function(t){var e;return e=t instanceof av?t.data:Pb.EMPTY,this.patchObject(e)},tw.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},tw);function tw(t,e,n,r){var i=$b.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=jb.Patch,i}var ew,nw=(ii(rw,ew=Gb),rw.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Nd(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new fv(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new av(this.key,i,o,{hasCommittedMutations:!0})},rw.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new av(this.key,r.version,o,{hasLocalMutations:!0})},rw.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof av?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Pb.EMPTY.set(i.field,a):e.set(i.field,a))}return e},rw.prototype.isEqual=function(t){return t instanceof rw&&this.key.isEqual(t.key)&&uy(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},rw.prototype.requireDocument=function(t){Nd(t instanceof av,"Unknown MaybeDocument type "+t);var e=t;return Nd(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},rw.prototype.serverTransformResults=function(t,e){var n=[];Nd(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof av&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},rw.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof av&&(u=e.field(a.field)),null===u&&n instanceof av&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},rw.prototype.transformObject=function(t,e){Nd(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},rw);function rw(t,e){var n=ew.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=jb.Transform,n.precondition=Qb.exists(!0),n}var iw,ow=(ii(aw,iw=Gb),aw.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Nd(null==e.transformResults,"Transform results received by DeleteMutation."),new cv(this.key,e.version,{hasCommittedMutations:!0})},aw.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Nd(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new cv(this.key,Xy.forDeletedDoc())):t},aw.prototype.extractBaseValue=function(t){return null},aw.prototype.isEqual=function(t){return t instanceof aw&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},aw);function aw(t,e){var n=iw.call(this)||this;return n.key=t,n.precondition=e,n.type=jb.Delete,n}var sw=(uw.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},uw.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},uw.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=fm();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},uw.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},uw.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=lm();return e.forEach(function(t,e){e=e||new cv(t,Xy.forDeletedDoc()),n=n.insert(t,e)}),n})},uw.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},uw.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Ry(e)).next(function(t){var e=dm();return t instanceof av&&(e=e.insert(t.key,t)),e})},uw.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;Nd(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=dm();return this.indexManager.getCollectionParents(n,o).next(function(t){return Im.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},uw.prototype.getDocumentsMatchingCollectionQuery=function(e,n){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof av?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},uw.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=gm(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Zb&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof av&&(c=c.insert(t,e))}),c})},uw);function uw(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var cw=(hw.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},hw.prototype.addReference=function(t,e){var n=new lw(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},hw.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},hw.prototype.removeReference=function(t,e){this.removeRef(new lw(t,e))},hw.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},hw.prototype.removeReferencesForId=function(t){var e=this,n=Ry.EMPTY,r=new lw(n,t),i=new lw(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},hw.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},hw.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},hw.prototype.referencesForId=function(t){var e=Ry.EMPTY,n=new lw(e,t),r=new lw(e,t+1),i=gm();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},hw.prototype.containsKey=function(t){var e=new lw(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},hw);function hw(){this.refsByKey=new am(lw.compareByKey),this.refsByTarget=new am(lw.compareByTargetId)}var lw=(fw.compareByKey=function(t,e){return Ry.comparator(t.key,e.key)||sy(t.targetOrBatchId,e.targetOrBatchId)},fw.compareByTargetId=function(t,e){return sy(t.targetOrBatchId,e.targetOrBatchId)||Ry.comparator(t.key,e.key)},fw);function fw(t,e){this.key=t,this.targetOrBatchId=e}var pw=(dw.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new sw(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=gm(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},dw.prototype.localWrite=function(s){var u=this,c=zy.now(),t=s.reduce(function(t,e){return t.add(e.key)},gm());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return u.localDocuments.getDocuments(a,t).next(function(n){for(var t=[],e=0,r=s;e<r.length;e++){var i=r[e],o=i.extractBaseValue(n.get(i.key));null!=o&&t.push(new Zb(i.key,o,o.fieldMask(),Qb.exists(!0)))}return u.mutationQueue.addMutationBatch(a,c,t,s).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},dw.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Im.resolve(null)})})},dw.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},dw.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Nd(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},dw.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},dw.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},dw.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},dw.prototype.applyRemoteEvent=function(u){var c=this,h=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[],s=gm();Ud(u.targetChanges,function(t,e){var n=c.queryDataByTarget[t];if(n){e.addedDocuments.forEach(function(t){s=s.add(t)}),e.modifiedDocuments.forEach(function(t){s=s.add(t)}),a.push(c.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n;n=n.copy({resumeToken:r,snapshotVersion:u.snapshotVersion}),c.queryDataByTarget[t]=n,dw.shouldPersistQueryData(i,n,e)&&a.push(c.queryCache.updateQueryData(o,n))}}});var i=lm(),n=gm();u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(h.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||e.version.isEqual(Xy.MIN)||s.has(e.key)&&!n.hasPendingWrites||0<=e.version.compareTo(n.version)?(h.addEntry(e),i=i.insert(t,e)):Td("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})}));var e=u.snapshotVersion;if(!e.isEqual(Xy.MIN)){var t=c.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Nd(0<=e.compareTo(t),"Watch stream reverted to previous snapshot?? "+e+" < "+t),c.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,e)});a.push(t)}return Im.waitFor(a).next(function(){return h.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,i)})})},dw.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size)},dw.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Im.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),Im.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},dw.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},dw.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},dw.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,Im.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new mg(r,t,hg.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Nd(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},dw.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){Nd(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?Im.resolve():Im.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},dw.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},dw.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},dw.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},dw.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},dw.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},dw.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Im.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Nd(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):Nd(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},dw.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},dw.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},dw.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},dw.RESUME_TOKEN_MAX_AGE_MICROS=3e8,dw);function dw(t,e){this.persistence=t,this.localViewReferences=new cw,this.queryDataByTarget={},Nd(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new sw(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}var yw=(mw.prototype.checkEmpty=function(t){return Im.resolve(0===this.mutationQueue.length)},mw.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Nd(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Nd(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Im.resolve()},mw.prototype.getLastStreamToken=function(t){return Im.resolve(this.lastStreamToken)},mw.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Im.resolve()},mw.prototype.addMutationBatch=function(t,e,n,r){Nd(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Nd(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new _m(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new lw(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Im.resolve(o)},mw.prototype.lookupMutationBatch=function(t,e){return Im.resolve(this.findMutationBatch(e))},mw.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Nd(null!=n,"Failed to find local mutation batch."),Im.resolve(n.keys())},mw.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Im.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},mw.prototype.getAllMutationBatches=function(t){return Im.resolve(this.mutationQueue.slice())},mw.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new lw(n,0),i=new lw(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Nd(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Nd(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Im.resolve(o)},mw.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new am(sy);return e.forEach(function(e){var t=new lw(e,0),n=new lw(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Nd(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Im.resolve(this.findMutationBatches(i))},mw.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Nd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Ry.isDocumentKey(i)||(i=i.child(""));var o=new lw(new Ry(i),0),a=new am(sy);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Im.resolve(this.findMutationBatches(a))},mw.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},mw.prototype.removeMutationBatch=function(n,r){var i=this;Nd(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Im.forEach(r.mutations,function(t){var e=new lw(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},mw.prototype.removeCachedMutationKeys=function(t){},mw.prototype.containsKey=function(t,e){var n=new lw(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Im.resolve(e.isEqual(r&&r.key))},mw.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Nd(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Im.resolve()},mw.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Nd(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},mw.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},mw.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Nd(n.batchId===t,"If found batch must match"),n},mw);function mw(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Dd(),this.batchesByDocumentKey=new am(lw.compareByKey)}var vw=(gw.prototype.getTargetCount=function(t){return Im.resolve(this.targetCount)},gw.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),Im.resolve()},gw.prototype.getLastRemoteSnapshotVersion=function(t){return Im.resolve(this.lastRemoteSnapshotVersion)},gw.prototype.getHighestSequenceNumber=function(t){return Im.resolve(this.highestSequenceNumber)},gw.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Im.resolve(e)},gw.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Im.resolve()},gw.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},gw.prototype.addQueryData=function(t,e){return Nd(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Im.resolve()},gw.prototype.updateQueryData=function(t,e){return Nd(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Im.resolve()},gw.prototype.removeQueryData=function(t,e){return Nd(0<this.targetCount,"Removing a target from an empty cache"),Nd(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Im.resolve()},gw.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Im.waitFor(s).next(function(){return a})},gw.prototype.getQueryCount=function(t){return Im.resolve(this.targetCount)},gw.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Im.resolve(n)},gw.prototype.getQueryDataForTarget=function(t,e){return Cd("Not yet implemented.")},gw.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Im.waitFor(i)},gw.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Im.waitFor(i)},gw.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Im.resolve()},gw.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Im.resolve(n)},gw.prototype.containsKey=function(t,e){return Im.resolve(this.references.containsKey(e))},gw);function gw(t){this.persistence=t,this.queries=new dv(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Xy.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new cw,this.targetCount=0,this.targetIdGenerator=Fm.forQueryCache()}var bw=(ww.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,Im.waitFor(r)},ww.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,Im.resolve(n.size)):Im.resolve(0)},ww.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Im.resolve(n?n.maybeDocument:null)},ww.prototype.getSizedEntry=function(t,e){return Im.resolve(this.docs.get(e))},ww.prototype.getEntries=function(t,e){var n=this,r=fm();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Im.resolve(r)},ww.prototype.getSizedEntries=function(t,e){var n=this,r=fm(),i=new $y(Ry.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),Im.resolve({maybeDocuments:r,sizeMap:i})},ww.prototype.getDocumentsMatchingQuery=function(t,e){Nd(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=dm(),r=new Ry(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof av&&e.matches(s)&&(n=n.insert(s.key,s))}return Im.resolve(n)},ww.prototype.forEachDocumentKey=function(t,e){return Im.forEach(this.docs,function(t){return e(t)})},ww.prototype.getNewDocumentChanges=function(t){var r=this,i=lm();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new cv(t,Xy.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=gm(),Im.resolve(i)},ww.prototype.newChangeBuffer=function(){return new Ew(this.sizer,this)},ww.prototype.getSize=function(t){return Im.resolve(this.size)},ww);function ww(t,e){this.indexManager=t,this.sizer=e,this.docs=new $y(Ry.comparator),this.newDocumentChanges=gm(),this.size=0}var _w,Ew=(ii(Tw,_w=mv),Tw.prototype.applyChanges=function(t){var i=this,e=this.assertChanges(),o=0,a=[];return e.forEach(function(t,e){var n=i.documentSizes.get(t);Nd(void 0!==n,"Attempting to change document "+t.toString()+" without having read it first");var r=i.sizer(e);o+=r-n,a.push({maybeDocument:e,size:r})}),this.documentCache.addEntries(t,a,o)},Tw.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},Tw.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},Tw);function Tw(t,e){var n=_w.call(this)||this;return n.sizer=t,n.documentCache=e,n}var Sw=(Iw.createLruPersistence=function(t,e,n){return new Iw(t,function(t){return new kw(t,new gg(e),n)})},Iw.createEagerPersistence=function(t){return new Iw(t,function(t){return new Nw(t)})},Iw.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(Iw.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),Iw.prototype.getActiveClients=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,[this.clientId]]})})},Iw.prototype.setPrimaryStateListener=function(t){return t(!0)},Iw.prototype.setDatabaseDeletedListener=function(){},Iw.prototype.setNetworkEnabled=function(t){},Iw.prototype.getIndexManager=function(){return this.indexManager},Iw.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new yw(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},Iw.prototype.getQueryCache=function(){return this.queryCache},Iw.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},Iw.prototype.runTransaction=function(t,e,n){var r=this;Td("MemoryPersistence","Starting transaction:",t);var i=new Cw(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},Iw.prototype.mutationQueuesContainKey=function(e,n){return Im.or(function(t){var n=[];return qd(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},Iw);function Iw(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new by(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new vw(this);this.indexManager=new kv,this.remoteDocumentCache=new bw(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var Cw=function(t){this.currentSequenceNumber=t},Nw=(Aw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Aw.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Im.resolve()},Aw.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Im.resolve()},Aw.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Im.resolve()},Aw.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},Aw.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},Aw.prototype.onTransactionCommitted=function(n){var t=this,r=this.persistence.getRemoteDocumentCache();return Im.forEach(this.orphanedDocuments,function(e){return t.isReferenced(n,e).next(function(t){return t?Im.resolve():r.removeEntry(n,e).next(function(){})})})},Aw.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},Aw.prototype.documentSize=function(t){return 0},Aw.prototype.isReferenced=function(t,e){var n=this;return Im.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Im.resolve(n.inMemoryPins.containsKey(e))}])},Aw);function Aw(t){this.persistence=t}var kw=(Dw.prototype.onTransactionStarted=function(){},Dw.prototype.onTransactionCommitted=function(t){return Im.resolve()},Dw.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},Dw.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},Dw.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},Dw.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Im.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Im.resolve():r(e)})})},Dw.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},Dw.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},Dw.prototype.removeOrphanedDocuments=function(n,t){var r=this,i=0,o=this.persistence.getRemoteDocumentCache();return o.forEachDocumentKey(n,function(e){return r.isPinned(n,e,t).next(function(t){return t?Im.resolve():(i++,o.removeEntry(n,e).next())})}).next(function(){return i})},Dw.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Im.resolve()},Dw.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},Dw.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Im.resolve()},Dw.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Im.resolve()},Dw.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Im.resolve()},Dw.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Cd("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},Dw.prototype.isPinned=function(t,e,n){var r=this;return Im.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Im.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Im.resolve(void 0!==t&&n<t)}])},Dw.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},Dw);function Dw(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new dv(function(t){return Ky(t.path)}),this.garbageCollector=new Ag(this,n)}var Rw=Number,Ow=Rw.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Pw=Rw.MAX_SAFE_INTEGER||Math.pow(2,53)-1,xw=Rw.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Mw(t){return null==t}function Lw(t){return xw(t)&&t<=Pw&&Ow<=t}var Fw=(Uw.prototype.reset=function(){this.currentBaseMs=0},Uw.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},Uw.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Td("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},Uw.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},Uw.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},Uw);function Uw(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var qw,Vw,Bw="PersistentStream";(Vw=qw=qw||{})[Vw.Initial=0]="Initial",Vw[Vw.Starting=1]="Starting",Vw[Vw.Open=2]="Open",Vw[Vw.Error=3]="Error",Vw[Vw.Backoff=4]="Backoff";var jw=(Ww.prototype.isStarted=function(){return this.state===qw.Starting||this.state===qw.Open||this.state===qw.Backoff},Ww.prototype.isOpen=function(){return this.state===qw.Open},Ww.prototype.start=function(){this.state!==qw.Error?(Nd(this.state===qw.Initial,"Already started"),this.auth()):this.performBackoff()},Ww.prototype.stop=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(qw.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ww.prototype.inhibitBackoff=function(){Nd(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=qw.Initial,this.backoff.reset()},Ww.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},Ww.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},Ww.prototype.handleIdleCloseTimer=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.isOpen()?[2,this.close(qw.Initial)]:[2]})})},Ww.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},Ww.prototype.close=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Nd(this.isStarted(),"Only started streams should be closed."),Nd(e===qw.Error||Mw(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==qw.Error?this.backoff.reset():n&&n.code===Od.RESOURCE_EXHAUSTED?(Sd(n.toString()),Sd("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Od.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},Ww.prototype.tearDown=function(){},Ww.prototype.auth=function(){var n=this;Nd(this.state===qw.Initial,"Must be in initial state to auth"),this.state=qw.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Pd(Od.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},Ww.prototype.startStream=function(t){var e=this;Nd(this.state===qw.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Nd(e.state===qw.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=qw.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Ww.prototype.performBackoff=function(){var t=this;Nd(this.state===qw.Error,"Should only perform backoff when in Error state"),this.state=qw.Backoff,this.backoff.backoffAndRun(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){return Nd(this.state===qw.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=qw.Initial,this.start(),Nd(this.isStarted(),"PersistentStream should have started"),[2]})})})},Ww.prototype.handleStreamClose=function(t){return Nd(this.isStarted(),"Can't handle server close on non-started stream"),Td(Bw,"close with error: "+t),this.stream=null,this.close(qw.Error,t)},Ww.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Td(Bw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Ww);function Ww(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=qw.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Fw(t,e,1e3,1.5,6e4)}var Kw,Qw=(ii(Hw,Kw=jw),Hw.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},Hw.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},Hw.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},Hw.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},Hw);function Hw(t,e,n,r,i){var o=Kw.call(this,t,Py.ListenStreamConnectionBackoff,Py.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var Gw,zw=(ii(Yw,Gw=jw),Object.defineProperty(Yw.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),Yw.prototype.start=function(){this.handshakeComplete_=!1,Gw.prototype.start.call(this)},Yw.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},Yw.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},Yw.prototype.onMessage=function(t){if(Nd(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Nd(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},Yw.prototype.writeHandshake=function(){Nd(this.isOpen(),"Writing handshake requires an opened stream"),Nd(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},Yw.prototype.writeMutations=function(t){var e=this;Nd(this.isOpen(),"Writing mutations requires an opened stream"),Nd(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Nd(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},Yw);function Yw(t,e,n,r,i){var o=Gw.call(this,t,Py.WriteStreamConnectionBackoff,Py.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o}var Xw=(Jw.prototype.newPersistentWriteStream=function(t){return new zw(this.queue,this.connection,this.credentials,this.serializer,t)},Jw.prototype.newPersistentWatchStream=function(t){return new Qw(this.queue,this.connection,this.credentials,this.serializer,t)},Jw.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},Jw.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=lm();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Nd(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},Jw.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Od.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},Jw.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Od.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},Jw);function Jw(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var $w,Zw,t_,e_,n_=(r_.prototype.lookup=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Pd(Od.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof cv||t instanceof av?n.recordVersion(t):Cd("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},r_.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},r_.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},r_.prototype.delete=function(t){this.write([new ow(t,this.precondition(t))]),this.writtenDocs.add(t)},r_.prototype.commit=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Pd(Od.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},r_.prototype.recordVersion=function(t){var e;if(t instanceof av)e=t.version;else{if(!(t instanceof cv))throw Cd("Document in a transaction was a "+t.constructor.name);e=Xy.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Pd(Od.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},r_.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Qb.updateTime(e):Qb.NONE},r_.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Qb.exists(!0);if(e.isEqual(Xy.forDeletedDoc()))throw new Pd(Od.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qb.updateTime(e)},r_.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},r_.prototype.ensureCommitNotCalled=function(){Nd(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},r_);function r_(t){this.datastore=t,this.readVersions=mm(),this.mutations=[],this.committed=!1,this.writtenDocs=new Set}(Zw=$w=$w||{})[Zw.Unknown=0]="Unknown",Zw[Zw.Online=1]="Online",Zw[Zw.Offline=2]="Offline",(e_=t_=t_||{})[e_.RemoteStore=0]="RemoteStore",e_[e_.SharedClientState=1]="SharedClientState";var i_,o_,a_=(s_.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast($w.Unknown),Nd(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Py.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Nd(t.state===$w.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast($w.Offline),Promise.resolve()}))},s_.prototype.handleWatchStreamFailure=function(t){this.state===$w.Online?(this.setAndBroadcast($w.Unknown),Nd(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Nd(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast($w.Offline)))},s_.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===$w.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},s_.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},s_.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Sd(e),this.shouldWarnClientIsOffline=!1):Td("OnlineStateTracker",e)},s_.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},s_);function s_(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=$w.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function u_(t){switch(t){case Od.OK:return Cd("Treated status OK as error");case Od.CANCELLED:case Od.UNKNOWN:case Od.DEADLINE_EXCEEDED:case Od.RESOURCE_EXHAUSTED:case Od.INTERNAL:case Od.UNAVAILABLE:case Od.UNAUTHENTICATED:return!1;case Od.INVALID_ARGUMENT:case Od.NOT_FOUND:case Od.ALREADY_EXISTS:case Od.PERMISSION_DENIED:case Od.FAILED_PRECONDITION:case Od.ABORTED:case Od.OUT_OF_RANGE:case Od.UNIMPLEMENTED:case Od.DATA_LOSS:return!0;default:return Cd("Unknown status code: "+t)}}function c_(t){if(void 0===t)return Sd("GRPC error has no .code"),Od.UNKNOWN;switch(t){case i_.OK:return Od.OK;case i_.CANCELLED:return Od.CANCELLED;case i_.UNKNOWN:return Od.UNKNOWN;case i_.DEADLINE_EXCEEDED:return Od.DEADLINE_EXCEEDED;case i_.RESOURCE_EXHAUSTED:return Od.RESOURCE_EXHAUSTED;case i_.INTERNAL:return Od.INTERNAL;case i_.UNAVAILABLE:return Od.UNAVAILABLE;case i_.UNAUTHENTICATED:return Od.UNAUTHENTICATED;case i_.INVALID_ARGUMENT:return Od.INVALID_ARGUMENT;case i_.NOT_FOUND:return Od.NOT_FOUND;case i_.ALREADY_EXISTS:return Od.ALREADY_EXISTS;case i_.PERMISSION_DENIED:return Od.PERMISSION_DENIED;case i_.FAILED_PRECONDITION:return Od.FAILED_PRECONDITION;case i_.ABORTED:return Od.ABORTED;case i_.OUT_OF_RANGE:return Od.OUT_OF_RANGE;case i_.UNIMPLEMENTED:return Od.UNIMPLEMENTED;case i_.DATA_LOSS:return Od.DATA_LOSS;default:return Cd("Unknown status code: "+t)}}(o_=i_=i_||{})[o_.OK=0]="OK",o_[o_.CANCELLED=1]="CANCELLED",o_[o_.UNKNOWN=2]="UNKNOWN",o_[o_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",o_[o_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",o_[o_.NOT_FOUND=5]="NOT_FOUND",o_[o_.ALREADY_EXISTS=6]="ALREADY_EXISTS",o_[o_.PERMISSION_DENIED=7]="PERMISSION_DENIED",o_[o_.UNAUTHENTICATED=16]="UNAUTHENTICATED",o_[o_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",o_[o_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",o_[o_.ABORTED=10]="ABORTED",o_[o_.OUT_OF_RANGE=11]="OUT_OF_RANGE",o_[o_.UNIMPLEMENTED=12]="UNIMPLEMENTED",o_[o_.INTERNAL=13]="INTERNAL",o_[o_.UNAVAILABLE=14]="UNAVAILABLE",o_[o_.DATA_LOSS=15]="DATA_LOSS";var h_,l_,f_,p_,d_=(y_.emptySet=function(t){return new y_(t.comparator)},y_.prototype.has=function(t){return null!=this.keyedMap.get(t)},y_.prototype.get=function(t){return this.keyedMap.get(t)},y_.prototype.first=function(){return this.sortedSet.minKey()},y_.prototype.last=function(){return this.sortedSet.maxKey()},y_.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},y_.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(y_.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),y_.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},y_.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},y_.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},y_.prototype.isEqual=function(t){if(!(t instanceof y_))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},y_.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},y_.prototype.copy=function(t,e){var n=new y_;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},y_);function y_(n){this.comparator=n?function(t,e){return n(t,e)||Ry.comparator(t.key,e.key)}:function(t,e){return Ry.comparator(t.key,e.key)},this.keyedMap=dm(),this.sortedSet=new $y(this.comparator)}(l_=h_=h_||{})[l_.Added=0]="Added",l_[l_.Removed=1]="Removed",l_[l_.Modified=2]="Modified",l_[l_.Metadata=3]="Metadata",(p_=f_=f_||{})[p_.Local=0]="Local",p_[p_.Synced=1]="Synced";var m_=(v_.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==h_.Added&&n.type===h_.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===h_.Metadata&&n.type!==h_.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===h_.Modified&&n.type===h_.Modified?this.changeMap=this.changeMap.insert(e,{type:h_.Modified,doc:t.doc}):t.type===h_.Modified&&n.type===h_.Added?this.changeMap=this.changeMap.insert(e,{type:h_.Added,doc:t.doc}):t.type===h_.Removed&&n.type===h_.Added?this.changeMap=this.changeMap.remove(e):t.type===h_.Removed&&n.type===h_.Modified?this.changeMap=this.changeMap.insert(e,{type:h_.Removed,doc:n.doc}):t.type===h_.Added&&n.type===h_.Removed?this.changeMap=this.changeMap.insert(e,{type:h_.Modified,doc:t.doc}):Cd("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},v_.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},v_);function v_(){this.changeMap=new $y(Ry.comparator)}var g_=(b_.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:h_.Added,doc:t})}),new b_(t,e,d_.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(b_.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),b_.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},b_);function b_(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var w_=(__.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=E_.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new __(Xy.MIN,r,wm(),lm(),gm())},__);function __(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var E_=(T_.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new T_(Dd(),e,gm(),gm(),gm())},T_);function T_(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var S_,I_,C_=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},N_=function(t,e){this.targetId=t,this.existenceFilter=e};(I_=S_=S_||{})[I_.NoChange=0]="NoChange",I_[I_.Added=1]="Added",I_[I_.Removed=2]="Removed",I_[I_.Current=3]="Current",I_[I_.Reset=4]="Reset";var A_=function(t,e,n,r){void 0===n&&(n=Dd()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},k_=(Object.defineProperty(D_.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(D_.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(D_.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(D_.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),D_.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},D_.prototype.toTargetChange=function(){var n=gm(),r=gm(),i=gm();return this.documentChanges.forEach(function(t,e){switch(e){case h_.Added:n=n.add(t);break;case h_.Modified:r=r.add(t);break;case h_.Removed:i=i.add(t);break;default:Cd("Encountered invalid change type: "+e)}}),new E_(this._resumeToken,this._current,n,r,i)},D_.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=x_()},D_.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},D_.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},D_.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},D_.prototype.recordTargetResponse=function(){this.pendingResponses-=1},D_.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},D_);function D_(){this.pendingResponses=0,this.documentChanges=x_(),this._resumeToken=Dd(),this._current=!1,this._hasPendingChanges=!0}var R_=(O_.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof av?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof cv&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},O_.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case S_.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case S_.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case S_.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Nd(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case S_.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case S_.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Cd("Unknown target watch change state: "+n.state)}})},O_.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Ud(this.targetStates,e)},O_.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Ry(i.path);this.removeDocumentFromTarget(e,o,new cv(o,Xy.forDeletedDoc()))}else Nd(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},O_.prototype.createRemoteEvent=function(i){var o=this,a={};Ud(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new Ry(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new cv(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=gm();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===hg.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new w_(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=lm(),this.pendingDocumentTargetMapping=P_(),this.pendingTargetResets=new am(sy),t},O_.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?h_.Modified:h_.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},O_.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,h_.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},O_.prototype.removeTarget=function(t){delete this.targetStates[t]},O_.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},O_.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},O_.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new k_),this.targetStates[t]},O_.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new am(sy),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},O_.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Td("WatchChangeAggregator","Detected inactive target",t),e},O_.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},O_.prototype.resetTarget=function(e){var n=this;Nd(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new k_,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},O_.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},O_);function O_(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=lm(),this.pendingDocumentTargetMapping=P_(),this.pendingTargetResets=new am(sy)}function P_(){return new $y(Ry.comparator)}function x_(){return new $y(Ry.comparator)}var M_="RemoteStore",L_=(F_.prototype.start=function(){return this.enableNetwork()},F_.prototype.enableNetwork=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set($w.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},F_.prototype.disableNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set($w.Offline),[2]}})})},F_.prototype.disableNetworkInternal=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Td(M_,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},F_.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Td(M_,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set($w.Unknown),[2]}})})},F_.prototype.listen=function(t){Nd(!Ld(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},F_.prototype.unlisten=function(t){Nd(Ld(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Vd(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set($w.Unknown))},F_.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},F_.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},F_.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},F_.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},F_.prototype.startWatchStream=function(){Nd(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new R_(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},F_.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Vd(this.listenTargets)},F_.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},F_.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},F_.prototype.onWatchStreamOpen=function(){return ai(this,void 0,void 0,function(){var n=this;return si(this,function(t){return Ud(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},F_.prototype.onWatchStreamClose=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return void 0===e&&Nd(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set($w.Unknown),[2]})})},F_.prototype.onWatchStreamChange=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set($w.Online),n instanceof A_&&n.state===S_.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof C_?this.watchChangeAggregator.handleDocumentChange(n):n instanceof N_?this.watchChangeAggregator.handleExistenceFilter(n):(Nd(n instanceof A_,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(Xy.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},F_.prototype.raiseWatchSnapshot=function(r){var i=this;Nd(!r.isEqual(Xy.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Ud(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.copy({resumeToken:e.resumeToken,snapshotVersion:r}))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.copy({resumeToken:Dd()}),i.sendUnwatchRequest(t);var n=new mg(e.query,t,hg.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},F_.prototype.handleTargetError=function(t){var n=this;Nd(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ai(n,void 0,void 0,function(){return si(this,function(t){return Ld(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},F_.prototype.fillWritePipeline=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},F_.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},F_.prototype.outstandingWrites=function(){return this.writePipeline.length},F_.prototype.addToWritePipeline=function(t){Nd(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},F_.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},F_.prototype.startWriteStream=function(){Nd(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},F_.prototype.onWriteStreamOpen=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.writeStream.writeHandshake(),[2]})})},F_.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(Ug)},F_.prototype.onMutationResult=function(t,e){var n=this;Nd(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Tm.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},F_.prototype.onWriteStreamClose=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){return void 0===n&&Nd(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},F_.prototype.handleHandshakeError=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return u_(e.code)?(Td(M_,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Dd(),[2,this.localStore.setLastStreamToken(Dd()).catch(Ug)]):[2]})})},F_.prototype.handleWriteError=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){return function(t){return u_(t)&&t!==Od.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},F_.prototype.createTransaction=function(){return new n_(this.datastore)},F_.prototype.restartNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set($w.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},F_.prototype.handleCredentialChange=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Td(M_,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},F_.prototype.applyPrimaryState=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set($w.Unknown),t.label=4;case 4:return[2]}})})},F_);function F_(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ai(o,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Td(M_,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new a_(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var U_=(Object.defineProperty(q_.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(q_.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),q_.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},q_.prototype._compareTo=function(t){return sy(this._lat,t._lat)||sy(this._long,t._long)},q_);function q_(t,e){if(jd("GeoPoint",arguments,2),Qd("GeoPoint","number",1,t),Qd("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Pd(Od.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Pd(Od.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var V_=(B_.atPath=function(t){return new B_(t)},Object.defineProperty(B_.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[yE]:this.memoizedOrderBy=[new pE(t),yE];else{Nd(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:cE.ASCENDING;this.memoizedOrderBy.push(a===cE.ASCENDING?yE:mE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),B_.prototype.addFilter=function(t){Nd(null==this.getInequalityFilterField()||!(t instanceof H_)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Nd(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new B_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},B_.prototype.addOrderBy=function(t){Nd(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new B_(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},B_.prototype.withLimit=function(t){return new B_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},B_.prototype.withStartAt=function(t){return new B_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},B_.prototype.withEndAt=function(t){return new B_(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},B_.prototype.asCollectionQueryAtPath=function(t){return new B_(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},B_.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Mw(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},B_.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Mw(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},B_.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},B_.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Nd(n,"orderBy used that doesn't compare on key field"),0},B_.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},B_.prototype.hasLimit=function(){return!Mw(this.limit)},B_.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},B_.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof H_&&n.isInequality())return n.field}return null},B_.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof H_&&0<=t.indexOf(r.op))return r.op}return null},B_.prototype.isDocumentQuery=function(){return Ry.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},B_.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},B_.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Ry.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},B_.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},B_.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},B_.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},B_.prototype.assertValidBound=function(t){Nd(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},B_);function B_(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function j_(){}var W_=(K_.fromString=function(t){switch(t){case"<":return K_.LESS_THAN;case"<=":return K_.LESS_THAN_OR_EQUAL;case"==":return K_.EQUAL;case">=":return K_.GREATER_THAN_OR_EQUAL;case">":return K_.GREATER_THAN;case"array-contains":return K_.ARRAY_CONTAINS;case"in":return K_.IN;case"array-contains-any":return K_.ARRAY_CONTAINS_ANY;default:return Cd("Unknown FieldFilter operator: "+t)}},K_.prototype.toString=function(){return this.name},K_.prototype.isEqual=function(t){return this.name===t.name},K_.LESS_THAN=new K_("<"),K_.LESS_THAN_OR_EQUAL=new K_("<="),K_.EQUAL=new K_("=="),K_.GREATER_THAN=new K_(">"),K_.GREATER_THAN_OR_EQUAL=new K_(">="),K_.ARRAY_CONTAINS=new K_("array-contains"),K_.IN=new K_("in"),K_.ARRAY_CONTAINS_ANY=new K_("array-contains-any"),K_);function K_(t){this.name=t}var Q_,H_=(ii(G_,Q_=j_),G_.create=function(t,e,n){if(t.isKeyField())return e===W_.IN?(Nd(n instanceof Lb,"Comparing on key with IN, but filter value not an ArrayValue"),Nd(n.internalValue.every(function(t){return t instanceof Nb}),"Comparing on key with IN, but an array value was not a RefValue"),new $_(t,n)):(Nd(n instanceof Nb,"Comparing on key, but filter value not a RefValue"),Nd(e!==W_.ARRAY_CONTAINS&&e!==W_.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Y_(t,e,n));if(n.isEqual(Zg.INSTANCE)){if(e!==W_.EQUAL)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new G_(t,e,n)}if(n.isEqual(fb.NAN)){if(e!==W_.EQUAL)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new G_(t,e,n)}return e===W_.ARRAY_CONTAINS?new eE(t,n):e===W_.IN?(Nd(n instanceof Lb,"IN filter has invalid value: "+n.toString()),new iE(t,n)):e===W_.ARRAY_CONTAINS_ANY?(Nd(n instanceof Lb,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new sE(t,n)):new G_(t,e,n)},G_.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},G_.prototype.matchesComparison=function(t){switch(this.op){case W_.LESS_THAN:return t<0;case W_.LESS_THAN_OR_EQUAL:return t<=0;case W_.EQUAL:return 0===t;case W_.GREATER_THAN:return 0<t;case W_.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Cd("Unknown FieldFilter operator: "+this.op)}},G_.prototype.isInequality=function(){return 0<=[W_.LESS_THAN,W_.LESS_THAN_OR_EQUAL,W_.GREATER_THAN,W_.GREATER_THAN_OR_EQUAL].indexOf(this.op)},G_.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},G_.prototype.isEqual=function(t){return t instanceof G_&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},G_.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},G_);function G_(t,e,n){var r=Q_.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var z_,Y_=(ii(X_,z_=H_),X_.prototype.matches=function(t){var e=this.value,n=Ry.comparator(t.key,e.key);return this.matchesComparison(n)},X_);function X_(){return null!==z_&&z_.apply(this,arguments)||this}var J_,$_=(ii(Z_,J_=H_),Z_.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},Z_);function Z_(t,e){var n=J_.call(this,t,W_.IN,e)||this;return n.value=e,n}var tE,eE=(ii(nE,tE=H_),nE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Lb&&e.contains(this.value)},nE);function nE(t,e){return tE.call(this,t,W_.ARRAY_CONTAINS,e)||this}var rE,iE=(ii(oE,rE=H_),oE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},oE);function oE(t,e){var n=rE.call(this,t,W_.IN,e)||this;return n.value=e,n}var aE,sE=(ii(uE,aE=H_),uE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Lb&&n.internalValue.some(function(t){return e.value.contains(t)})},uE);function uE(t,e){var n=aE.call(this,t,W_.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var cE=(hE.prototype.toString=function(){return this.name},hE.ASCENDING=new hE("asc"),hE.DESCENDING=new hE("desc"),hE);function hE(t){this.name=t}var lE=(fE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},fE.prototype.sortsBeforeDocument=function(t,e){Nd(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Nd(o instanceof Nb,"Bound has a non-key value where the key path is being used."),n=Ry.comparator(o.key,e.key);else{var a=e.field(i.field);Nd(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===cE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},fE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},fE);function fE(t,e){this.position=t,this.before=e}var pE=(dE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?av.compareByKey(t,e):av.compareByField(this.field,t,e);switch(this.dir){case cE.ASCENDING:return n;case cE.DESCENDING:return-1*n;default:return Cd("Unknown direction: "+this.dir)}},dE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},dE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},dE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},dE);function dE(t,e){this.field=t,void 0===e&&(e=cE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var yE=new pE(ky.keyField(),cE.ASCENDING),mE=new pE(ky.keyField(),cE.DESCENDING),vE=(gE.prototype.applyToLocalView=function(t,e){return new _b(e,t)},gE.prototype.applyToRemoteDocument=function(t,e){return e},gE.prototype.computeBaseValue=function(t){return null},gE.prototype.isEqual=function(t){return t instanceof gE},gE.instance=new gE,gE);function gE(){}var bE=(wE.prototype.applyToLocalView=function(t,e){return this.apply(t)},wE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},wE.prototype.apply=function(t){for(var n=IE(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Lb(n)},wE.prototype.computeBaseValue=function(t){return null},wE.prototype.isEqual=function(t){return t instanceof wE&&uy(t.elements,this.elements)},wE);function wE(t){this.elements=t}var _E=(EE.prototype.applyToLocalView=function(t,e){return this.apply(t)},EE.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},EE.prototype.apply=function(t){for(var n=IE(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Lb(n)},EE.prototype.computeBaseValue=function(t){return null},EE.prototype.isEqual=function(t){return t instanceof EE&&uy(t.elements,this.elements)},EE);function EE(t){this.elements=t}var TE=(SE.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof cb&&this.operand instanceof cb){var r=n.internalValue+this.operand.internalValue;return new cb(r)}return r=n.internalValue+this.operand.internalValue,new fb(r)},SE.prototype.applyToRemoteDocument=function(t,e){return Nd(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},SE.prototype.computeBaseValue=function(t){return t instanceof ob?t:new cb(0)},SE.prototype.isEqual=function(t){return t instanceof SE&&this.operand.isEqual(t.operand)},SE);function SE(t){this.operand=t}function IE(t){return t instanceof Lb?t.internalValue.slice():[]}var CE=(NE.prototype.isEqual=function(t){return t&&t.count===this.count},NE);function NE(t){this.count=t}var AE,kE,DE=((AE={})[cE.ASCENDING.name]="ASCENDING",AE[cE.DESCENDING.name]="DESCENDING",AE),RE=((kE={})[W_.LESS_THAN.name]="LESS_THAN",kE[W_.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",kE[W_.GREATER_THAN.name]="GREATER_THAN",kE[W_.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",kE[W_.EQUAL.name]="EQUAL",kE[W_.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",kE[W_.IN.name]="IN",kE[W_.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",kE),OE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function PE(t,e){Nd(!Mw(t),e+" is missing")}function xE(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Cd("can't parse "+t)}var ME=(LE.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},LE.prototype.unsafeCastProtoByteString=function(t){return t},LE.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Od.UNKNOWN:c_(t.code);return new Pd(e,t.message||"")},LE.prototype.toInt32Value=function(t){return Mw(t)?void 0:{value:t}},LE.prototype.fromInt32Value=function(t){var e;return Mw(e="object"==typeof t?t.value:t)?null:e},LE.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},LE.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Nd(!!t,"Cannot deserialize null or undefined timestamp.");var e=xE(t.seconds||"0"),n=t.nanos||0;return new zy(e,n)},LE.prototype.fromIso8601String=function(t){var e=0,n=OE.exec(t);if(Nd(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new zy(o,e)},LE.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},LE.prototype.fromBlob=function(t){return"string"==typeof t?(Nd(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),fy.fromBase64String(t)):(Nd(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),fy.fromUint8Array(t))},LE.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},LE.prototype.fromVersion=function(t){return Nd(!!t,"Trying to deserialize version that isn't set"),Xy.fromTimestamp(this.fromTimestamp(t))},LE.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},LE.prototype.fromResourceName=function(t){var e=Iy.fromString(t);return Nd(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},LE.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},LE.prototype.fromName=function(t){var e=this.fromResourceName(t);return Nd(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Nd(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Ry(this.extractLocalPathFromResourceName(e))},LE.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},LE.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Iy.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(LE.prototype,"encodedDatabaseId",{get:function(){return new Iy(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),LE.prototype.fullyQualifiedPrefixPath=function(t){return new Iy(["projects",t.projectId,"databases",t.database])},LE.prototype.extractLocalPathFromResourceName=function(t){return Nd(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},LE.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},LE.prototype.toValue=function(t){if(t instanceof Zg)return{nullValue:"NULL_VALUE"};if(t instanceof nb)return{booleanValue:t.value()};if(t instanceof cb)return{integerValue:""+t.value()};if(t instanceof fb){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof yb?{stringValue:t.value()}:t instanceof Pb?{mapValue:this.toMapValue(t)}:t instanceof Lb?{arrayValue:this.toArrayValue(t)}:t instanceof gb?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Db?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Sb?{bytesValue:this.toBytes(t.value())}:t instanceof Nb?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Cd("Unknown FieldValue "+JSON.stringify(t))},LE.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Zg.INSTANCE;if("booleanValue"in t)return nb.of(t.booleanValue);if("integerValue"in t)return new cb(xE(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return fb.NAN;if("Infinity"===t.doubleValue)return fb.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return fb.NEGATIVE_INFINITY}return new fb(t.doubleValue)}if("stringValue"in t)return new yb(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){PE(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Lb(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return PE(t.timestampValue,"timestampValue"),new gb(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){PE(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Db(new U_(r,i))}if("bytesValue"in t){PE(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Sb(o)}if("referenceValue"in t){PE(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new vy(a.get(1),a.get(3)),u=new Ry(this.extractLocalPathFromResourceName(a));return new Nb(s,u)}return Cd("Unknown Value proto "+JSON.stringify(t))},LE.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},LE.prototype.toDocument=function(t){return Nd(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},LE.prototype.fromDocument=function(t,e){return new av(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},LE.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},LE.prototype.fromFields=function(t){var n=this,e=t,r=Pb.EMPTY;return qd(e,function(t,e){r=r.set(new ky([t]),n.fromValue(e))}),r},LE.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},LE.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},LE.prototype.fromFound=function(t){Nd(!!t.found,"Tried to deserialize a found document from a missing document."),PE(t.found.name,"doc.found.name"),PE(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new av(e,n,r,{},t.found)},LE.prototype.fromMissing=function(t){Nd(!!t.missing,"Tried to deserialize a missing document from a found document."),Nd(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new cv(e,n)},LE.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Cd("invalid batch get response: "+JSON.stringify(t))},LE.prototype.toWatchTargetChangeState=function(t){switch(t){case S_.Added:return"ADD";case S_.Current:return"CURRENT";case S_.NoChange:return"NO_CHANGE";case S_.Removed:return"REMOVE";case S_.Reset:return"RESET";default:return Cd("Unknown WatchTargetChangeState: "+t)}},LE.prototype.toTestWatchChange=function(t){if(t instanceof N_)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof C_){if(t.newDoc instanceof av){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof cv)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof A_){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return i_.OK;switch(t){case Od.OK:return i_.OK;case Od.CANCELLED:return i_.CANCELLED;case Od.UNKNOWN:return i_.UNKNOWN;case Od.DEADLINE_EXCEEDED:return i_.DEADLINE_EXCEEDED;case Od.RESOURCE_EXHAUSTED:return i_.RESOURCE_EXHAUSTED;case Od.INTERNAL:return i_.INTERNAL;case Od.UNAVAILABLE:return i_.UNAVAILABLE;case Od.UNAUTHENTICATED:return i_.UNAUTHENTICATED;case Od.INVALID_ARGUMENT:return i_.INVALID_ARGUMENT;case Od.NOT_FOUND:return i_.NOT_FOUND;case Od.ALREADY_EXISTS:return i_.ALREADY_EXISTS;case Od.PERMISSION_DENIED:return i_.PERMISSION_DENIED;case Od.FAILED_PRECONDITION:return i_.FAILED_PRECONDITION;case Od.ABORTED:return i_.ABORTED;case Od.OUT_OF_RANGE:return i_.OUT_OF_RANGE;case Od.UNIMPLEMENTED:return i_.UNIMPLEMENTED;case Od.DATA_LOSS:return i_.DATA_LOSS;default:return Cd("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Cd("Unrecognized watch change: "+JSON.stringify(t))},LE.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){PE(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new A_(n,r,i,a||null)}else if("documentChange"in t){PE(t.documentChange,"documentChange"),PE(t.documentChange.document,"documentChange.name"),PE(t.documentChange.document.name,"documentChange.document.name"),PE(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new av(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new C_(f,p,l.key,l)}else if("documentDelete"in t){PE(t.documentDelete,"documentDelete"),PE(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):Xy.forDeletedDoc(),l=new cv(u,c),p=d.removedTargetIds||[],e=new C_([],p,l.key,l)}else if("documentRemove"in t){PE(t.documentRemove,"documentRemove"),PE(t.documentRemove.document,"documentRemove");var y=t.documentRemove;u=this.fromName(y.document),p=y.removedTargetIds||[],e=new C_([],p,u,null)}else{if(!("filter"in t))return Cd("Unknown change type "+JSON.stringify(t));PE(t.filter,"filter"),PE(t.filter.targetId,"filter.targetId");var m=t.filter,v=m.count||0,g=new CE(v),b=m.targetId;e=new N_(b,g)}return e},LE.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?S_.NoChange:"ADD"===t?S_.Added:"REMOVE"===t?S_.Removed:"CURRENT"===t?S_.Current:"RESET"===t?S_.Reset:Cd("Got unexpected TargetChange.state: "+t)},LE.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Xy.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Xy.MIN:e.readTime?this.fromVersion(e.readTime):Xy.MIN},LE.prototype.toMutation=function(t){var e,n=this;if(t instanceof Xb)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof ow)e={delete:this.toName(t.key)};else if(t instanceof Zb)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof nw))return Cd("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},LE.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Qb.NONE;if(t.update){PE(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Zb(r,i,o,n)}return new Xb(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new ow(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Nd(!0===n.exists,'Transforms only support precondition "exists == true"'),new nw(r,a)}return Cd("unknown mutation proto: "+JSON.stringify(t))},LE.prototype.toPrecondition=function(t){return Nd(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Cd("Unknown precondition")},LE.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Qb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Qb.exists(t.exists):Qb.NONE},LE.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Kb(r,i)},LE.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Nd(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},LE.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof vE)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof bE)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof _E)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof TE)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Cd("Unknown transform: "+t.transform)},LE.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Nd("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=vE.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new bE(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new _E(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Nd(i instanceof ob,"NUMERIC_ADD transform requires a NumberValue"),n=new TE(i)}else Cd("Unknown transform proto: "+JSON.stringify(t));var o=ky.fromServerFormat(t.fieldPath);return new Vb(o,n)},LE.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},LE.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Nd(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return V_.atPath(this.fromQueryPath(n))},LE.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Nd(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Nd(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},LE.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Nd(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new V_(e,i,s,a,u,c,h)},LE.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},LE.prototype.toLabel=function(t){switch(t){case hg.Listen:return null;case hg.ExistenceFilterMismatch:return"existence-filter-mismatch";case hg.LimboResolution:return"limbo-document";default:return Cd("Unrecognized query purpose: "+t)}},LE.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},LE.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof H_?e.toUnaryOrFieldFilter(t):Cd("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},LE.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Cd("Unknown filter: "+JSON.stringify(t)):[]},LE.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},LE.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},LE.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},LE.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new lE(r,n)},LE.prototype.toDirection=function(t){return DE[t.name]},LE.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return cE.ASCENDING;case"DESCENDING":return cE.DESCENDING;default:return}},LE.prototype.toOperatorName=function(t){return RE[t.name]},LE.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return W_.EQUAL;case"GREATER_THAN":return W_.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return W_.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return W_.LESS_THAN;case"LESS_THAN_OR_EQUAL":return W_.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return W_.ARRAY_CONTAINS;case"IN":return W_.IN;case"ARRAY_CONTAINS_ANY":return W_.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Cd("Unspecified operator");default:return Cd("Unknown operator")}},LE.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},LE.prototype.fromFieldPathReference=function(t){return ky.fromServerFormat(t.fieldPath)},LE.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},LE.prototype.fromPropertyOrder=function(t){return new pE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},LE.prototype.fromFieldFilter=function(t){return H_.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},LE.prototype.toUnaryOrFieldFilter=function(t){if(t.op===W_.EQUAL){if(t.value.isEqual(fb.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Zg.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},LE.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return H_.create(e,W_.EQUAL,fb.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return H_.create(n,W_.EQUAL,Zg.INSTANCE);case"OPERATOR_UNSPECIFIED":return Cd("Unspecified filter");default:return Cd("Unknown filter")}},LE.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},LE.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return ky.fromServerFormat(t)});return Ub.fromArray(e)},LE);function LE(t,e){this.databaseId=t,this.options=e}var FE=function(){this.listeners=[]},UE=(qE.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new FE,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},qE.prototype.unlisten=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},qE.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(r);o.viewSnap=r}}},qE.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},qE.prototype.onOnlineStateChange=function(i){this.onlineState=i,this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)})},qE);function qE(t){this.syncEngine=t,this.queries=new dv(function(t){return t.canonicalId()}),this.onlineState=$w.Unknown,this.syncEngine.subscribe(this)}var VE=(BE.prototype.onViewSnapshot=function(t){if(Nd(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==h_.Metadata&&e.push(i)}t=new g_(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},BE.prototype.onError=function(t){this.queryObserver.error(t)},BE.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},BE.prototype.shouldRaiseInitialEvent=function(t,e){if(Nd(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==$w.Offline;return this.options.waitForSyncWhenOnline&&n?(Nd(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===$w.Offline},BE.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},BE.prototype.raiseInitialEvent=function(t){Nd(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=g_.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},BE);function BE(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=$w.Unknown,this.options=n||{}}var jE=(WE.fromSnapshot=function(t,e){for(var n=gm(),r=gm(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case h_.Added:n=n.add(a.doc.key);break;case h_.Removed:r=r.add(a.doc.key)}}return new WE(t,n,r)},WE);function WE(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}var KE=function(t){this.key=t},QE=function(t){this.key=t},HE=(Object.defineProperty(GE.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),GE.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new m_,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof av?e:null;r&&(Nd(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(u.track({type:h_.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:h_.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:h_.Added,doc:r}),a=!0):n&&!r&&(u.track({type:h_.Removed,doc:n}),a=!0,p&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:h_.Removed,doc:n})}return Nd(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},GE.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},GE.prototype.applyChanges=function(t,e,n){var r=this;Nd(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case h_.Added:return 1;case h_.Modified:case h_.Metadata:return 2;case h_.Removed:return 0;default:return Cd("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?f_.Synced:f_.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new g_(this.query,t.documentSet,i,o,t.mutatedKeys,s===f_.Local,u,!1),limboChanges:a}:{limboChanges:a}},GE.prototype.applyOnlineStateChange=function(t){return this.current&&t===$w.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new m_,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},GE.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},GE.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Nd(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},GE.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=gm(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new QE(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new KE(t))}),r},GE.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=gm();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},GE.prototype.computeInitialSnapshot=function(){return g_.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===f_.Local)},GE);function GE(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=gm(),this.mutatedKeys=gm(),this.documentSet=new d_(t.docComparator.bind(t))}var zE="SyncEngine",YE=function(t,e,n){this.query=t,this.targetId=e,this.view=n},XE=function(t){this.key=t},JE=(Object.defineProperty($E.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),$E.prototype.subscribe=function(t){Nd(null!==t,"SyncEngine listener cannot be null"),Nd(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},$E.prototype.listen=function(a){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},$E.prototype.initializeViewAndComputeSnapshot=function(c,h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=c.query,[4,this.localStore.executeQuery(e)];case 1:return n=t.sent(),[4,this.localStore.remoteDocumentKeys(c.targetId)];case 2:return r=t.sent(),i=new HE(e,r),o=i.computeDocChanges(n),a=E_.createSynthesizedTargetChangeForCurrentChange(c.targetId,h&&this.onlineState!==$w.Offline),Nd(0===(s=i.applyChanges(o,!0===this.isPrimary,a)).limboChanges.length,"View returned limbo docs before target ack from the server."),Nd(!!s.snapshot,"applyChanges for new view should always return a snapshot"),u=new YE(e,c.targetId,i),this.queryViewsByQuery.set(e,u),this.queryViewsByTarget[c.targetId]=u,[2,s.snapshot]}})})},$E.prototype.synchronizeViewAndComputeSnapshot=function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i.query)];case 1:return e=t.sent(),[4,this.localStore.remoteDocumentKeys(i.targetId)];case 2:return n=t.sent(),r=i.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,r.limboChanges),[2,r]}})})},$E.prototype.unlisten=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Nd(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Ug)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},$E.prototype.write=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},$E.prototype.runTransaction=function(o,a){return void 0===a&&(a=5),ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:if(Nd(0<=a,"Got negative number of retries for transaction."),e=this.remoteStore.createTransaction(),Mw(n=o(e))||!n.catch||!n.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,n];case 2:return r=t.sent(),[4,e.commit()];case 3:return t.sent(),[2,r];case 4:return i=t.sent(),0<a&&this.isRetryableTransactionError(i)?[2,this.runTransaction(o,a-1)]:[2,Promise.reject(i)];case 5:return[2]}})})},$E.prototype.applyRemoteEvent=function(n){return ai(this,void 0,void 0,function(){var e,r=this;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),qd(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Nd(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Nd(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Nd(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Ug(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},$E.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===t_.RemoteStore||!this.isPrimary&&t===t_.SharedClientState){var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Nd(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},$E.prototype.rejectListen=function(u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new $y(Ry.comparator)).insert(n,new cv(n,Xy.forDeletedDoc())),i=gm().add(n),o=new w_(Xy.MIN,{},new am(sy),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Nd(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(Ug)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},$E.prototype.applyBatchState=function(n,r,i){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Td(zE,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Cd("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},$E.prototype.applySuccessfulWrite=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,Ug(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},$E.prototype.rejectFailedWrite=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,Ug(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},$E.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new $y(sy)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},$E.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Nd(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},$E.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},$E.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},$E.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof KE?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof QE?(Td(zE,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Cd("Unknown limbo change: "+JSON.stringify(i))}},$E.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Td(zE,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=V_.atPath(e.path);this.limboResolutionsByTarget[n]=new XE(e),this.remoteStore.listen(new mg(r,n,hg.LimboResolution,by.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},$E.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},$E.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return ai(this,void 0,void 0,function(){var o,a,e,s=this;return si(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=jE.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},$E.prototype.assertSubscribed=function(t){Nd(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},$E.prototype.handleCredentialChange=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?[4,this.localStore.handleUserChange(r)]:[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},$E.prototype.applyPrimaryState=function(c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return si(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Ud(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},$E.prototype.resetLimboDocuments=function(){var e=this;Ud(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new $y(Ry.comparator)},$E.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(h){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=h,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return t.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=t.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return Nd(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return Nd(!!(c=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:t.sent(),t.label=9;case 9:e.push(a),t.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},$E.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!u_(e)},$E.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},$E.prototype.applyTargetState=function(a,s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Td(zE,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[a])return[3,11];switch(s){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return t.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=w_.createSynthesizedRemoteEventForCurrentChange(a,"current"===s),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,11];case 4:return function(t){return t.code===Od.DATA_LOSS&&t.message===gv}(r=t.sent())?(i=[],Ud(this.queryViewsByTarget,function(t){return i.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(i)]):[3,6];case 5:return t.sent(),[3,7];case 6:throw r;case 7:return[3,8];case 8:return o=this.queryViewsByTarget[a],this.removeAndCleanupQuery(o),[4,this.localStore.releaseQuery(o.query,!0)];case 9:return t.sent(),this.syncEngineListener.onWatchError(o.query,u),[3,11];case 10:Cd("Unexpected target state: "+s),t.label=11;case 11:return[2]}})})},$E.prototype.applyActiveTargetsChange=function(l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return si(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Nd(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return Nd(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return si(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(Ug)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},$E.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},$E.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},$E.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?gm().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:gm()},$E);function $E(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new dv(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new $y(Ry.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new cw,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Fm.forSyncEngine(),this.isPrimary=void 0,this.onlineState=$w.Unknown}var ZE=(tT.prototype.isAuthenticated=function(){return null!=this.uid},tT.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},tT.prototype.isEqual=function(t){return t.uid===this.uid},tT.UNAUTHENTICATED=new tT(null),tT.GOOGLE_CREDENTIALS=new tT("google-credentials-uid"),tT.FIRST_PARTY=new tT("first-party-uid"),tT);function tT(t){this.uid=t}var eT="SharedClientState",nT="firestore_clients",rT="firestore_mutations",iT="firestore_targets",oT=(aT.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Pd(r.error.code,r.error.message)),i?new aT(t,e,r.state,o):(Sd(eT,"Failed to parse mutation state for ID '"+e+"': "+n),null)},aT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},aT);function aT(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Nd(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var sT=(uT.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Pd(n.error.code,n.error.message)),r?new uT(t,n.state,i):(Sd(eT,"Failed to parse target state for ID '"+t+"': "+e),null)},uT.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},uT);function uT(t,e,n){this.targetId=t,this.state=e,Nd(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var cT=(hT.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=wm(),o=0;r&&o<n.activeTargetIds.length;++o)r=Lw(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new hT(t,i):(Sd(eT,"Failed to parse client data for instance '"+t+"': "+e),null)},hT);function hT(t,e){this.clientId=t,this.activeTargetIds=e}var lT=(fT.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in $w&&"string"==typeof e.clientId?new fT(e.clientId,$w[e.onlineState]):(Sd(eT,"Failed to parse online state: "+t),null)},fT);function fT(t,e){this.clientId=t,this.onlineState=e}var pT=(dT.prototype.addQueryTarget=function(t){Nd(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},dT.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},dT.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},dT);function dT(){this.activeTargetIds=wm()}var yT=(mT.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},mT.prototype.start=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return si(this,function(t){switch(t.label){case 0:return Nd(!this.started,"WebStorageSharedClientState already started"),Nd(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Nd(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=cT.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},mT.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},mT.prototype.getAllActiveQueryTargets=function(){var n=wm();return qd(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},mT.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},mT.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},mT.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},mT.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=sT.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},mT.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},mT.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},mT.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},mT.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},mT.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},mT.prototype.setOnlineState=function(t){this.persistOnlineState(t)},mT.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},mT.prototype.getItem=function(t){var e=this.storage.getItem(t);return Td(eT,"READ",t,e),e},mT.prototype.setItem=function(t,e){Td(eT,"SET",t,e),this.storage.setItem(t,e)},mT.prototype.removeItem=function(t){Td(eT,"REMOVE",t),this.storage.removeItem(t)},mT.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Td(eT,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Sd("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Nd(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=by.INVALID;if(null!=t)try{var n=JSON.parse(t);Nd("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Sd(eT,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==by.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(mT.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),mT.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},mT.prototype.persistMutationState=function(t,e,n){var r=new oT(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},mT.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},mT.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:$w[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},mT.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new sT(t,e,n);this.setItem(r,i.toWebStorageJSON())},mT.prototype.toWebStorageClientStateKey=function(t){return Nd(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),nT+"_"+this.persistenceKey+"_"+t},mT.prototype.toWebStorageQueryTargetMetadataKey=function(t){return iT+"_"+this.persistenceKey+"_"+t},mT.prototype.toWebStorageMutationBatchKey=function(t){var e=rT+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},mT.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},mT.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Nd(null!==n,"Cannot parse client state key '"+t+"'"),cT.fromWebStorageEntry(n,e)},mT.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Nd(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return oT.fromWebStorageEntry(new ZE(i),r,e)},mT.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Nd(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return sT.fromWebStorageEntry(r,e)},mT.prototype.fromWebStorageOnlineState=function(t){return lT.fromWebStorageEntry(t)},mT.prototype.handleMutationBatchEvent=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return e.user.uid!==this.currentUser.uid?(Td(eT,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},mT.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},mT.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},mT.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},mT);function mT(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!mT.isAvailable(this.platform))throw new Pd(Od.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new pT,this.clientStateKeyRe=new RegExp("^"+nT+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+rT+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+iT+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var vT=(gT.prototype.addPendingMutation=function(t){},gT.prototype.updateMutationState=function(t,e,n){},gT.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},gT.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},gT.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},gT.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},gT.prototype.clearQueryState=function(t){delete this.queryState[t]},gT.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},gT.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},gT.prototype.start=function(){return this.localState=new pT,Promise.resolve()},gT.prototype.handleUserChange=function(t,e,n){},gT.prototype.setOnlineState=function(t){},gT.prototype.shutdown=function(){},gT.prototype.writeSequenceNumber=function(t){},gT);function gT(){this.localState=new pT,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var bT="FirestoreClient",wT=(_T.prototype.lruParams=function(){return Sg.withCacheSize(this.cacheSizeBytes)},_T);function _T(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var ET=function(){},TT=(ST.prototype.start=function(t){var n=this;this.verifyNotShutdown();var r=new My,i=new My,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},ST.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},ST.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof wT?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},ST.prototype.canFallback=function(t){return t instanceof Pd?t.code===Od.FAILED_PRECONDITION||t.code===Od.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},ST.prototype.verifyNotShutdown=function(){if(this._clientShutdown)throw new Pd(Od.FAILED_PRECONDITION,"The client has already been shutdown.")},ST.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=Lg.buildStoragePrefix(this.databaseInfo),a=new ME(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ai(t,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!yT.isAvailable(this.platform))throw new Pd(Od.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=i.lruParams(),i.synchronizeTabs?(this.sharedClientState=new yT(this.asyncQueue,this.platform,o,this.clientId,r),[4,Lg.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return e=t.sent(),[3,4];case 2:return this.sharedClientState=new vT,[4,Lg.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n)];case 3:e=t.sent(),t.label=4;case 4:return[2,(this.persistence=e).referenceDelegate.garbageCollector]}})})})},ST.prototype.startMemoryPersistence=function(){return this.persistence=Sw.createEagerPersistence(this.clientId),this.sharedClientState=new vT,Promise.resolve(null)},ST.prototype.initializeRest=function(u,c){var t=this;return Td(bT,"Initializing. user=",u.uid),this.platform.loadConnection(this.databaseInfo).then(function(s){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a=this;return si(this,function(t){switch(t.label){case 0:return this.localStore=new pw(this.persistence,u),c&&(this.lruScheduler=new Cg(c,this.asyncQueue,this.localStore)),e=this.platform.newConnectivityMonitor(),n=this.platform.newSerializer(this.databaseInfo.databaseId),r=new Xw(this.asyncQueue,s,this.credentials,n),i=function(t){return a.syncEngine.applyOnlineStateChange(t,t_.RemoteStore)},o=function(t){return a.syncEngine.applyOnlineStateChange(t,t_.SharedClientState)},this.remoteStore=new L_(this.localStore,r,this.asyncQueue,i,e),this.syncEngine=new JE(this.localStore,this.remoteStore,this.sharedClientState,u),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new UE(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ai(a,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return t.sent(),[2]}})})})},ST.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Td(bT,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},ST.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},ST.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueue(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this._clientShutdown?[3,4]:(this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()]);case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:t.sent(),this.credentials.removeChangeListener(),this._clientShutdown=!0,t.label=4;case 4:return[2]}})})})},ST.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new VE(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},ST.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},ST.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof av)return t;if(t instanceof cv)return null;throw new Pd(Od.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},ST.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=gm(),n=new HE(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},ST.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new My;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},ST.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(ST.prototype,"clientShutdown",{get:function(){return this._clientShutdown},enumerable:!0,configurable:!0}),ST.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},ST);function ST(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=oy.newId(),this._clientShutdown=!1}var IT=(CT.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},CT.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},CT.prototype.mute=function(){this.muted=!0},CT.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},CT);function CT(t){this.observer=t,this.muted=!1}var NT=(AT.documentId=function(){return AT._DOCUMENT_ID},AT.prototype.isEqual=function(t){if(!(t instanceof AT))throw ny("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},AT._DOCUMENT_ID=new AT(ky.keyField().canonicalString()),AT);function AT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+iy(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Qd("FieldPath","string",n,t[n]),0===t[n].length)throw new Pd(Od.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ky(t)}var kT=new RegExp("[~\\*/\\[\\]]");var DT=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},RT=(OT.prototype.getToken=function(){return Promise.resolve(null)},OT.prototype.invalidateToken=function(){},OT.prototype.setChangeListener=function(t){Nd(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(ZE.UNAUTHENTICATED)},OT.prototype.removeChangeListener=function(){Nd(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},OT);function OT(){this.changeListener=null}var PT=(xT.prototype.getToken=function(){var e=this;Nd(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Pd(Od.ABORTED,"getToken aborted due to token change.");return t?(Nd("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new DT(t.accessToken,e.currentUser)):null})},xT.prototype.invalidateToken=function(){this.forceRefresh=!0},xT.prototype.setChangeListener=function(t){Nd(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},xT.prototype.removeChangeListener=function(){Nd(null!=this.tokenListener,"removeChangeListener() called twice"),Nd(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},xT.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Nd(null===t||"string"==typeof t,"Received invalid UID: "+t),new ZE(t)},xT);function xT(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var MT=(Object.defineProperty(LT.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),LT);function LT(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=ZE.FIRST_PARTY}var FT=(UT.prototype.getToken=function(){return Promise.resolve(new MT(this.gapi,this.sessionIndex))},UT.prototype.setChangeListener=function(t){t(ZE.FIRST_PARTY)},UT.prototype.removeChangeListener=function(){},UT.prototype.invalidateToken=function(){},UT);function UT(t,e){this.gapi=t,this.sessionIndex=e}function qT(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var VT=(BT.delete=function(){return Bd("FieldValue.delete",arguments),WT.instance},BT.serverTimestamp=function(){return Bd("FieldValue.serverTimestamp",arguments),HT.instance},BT.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Wd("FieldValue.arrayUnion",arguments,1),new YT(t)},BT.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Wd("FieldValue.arrayRemove",arguments,1),new $T(t)},BT.increment=function(t){return Qd("FieldValue.increment","number",1,t),jd("FieldValue.increment",arguments,1),new eS(t)},BT.prototype.isEqual=function(t){return this===t},BT);function BT(t){this._methodName=t}var jT,WT=(ii(KT,jT=VT),KT.instance=new KT,KT);function KT(){return jT.call(this,"FieldValue.delete")||this}var QT,HT=(ii(GT,QT=VT),GT.instance=new GT,GT);function GT(){return QT.call(this,"FieldValue.serverTimestamp")||this}var zT,YT=(ii(XT,zT=VT),XT);function XT(t){var e=zT.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var JT,$T=(ii(ZT,JT=VT),ZT);function ZT(t){var e=JT.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var tS,eS=(ii(nS,tS=VT),nS);function nS(t){var e=tS.call(this,"FieldValue.increment")||this;return e._operand=t,e}var rS=Md(VT,"Use FieldValue.<field>() instead."),iS=/^__.*__$/,oS=(aS.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Zb(t,this.data,this.fieldMask,e)):n.push(new Xb(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new nw(t,this.fieldTransforms)),n},aS);function aS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var sS,uS,cS=(hS.prototype.toMutations=function(t,e){var n=[new Zb(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new nw(t,this.fieldTransforms)),n},hS);function hS(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function lS(t){switch(t){case sS.Set:case sS.MergeSet:case sS.Update:return!0;case sS.Argument:return!1;default:throw Cd("Unexpected case for UserDataSource: "+t)}}(uS=sS=sS||{})[uS.Set=0]="Set",uS[uS.Update=1]="Update",uS[uS.MergeSet=2]="MergeSet",uS[uS.Argument=3]="Argument";var fS=(pS.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new pS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},pS.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new pS(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},pS.prototype.childContextForArray=function(t){return new pS(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},pS.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Pd(Od.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},pS.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},pS.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},pS.prototype.validatePathSegment=function(t){if(lS(this.dataSource)&&iS.test(t))throw this.createError("Document fields cannot begin and end with __")},pS);function pS(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var dS=function(t,e){this.databaseId=t,this.key=e},yS=(mS.prototype.parseSetData=function(t,e){var n=new fS(sS.Set,t,ky.EMPTY_PATH);gS("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new oS(r,null,n.fieldTransforms)},mS.prototype.parseMergeData=function(t,e,n){var r=new fS(sS.MergeSet,t,ky.EMPTY_PATH);gS("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new am(ky.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof NT)l=h._internalPath;else{if("string"!=typeof h)throw Cd("Expected stringOrFieldPath to be a string or a FieldPath");l=wS(t,h)}if(!r.contains(l))throw new Pd(Od.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Ub.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Ub.fromArray(r.fieldMask),o=r.fieldTransforms;return new oS(a,i,o)},mS.prototype.parseUpdateData=function(o,t){var a=this,s=new fS(sS.Update,o,ky.EMPTY_PATH);gS("Data must be an object, but it was:",s,t);var u=new am(ky.comparator),c=Pb.EMPTY;qd(t,function(t,e){var n=wS(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof WT)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=Ub.fromSet(u);return new cS(c,e,s.fieldTransforms)},mS.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new fS(sS.Update,t,ky.EMPTY_PATH),o=[bS(t,e)],a=[n];if(r.length%2!=0)throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(bS(t,r[s])),a.push(r[s+1]);var u=new am(ky.comparator),c=Pb.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof WT)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Ub.fromSet(u);return new cS(c,d,i.fieldTransforms)},mS.prototype.parseQueryValue=function(t,e){var n=new fS(sS.Argument,t,ky.EMPTY_PATH),r=this.parseData(e,n);return Nd(null!=r,"Parsed data should not be null."),Nd(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},mS.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=_S(t);throw e.createError(n)}},mS.prototype.parseData=function(t,e){if(vS(t=this.runPreConverter(t,e)))return gS("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof VT)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},mS.prototype.parseObject=function(t,r){var i=this,o=new $y(sy);return Vd(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):qd(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new Pb(o)},mS.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Zg.INSTANCE),n.push(s),r++}return new Lb(n)},mS.prototype.parseSentinelFieldValue=function(t,e){if(!lS(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof WT){if(e.dataSource!==sS.MergeSet)throw e.dataSource===sS.Update?(Nd(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof HT)e.fieldTransforms.push(new Vb(e.path,vE.instance));else if(t instanceof YT){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new bE(n);e.fieldTransforms.push(new Vb(e.path,r))}else if(t instanceof $T){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new _E(n);e.fieldTransforms.push(new Vb(e.path,i))}else if(t instanceof eS){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new TE(o);e.fieldTransforms.push(new Vb(e.path,a))}else Cd("Unknown FieldValue type: "+t)},mS.prototype.parseScalarValue=function(t,e){if(null===t)return Zg.INSTANCE;if("number"==typeof t)return Lw(t)?new cb(t):new fb(t);if("boolean"==typeof t)return nb.of(t);if("string"==typeof t)return new yb(t);if(t instanceof Date)return new gb(zy.fromDate(t));if(t instanceof zy)return new gb(new zy(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof U_)return new Db(t);if(t instanceof fy)return new Sb(t);if(t instanceof dS)return new Nb(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Zd(t))},mS.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new fS(sS.Argument,r,ky.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},mS);function mS(t){this.preConverter=t}function vS(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof zy||t instanceof U_||t instanceof fy||t instanceof dS||t instanceof VT)}function gS(t,e,n){if(!vS(n)||!$d(n)){var r=Zd(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function bS(t,e){if(e instanceof NT)return e._internalPath;if("string"==typeof e)return wS(t,e);throw new Pd(Od.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function wS(e,t){try{return function(e){if(0<=e.search(kT))throw new Pd(Od.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(NT.bind.apply(NT,[void 0].concat(e.split("."))))}catch(t){throw new Pd(Od.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=_S(t);throw new Pd(Od.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function _S(t){return t instanceof Error?t.message:t.toString()}var ES=Sg.COLLECTION_DISABLED,TS=(SS.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},SS);function SS(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Pd(Od.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Gd("settings","non-empty string","host",t.host),this.host=t.host,zd("settings","boolean","ssl",t.ssl),this.ssl=Fd(t.ssl,!0);if(ey("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),zd("settings","object","credentials",t.credentials),this.credentials=t.credentials,zd("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Sd("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Sd("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Fd(t.timestampsInSnapshots,!0),zd("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Sg.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==ES&&t.cacheSizeBytes<Sg.MINIMUM_CACHE_SIZE_BYTES)throw new Pd(Od.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Sg.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}zd("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var IS=function(){},CS=(NS.prototype.settings=function(t){if(jd("Firestore.settings",arguments,1),Qd("Firestore.settings","object",1,t),Ld(t,"persistence"))throw new Pd(Od.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new TS(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new Pd(Od.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._config.settings=e).credentials&&(this._config.credentials=function(t){if(!t)return new RT;switch(t.type){case"gapi":var e=t.client;return Nd(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new FT(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Pd(Od.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},NS.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},NS.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},NS.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Pd(Od.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Sd("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=Fd(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new wT(this._config.settings.cacheSizeBytes,e))},NS.prototype.clearPersistence=function(){var t=this,n=Lg.buildStoragePrefix(this.makeDatabaseInfo()),r=new My;return this._queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new Pd(Od.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Lg.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},NS.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new ET),this._firestoreClient},NS.prototype.makeDatabaseInfo=function(){return new yy(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},NS.prototype.configureClient=function(t){var r=this;Nd(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Nd(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._dataConverter=new yS(function(t){if(t instanceof OS){var e=r._config.databaseId,n=t.firestore._config.databaseId;if(!n.isEqual(e))throw new Pd(Od.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new dS(r._config.databaseId,t._key)}return t}),this._firestoreClient=new TT(Ad.getPlatform(),e,this._config.credentials,this._queue),this._firestoreClient.start(t)},NS.databaseIdFromApp=function(t){var e=t.options;if(!Ld(e,"projectId"))throw new Pd(Od.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Pd(Od.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new vy(n)},Object.defineProperty(NS.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new Pd(Od.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),NS.prototype.collection=function(t){return jd("Firestore.collection",arguments,1),Qd("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new HS(Iy.fromString(t),this)},NS.prototype.doc=function(t){return jd("Firestore.doc",arguments,1),Qd("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),OS.forPath(Iy.fromString(t),this)},NS.prototype.collectionGroup=function(t){if(jd("Firestore.collectionGroup",arguments,1),Qd("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Pd(Od.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new BS(new V_(Iy.EMPTY_PATH,t),this)},NS.prototype.runTransaction=function(e){var n=this;return jd("Firestore.runTransaction",arguments,1),Qd("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new AS(n,t))})},NS.prototype.batch=function(){return this.ensureClientConfigured(),new DS(this)},Object.defineProperty(NS,"logLevel",{get:function(){switch(_d()){case ld.DEBUG:return"debug";case ld.ERROR:return"error";case ld.SILENT:return"silent";default:return Cd("Unknown log level: "+_d())}},enumerable:!0,configurable:!0}),NS.setLogLevel=function(t){switch(jd("Firestore.setLogLevel",arguments,1),Qd("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ed(ld.DEBUG);break;case"error":Ed(ld.ERROR);break;case"silent":Ed(ld.SILENT);break;default:throw new Pd(Od.INVALID_ARGUMENT,"Invalid log level: "+t)}},NS.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},NS);function NS(t){var e=this;this._queue=new Uy,this.INTERNAL={delete:function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}};var n=new IS;if("object"==typeof t.options){var r=t;n.firebaseApp=r,n.databaseId=NS.databaseIdFromApp(r),n.persistenceKey=n.firebaseApp.name,n.credentials=new PT(r)}else{var i=t;if(!i.projectId)throw new Pd(Od.INVALID_ARGUMENT,"Must provide projectId");n.databaseId=new vy(i.projectId,i.database),n.persistenceKey="[DEFAULT]",n.credentials=new RT}n.settings=new TS({}),this._config=n,this._databaseId=n.databaseId}var AS=(kS.prototype.get=function(t){var n=this;jd("Transaction.get",arguments,1);var r=JS("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Cd("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof cv)return new LS(n._firestore,r._key,null,!1,!1);if(e instanceof av)return new LS(n._firestore,r._key,e,!1,!1);throw Cd("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},kS.prototype.set=function(t,e,n){Kd("Transaction.set",arguments,2,3);var r=JS("Transaction.set",t,this._firestore),i=(n=zS("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},kS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof NT?(Wd("Transaction.update",arguments,3),r=JS("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(jd("Transaction.update",arguments,2),r=JS("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},kS.prototype.delete=function(t){jd("Transaction.delete",arguments,1);var e=JS("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},kS);function kS(t,e){this._firestore=t,this._transaction=e}var DS=(RS.prototype.set=function(t,e,n){Kd("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=JS("WriteBatch.set",t,this._firestore),i=(n=zS("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Qb.NONE)),this},RS.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof NT?(Wd("WriteBatch.update",arguments,3),r=JS("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(jd("WriteBatch.update",arguments,2),r=JS("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Qb.exists(!0))),this},RS.prototype.delete=function(t){jd("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=JS("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new ow(e._key,Qb.NONE)),this},RS.prototype.commit=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},RS.prototype.verifyNotCommitted=function(){if(this._committed)throw new Pd(Od.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},RS);function RS(t){this._firestore=t,this._mutations=[],this._committed=!1}var OS=(PS.forPath=function(t,e){if(t.length%2!=0)throw new Pd(Od.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new PS(new Ry(t),e)},Object.defineProperty(PS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(PS.prototype,"parent",{get:function(){return new HS(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(PS.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),PS.prototype.collection=function(t){if(jd("DocumentReference.collection",arguments,1),Qd("DocumentReference.collection","non-empty string",1,t),!t)throw new Pd(Od.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Iy.fromString(t);return new HS(this._key.path.child(e),this.firestore)},PS.prototype.isEqual=function(t){if(!(t instanceof PS))throw ny("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},PS.prototype.set=function(t,e){Kd("DocumentReference.set",arguments,1,2);var n=(e=zS("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Qb.NONE))},PS.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof NT?(Wd("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(jd("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Qb.exists(!0)))},PS.prototype.delete=function(){return jd("DocumentReference.delete",arguments,0),this._firestoreClient.write([new ow(this._key,Qb.NONE)])},PS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Kd("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||qT(t[i])||(ey("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),zd("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=qT(t[i])?t[i]:(Qd("DocumentReference.onSnapshot","function",i,t[i]),Hd("DocumentReference.onSnapshot","function",i+1,t[i+1]),Hd("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},PS.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new IT({next:function(t){if(n.next){Nd(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new LS(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(V_.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},PS.prototype.get=function(n){var r=this;return Kd("DocumentReference.get",arguments,0,1),XS("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new LS(r.firestore,r._key,t,!0,t instanceof av&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},PS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Pd(Od.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Pd(Od.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},PS);function PS(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var xS=(MS.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},MS);function MS(t,e){this.hasPendingWrites=t,this.fromCache=e}var LS=(FS.prototype.data=function(t){return Kd("DocumentSnapshot.data",arguments,0,1),t=YS("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,zg.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},FS.prototype.get=function(t,e){if(Kd("DocumentSnapshot.get",arguments,1,2),e=YS("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(bS("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,zg.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(FS.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"ref",{get:function(){return new OS(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"metadata",{get:function(){return new xS(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),FS.prototype.isEqual=function(t){if(!(t instanceof FS))throw ny("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},FS.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},FS.prototype.convertValue=function(t,e){if(t instanceof Pb)return this.convertObject(t,e);if(t instanceof Lb)return this.convertArray(t,e);if(t instanceof Nb){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Sd("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new OS(n,this._firestore)}return t.value(e)},FS.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},FS);function FS(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var US,qS=(ii(VS,US=LS),VS.prototype.data=function(t){var e=US.prototype.data.call(this,t);return Nd("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},VS);function VS(){return null!==US&&US.apply(this,arguments)||this}var BS=(jS.prototype.where=function(t,e,n){jd("Query.where",arguments,3),ty("Query.where",3,n),"in"!==e&&"array-contains-any"!==e&&function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Pd(Od.INVALID_ARGUMENT,"Invalid value "+Zd(r)+" provided to function "+t+"() for its "+ry(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,e);var r,i=bS("Query.where",t),o=W_.fromString(e);if(i.isKeyField()){if(o===W_.ARRAY_CONTAINS||o===W_.ARRAY_CONTAINS_ANY)throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===W_.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Lb(a)}else r=this.parseDocumentIdValue(n)}else o!==W_.IN&&o!==W_.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var h=H_.create(i,o,r);return this.validateNewFilter(h),new jS(this._query.addFilter(h),this.firestore)},jS.prototype.orderBy=function(t,e){var n;if(Kd("Query.orderBy",arguments,1,2),Hd("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=cE.ASCENDING;else{if("desc"!==e)throw new Pd(Od.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=cE.DESCENDING}if(null!==this._query.startAt)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=bS("Query.orderBy",t),i=new pE(r,n);return this.validateNewOrderBy(i),new jS(this._query.addOrderBy(i),this.firestore)},jS.prototype.limit=function(t){if(jd("Query.limit",arguments,1),Qd("Query.limit","number",1,t),t<=0)throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new jS(this._query.withLimit(t),this.firestore)},jS.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Wd("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new jS(this._query.withStartAt(r),this.firestore)},jS.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Wd("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new jS(this._query.withStartAt(r),this.firestore)},jS.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Wd("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new jS(this._query.withEndAt(r),this.firestore)},jS.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Wd("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new jS(this._query.withEndAt(r),this.firestore)},jS.prototype.isEqual=function(t){if(!(t instanceof jS))throw ny("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},jS.prototype.boundFromDocOrFields=function(t,e,n,r){if(ty(t,1,e),e instanceof LS){if(0<n.length)throw new Pd(Od.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Pd(Od.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},jS.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Nb(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof _b)throw new Pd(Od.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new lE(r,n)},jS.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Pd(Od.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Iy.fromString(a));if(!Ry.isDocumentKey(s))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Ry(s);i.push(new Nb(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new lE(i,n)},jS.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Kd("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||qT(t[i])||(ey("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),zd("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=qT(t[i])?t[i]:(Qd("Query.onSnapshot","function",i,t[i]),Hd("Query.onSnapshot","function",i+1,t[i+1]),Hd("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},jS.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new IT({next:function(t){e.next&&e.next(new WS(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},jS.prototype.get=function(n){var r=this;return Kd("Query.get",arguments,0,1),XS("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new WS(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},jS.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Pd(Od.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},jS.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Iy.fromString(t));if(!Ry.isDocumentKey(e))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Nb(this.firestore._databaseId,new Ry(e))}if(t instanceof OS){var n=t;return new Nb(this.firestore._databaseId,n._key)}throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Zd(t)+".")},jS.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Pd(Od.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},jS.prototype.validateNewFilter=function(t){if(t instanceof H_){var e=[W_.ARRAY_CONTAINS,W_.ARRAY_CONTAINS_ANY],n=[W_.IN,W_.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Pd(Od.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Pd(Od.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},jS.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},jS.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Pd(Od.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},jS);function jS(t,e){this._query=t,this.firestore=e}var WS=(Object.defineProperty(KS.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(KS.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(KS.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),KS.prototype.forEach=function(e,n){var r=this;Kd("QuerySnapshot.forEach",arguments,1,2),Qd("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(KS.prototype,"query",{get:function(){return new BS(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),KS.prototype.docChanges=function(t){t&&(ey("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),zd("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Pd(Od.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new qS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Nd(t.type===h_.Added,"Invalid event type for first snapshot"),Nd(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==h_.Metadata}).map(function(t){var e=new qS(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==h_.Added&&(Nd(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==h_.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case h_.Added:return"added";case h_.Modified:case h_.Metadata:return"modified";case h_.Removed:return"removed";default:return Cd("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},KS.prototype.isEqual=function(t){if(!(t instanceof KS))throw ny("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},KS.prototype.convertToDocumentImpl=function(t){return new qS(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},KS);function KS(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new xS(n.hasPendingWrites,n.fromCache)}["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(WS.prototype.docChanges,t,{get:function(){return function(){throw new Pd(Od.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var QS,HS=(ii(GS,QS=BS),Object.defineProperty(GS.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new OS(new Ry(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(GS.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),GS.prototype.doc=function(t){if(Kd("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=oy.newId()),Qd("CollectionReference.doc","non-empty string",1,t),""===t)throw new Pd(Od.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Iy.fromString(t);return OS.forPath(this._query.path.child(e),this.firestore)},GS.prototype.add=function(t){jd("CollectionReference.add",arguments,1),Qd("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},GS);function GS(t,e){var n=QS.call(this,V_.atPath(t),e)||this;if(t.length%2!=1)throw new Pd(Od.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function zS(t,e){if(void 0===e)return{merge:!1};if(ey(t,e,["merge","mergeFields"]),zd(t,"boolean","merge",e.merge),Yd(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof NT}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Pd(Od.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function YS(t,e){return void 0===e?{}:(ey(t,e,["serverTimestamps"]),Xd(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function XS(t,e){Hd(t,"object",1,e),e&&(ey(t,e,["source"]),Xd(t,0,"source",e.source,["default","server","cache"]))}function JS(t,e,n){if(e instanceof OS){if(e.firestore!==n)throw new Pd(Od.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw ny(t,"DocumentReference",1,e)}var $S=Md(CS,"Use firebase.firestore() instead."),ZS=Md(AS,"Use firebase.firestore().runTransaction() instead."),tI=Md(DS,"Use firebase.firestore().batch() instead."),eI=Md(OS,"Use firebase.firestore().doc() instead."),nI=Md(LS),rI=Md(qS),iI=Md(BS),oI=Md(WS),aI=Md(HS,"Use firebase.firestore().collection() instead."),sI={Firestore:$S,GeoPoint:U_,Timestamp:zy,Blob:dy,Transaction:ZS,WriteBatch:tI,DocumentReference:eI,DocumentSnapshot:nI,Query:iI,QueryDocumentSnapshot:rI,QuerySnapshot:oI,CollectionReference:aI,FieldPath:NT,FieldValue:rS,setLogLevel:CS.setLogLevel,CACHE_SIZE_UNLIMITED:ES};function uI(t){t.INTERNAL.registerService("firestore",function(t){return new CS(t)},function(t){Nd(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(sI))}var cI=(hI.prototype.addCallback=function(t){},hI.prototype.shutdown=function(){},hI);function hI(){}var lI="ConnectivityMonitor",fI=(pI.prototype.addCallback=function(t){this.callbacks.push(t)},pI.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},pI.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},pI.prototype.onNetworkAvailable=function(){Td(lI,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},pI.prototype.onNetworkUnavailable=function(){Td(lI,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},pI.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},pI);function pI(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var dI=(yI.prototype.onOpen=function(t){Nd(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},yI.prototype.onClose=function(t){Nd(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},yI.prototype.onMessage=function(t){Nd(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},yI.prototype.close=function(){this.closeFn()},yI.prototype.send=function(t){this.sendFn(t)},yI.prototype.callOnOpen=function(){Nd(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},yI.prototype.callOnClose=function(t){Nd(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},yI.prototype.callOnMessage=function(t){Nd(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},yI);function yI(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var mI="Connection",vI={BatchGetDocuments:"batchGet",Commit:"commit"},gI="gl-js/ fire/"+bd,bI=(wI.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=gI},wI.prototype.invokeRPC=function(s,n,r){var u=this,c=this.makeUrl(s);return new Promise(function(i,o){var a=new gd;a.listenOnce(md.COMPLETE,function(){try{switch(a.getLastErrorCode()){case yd.NO_ERROR:var t=a.getResponseJson();Td(mI,"XHR received:",JSON.stringify(t)),i(t);break;case yd.TIMEOUT:Td(mI,'RPC "'+s+'" timed out'),o(new Pd(Od.DEADLINE_EXCEEDED,"Request time out"));break;case yd.HTTP_ERROR:var e=a.getStatus();if(Td(mI,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Od).indexOf(e)?e:Od.UNKNOWN}(n.status);o(new Pd(r,n.message))}else o(new Pd(Od.UNKNOWN,"Server responded with status "+a.getStatus()))}else Td(mI,'RPC "'+s+'" failed'),o(new Pd(Od.UNAVAILABLE,"Connection failed."));break;default:Cd('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Td(mI,'RPC "'+s+'" completed.')}});var t=JSON.stringify(n);Td(mI,"XHR sending: ",c+" "+t);var e={"Content-Type":"text/plain"};u.modifyHeadersForRequest(e,r),a.send(c,"POST",t,e,15)})},wI.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},wI.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=dd(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ti()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Td(mI,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new dI({sendFn:function(t){c?Td(mI,"Not sending because WebChannel is closed:",t):(u||(Td(mI,"Opening WebChannel transport."),s.open(),u=!0),Td(mI,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(vd.EventType.OPEN,function(){c||Td(mI,"WebChannel transport opened.")}),a(vd.EventType.CLOSE,function(){c||(c=!0,Td(mI,"WebChannel transport closed"),h.callOnClose())}),a(vd.EventType.ERROR,function(t){c||(c=!0,Td(mI,"WebChannel transport errored:",t),h.callOnClose(new Pd(Od.UNAVAILABLE,"The operation could not be completed")))}),a(vd.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Nd(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Td(mI,"WebChannel received error:",r);var i=r.status,o=function(t){var e=i_[t];if(void 0!==e)return c_(e)}(i),a=r.message;void 0===o&&(o=Od.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Pd(o,a)),s.close()}else Td(mI,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},wI.prototype.makeUrl=function(t){var e=vI[t];Nd(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},wI);function wI(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var _I=(Object.defineProperty(EI.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(EI.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),EI.prototype.loadConnection=function(t){return Promise.resolve(new bI(t))},EI.prototype.newConnectivityMonitor=function(){return fI.isAvailable()?new fI:new cI},EI.prototype.newSerializer=function(t){return new ME(t,{useProto3Json:!0})},EI.prototype.formatJSON=function(t){return JSON.stringify(t)},EI.prototype.atob=function(t){return atob(t)},EI.prototype.btoa=function(t){return btoa(t)},EI);function EI(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Ad.setPlatform(new _I),uI(il);var TI,SI={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},II=(ii(CI,TI=Error),CI);function CI(t,e,n){var r=TI.call(this,e)||this;return Object.setPrototypeOf(r,CI.prototype),r.code=t,r.details=n,r}var NI=(AI.prototype.getAuthToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},AI.prototype.getInstanceIdToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},AI.prototype.getContext=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},AI);function AI(t){this.app=t}function kI(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var DI=(RI.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return kI(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},RI.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?kI(t,function(t){return e.decode(t)}):t},RI);function RI(){}var OI=(Object.defineProperty(PI.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),PI.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},PI.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},PI.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},PI.prototype.postJSON=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},PI.prototype.call=function(c,h,l){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new II("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new II("cancelled","Firebase Functions instance was deleted.");if(s=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!SI[s])return new II("internal","internal");r=SI[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new II(r,i,o)}(a.status,a.json,this.serializer))throw s;if(!a.json)throw new II("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new II("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},PI);function PI(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new DI,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new NI(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var xI,MI;function LI(t,e,n){return new OI(t,n)}xI={Functions:OI},il.INTERNAL.registerService("functions",LI,xI,void 0,!0);var FI,UI,qI,VI,BI=((MI={})["only-available-in-window"]="This method is available in a Window context.",MI["only-available-in-sw"]="This method is available in a service worker context.",MI["should-be-overriden"]="This method should be overriden by extended classes.",MI["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",MI["permission-default"]="The required permissions were not granted and dismissed instead.",MI["permission-blocked"]="The required permissions were not granted and blocked instead.",MI["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",MI["notifications-blocked"]="Notifications have been blocked.",MI["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",MI["sw-registration-expected"]="A service worker registration was the expected input.",MI["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",MI["invalid-saved-token"]="Unable to access details of the saved token.",MI["sw-reg-redundant"]="The service worker being used for push was made redundant.",MI["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",MI["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",MI["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",MI["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",MI["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",MI["token-update-no-token"]="FCM returned no token when updating the user to push.",MI["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",MI["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",MI["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",MI["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",MI["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",MI["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",MI["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",MI["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",MI["failed-to-delete-token"]="Unable to delete the currently saved token.",MI["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",MI["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",MI["bad-scope"]="The service worker scope must be a string with at least one character.",MI["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",MI["bad-subscription"]="The subscription must be a valid PushSubscription.",MI["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",MI["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",MI["failed-delete-vapid-key"]="The VAPID key could not be deleted.",MI["invalid-public-vapid-key"]="The public VAPID key must be a string.",MI["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",MI["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",MI),jI=new Ai("messaging","Messaging",BI),WI=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),KI="https://fcm.googleapis.com";function QI(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function HI(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,hi(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(UI=FI=FI||{}).TYPE_OF_MSG="firebase-messaging-msg-type",UI.DATA="firebase-messaging-msg-data",(VI=qI=qI||{}).PUSH_MSG_RECEIVED="push-msg-received",VI.NOTIFICATION_CLICKED="notification-clicked";var GI=(zI.prototype.getToken=function(h,l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=HI(l.getKey("p256dh")),n=HI(l.getKey("auth")),r="authorized_entity="+h+"&endpoint="+l.endpoint+"&encryption_key="+e+"&encryption_auth="+n,QI(f.buffer,WI.buffer)||(i=HI(f),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),jI.create("token-subscribe-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,jI.create("token-subscribe-failed",{errorInfo:c});if(!s.token)throw jI.create("token-subscribe-no-token");if(!s.pushSet)throw jI.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},zI.prototype.updateToken=function(h,l,f,p,d){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:e=HI(p.getKey("p256dh")),n=HI(p.getKey("auth")),r="push_set="+f+"&token="+l+"&authorized_entity="+h+"&endpoint="+p.endpoint+"&encryption_key="+e+"&encryption_auth="+n,QI(d.buffer,WI.buffer)||(i=HI(d),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw u=t.sent(),jI.create("token-update-failed",{errorInfo:u});case 5:if(s.error)throw c=s.error.message,jI.create("token-update-failed",{errorInfo:c});if(!s.token)throw jI.create("token-update-no-token");return[2,s.token]}})})},zI.prototype.deleteToken=function(s,u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:e="authorized_entity="+s+"&token="+u+"&pushSet="+c,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(KI+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,jI.create("token-unsubscribe-failed",{errorInfo:o});return[3,5];case 4:throw a=t.sent(),jI.create("token-unsubscribe-failed",{errorInfo:a});case 5:return[2]}})})},zI);function zI(){}function YI(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var XI="undefined",JI="fcm_token_object_Store";function $I(){var e=indexedDB.open(XI);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(JI)){var t=n.transaction(JI).objectStore(JI),r=new GI,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(XI)}}}(e.result)}}var ZI=(tC.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},tC.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},tC.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},tC.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},tC.prototype.closeDatabase=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},tC.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},tC.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},tC);function tC(){this.dbPromise=null}var eC,nC=(ii(rC,eC=ZI),rC.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:$I();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=oi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=YI(e.vapidKey)),"string"==typeof e.auth&&(n.auth=YI(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=YI(e.p256dh).buffer),t.update(n),t.continue()}}}},rC.prototype.getTokenDetailsFromToken=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw jI.create("bad-token");return iC({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},rC.prototype.getTokenDetailsFromSWScope=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw jI.create("bad-scope");return iC({swScope:e}),[2,this.get(e)]})})},rC.prototype.saveTokenDetails=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e.swScope)throw jI.create("bad-scope");if(!e.vapidKey)throw jI.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw jI.create("bad-subscription");if(!e.fcmSenderId)throw jI.create("bad-sender-id");if(!e.fcmToken)throw jI.create("bad-token");if(!e.fcmPushSet)throw jI.create("bad-push-set");return iC(e),[2,this.put(e)]})})},rC.prototype.deleteToken=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(jI.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw jI.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},rC);function rC(){var t=null!==eC&&eC.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}function iC(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw jI.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw jI.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw jI.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw jI.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw jI.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw jI.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw jI.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw jI.create("bad-push-set")}var oC,aC=(ii(sC,oC=ZI),sC.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},sC.prototype.getVapidFromSWScope=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw jI.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},sC.prototype.saveVapidDetails=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){if("string"!=typeof n||0===n.length)throw jI.create("bad-scope");if(null===r||65!==r.length)throw jI.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},sC.prototype.deleteVapidDetails=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw jI.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},sC);function sC(){var t=null!==oC&&oC.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var uC="messagingSenderId",cC=(hC.prototype.getToken=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw jI.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},hC.prototype.manageExistingToken=function(e,n,r,i){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!QI(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=QI(t.getKey("auth"),n.auth),o=QI(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},hC.prototype.updateToken=function(i,o,a,s){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},hC.prototype.getNewToken=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},hC.prototype.deleteToken=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},hC.prototype.deleteTokenFromDB=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},hC.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},hC.prototype.requestPermission=function(){throw jI.create("only-available-in-window")},hC.prototype.useServiceWorker=function(t){throw jI.create("only-available-in-window")},hC.prototype.usePublicVapidKey=function(t){throw jI.create("only-available-in-window")},hC.prototype.onMessage=function(t,e,n){throw jI.create("only-available-in-window")},hC.prototype.onTokenRefresh=function(t,e,n){throw jI.create("only-available-in-window")},hC.prototype.setBackgroundMessageHandler=function(t){throw jI.create("only-available-in-sw")},hC.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},hC.prototype.getNotificationPermission_=function(){return Notification.permission},hC.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},hC.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},hC.prototype.getIidModel=function(){return this.iidModel},hC);function hC(t){var e=this;if(!t.options[uC]||"string"!=typeof t.options[uC])throw jI.create("bad-sender-id");this.messagingSenderId=t.options[uC],this.tokenDetailsModel=new nC,this.vapidDetailsModel=new aC,this.iidModel=new GI,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}var lC,fC="FCM_MSG",pC=(ii(dC,lC=cC),dC.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},dC.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},dC.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},dC.prototype.onPush_=function(s){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},dC.prototype.onSubChange_=function(t){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),jI.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},dC.prototype.onNotificationClick_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[fC]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[fC]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=mC(qI.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},dC.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oi({},t.notification);return n.data=oi({},t.notification.data,((e={})[fC]=t,e)),n}},dC.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw jI.create("bg-handler-function-expected");this.bgMessageHandler=t},dC.prototype.getWindowClient_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,yC()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},dC.prototype.attemptToMessageClient_=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw jI.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},dC.prototype.hasVisibleClients_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,yC()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},dC.prototype.sendMessageToWindowClients_=function(i){return ai(this,void 0,void 0,function(){var e,n,r=this;return si(this,function(t){switch(t.label){case 0:return[4,yC()];case 1:return e=t.sent(),n=mC(qI.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},dC.prototype.getSWRegistration_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,self.registration]})})},dC.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw jI.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,WI]:[2,n]}})})},dC);function dC(t){var e=lC.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function yC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function mC(t,e){var n;return(n={})[FI.TYPE_OF_MSG]=t,n[FI.DATA]=e,n}var vC,gC,bC=(ii(wC,vC=cC),wC.prototype.getToken=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),[3,5];case 4:return t.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw jI.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,vC.prototype.getToken.call(this)]}})})},wC.prototype.requestPermission=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?jI.create("permission-blocked"):jI.create("permission-default")}})})},wC.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw jI.create("sw-registration-expected");if(null!=this.registrationToUse)throw jI.create("use-sw-before-get-token");this.registrationToUse=t},wC.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw jI.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw jI.create("use-public-key-before-get-token");var e=YI(t);if(65!==e.length)throw jI.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},wC.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},wC.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},wC.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(jI.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(jI.create("sw-reg-redundant"));else t(r);else e(jI.create("no-sw-in-reg"))})},wC.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw jI.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},wC.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,WI]})})},wC.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[FI.TYPE_OF_MSG]){var e=t.data;switch(e[FI.TYPE_OF_MSG]){case qI.PUSH_MSG_RECEIVED:case qI.NOTIFICATION_CLICKED:var n=e[FI.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},wC);function wC(t){var e=vC.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Vi(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Vi(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function _C(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}gC={isSupported:_C},il.INTERNAL.registerService("messaging",function(t){if(!_C())throw jI.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new pC(t):new bC(t)},gC);var EC="firebasestorage.googleapis.com",TC="storageBucket",SC=(IC.prototype.codeProp=function(){return this.code},IC.prototype.codeEquals=function(t){return NC(t)===this.codeProp()},IC.prototype.serverResponseProp=function(){return this.serverResponse_},IC.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(IC.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(IC.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),IC);function IC(t,e){this.code_=NC(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var CC={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function NC(t){return"storage/"+t}function AC(){return new SC(CC.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function kC(){return new SC(CC.CANCELED,"User canceled the upload/download.")}function DC(){return new SC(CC.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function RC(t,e,n){return new SC(CC.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function OC(){return new SC(CC.APP_DELETED,"The Firebase app was deleted.")}function PC(t,e){return new SC(CC.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function xC(t){throw new SC(CC.INTERNAL_ERROR,"Internal error: "+t)}var MC={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function LC(t){switch(t){case MC.RAW:case MC.BASE64:case MC.BASE64URL:case MC.DATA_URL:return;default:throw"Expected one of the event types: ["+MC.RAW+", "+MC.BASE64+", "+MC.BASE64URL+", "+MC.DATA_URL+"]."}}var FC=function(t,e){this.data=t,this.contentType=e||null};function UC(t,e){switch(t){case MC.RAW:return new FC(qC(e));case MC.BASE64:case MC.BASE64URL:return new FC(VC(t,e));case MC.DATA_URL:return new FC(function(t){var e=new BC(t);return e.base64?VC(MC.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw PC(MC.DATA_URL,"Malformed data URL.")}return qC(e)}(e.rest)}(e),function(t){return new BC(t).contentType}(e))}throw AC()}function qC(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function VC(e,t){switch(e){case MC.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw PC(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case MC.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw PC(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw PC(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var BC=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw PC(MC.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var jC,WC,KC={STATE_CHANGED:"state_changed"},QC="running",HC="pausing",GC="paused",zC="success",YC="canceling",XC="canceled",JC="error",$C={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function ZC(t){switch(t){case QC:case HC:case YC:return $C.RUNNING;case GC:return $C.PAUSED;case zC:return $C.SUCCESS;case XC:return $C.CANCELED;case JC:default:return $C.ERROR}}function tN(t){return null!=t}function eN(t){return void 0!==t}function nN(t){return"function"==typeof t}function rN(t){return"object"==typeof t}function iN(t){return"string"==typeof t||t instanceof String}function oN(t){return"number"==typeof t||t instanceof Number}function aN(t){return sN()&&t instanceof Blob}function sN(){return"undefined"!=typeof Blob}(WC=jC=jC||{})[WC.NO_ERROR=0]="NO_ERROR",WC[WC.NETWORK_ERROR=1]="NETWORK_ERROR",WC[WC.ABORT=2]="ABORT";var uN=(cN.prototype.send=function(t,e,n,r){if(this.sent_)throw xC("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),tN(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return tN(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},cN.prototype.getErrorCode=function(){if(!this.sent_)throw xC("cannot .getErrorCode() before sending");return this.errorCode_},cN.prototype.getStatus=function(){if(!this.sent_)throw xC("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},cN.prototype.getResponseText=function(){if(!this.sent_)throw xC("cannot .getResponseText() before sending");return this.xhr_.responseText},cN.prototype.abort=function(){this.xhr_.abort()},cN.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},cN.prototype.addUploadProgressListener=function(t){tN(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},cN.prototype.removeUploadProgressListener=function(t){tN(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},cN);function cN(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=jC.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=jC.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=jC.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var hN=(lN.prototype.createXhrIo=function(){return new uN},lN);function lN(){}function fN(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(sN())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var pN=(dN.prototype.size=function(){return this.size_},dN.prototype.type=function(){return this.type_},dN.prototype.slice=function(t,e){if(aN(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new dN(n)}return new dN(new Uint8Array(this.data_.buffer,t,e-t),!0)},dN.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(sN()){var n=t.map(function(t){return t instanceof dN?t.data_:t});return new dN(fN.apply(null,n))}var r=t.map(function(t){return iN(t)?UC(MC.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new dN(o,!0)},dN.prototype.uploadData=function(){return this.data_},dN);function dN(t,e){var n=0,r="";aN(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var yN=(Object.defineProperty(mN.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(mN.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),mN.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},mN.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},mN.makeFromBucketSpec=function(e){var t;try{t=mN.makeFromUrl(e)}catch(t){return new mN(e,"")}if(""===t.path)return t;throw function(t){return new SC(CC.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},mN.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=EC.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new mN(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new SC(CC.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},mN);function mN(t,e){this.bucket=t,this.path_=e}function vN(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return rN(t)&&!Array.isArray(t)}(e)?e:null}function gN(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function bN(t){return"https://"+EC+"/v0"+t}function wN(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function _N(t,e){return e}var EN=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||_N},TN=null;function SN(){if(TN)return TN;var t=[];t.push(new EN("bucket")),t.push(new EN("generation")),t.push(new EN("metageneration")),t.push(new EN("name","fullPath",!0));var e=new EN("name");e.xform=function(t,e){return function(t){return!iN(t)||t.length<2?t:gN(t)}(e)},t.push(e);var n=new EN("size");return n.xform=function(t,e){return tN(e)?Number(e):e},t.push(n),t.push(new EN("timeCreated")),t.push(new EN("updated")),t.push(new EN("md5Hash",null,!0)),t.push(new EN("cacheControl",null,!0)),t.push(new EN("contentDisposition",null,!0)),t.push(new EN("contentEncoding",null,!0)),t.push(new EN("contentLanguage",null,!0)),t.push(new EN("contentType",null,!0)),t.push(new EN("metadata","customMetadata",!0)),TN=t}function IN(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new yN(t,e);return i.makeStorageReference(n)}})}(r,t),r}function CN(t,e,n){var r=vN(e);return null===r?null:IN(t,r,n)}function NN(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function AN(t){if(!rN(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!rN(n))throw"Expected object for 'customMetadata' mapping."}else if(rN(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var kN="maxResults",DN=1e3,RN="pageToken",ON="prefixes",PN="items";function xN(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new SC(CC.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+TC+"' property when initializing the app?");if(e[ON])for(var i=0,o=e[ON];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new yN(r,a));n.prefixes.push(s)}if(e[PN])for(var u=0,c=e[PN];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new yN(r,h.name));n.items.push(s)}return n}function MN(t){if(!rN(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===kN){if(!oN(n=t[kN])||!Number.isInteger(n)||t[kN]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[kN])throw"Expected maxResults to be less than or equal to "+DN+"."}else{if(e!==RN)throw"Unknown option: "+e;if(t[RN]&&!iN(t[RN]))throw"Expected pageToken to be string."}var n}var LN=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function FN(t){if(!t)throw AC()}function UN(r,i){return function(t,e){var n=CN(r,e,i);return FN(null!==n),n}}function qN(r){return function(t,e){var n=function(t,e){var n=vN(e);return null===n?null:xN(t,n)}(r,e);return FN(null!==n),n}}function VN(r,i){return function(t,e){var n=CN(r,e,i);return FN(null!==n),function(r,t){var e=vN(t);if(null===e)return null;if(!iN(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return bN("/b/"+i(e)+"/o/"+i(n))+wN({alt:"media",token:t})})[0]}(n,e)}}function BN(r){return function(t,e){var n;return(n=401===t.getStatus()?new SC(CC.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new SC(CC.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new SC(CC.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function jN(r){var i=BN(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new SC(CC.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function WN(t,e,n){var r=bN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new LN(r,"GET",UN(t,n),i);return o.errorHandler=jN(e),o}function KN(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var QN=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function HN(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){FN(!1)}return FN(!!n&&-1!==(e||["active"]).indexOf(n)),n}function GN(t,a,e,s,n,u,r,i){var c=new QN(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new SC(CC.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw DC();var y=a.maxUploadRetryTime(),m=new LN(e,"POST",function(t,e){var n,r=HN(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?UN(a,u)(t,e):null,new QN(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=BN(t),m}var zN=function(t,e,n){if(nN(t)||tN(e)||tN(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},YN=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function XN(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new SC(CC.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?RC(o,e,t.message):RC(o,e,t)}}var JN=function(e,t){var n=this;this.validator=function(t){n.optional&&!eN(t)||e(t)},this.optional=!!t};function $N(t,e){function n(t){if(!iN(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new JN(r,e)}function ZN(t){return new JN(AN,t)}function tA(){return new JN(function(t){if(!(oN(t)&&0<=t))throw"Expected a number 0 or greater."})}function eA(e,t){return new JN(function(t){if(!(null===t||tN(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function nA(t){return new JN(function(t){if(!(null===t||nN(t)))throw"Expected a Function."},t)}function rA(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var iA=(oA.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},oA.prototype.shouldDoResumable_=function(t){return 262144<t.size()},oA.prototype.start_=function(){this.state_===QC&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},oA.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case QC:e(t);break;case YC:n.transition_(XC);break;case HC:n.transition_(GC)}})},oA.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=KN(e,r,i),s={name:a.fullPath},u=bN(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=NN(a,n),l=t.maxUploadRetryTime(),f=new LN(u,"POST",function(t){var e;HN(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){FN(!1)}return FN(iN(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=BN(e),f}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},oA.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=function(t,e,n,i){var r=t.maxUploadRetryTime(),o=new LN(n,"POST",function(t){var e=HN(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){FN(!1)}n||FN(!1);var r=Number(n);return FN(!isNaN(r)),new QN(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=BN(e),o}(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},oA.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new QN(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=GN(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(JC)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(zC)):r.completeTransitions_()},r.errorHandler_)})},oA.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},oA.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=WN(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(zC)},r.metadataErrorHandler_)})},oA.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=KN(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+NN(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=pN.getBlob(c,r,h);if(null===l)throw DC();var f={name:u.fullPath},p=bN(o),d=t.maxUploadRetryTime(),y=new LN(p,"POST",UN(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=BN(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(zC)},r.errorHandler_)})},oA.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},oA.prototype.transition_=function(t){if(this.state_!==t)switch(t){case YC:case HC:this.state_=t,null!==this.request_&&this.request_.cancel();break;case QC:var e=this.state_===GC;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case GC:this.state_=t,this.notifyObservers_();break;case XC:this.error_=kC(),this.state_=t,this.notifyObservers_();break;case JC:case zC:this.state_=t,this.notifyObservers_()}},oA.prototype.completeTransitions_=function(){switch(this.state_){case HC:this.transition_(GC);break;case YC:this.transition_(XC);break;case QC:this.start_()}},Object.defineProperty(oA.prototype,"snapshot",{get:function(){var t=ZC(this.state_);return new YN(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),oA.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=nA(!0).validator,a=eA(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(eN(t.next)||eN(t.error)||eN(t.complete)))throw"";return}catch(t){throw r}}XN("on",[$N(function(){if(t!==KC.STATE_CHANGED)throw"Expected one of the event types: ["+KC.STATE_CHANGED+"]."}),eA(s,!0),nA(!0),nA(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&XN("on",i,arguments);var r=new zN(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[eA(function(t){if(null===t)throw r;s(t)}),nA(!0),nA(!0)];return eN(e)||eN(n)||eN(o)?c(null)(e,n,o):c(h)},oA.prototype.then=function(t,e){return this.promise_.then(t,e)},oA.prototype.catch=function(t){return this.then(null,t)},oA.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},oA.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},oA.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},oA.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(ZC(this.state_)){case $C.SUCCESS:rA(this.resolve_.bind(null,this.snapshot))();break;case $C.CANCELED:case $C.ERROR:rA(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},oA.prototype.notifyObserver_=function(t){switch(ZC(this.state_)){case $C.RUNNING:case $C.PAUSED:t.next&&rA(t.next.bind(t,this.snapshot))();break;case $C.SUCCESS:t.complete&&rA(t.complete.bind(t))();break;case $C.CANCELED:case $C.ERROR:t.error&&rA(t.error.bind(t,this.error_))();break;default:t.error&&rA(t.error.bind(t,this.error_))()}},oA.prototype.resume=function(){XN("resume",[],arguments);var t=this.state_===GC||this.state_===HC;return t&&this.transition_(QC),t},oA.prototype.pause=function(){XN("pause",[],arguments);var t=this.state_===QC;return t&&this.transition_(HC),t},oA.prototype.cancel=function(){XN("cancel",[],arguments);var t=this.state_===QC||this.state_===HC;return t&&this.transition_(YC),t},oA);function oA(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=QC,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(CC.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(JC))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(CC.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(JC))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var aA=(sA.prototype.toString=function(){return XN("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},sA.prototype.newRef=function(t,e){return new sA(t,e)},sA.prototype.mappings=function(){return SN()},sA.prototype.child=function(t){XN("child",[$N()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new yN(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(sA.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new yN(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(sA.prototype,"root",{get:function(){var t=new yN(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(sA.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(sA.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(sA.prototype,"name",{get:function(){return gN(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(sA.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),sA.prototype.put=function(t,e){return void 0===e&&(e=null),XN("put",[new JN(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||sN()&&t instanceof Blob))throw"Expected Blob or File."}),ZN(!0)],arguments),this.throwIfRoot_("put"),new iA(this,this.authWrapper,this.location,this.mappings(),new pN(t),e)},sA.prototype.putString=function(t,e,n){void 0===e&&(e=MC.RAW),XN("putString",[$N(),$N(LC,!0),ZN(!0)],arguments),this.throwIfRoot_("putString");var r=UC(e,t),i=Object.assign({},n);return!tN(i.contentType)&&tN(r.contentType)&&(i.contentType=r.contentType),new iA(this,this.authWrapper,this.location,this.mappings(),new pN(r.data,!0),i)},sA.prototype.delete=function(){var n=this;return XN("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=bN(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new LN(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=jN(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},sA.prototype.listAll=function(){XN("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},sA.prototype.listAllHelper=function(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},sA.prototype.list=function(r){XN("list",[function(t){return new JN(MN,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=bN(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new LN(a,"GET",qN(t),s);return u.urlParams=o,u.errorHandler=BN(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},sA.prototype.getMetadata=function(){var n=this;return XN("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=WN(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},sA.prototype.updateMetadata=function(n){var r=this;return XN("updateMetadata",[ZN()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=bN(e.fullServerUrl()),o=NN(n,r),a=t.maxOperationRetryTime(),s=new LN(i,"PATCH",UN(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=jN(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},sA.prototype.getDownloadURL=function(){var n=this;return XN("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=bN(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new LN(r,"GET",VN(t,n),i);return o.errorHandler=jN(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new SC(CC.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},sA.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new SC(CC.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},sA);function sA(t,e){this.authWrapper=t,this.location=e instanceof yN?e:yN.makeFromUrl(e)}var uA=(cA.prototype.getPromise=function(){return this.promise_},cA.prototype.cancel=function(t){},cA);function cA(t){this.promise_=Promise.reject(t)}var hA=(lA.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},lA.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},lA);function lA(){this.map=new Map,this.id=-9007199254740991}var fA=(pA.extractBucket_=function(t){var e=t[TC]||null;return null==e?null:yN.makeFromBucketSpec(e).bucket},pA.prototype.getAuthToken=function(){return null!==this.app_&&tN(this.app_.INTERNAL)&&tN(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},pA.prototype.bucket=function(){if(this.deleted_)throw OC();return this.bucket_},pA.prototype.service=function(){return this.service_},pA.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},pA.prototype.makeRequest=function(t,e){if(this.deleted_)return new uA(OC());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},pA.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},pA.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},pA.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},pA.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},pA.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},pA);function pA(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;tN(o)&&(this.bucket_=pA.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new hA}var dA=(yA.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());eN(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=AC()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?OC():kC()):i(n=new SC(CC.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new mA(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,[null,t].concat(e)):s()||o?c.call.apply(c,[null,t].concat(e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new mA(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===jC.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new mA(r,t))}else{var i=t.getErrorCode()===jC.ABORT;o(!1,new mA(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},yA.prototype.getPromise=function(){return this.promise_},yA.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},yA.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},yA);function yA(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var mA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function vA(t,e,n){var r=wN(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==il?il.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new dA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var gA=(bA.prototype.ref=function(t){if(XN("ref",[$N(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new aA(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},bA.prototype.refFromURL=function(t){return XN("refFromURL",[$N(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{yN.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new aA(this.authWrapper_,t)},Object.defineProperty(bA.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),bA.prototype.setMaxUploadRetryTime=function(t){XN("setMaxUploadRetryTime",[tA()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},bA.prototype.setMaxOperationRetryTime=function(t){XN("setMaxOperationRetryTime",[tA()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(bA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(bA.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),bA);function bA(t,e,n){if(this.bucket_=null,this.authWrapper_=new fA(t,function(t,e){return new aA(t,e)},vA,this,e),this.app_=t,null!=n)this.bucket_=yN.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new yN(r,""))}this.internals_=new wA(this)}var wA=(_A.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},_A);function _A(t){this.service_=t}var EA;function TA(t,e,n){return new gA(t,new hN,n)}function SA(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function IA(n,r,i){var o,t=new Promise(function(t,e){SA(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function CA(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function NA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return IA(this[n],t,arguments)})})}function AA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function kA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=IA(t,e,n);return r.then(function(t){if(t)return new RA(t,r.request)})}(this[n],t,arguments)})})}function DA(t){this._index=t}function RA(t,e){this._cursor=t,this._request=e}function OA(t){this._store=t}function PA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function xA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new PA(n)}function MA(t){this._db=t}EA={TaskState:$C,TaskEvent:KC,StringFormat:MC,Storage:gA,Reference:aA},il.INTERNAL.registerService("storage",TA,EA,void 0,!0),CA(DA,"_index",["name","keyPath","multiEntry","unique"]),NA(DA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),kA(DA,"_index",IDBIndex,["openCursor","openKeyCursor"]),CA(RA,"_cursor",["direction","key","primaryKey","value"]),NA(RA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(RA.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),SA(e._request).then(function(t){if(t)return new RA(t,e._request)})})})}),OA.prototype.createIndex=function(){return new DA(this._store.createIndex.apply(this._store,arguments))},OA.prototype.index=function(){return new DA(this._store.index.apply(this._store,arguments))},CA(OA,"_store",["name","keyPath","indexNames","autoIncrement"]),NA(OA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),kA(OA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),AA(OA,"_store",IDBObjectStore,["deleteIndex"]),PA.prototype.objectStore=function(){return new OA(this._tx.objectStore.apply(this._tx,arguments))},CA(PA,"_tx",["objectStoreNames","mode"]),AA(PA,"_tx",IDBTransaction,["abort"]),xA.prototype.createObjectStore=function(){return new OA(this._db.createObjectStore.apply(this._db,arguments))},CA(xA,"_db",["name","version","objectStoreNames"]),AA(xA,"_db",IDBDatabase,["deleteObjectStore","close"]),MA.prototype.transaction=function(){return new PA(this._db.transaction.apply(this._db,arguments))},CA(MA,"_db",["name","version","objectStoreNames"]),AA(MA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[OA,DA].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[DA,OA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var LA,FA=1e4,UA="w:0.2.4",qA="FIS_v2",VA="https://firebaseinstallations.googleapis.com/v1",BA=36e5,jA=((LA={})["missing-app-config-values"]="Missing App configuration values.",LA["create-installation-failed"]="Could not register Firebase Installation.",LA["generate-token-failed"]="Could not generate Auth Token.",LA["not-registered"]="Firebase Installation is not registered.",LA["installation-not-found"]="Firebase Installation not found.",LA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',LA["app-offline"]="Could not process request. Application offline.",LA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",LA),WA=new Ai("installations","Installations",jA);function KA(t){return t instanceof Ci&&t.code.includes("request-failed")}function QA(t){if(!t||!t.options)throw WA.create("missing-app-config-values");var e=t.name,n=t.options,r=n.projectId,i=n.apiKey,o=n.appId;if(!(e&&r&&i&&o))throw WA.create("missing-app-config-values");return{appName:e,projectId:r,apiKey:i,appId:o}}function HA(t){var e=t.projectId;return VA+"/projects/"+e+"/installations"}function GA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function zA(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,WA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function YA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function XA(t,e){var n=e.refreshToken,r=YA(t);return r.append("Authorization",function(t){return qA+" "+t}(n)),r}function JA(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function $A(e){return new Promise(function(t){setTimeout(t,e)})}var ZA=/^[cdef][\w-]{21}$/,tk="";function ek(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,hi(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return ZA.test(e)?e:tk}catch(t){return tk}}var nk="firebase-installations-database",rk=1,ik="firebase-installations-store",ok=null;function ak(){return ok=ok||function(t,e,n){var r=IA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new xA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new MA(t)})}(nk,rk,function(t){switch(t.oldVersion){case 0:t.createObjectStore(ik)}})}function sk(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=hk(i),[4,ak()];case 1:return n=t.sent(),[4,(r=n.transaction(ik,"readwrite")).objectStore(ik).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function uk(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return e=hk(i),[4,ak()];case 1:return n=t.sent(),[4,(r=n.transaction(ik,"readwrite")).objectStore(ik).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function ck(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=hk(s),[4,ak()];case 1:return n=t.sent(),r=n.transaction(ik,"readwrite"),[4,(i=r.objectStore(ik)).get(e)];case 2:return o=t.sent(),(a=u(o))===o?[2,a]:void 0!==a?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function hk(t){return t.appName+"!"+t.appId}function lk(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,ck(i,function(t){var e=function(t){var e=t||{fid:ek(),registrationStatus:0};if(pk(e))return{fid:e.fid,registrationStatus:0};return e}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,fk(n)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,$A(100)];case 3:return t.sent(),[4,fk(n)];case 4:return e=t.sent(),[3,2];case 5:if(0===e.registrationStatus)throw WA.create("create-installation-failed");return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(WA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=HA(s),n=YA(s),r={fid:u,authVersion:qA,appId:s.appId,sdkVersion:UA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,JA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:GA(a.authToken)}];case 3:return[4,zA("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,sk(r,e)];case 2:return KA(n=t.sent())&&409===n.serverCode?[4,uk(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,sk(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==tk?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function fk(t){return ck(t,function(t){if(!t)throw WA.create("installation-not-found");return pk(t)?{fid:t.fid,registrationStatus:0}:t})}function pk(t){return 1===t.registrationStatus&&t.registrationTime+FA<Date.now()}function dk(s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return HA(t)+"/"+n+"/authTokens:generate"}(s,u),n=XA(s,u),r={installation:{sdkVersion:UA}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,JA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,GA(a)];case 3:return[4,zA("Generate Auth Token",o)];case 4:throw t.sent()}})})}function yk(i){return ai(this,void 0,void 0,function(){var r,e,n;return si(this,function(t){switch(t.label){case 0:return[4,ck(i,function(t){if(!vk(t))throw WA.create("not-registered");var e=t.authToken;if(function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+BA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,mk(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,$A(100)];case 3:return t.sent(),[4,mk(r)];case 4:return e=t.sent(),[3,2];case 5:if(0===(n=e.authToken).requestStatus)throw WA.create("generate-token-failed");return[2,n]}})})}(i),t;if(!navigator.onLine)throw WA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return oi({},t,{authToken:e})}(t);return r=function(i,o){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,dk(i,o)];case 1:return e=t.sent(),r=oi({},o,{authToken:e}),[4,sk(i,r)];case 2:return t.sent(),[2,e];case 3:return!KA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,uk(i)];case 4:return t.sent(),[3,7];case 5:return r=oi({},o,{authToken:{requestStatus:0}}),[4,sk(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n.token]}})})}function mk(t){return ck(t,function(t){if(!vk(t))throw WA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+FA<Date.now()}(t.authToken)?oi({},t,{authToken:{requestStatus:0}}):t})}function vk(t){return void 0!==t&&2===t.registrationStatus}function gk(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,function(i){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return[4,lk(i)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?[4,r]:[3,3];case 2:return t.sent(),[3,4];case 3:if(2!==n.registrationStatus)throw WA.create("create-installation-failed");t.label=4;case 4:return[2]}})})}(e=QA(n))];case 1:return t.sent(),[2,yk(e)]}})})}function bk(o,a){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return HA(t)+"/"+n}(o,a),n=XA(o,a),r={method:"DELETE",headers:n},[4,JA(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,zA("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}il.INTERNAL.registerService("installations",function(t){return QA(t),{app:t,getId:function(){return function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return[4,lk(e=QA(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)&&i.catch(function(){}),2===r.registrationStatus&&yk(e).catch(function(){}),[2,r.fid]}})})}(t)},getToken:function(){return gk(t)},delete:function(){return function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,ck(e=QA(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw WA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw WA.create("app-offline");case 3:return[4,bk(e,n)];case 4:return t.sent(),[4,uk(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(t)}}});var wk,_k,Ek,Tk,Sk="0.2.15",Ik="FB-PERF-TRACE-MEASURE",Ck="@firebase/performance/config",Nk="@firebase/performance/configexpire",Ak="Performance",kk=((wk={})["trace started"]="Trace {$traceName} was started before.",wk["trace stopped"]="Trace {$traceName} is not running.",wk["no window"]="Window is not available.",wk["no app id"]="App id is not available.",wk["no project id"]="Project id is not available.",wk["no api key"]="Api key is not available.",wk["invalid cc log"]="Attempted to queue invalid cc event",wk["FB not default"]="Performance can only start when Firebase app instance is the default one.",wk["RC response not ok"]="RC response is not ok",wk),Dk=new Ai("performance",Ak,kk),Rk=(Ok.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},Ok.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},Ok.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},Ok.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},Ok.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},Ok.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},Ok.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},Ok.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},Ok.getInstance=function(){return void 0===_k&&(_k=new Ok(Ek)),_k},Ok);function Ok(t){if(!t)throw Dk.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var Pk,xk,Mk,Lk=(Fk.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw Dk.create("no app id");return t},Fk.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw Dk.create("no project id");return t},Fk.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw Dk.create("no api key");return t},Fk.getInstance=function(){return void 0===Tk&&(Tk=new Fk),Tk},Fk);function Fk(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function Uk(){return Pk}function qk(){switch(Rk.getInstance().document.visibilityState){case"visible":return xk.VISIBLE;case"hidden":return xk.HIDDEN;case"prerender":return xk.PRERENDER;default:return xk.UNKNOWN}}(Mk=xk=xk||{})[Mk.UNKNOWN=0]="UNKNOWN",Mk[Mk.VISIBLE=1]="VISIBLE",Mk[Mk.HIDDEN=2]="HIDDEN",Mk[Mk.PRERENDER=3]="PRERENDER",Mk[Mk.UNLOADED=4]="UNLOADED";var Vk=new to(Ak);Vk.logLevel=Yi.INFO;var Bk="0.0.1",jk={loggingEnabled:!0},Wk="FIREBASE_INSTALLATIONS_AUTH";function Kk(t){var e=function(){var t=Rk.getInstance().localStorage,e=t.getItem(Nk);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(Ck);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(Hk(e),Promise.resolve()):function(r){return function(){var t=Lk.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+Lk.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+Lk.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:Wk+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:Lk.getInstance().getAppId(),app_version:Sk,sdk_version:Bk})});return fetch(n).then(function(t){if(t.ok)return t.json();throw Dk.create("RC response not ok")})}).catch(function(){Vk.info(Qk)})}(t).then(function(t){return Hk(t)}).then(function(t){return function(t){if(!t)return;var e=Rk.getInstance().localStorage;e.setItem(Ck,JSON.stringify(t)),e.setItem(Nk,String(Date.now()+60*Lk.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var Qk="Could not fetch config, will use default configs";function Hk(t){if(!t)return t;var e=Lk.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=jk.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=Gk(e.tracesSamplingRate),e.logNetworkAfterSampling=Gk(e.networkRequestsSamplingRate),t}function Gk(t){return Math.random()<=t}var zk,Yk=1;function Xk(){return Yk=2,zk=zk||function(){var n=Rk.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=Lk.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){Pk=t}),t}()}).then(function(t){return Kk(t)}).then(function(){return Jk()},function(){return Jk()})}function Jk(){Yk=3}var $k,Zk=1e4,tD=3,eD=tD,nD=[];function rD(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw Dk.create("invalid cc log");nD=nD.concat([t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function iD(){if($k)return $k;var t=rD(sD);return($k=new to("@firebase/performance/cc")).logHandler=t,$k}function oD(t){var e=Lk.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&Rk.getInstance().requiredApisAvailable()&&(t.isAuto&&qk()!==xk.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===Yk?aD(t):Xk().then(function(){return aD(t)},function(){return aD(t)})))}function aD(t){Uk()&&setTimeout(function(){return iD().log(t,1)},0)}function sD(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:uD(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=cD(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=cD(n));var r={application_info:uD(),trace_metric:e};return JSON.stringify(r)}(t)}function uD(){return{google_app_id:Lk.getInstance().getAppId(),app_instance_id:Uk(),web_app_info:{sdk_version:Sk,page_url:Rk.getInstance().getUrl(),service_worker_status:function(){var t=Rk.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:qk(),effective_connection_type:function(){var t=Rk.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function cD(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==eD){if(!nD.length)return r(Zk);var t=nD.slice();nD=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Lk.getInstance().logSource,log_event:e};fetch(Lk.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||Vk.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?Zk:Math.max(Zk,e);eD=tD,r(n)}).catch(function(){nD=t.concat(nD),eD--,Vk.info("Tries left: "+eD+"."),r(Zk)})}},t)}(5500);var hD=(lD.prototype.start=function(){if(1!==this.state)throw Dk.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},lD.prototype.stop=function(){if(2!==this.state)throw Dk.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),oD(this)},lD.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=oi({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}oD(this)},lD.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&(this.counters[t]=0),this.counters[t]+=e},lD.prototype.putMetric=function(t,e){this.counters[t]=e},lD.prototype.getMetric=function(t){return this.counters[t]||0},lD.prototype.putAttribute=function(t,e){this.customAttributes[t]=e},lD.prototype.getAttribute=function(t){return this.customAttributes[t]},lD.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},lD.prototype.getAttributes=function(){return oi({},this.customAttributes)},lD.prototype.setStartTime=function(t){this.startTimeUs=t},lD.prototype.setDuration=function(t){this.durationUs=t},lD.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},lD.createOobTrace=function(t,e,n){var r=Rk.getInstance().getUrl();if(r){var i=new lD("_wt_"+r,!0),o=Math.floor(1e3*Rk.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.incrementMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.incrementMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.incrementMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.incrementMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.incrementMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.incrementMetric("_fid",Math.floor(1e3*n))}oD(i)}},lD.createUserTimingTrace=function(t){oD(new lD(t,!1,t))},lD);function lD(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=Rk.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||Ik+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function fD(t){var e=t;if(e&&void 0!==e.responseStart){var n=Rk.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=Lk.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return iD().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var pD=5e3;function dD(){Uk()&&(setTimeout(function(){return function(){var t=Rk.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){hD.createOobTrace(e,n),r=void 0},pD);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),hD.createOobTrace(e,n,t))})}else hD.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=Rk.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){fD(r[n])}t.setupObserver("resource",fD)}()},0),setTimeout(function(){return function(){for(var t=Rk.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){yD(r[n])}t.setupObserver("measure",yD)}()},0))}function yD(t){var e=t.name;e.substring(0,Ik.length)!==Ik&&hD.createUserTimingTrace(e)}var mD=(vD.prototype.trace=function(t){return new hD(t)},Object.defineProperty(vD.prototype,"instrumentationEnabled",{get:function(){return Lk.getInstance().instrumentationEnabled},set:function(t){Lk.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(vD.prototype,"dataCollectionEnabled",{get:function(){return Lk.getInstance().dataCollectionEnabled},set:function(t){Lk.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),vD);function vD(t){this.app=t,Rk.getInstance().requiredApisAvailable()?Xk().then(dD,dD):Vk.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}return il.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw Dk.create("FB not default");if("undefined"==typeof window)throw Dk.create("no window");return function(t){Ek=t}(window),Lk.getInstance().firebaseAppInstance=t,new mD(t)},{}),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),il});
//# sourceMappingURL=firebase.js.map
